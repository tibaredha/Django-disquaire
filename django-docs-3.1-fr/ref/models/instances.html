
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="fr">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Référence des instances de modèles &#8212; Documentation Django 3.1.3.dev</title>
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../_static/translations.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Recherche" href="../../search.html" />
    <link rel="next" title="Référence de l’API QuerySet" href="querysets.html" />
    <link rel="prev" title="Options Meta des modèles" href="options.html" />



 
<script src="../../templatebuiltins.js"></script>
<script>
(function($) {
    if (!django_template_builtins) {
       // templatebuiltins.js missing, do nothing.
       return;
    }
    $(document).ready(function() {
        // Hyperlink Django template tags and filters
        var base = "../templates/builtins.html";
        if (base == "#") {
            // Special case for builtins.html itself
            base = "";
        }
        // Tags are keywords, class '.k'
        $("div.highlight\\-html\\+django span.k").each(function(i, elem) {
             var tagname = $(elem).text();
             if ($.inArray(tagname, django_template_builtins.ttags) != -1) {
                 var fragment = tagname.replace(/_/, '-');
                 $(elem).html("<a href='" + base + "#" + fragment + "'>" + tagname + "</a>");
             }
        });
        // Filters are functions, class '.nf'
        $("div.highlight\\-html\\+django span.nf").each(function(i, elem) {
             var filtername = $(elem).text();
             if ($.inArray(filtername, django_template_builtins.tfilters) != -1) {
                 var fragment = filtername.replace(/_/, '-');
                 $(elem).html("<a href='" + base + "#" + fragment + "'>" + filtername + "</a>");
             }
        });
    });
})(jQuery);</script>

  </head><body>

    <div class="document">
  <div id="custom-doc" class="yui-t6">
    <div id="hd">
      <h1><a href="../../index.html">Documentation Django 3.1.3.dev</a></h1>
      <div id="global-nav">
        <a title="Home page" href="../../index.html">Home</a>  |
        <a title="Table of contents" href="../../contents.html">Table of contents</a>  |
        <a title="Global index" href="../../genindex.html">Index</a>  |
        <a title="Module index" href="../../py-modindex.html">Modules</a>
      </div>
      <div class="nav">
    &laquo; <a href="options.html" title="Options &lt;code class=&#34;docutils literal notranslate&#34;&gt;&lt;span class=&#34;pre&#34;&gt;Meta&lt;/span&gt;&lt;/code&gt; des modèles">previous</a>
     |
    <a href="../index.html" title="Référence de l’API" accesskey="U">up</a>
   |
    <a href="querysets.html" title="Référence de l’API &lt;code class=&#34;docutils literal notranslate&#34;&gt;&lt;span class=&#34;pre&#34;&gt;QuerySet&lt;/span&gt;&lt;/code&gt;">next</a> &raquo;</div>
    </div>

    <div id="bd">
      <div id="yui-main">
        <div class="yui-b">
          <div class="yui-g" id="ref-models-instances">
            
  <div class="section" id="s-model-instance-reference">
<span id="model-instance-reference"></span><h1>Référence des instances de modèles<a class="headerlink" href="#model-instance-reference" title="Lien permanent vers ce titre">¶</a></h1>
<p>Ce document détaille l’API des objets <code class="docutils literal notranslate"><span class="pre">Model</span></code>. Il augmente les contenus présentés dans les guides des <a class="reference internal" href="../../topics/db/models.html"><span class="doc">modèles</span></a> et des <a class="reference internal" href="../../topics/db/queries.html"><span class="doc">requêtes de base de données</span></a>, il est donc conseillé de lire et de comprendre ces derniers avant de lire celui-ci.</p>
<p>Tout au long de cette référence, nous utiliserons les <a class="reference internal" href="../../topics/db/queries.html#queryset-model-example"><span class="std std-ref">modèles d’exemple Weblog</span></a> présentés dans le <a class="reference internal" href="../../topics/db/queries.html"><span class="doc">guide des requêtes de base de données</span></a>.</p>
<div class="section" id="s-creating-objects">
<span id="creating-objects"></span><h2>Création d’objets<a class="headerlink" href="#creating-objects" title="Lien permanent vers ce titre">¶</a></h2>
<p>Pour créer une nouvelle instance d’un modèle, instanciez-la comme n’importe quelle autre classe Python&nbsp;:</p>
<dl class="class">
<dt id="django.db.models.Model">
<em class="property">class </em><code class="descname">Model</code>(<em>**kwargs</em>)<a class="headerlink" href="#django.db.models.Model" title="Lien permanent vers cette définition">¶</a></dt>
<dd></dd></dl>

<p>Les paramètres nommés sont les noms des champs définis dans le modèle. Notez que l’instanciation d’un modèle ne touche pas à la base de données&nbsp;; pour cela, il faut enregistrer avec <a class="reference internal" href="#django.db.models.Model.save" title="django.db.models.Model.save"><code class="xref py py-meth docutils literal notranslate"><span class="pre">save()</span></code></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Vous pourriez être tenté de personnaliser le modèle en surchargeant sa méthode <code class="docutils literal notranslate"><span class="pre">__init__</span></code>. Cependant, si vous faites cela, prenez soin de ne pas modifier la signature de la méthode car tout changement pourrait bloquer l’enregistrement de l’instance de modèle. Plutôt que de surcharger <code class="docutils literal notranslate"><span class="pre">__init__</span></code>, essayer d’utiliser l’une de ces approches&nbsp;:</p>
<ol class="last arabic">
<li><p class="first">Ajouter une méthode <code class="docutils literal notranslate"><span class="pre">classmethod</span></code> sur la classe du modèle&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="k">import</span> <span class="n">models</span>

<span class="k">class</span> <span class="nc">Book</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">create</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
        <span class="n">book</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
        <span class="c1"># do something with the book</span>
        <span class="k">return</span> <span class="n">book</span>

<span class="n">book</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="s2">&quot;Pride and Prejudice&quot;</span><span class="p">)</span>
</pre></div>
</div>
</li>
<li><p class="first">Ajouter une méthode dans un gestionnaire personnalisé (souvent plus judicieux)&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">BookManager</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Manager</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">create_book</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
        <span class="n">book</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
        <span class="c1"># do something with the book</span>
        <span class="k">return</span> <span class="n">book</span>

<span class="k">class</span> <span class="nc">Book</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">title</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

    <span class="n">objects</span> <span class="o">=</span> <span class="n">BookManager</span><span class="p">()</span>

<span class="n">book</span> <span class="o">=</span> <span class="n">Book</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_book</span><span class="p">(</span><span class="s2">&quot;Pride and Prejudice&quot;</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ol>
</div>
<div class="section" id="s-customizing-model-loading">
<span id="customizing-model-loading"></span><h3>Personnalisation du chargement des modèles<a class="headerlink" href="#customizing-model-loading" title="Lien permanent vers ce titre">¶</a></h3>
<dl class="classmethod">
<dt id="django.db.models.Model.from_db">
<em class="property">classmethod </em><code class="descclassname">Model.</code><code class="descname">from_db</code>(<em>db</em>, <em>field_names</em>, <em>values</em>)<a class="headerlink" href="#django.db.models.Model.from_db" title="Lien permanent vers cette définition">¶</a></dt>
<dd></dd></dl>

<p>La méthode <code class="docutils literal notranslate"><span class="pre">from_db()</span></code> peut être utilisée pour personnaliser la création des instances de modèles lors de leur chargement à partir de la base de données.</p>
<p>Le paramètre <code class="docutils literal notranslate"><span class="pre">db</span></code> contient l’alias de la base de données à partir de laquelle le modèle est chargé, <code class="docutils literal notranslate"><span class="pre">field_names</span></code> contient les noms de tous les champs chargés et <code class="docutils literal notranslate"><span class="pre">values</span></code> contient les valeurs chargées pour chaque champ de <code class="docutils literal notranslate"><span class="pre">field_names</span></code>. L’ordre des champs dans <code class="docutils literal notranslate"><span class="pre">field_names</span></code> est le même que dans <code class="docutils literal notranslate"><span class="pre">values</span></code>. Si tous les champs du modèle sont présents, <code class="docutils literal notranslate"><span class="pre">values</span></code> est toujours dans l’ordre attendu par <code class="docutils literal notranslate"><span class="pre">__init__()</span></code>. Cela signifie que l’instance peut être créée par <code class="docutils literal notranslate"><span class="pre">cls(*values)</span></code>. Si certains champs sont différés, ils n’apparaissent pas dans <code class="docutils literal notranslate"><span class="pre">field_names</span></code>. Dans ce cas, attribuez une valeur <code class="docutils literal notranslate"><span class="pre">django.db.models.DEFERRED</span></code> à chacun des champs manquants.</p>
<p>En plus de créer le nouveau modèle, la méthode <code class="docutils literal notranslate"><span class="pre">from_db()</span></code> doit définir les drapeaux <code class="docutils literal notranslate"><span class="pre">adding</span></code> et <code class="docutils literal notranslate"><span class="pre">db</span></code> de l’attribut <a class="reference internal" href="#django.db.models.Model._state" title="django.db.models.Model._state"><code class="xref py py-attr docutils literal notranslate"><span class="pre">_state</span></code></a>  de la nouvelle instance.</p>
<p>Dans l’exemple ci-dessous, on voit comment mémoriser les valeurs des champs telles que chargées à partir de la base de données&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db.models</span> <span class="k">import</span> <span class="n">DEFERRED</span>

<span class="nd">@classmethod</span>
<span class="k">def</span> <span class="nf">from_db</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">db</span><span class="p">,</span> <span class="n">field_names</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
    <span class="c1"># Default implementation of from_db() (subject to change and could</span>
    <span class="c1"># be replaced with super()).</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">concrete_fields</span><span class="p">):</span>
        <span class="n">values</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">values</span><span class="p">)</span>
        <span class="n">values</span><span class="o">.</span><span class="n">reverse</span><span class="p">()</span>
        <span class="n">values</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">values</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">attname</span> <span class="ow">in</span> <span class="n">field_names</span> <span class="k">else</span> <span class="n">DEFERRED</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">concrete_fields</span>
        <span class="p">]</span>
    <span class="n">instance</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="o">*</span><span class="n">values</span><span class="p">)</span>
    <span class="n">instance</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">adding</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">instance</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">db</span> <span class="o">=</span> <span class="n">db</span>
    <span class="c1"># customization to store the original field values on the instance</span>
    <span class="n">instance</span><span class="o">.</span><span class="n">_loaded_values</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">field_names</span><span class="p">,</span> <span class="n">values</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">instance</span>

<span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="c1"># Check how the current values differ from ._loaded_values. For example,</span>
    <span class="c1"># prevent changing the creator_id of the model. (This example doesn&#39;t</span>
    <span class="c1"># support cases where &#39;creator_id&#39; is deferred).</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_state</span><span class="o">.</span><span class="n">adding</span> <span class="ow">and</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">creator_id</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_loaded_values</span><span class="p">[</span><span class="s1">&#39;creator_id&#39;</span><span class="p">]):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Updating the value of creator isn&#39;t allowed&quot;</span><span class="p">)</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
<p>L’exemple ci-dessus montre une implémentation complète de <code class="docutils literal notranslate"><span class="pre">from_db()</span></code> pour clarifier son fonctionnement. Dans ce cas, il aurait été possible de faire appel à <code class="docutils literal notranslate"><span class="pre">super()</span></code> dans la méthode <code class="docutils literal notranslate"><span class="pre">from_db()</span></code>.</p>
</div>
</div>
<div class="section" id="s-refreshing-objects-from-database">
<span id="refreshing-objects-from-database"></span><h2>Actualisation des objets à partir de la base de données<a class="headerlink" href="#refreshing-objects-from-database" title="Lien permanent vers ce titre">¶</a></h2>
<p>Si vous supprimez un champ à partir d’une instance de modèle, un nouvel accès va recharger la valeur de la base de données&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">obj</span> <span class="o">=</span> <span class="n">MyModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">del</span> <span class="n">obj</span><span class="o">.</span><span class="n">field</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">obj</span><span class="o">.</span><span class="n">field</span>  <span class="c1"># Loads the field from the database</span>
</pre></div>
</div>
<dl class="method">
<dt id="django.db.models.Model.refresh_from_db">
<code class="descclassname">Model.</code><code class="descname">refresh_from_db</code>(<em>using=None</em>, <em>fields=None</em>)<a class="headerlink" href="#django.db.models.Model.refresh_from_db" title="Lien permanent vers cette définition">¶</a></dt>
<dd></dd></dl>

<p>Si vous avez besoin de recharger les valeurs d’un modèle à partir de la base de données, vous pouvez utiliser la méthode <code class="docutils literal notranslate"><span class="pre">refresh_from_db()</span></code>. Lorsque cette méthode est appelée sans paramètre, voici ce qui se passe&nbsp;:</p>
<ol class="arabic simple">
<li>Tous les champs non différés du modèle sont mis à jour avec les valeurs actuellement présentes en base de données.</li>
<li>Toutes les relations en cache sont effacées de l’instance rechargée.</li>
</ol>
<p>Seuls les champs du modèle sont rechargés à partir de la base de données. D’autres valeurs dépendantes de la base de données telles que les annotations ne sont pas rechargées. Tout attribut <a class="reference internal" href="../utils.html#django.utils.functional.cached_property" title="django.utils.functional.cached_property"><code class="xref py py-func docutils literal notranslate"><span class="pre">&#64;cached_property</span></code></a> n’est pas non plus réinitialisé.</p>
<p>Le rechargement s’opère à partir de la base de données à l’origine des valeurs existantes, ou de la base de données par défaut si l’instance n’a pas été chargée à partir de la base de données. Le paramètre <code class="docutils literal notranslate"><span class="pre">using</span></code> peut être utilisé pour forcer la base de données source du rechargement.</p>
<p>Il est possible de forcer le groupe de champs à recharger en utilisant le paramètre <code class="docutils literal notranslate"><span class="pre">fields</span></code>.</p>
<p>Par exemple, pour tester qu’un appel à <code class="docutils literal notranslate"><span class="pre">update()</span></code> a effectivement produit le résultat attendu, vous pourriez écrire un test semblable à celui-ci&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">test_update_result</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="n">MyModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">val</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">MyModel</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">pk</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">pk</span><span class="p">)</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">val</span><span class="o">=</span><span class="n">F</span><span class="p">(</span><span class="s1">&#39;val&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="c1"># At this point obj.val is still 1, but the value in the database</span>
    <span class="c1"># was updated to 2. The object&#39;s updated value needs to be reloaded</span>
    <span class="c1"># from the database.</span>
    <span class="n">obj</span><span class="o">.</span><span class="n">refresh_from_db</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">assertEqual</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">val</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>Notez que quand on accède à des champs différés, le chargement de la valeur différée du champ s’effectue avec cette méthode. Il est donc possible de personnaliser la manière de charger les données différées. L’exemple ci-dessous montre comment l’on peut recharger tous les champs d’une instance lorsqu’un champ différé est rechargé&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">ExampleModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">refresh_from_db</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">using</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fields</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># fields contains the name of the deferred field to be</span>
        <span class="c1"># loaded.</span>
        <span class="k">if</span> <span class="n">fields</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
            <span class="n">deferred_fields</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_deferred_fields</span><span class="p">()</span>
            <span class="c1"># If any deferred field is going to be loaded</span>
            <span class="k">if</span> <span class="n">fields</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">deferred_fields</span><span class="p">):</span>
                <span class="c1"># then load all of them</span>
                <span class="n">fields</span> <span class="o">=</span> <span class="n">fields</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">deferred_fields</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">refresh_from_db</span><span class="p">(</span><span class="n">using</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
<dl class="method">
<dt id="django.db.models.Model.get_deferred_fields">
<code class="descclassname">Model.</code><code class="descname">get_deferred_fields</code>()<a class="headerlink" href="#django.db.models.Model.get_deferred_fields" title="Lien permanent vers cette définition">¶</a></dt>
<dd></dd></dl>

<p>Une méthode utilitaire renvoyant un ensemble contenant les noms d’attributs de tous les champs d’un modèle qui sont actuellement différés.</p>
</div>
<div class="section" id="s-validating-objects">
<span id="s-id1"></span><span id="validating-objects"></span><span id="id1"></span><h2>Validation d’objets<a class="headerlink" href="#validating-objects" title="Lien permanent vers ce titre">¶</a></h2>
<p>La validation d’un modèle se déroule en trois étapes&nbsp;:</p>
<ol class="arabic simple">
<li>Validation des champs de modèle - <a class="reference internal" href="#django.db.models.Model.clean_fields" title="django.db.models.Model.clean_fields"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Model.clean_fields()</span></code></a></li>
<li>Validation du modèle en entier - <a class="reference internal" href="#django.db.models.Model.clean" title="django.db.models.Model.clean"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Model.clean()</span></code></a></li>
<li>Validation de l’unicité des champs - <a class="reference internal" href="#django.db.models.Model.validate_unique" title="django.db.models.Model.validate_unique"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Model.validate_unique()</span></code></a></li>
</ol>
<p>Les trois étapes sont effectuées lorsque la méthode <a class="reference internal" href="#django.db.models.Model.full_clean" title="django.db.models.Model.full_clean"><code class="xref py py-meth docutils literal notranslate"><span class="pre">full_clean()</span></code></a> d’un modèle est appelée.</p>
<p>Lors de l’utilisation d’un formulaire <a class="reference internal" href="../../topics/forms/modelforms.html#django.forms.ModelForm" title="django.forms.ModelForm"><code class="xref py py-class docutils literal notranslate"><span class="pre">ModelForm</span></code></a>, l’appel à <a class="reference internal" href="../forms/api.html#django.forms.Form.is_valid" title="django.forms.Form.is_valid"><code class="xref py py-meth docutils literal notranslate"><span class="pre">is_valid()</span></code></a> effectue ces étapes de validation pour tous les champs inclus dans le formulaire. Consultez la <a class="reference internal" href="../../topics/forms/modelforms.html"><span class="doc">documentation de ModelForm</span></a> pour plus d’informations. L’appel à la méthode <a class="reference internal" href="#django.db.models.Model.full_clean" title="django.db.models.Model.full_clean"><code class="xref py py-meth docutils literal notranslate"><span class="pre">full_clean()</span></code></a> d’un modèle ne devrait être nécessaire que lorsque l’on souhaite s’occuper soi-même des erreurs de validation ou si des champs ont été exclu du <a class="reference internal" href="../../topics/forms/modelforms.html#django.forms.ModelForm" title="django.forms.ModelForm"><code class="xref py py-class docutils literal notranslate"><span class="pre">ModelForm</span></code></a> et qu’ils nécessitent une validation.</p>
<dl class="method">
<dt id="django.db.models.Model.full_clean">
<code class="descclassname">Model.</code><code class="descname">full_clean</code>(<em>exclude=None</em>, <em>validate_unique=True</em>)<a class="headerlink" href="#django.db.models.Model.full_clean" title="Lien permanent vers cette définition">¶</a></dt>
<dd></dd></dl>

<p>Cette méthode appelle <a class="reference internal" href="#django.db.models.Model.clean_fields" title="django.db.models.Model.clean_fields"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Model.clean_fields()</span></code></a>, <a class="reference internal" href="#django.db.models.Model.clean" title="django.db.models.Model.clean"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Model.clean()</span></code></a> et <a class="reference internal" href="#django.db.models.Model.validate_unique" title="django.db.models.Model.validate_unique"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Model.validate_unique()</span></code></a> (si <code class="docutils literal notranslate"><span class="pre">validate_unique</span></code> vaut <code class="docutils literal notranslate"><span class="pre">True</span></code>), dans cet ordre et peut générer une exception  <a class="reference internal" href="../exceptions.html#django.core.exceptions.ValidationError" title="django.core.exceptions.ValidationError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ValidationError</span></code></a> avec un attribut <code class="docutils literal notranslate"><span class="pre">message_dict</span></code> contenant les erreurs produites par les trois méthodes.</p>
<p>Le paramètre facultatif <code class="docutils literal notranslate"><span class="pre">exclude</span></code> peut être utilisé pour fournir une liste de noms de champs qui peuvent être exclus de la validation et du nettoyage. <a class="reference internal" href="../../topics/forms/modelforms.html#django.forms.ModelForm" title="django.forms.ModelForm"><code class="xref py py-class docutils literal notranslate"><span class="pre">ModelForm</span></code></a> utilise ce paramètre pour exclure de la validation les champs qui sont absents du formulaire, car d’éventuelles erreurs ne pourraient pas être corrigées par l’utilisateur.</p>
<p>Notez que <code class="docutils literal notranslate"><span class="pre">full_clean()</span></code> ne sera <em>pas</em> appelée automatiquement lorsque vous appelez la méthode <a class="reference internal" href="#django.db.models.Model.save" title="django.db.models.Model.save"><code class="xref py py-meth docutils literal notranslate"><span class="pre">save()</span></code></a> d’un modèle. Il faut l’appeler manuellement au moment où vous souhaitez effectuer la validation de modèle pour vos propres modèles. Par exemple&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.core.exceptions</span> <span class="k">import</span> <span class="n">ValidationError</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">article</span><span class="o">.</span><span class="n">full_clean</span><span class="p">()</span>
<span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="c1"># Do something based on the errors contained in e.message_dict.</span>
    <span class="c1"># Display them to a user, or handle them programmatically.</span>
    <span class="k">pass</span>
</pre></div>
</div>
<p>La première chose que fait <code class="docutils literal notranslate"><span class="pre">full_clean()</span></code> est de procéder au nettoyage de chaque champ individuellement.</p>
<dl class="method">
<dt id="django.db.models.Model.clean_fields">
<code class="descclassname">Model.</code><code class="descname">clean_fields</code>(<em>exclude=None</em>)<a class="headerlink" href="#django.db.models.Model.clean_fields" title="Lien permanent vers cette définition">¶</a></dt>
<dd></dd></dl>

<p>Cette méthode valide tous les champs du modèle. Le paramètre facultatif <code class="docutils literal notranslate"><span class="pre">exclude</span></code> peut être utilisé pour fournir une liste de noms de champs à exclure de la validation. Une exception <a class="reference internal" href="../exceptions.html#django.core.exceptions.ValidationError" title="django.core.exceptions.ValidationError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ValidationError</span></code></a> est générée pour chaque champ dont la validation échoue.</p>
<p>La deuxième chose que fait <code class="docutils literal notranslate"><span class="pre">full_clean()</span></code> est d’appeler <a class="reference internal" href="#django.db.models.Model.clean" title="django.db.models.Model.clean"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Model.clean()</span></code></a>. Cette méthode peut être surchargée pour effectuer une validation personnalisée du modèle.</p>
<dl class="method">
<dt id="django.db.models.Model.clean">
<code class="descclassname">Model.</code><code class="descname">clean</code>()<a class="headerlink" href="#django.db.models.Model.clean" title="Lien permanent vers cette définition">¶</a></dt>
<dd></dd></dl>

<p>C’est cette méthode qui devrait être utilisée pour fournir une validation de modèle personnalisée et pour modifier des attributs du modèle, le cas échéant. Par exemple, on pourrait profiter de cette méthode pour attribuer une valeur automatique à un champ ou pour procéder à une validation qui nécessite de pouvoir accéder à d’autres champs du modèle&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">from</span> <span class="nn">django.core.exceptions</span> <span class="k">import</span> <span class="n">ValidationError</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="k">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="k">import</span> <span class="n">gettext_lazy</span> <span class="k">as</span> <span class="n">_</span>

<span class="k">class</span> <span class="nc">Article</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="k">def</span> <span class="nf">clean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Don&#39;t allow draft entries to have a pub_date.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s1">&#39;draft&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;Draft entries may not have a publication date.&#39;</span><span class="p">))</span>
        <span class="c1"># Set the pub_date for published items if it hasn&#39;t been set already.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s1">&#39;published&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_date</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">pub_date</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>
</pre></div>
</div>
<p>Notez cependant que comme pour <a class="reference internal" href="#django.db.models.Model.full_clean" title="django.db.models.Model.full_clean"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Model.full_clean()</span></code></a>, la méthode <code class="docutils literal notranslate"><span class="pre">clean()</span></code> d’un modèle n’est pas invoquée lors d’un appel à la méthode <a class="reference internal" href="#django.db.models.Model.save" title="django.db.models.Model.save"><code class="xref py py-meth docutils literal notranslate"><span class="pre">save()</span></code></a> du modèle.</p>
<p>Dans l’exemple ci-dessus, l’exception <a class="reference internal" href="../exceptions.html#django.core.exceptions.ValidationError" title="django.core.exceptions.ValidationError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ValidationError</span></code></a> générée par <code class="docutils literal notranslate"><span class="pre">Model.clean()</span></code> a été créée en lui passant une chaîne, elle sera donc stockée dans une clé particulière d’un dictionnaire d’erreurs, <a class="reference internal" href="../exceptions.html#django.core.exceptions.NON_FIELD_ERRORS" title="django.core.exceptions.NON_FIELD_ERRORS"><code class="xref py py-data docutils literal notranslate"><span class="pre">NON_FIELD_ERRORS</span></code></a>. Cette clé est réservée aux erreurs liées au modèle dans son entier plutôt qu’à un champ spécifique&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.core.exceptions</span> <span class="k">import</span> <span class="n">NON_FIELD_ERRORS</span><span class="p">,</span> <span class="n">ValidationError</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">article</span><span class="o">.</span><span class="n">full_clean</span><span class="p">()</span>
<span class="k">except</span> <span class="n">ValidationError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="n">non_field_errors</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">message_dict</span><span class="p">[</span><span class="n">NON_FIELD_ERRORS</span><span class="p">]</span>
</pre></div>
</div>
<p>Pour attribuer une exception à un champ particulier, créez une instance de <a class="reference internal" href="../exceptions.html#django.core.exceptions.ValidationError" title="django.core.exceptions.ValidationError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ValidationError</span></code></a> avec un dictionnaire dont les clés correspondent aux noms de champs. Nous pourrions mettre à jour l’exemple précédent en attribuant l’erreur au champ <code class="docutils literal notranslate"><span class="pre">pub_date</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Article</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="k">def</span> <span class="nf">clean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Don&#39;t allow draft entries to have a pub_date.</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s1">&#39;draft&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">({</span><span class="s1">&#39;pub_date&#39;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Draft entries may not have a publication date.&#39;</span><span class="p">)})</span>
        <span class="o">...</span>
</pre></div>
</div>
<p>Si vous détectez des erreurs dans plusieurs champs pendant <code class="docutils literal notranslate"><span class="pre">Model.clean()</span></code>, il est aussi possible de passer un dictionnaire faisant correspondre des noms de champs aux erreurs&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">raise</span> <span class="n">ValidationError</span><span class="p">({</span>
    <span class="s1">&#39;title&#39;</span><span class="p">:</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;Missing title.&#39;</span><span class="p">),</span> <span class="n">code</span><span class="o">=</span><span class="s1">&#39;required&#39;</span><span class="p">),</span>
    <span class="s1">&#39;pub_date&#39;</span><span class="p">:</span> <span class="n">ValidationError</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;Invalid date.&#39;</span><span class="p">),</span> <span class="n">code</span><span class="o">=</span><span class="s1">&#39;invalid&#39;</span><span class="p">),</span>
<span class="p">})</span>
</pre></div>
</div>
<p>Finalement, <code class="docutils literal notranslate"><span class="pre">full_clean()</span></code> vérifie les contraintes d’unicité éventuelles du modèle.</p>
<div class="admonition-how-to-raise-field-specific-validation-errors-if-those-fields-don-t-appear-in-a-modelform admonition">
<p class="first admonition-title">Comment générer des erreurs de validation spécifiques à certains champs si ceux-ci n’apparaissent pas dans un <code class="docutils literal notranslate"><span class="pre">ModelForm</span></code></p>
<p>Il n’est pas possible de générer des erreurs de validation dans <code class="docutils literal notranslate"><span class="pre">Model.clean()</span></code> pour des champs qui n’apparaissent pas dans un formulaire de modèle (un formulaire peut limiter ses champs à l’aide des attributs <code class="docutils literal notranslate"><span class="pre">Meta.fields</span></code> ou <code class="docutils literal notranslate"><span class="pre">Meta.exclude</span></code>). Si vous essayez, vous obtiendrez une exception <code class="docutils literal notranslate"><span class="pre">ValueError</span></code> car l’erreur de validation ne pourra pas être associée au champ absent du formulaire.</p>
<p>Pour contourner ce problème, il est possible de surcharger <a class="reference internal" href="#django.db.models.Model.clean_fields" title="django.db.models.Model.clean_fields"><code class="xref py py-meth docutils literal notranslate"><span class="pre">Model.clean_fields()</span></code></a> car elle reçoit la liste des champs qui sont exclus de la validation. Par exemple</p>
<div class="last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Article</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="o">...</span>
    <span class="k">def</span> <span class="nf">clean_fields</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exclude</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">clean_fields</span><span class="p">(</span><span class="n">exclude</span><span class="o">=</span><span class="n">exclude</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">status</span> <span class="o">==</span> <span class="s1">&#39;draft&#39;</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">pub_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">exclude</span> <span class="ow">and</span> <span class="s1">&#39;status&#39;</span> <span class="ow">in</span> <span class="n">exclude</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span>
                    <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Draft entries may not have a publication date.&#39;</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">({</span>
                    <span class="s1">&#39;status&#39;</span><span class="p">:</span> <span class="n">_</span><span class="p">(</span>
                        <span class="s1">&#39;Set status to draft if there is not a &#39;</span>
                        <span class="s1">&#39;publication date.&#39;</span>
                     <span class="p">),</span>
                <span class="p">})</span>
</pre></div>
</div>
</div>
<dl class="method">
<dt id="django.db.models.Model.validate_unique">
<code class="descclassname">Model.</code><code class="descname">validate_unique</code>(<em>exclude=None</em>)<a class="headerlink" href="#django.db.models.Model.validate_unique" title="Lien permanent vers cette définition">¶</a></dt>
<dd></dd></dl>

<p>Cette méthode est semblable à <a class="reference internal" href="#django.db.models.Model.clean_fields" title="django.db.models.Model.clean_fields"><code class="xref py py-meth docutils literal notranslate"><span class="pre">clean_fields()</span></code></a>, mais elle valide toutes les contraintes d’unicité du modèle au lieu des valeurs de champs individuelles. Le paramètre facultatif <code class="docutils literal notranslate"><span class="pre">exclude</span></code> peut être utilisé pour fournir une liste de noms de champs à exclure de la validation. Une exception <a class="reference internal" href="../exceptions.html#django.core.exceptions.ValidationError" title="django.core.exceptions.ValidationError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ValidationError</span></code></a> est générée pour chaque champ dont la validation échoue.</p>
<p>Notez que si vous renseignez le paramètre <code class="docutils literal notranslate"><span class="pre">exclude</span></code> de <code class="docutils literal notranslate"><span class="pre">validate_unique()</span></code>, les contraintes <a class="reference internal" href="options.html#django.db.models.Options.unique_together" title="django.db.models.Options.unique_together"><code class="xref py py-attr docutils literal notranslate"><span class="pre">unique_together</span></code></a> impliquant l’un des champs de la liste ne seront pas contrôlées.</p>
</div>
<div class="section" id="s-saving-objects">
<span id="saving-objects"></span><h2>Enregistrement d’objets<a class="headerlink" href="#saving-objects" title="Lien permanent vers ce titre">¶</a></h2>
<p>Pour enregistrer un objet dans la base de données, appelez <code class="docutils literal notranslate"><span class="pre">save()</span></code>:</p>
<dl class="method">
<dt id="django.db.models.Model.save">
<code class="descclassname">Model.</code><code class="descname">save</code>(<em>force_insert=False</em>, <em>force_update=False</em>, <em>using=DEFAULT_DB_ALIAS</em>, <em>update_fields=None</em>)<a class="headerlink" href="#django.db.models.Model.save" title="Lien permanent vers cette définition">¶</a></dt>
<dd></dd></dl>

<p>Si vous souhaitez personnaliser le comportement d’enregistrement, vous pouvez surcharger cette méthode <code class="docutils literal notranslate"><span class="pre">save()</span></code>. Voir <a class="reference internal" href="../../topics/db/models.html#overriding-model-methods"><span class="std std-ref">Surcharge des méthodes de modèles prédéfinies</span></a> pour plus de détails.</p>
<p>Le processus d’enregistrement des modèles comporte également certaines subtilités&nbsp;; voir les sections ci-dessous.</p>
<div class="section" id="s-auto-incrementing-primary-keys">
<span id="auto-incrementing-primary-keys"></span><h3>Incrémentation automatique des clés primaires<a class="headerlink" href="#auto-incrementing-primary-keys" title="Lien permanent vers ce titre">¶</a></h3>
<p>Si un modèle contient un champ <a class="reference internal" href="fields.html#django.db.models.AutoField" title="django.db.models.AutoField"><code class="xref py py-class docutils literal notranslate"><span class="pre">AutoField</span></code></a> – une clé primaire avec incrémentation automatique – la valeur incrémentée automatiquement sera calculée et enregistrée comme attribut de l’objet lors de son premier enregistrement avec <code class="docutils literal notranslate"><span class="pre">save()</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">b2</span> <span class="o">=</span> <span class="n">Blog</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Cheddar Talk&#39;</span><span class="p">,</span> <span class="n">tagline</span><span class="o">=</span><span class="s1">&#39;Thoughts on cheese.&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b2</span><span class="o">.</span><span class="n">id</span>     <span class="c1"># Returns None, because b2 doesn&#39;t have an ID yet.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b2</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b2</span><span class="o">.</span><span class="n">id</span>     <span class="c1"># Returns the ID of your new object.</span>
</pre></div>
</div>
<p>Il n’est pas possible de connaître la valeur future de l’identifiant avant d’appeler <code class="docutils literal notranslate"><span class="pre">save()</span></code>, car cette valeur est calculée par la base de données, et non par Django.</p>
<p>Par commodité, chaque modèle possède par défaut un champ <a class="reference internal" href="fields.html#django.db.models.AutoField" title="django.db.models.AutoField"><code class="xref py py-class docutils literal notranslate"><span class="pre">AutoField</span></code></a> nommé <code class="docutils literal notranslate"><span class="pre">id</span></code>, sauf dans le cas où vous ajoutez explicitement le paramètre <code class="docutils literal notranslate"><span class="pre">primary_key=True</span></code> à l’un des champs du modèle. Consultez la documentation de <a class="reference internal" href="fields.html#django.db.models.AutoField" title="django.db.models.AutoField"><code class="xref py py-class docutils literal notranslate"><span class="pre">AutoField</span></code></a> pour plus de détails.</p>
<div class="section" id="s-the-pk-property">
<span id="the-pk-property"></span><h4>La propriété <code class="docutils literal notranslate"><span class="pre">pk</span></code><a class="headerlink" href="#the-pk-property" title="Lien permanent vers ce titre">¶</a></h4>
<dl class="attribute">
<dt id="django.db.models.Model.pk">
<code class="descclassname">Model.</code><code class="descname">pk</code><a class="headerlink" href="#django.db.models.Model.pk" title="Lien permanent vers cette définition">¶</a></dt>
<dd></dd></dl>

<p>Que vous définissiez vous-même un champ de clé primaire ou que vous laissiez Django s’en charger, chaque modèle possède une propriété nommée <code class="docutils literal notranslate"><span class="pre">pk</span></code>. Elle se comporte comme un attribut normal du modèle, mais représente en réalité un alias vers l’attribut du modèle qui a la fonction de clé primaire. Vous pouvez lire et définir cette valeur, comme vous le feriez pour tout autre attribut, et l’action s’applique au bon champ du modèle, c’est-à-dire à la clé primaire.</p>
</div>
<div class="section" id="s-explicitly-specifying-auto-primary-key-values">
<span id="explicitly-specifying-auto-primary-key-values"></span><h4>Définition explicite des valeurs de clés primaires<a class="headerlink" href="#explicitly-specifying-auto-primary-key-values" title="Lien permanent vers ce titre">¶</a></h4>
<p>Si un modèle contient un champ <a class="reference internal" href="fields.html#django.db.models.AutoField" title="django.db.models.AutoField"><code class="xref py py-class docutils literal notranslate"><span class="pre">AutoField</span></code></a> mais que vous souhaiteriez définir explicitement l’identifiant d’un nouvel objet lors de son enregistrement, définissez-le explicitement avant de l’enregistrer, plutôt que de compter sur l’attribution automatique de l’identifiant&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">b3</span> <span class="o">=</span> <span class="n">Blog</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Cheddar Talk&#39;</span><span class="p">,</span> <span class="n">tagline</span><span class="o">=</span><span class="s1">&#39;Thoughts on cheese.&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b3</span><span class="o">.</span><span class="n">id</span>     <span class="c1"># Returns 3.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b3</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">b3</span><span class="o">.</span><span class="n">id</span>     <span class="c1"># Returns 3.</span>
</pre></div>
</div>
<p>Si vous attribuez manuellement des valeurs de clé primaire habituellement automatiques, prenez garde de ne pas utiliser des valeurs déjà existantes&nbsp;! Si vous créez un nouvel objet avec une valeur de clé primaire explicite qui existe déjà dans la base de données, Django pense que vous modifiez un objet existant, et non que vous en créez un nouveau.</p>
<p>En reprenant l’exemple du blog <code class="docutils literal notranslate"><span class="pre">'Cheddar</span> <span class="pre">Talk'</span></code> ci-dessus, cet exemple écraserait l’objet existant dans la base de données&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">b4</span> <span class="o">=</span> <span class="n">Blog</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Not Cheddar&#39;</span><span class="p">,</span> <span class="n">tagline</span><span class="o">=</span><span class="s1">&#39;Anything but cheese.&#39;</span><span class="p">)</span>
<span class="n">b4</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>  <span class="c1"># Overrides the previous blog with ID=3!</span>
</pre></div>
</div>
<p>Lisez <a class="reference internal" href="#how-django-knows-to-update-vs-insert">Comment Django distingue UPDATE de INSERT</a> ci-dessous, pour comprendre pourquoi cela se passe ainsi.</p>
<p>La définition explicite de valeurs de clés primaires est essentiellement utile lors de l’enregistrement d’objets en vrac, lorsque l’on est à peu près certain qu’il n’y aura pas de collision de clés primaires.</p>
<p>Si vous utilisez PostgreSQL, la séquence associée à la clé primaire pourrait devoir être mise à jour ; voir <a class="reference internal" href="../databases.html#manually-specified-autoincrement-pk"><span class="std std-ref">Indication manuelle des valeurs de clé primaire avec autoincrémentation</span></a>.</p>
</div>
</div>
<div class="section" id="s-what-happens-when-you-save">
<span id="what-happens-when-you-save"></span><h3>Que se passe-t-il lors de l’enregistrement&nbsp;?<a class="headerlink" href="#what-happens-when-you-save" title="Lien permanent vers ce titre">¶</a></h3>
<p>Lorsque vous enregistrez un objet, Django effectue les étapes suivantes&nbsp;:</p>
<ol class="arabic">
<li><p class="first"><strong>Émission d’un signal avant enregistrement.</strong> Le signal <a class="reference internal" href="../signals.html#django.db.models.signals.pre_save" title="django.db.models.signals.pre_save"><code class="xref py py-attr docutils literal notranslate"><span class="pre">django.db.models.signals.pre_save</span></code></a> est envoyé, permettant à toute fonction à l’écoute de ce signal d’accomplir une action.</p>
</li>
<li><p class="first"><strong>Préparation des données.</strong> La méthode <a class="reference internal" href="fields.html#django.db.models.Field.pre_save" title="django.db.models.Field.pre_save"><code class="xref py py-meth docutils literal notranslate"><span class="pre">pre_save()</span></code></a> de chaque champ est appelée pour effectuer toute éventuelle modification automatique de données. Par exemple, les champs date/heure surchargent <code class="docutils literal notranslate"><span class="pre">pre_save()</span></code> pour implémenter <a class="reference internal" href="fields.html#django.db.models.DateField.auto_now_add" title="django.db.models.DateField.auto_now_add"><code class="xref py py-attr docutils literal notranslate"><span class="pre">auto_now_add</span></code></a> et <a class="reference internal" href="fields.html#django.db.models.DateField.auto_now" title="django.db.models.DateField.auto_now"><code class="xref py py-attr docutils literal notranslate"><span class="pre">auto_now</span></code></a>.</p>
</li>
<li><p class="first"><strong>Préparation des données pour la base de données.</strong> La méthode <a class="reference internal" href="fields.html#django.db.models.Field.get_db_prep_save" title="django.db.models.Field.get_db_prep_save"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_db_prep_save()</span></code></a> de chaque champ doit fournir sa valeur actuelle dans un type de données qui peut être écrit dans la base de données.</p>
<p>La plupart des champs ne nécessitent aucune préparation de données. Les types de données simples, comme les entiers ou les chaînes de caractères, sont «&nbsp;prêtes à l’écriture&nbsp;» en tant qu’objet Python. Cependant, les types de données plus complexes ont souvent besoin de certaines modifications.</p>
<p>Par exemple, les champs <a class="reference internal" href="fields.html#django.db.models.DateField" title="django.db.models.DateField"><code class="xref py py-class docutils literal notranslate"><span class="pre">DateField</span></code></a> utilisent un objet Python <code class="docutils literal notranslate"><span class="pre">datetime</span></code> pour stocker leurs données. Les bases de données ne peuvent pas stocker d’objet <code class="docutils literal notranslate"><span class="pre">datetime</span></code>, il faut donc que la valeur du champ soit convertie dans une chaîne date au format ISO pour être insérée dans la base de données.</p>
</li>
<li><p class="first"><strong>Insertion des données dans la base de données.</strong> Les données pré-traitées et préparées sont converties en instruction SQL en vue de leur insertion dans la base de données.</p>
</li>
<li><p class="first"><strong>Émission d’un signal après enregistrement.</strong> Le signal <a class="reference internal" href="../signals.html#django.db.models.signals.post_save" title="django.db.models.signals.post_save"><code class="xref py py-attr docutils literal notranslate"><span class="pre">django.db.models.signals.post_save</span></code></a> est envoyé, permettant à toute fonction à l’écoute de ce signal d’accomplir une action.</p>
</li>
</ol>
</div>
<div class="section" id="s-how-django-knows-to-update-vs-insert">
<span id="how-django-knows-to-update-vs-insert"></span><h3>Comment Django distingue UPDATE de INSERT<a class="headerlink" href="#how-django-knows-to-update-vs-insert" title="Lien permanent vers ce titre">¶</a></h3>
<p>Vous avez peut-être remarqué que les objets de base de données de Django utilisent la même méthode <code class="docutils literal notranslate"><span class="pre">save()</span></code> pour créer ou modifier des objets. La couche d’abstraction de Django évite de devoir différencier les instructions SQL <code class="docutils literal notranslate"><span class="pre">INSERT</span></code> ou <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code>. Plus concrètement, lors de l’appel à <code class="docutils literal notranslate"><span class="pre">save()</span></code> et que l’attribut clé primaire de l’objet ne définit <strong>pas</strong> de valeur <a class="reference internal" href="fields.html#django.db.models.Field.default" title="django.db.models.Field.default"><code class="xref py py-attr docutils literal notranslate"><span class="pre">default</span></code></a>, Django suit l’algorithme suivant&nbsp;:</p>
<ul class="simple">
<li>Si l’attribut de clé primaire de l’objet est défini à une valeur équivalent à <code class="docutils literal notranslate"><span class="pre">True</span></code> (c’est-à-dire une valeur autre que <code class="docutils literal notranslate"><span class="pre">None</span></code> ou que la chaîne vide), Django effectue une instruction <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code> (mise à jour).</li>
<li>Si l’attribut de clé primaire de l’objet n’est <em>pas</em> défini où si l’instruction <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code> n’a rien mis à jour (par ex. si la clé primaire est définie à une valeur qui n’existe pas en base de données), Django exécute une requête <code class="docutils literal notranslate"><span class="pre">INSERT</span></code>.</li>
</ul>
<p>Si l’attribut clé primaire de l’objet définit une valeur par défaut <a class="reference internal" href="fields.html#django.db.models.Field.default" title="django.db.models.Field.default"><code class="xref py py-attr docutils literal notranslate"><span class="pre">default</span></code></a>, Django exécute une instruction <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code> s’il s’agit d’une instance de modèle existante et que sa clé primaire est définie à une valeur qui existe dans la base de données. Sinon, Django exécute une instruction <code class="docutils literal notranslate"><span class="pre">INSERT</span></code>.</p>
<p>Le point délicat ici est de faire attention à ne pas indiquer explicitement de valeur de clé primaire lors de l’enregistrement de nouveaux objets, si vous ne pouvez garantir que cette clé primaire est libre. Pour plus de détails sur cette nuance, consultez <a class="reference internal" href="#explicitly-specifying-auto-primary-key-values">Définition explicite des valeurs de clés primaires</a> ci-dessus et <a class="reference internal" href="#forcing-an-insert-or-update">Contrainte d’insertion ou de mise à jour</a> ci-dessous.</p>
<p>Jusqu’à Django 1.5, Django faisait un <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> lorsque l’attribut de clé primaire était défini. Si le <code class="docutils literal notranslate"><span class="pre">SELECT</span></code> trouvait un objet, Django effectuait ensuite un <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code>, sinon il procédait à un <code class="docutils literal notranslate"><span class="pre">INSERT</span></code>. Cet ancien algorithme produisait une requête supplémentaire dans le cas <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code>. Il peut arriver dans certains cas que la base de données ne signale pas qu’une ligne a été mise à jour même quand il existe une ligne de base de données correspondant à la clé primaire de l’objet. Un exemple est le déclencheur <code class="docutils literal notranslate"><span class="pre">ON</span> <span class="pre">UPDATE</span></code> de PostgreSQL qui renvoie <code class="docutils literal notranslate"><span class="pre">NULL</span></code>. Dans de tels cas, il est possible de revenir à l’algorithme précédent en définissant l’option <a class="reference internal" href="options.html#django.db.models.Options.select_on_save" title="django.db.models.Options.select_on_save"><code class="xref py py-attr docutils literal notranslate"><span class="pre">select_on_save</span></code></a> à <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p>
<div class="versionchanged">
<span class="title">Changed in Django 3.0:</span> <p><code class="docutils literal notranslate"><span class="pre">Model.save()</span></code> n’essaie plus de trouver un enregistrement de base de données lors de l’enregistrement d’une nouvelle instance de <code class="docutils literal notranslate"><span class="pre">Model</span></code> et qu’une valeur par défaut est définie pour la clé primaire ; dans ce cas, il procède toujours à un <code class="docutils literal notranslate"><span class="pre">INSERT</span></code>.</p>
</div>
<div class="section" id="s-forcing-an-insert-or-update">
<span id="s-ref-models-force-insert"></span><span id="forcing-an-insert-or-update"></span><span id="ref-models-force-insert"></span><h4>Contrainte d’insertion ou de mise à jour<a class="headerlink" href="#forcing-an-insert-or-update" title="Lien permanent vers ce titre">¶</a></h4>
<p>Dans de rares circonstances, il est nécessaire de pouvoir forcer la méthode <a class="reference internal" href="#django.db.models.Model.save" title="django.db.models.Model.save"><code class="xref py py-meth docutils literal notranslate"><span class="pre">save()</span></code></a> à recourir à une instruction SQL <code class="docutils literal notranslate"><span class="pre">INSERT</span></code> au lieu d’une instruction <code class="docutils literal notranslate"><span class="pre">UPDATE</span></code>. Ou l’inverse&nbsp;: mettre à jour si possible, mais ne pas insérer un nouvel enregistrement. Dans ces situations, il est possible de fournir les paramètres <code class="docutils literal notranslate"><span class="pre">force_insert=True</span></code> ou <code class="docutils literal notranslate"><span class="pre">force_update=True</span></code> à la méthode <a class="reference internal" href="#django.db.models.Model.save" title="django.db.models.Model.save"><code class="xref py py-meth docutils literal notranslate"><span class="pre">save()</span></code></a>. Il est faux de fournir les deux paramètres simultanément&nbsp;: il est impossible d’insérer <em>et</em> de mettre à jour en même temps&nbsp;!</p>
<p>L’usage de ces paramètres est très rare. Django effectue presque toujours le bon choix et en surchargeant le comportement habituel, des erreurs difficiles à détecter peuvent survenir. Cette fonctionnalité est réservée aux experts.</p>
<p>L’utilisation de <code class="docutils literal notranslate"><span class="pre">update_fields</span></code> force une mise à jour de la même façon que <code class="docutils literal notranslate"><span class="pre">force_update</span></code>.</p>
</div>
</div>
<div class="section" id="s-updating-attributes-based-on-existing-fields">
<span id="s-ref-models-field-updates-using-f-expressions"></span><span id="updating-attributes-based-on-existing-fields"></span><span id="ref-models-field-updates-using-f-expressions"></span><h3>Mise à jour d’attributs basés sur des champs existants<a class="headerlink" href="#updating-attributes-based-on-existing-fields" title="Lien permanent vers ce titre">¶</a></h3>
<p>Il est parfois nécessaire d’effectuer une tâche arithmétique simple sur un champ, comme l’incrémentation ou la décrémentation de la valeur actuelle. Une façon de faire cela serait d’effectuer l’arithmétique en Python comme ceci&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">product</span> <span class="o">=</span> <span class="n">Product</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Venezuelan Beaver Cheese&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">product</span><span class="o">.</span><span class="n">number_sold</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">product</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p>Si la valeur <code class="docutils literal notranslate"><span class="pre">number_sold</span></code> existante dans la base de données est 10, c’est la valeur 11 qui sera écrite comme nouvelle valeur en base de données.</p>
<p>Ce processus peut être solidifié, <a class="reference internal" href="expressions.html#avoiding-race-conditions-using-f"><span class="std std-ref">évitant un conflit de concurrence</span></a>, et rendu légèrement plus rapide en exprimant la mise à jour relativement à la valeur existante plutôt qu’en attribuant explicitement une nouvelle valeur. Django fournit des <a class="reference internal" href="expressions.html#django.db.models.F" title="django.db.models.F"><code class="xref py py-class docutils literal notranslate"><span class="pre">expressions</span> <span class="pre">F</span></code></a> pour parvenir à ce genre de mise à jour relative. En employant des <a class="reference internal" href="expressions.html#django.db.models.F" title="django.db.models.F"><code class="xref py py-class docutils literal notranslate"><span class="pre">expressions</span> <span class="pre">F</span></code></a>, l’exemple précédent est formulé ainsi&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.db.models</span> <span class="k">import</span> <span class="n">F</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">product</span> <span class="o">=</span> <span class="n">Product</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Venezuelan Beaver Cheese&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">product</span><span class="o">.</span><span class="n">number_sold</span> <span class="o">=</span> <span class="n">F</span><span class="p">(</span><span class="s1">&#39;number_sold&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">product</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p>Pour plus de détails, consultez la documentation sur les <a class="reference internal" href="expressions.html#django.db.models.F" title="django.db.models.F"><code class="xref py py-class docutils literal notranslate"><span class="pre">expressions</span> <span class="pre">F</span></code></a> et leur <a class="reference internal" href="../../topics/db/queries.html#topics-db-queries-update"><span class="std std-ref">emploi dans les requêtes de mise à jour</span></a>.</p>
</div>
<div class="section" id="s-specifying-which-fields-to-save">
<span id="specifying-which-fields-to-save"></span><h3>Indication des champs à enregistrer<a class="headerlink" href="#specifying-which-fields-to-save" title="Lien permanent vers ce titre">¶</a></h3>
<p>En transmettant une liste de noms de champs dans le paramètre <code class="docutils literal notranslate"><span class="pre">update_fields</span></code> de <code class="docutils literal notranslate"><span class="pre">save()</span></code>, seuls les champs figurant dans cette liste sont mis à jour. Cela peut être judicieux lorsque un petit sous-ensemble des champs d’un objet doivent être mis à jour. Un léger gain de performances peut être espéré en évitant de mettre à jour tous les champs du modèle en base de données. Par exemple&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">product</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Name changed again&#39;</span>
<span class="n">product</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">update_fields</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
</pre></div>
</div>
<p>Le paramètre <code class="docutils literal notranslate"><span class="pre">update_fields</span></code> peut être n’importe quel objet itérable contenant des chaînes de caractères. Si ce dernier est vide, l’enregistrement n’a pas lieu. La valeur <code class="docutils literal notranslate"><span class="pre">None</span></code> provoque la mise à jour de tous les champs.</p>
<p>L’utilisation de <code class="docutils literal notranslate"><span class="pre">update_fields</span></code> force une mise à jour.</p>
<p>Lors de l’enregistrement d’un modèle obtenu par chargement différé de modèle (<a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.only" title="django.db.models.query.QuerySet.only"><code class="xref py py-meth docutils literal notranslate"><span class="pre">only()</span></code></a> ou <a class="reference internal" href="querysets.html#django.db.models.query.QuerySet.defer" title="django.db.models.query.QuerySet.defer"><code class="xref py py-meth docutils literal notranslate"><span class="pre">defer()</span></code></a>), seuls les champs chargés à partir de la base de données sont mis à jour. Dans ce cas, l’effet est semblable à un <code class="docutils literal notranslate"><span class="pre">update_fields</span></code> automatique. Si vous attribuez ou que vous modifiez l’une des valeurs de champ différé, le champ est ajouté aux champs à mettre à jour.</p>
</div>
</div>
<div class="section" id="s-deleting-objects">
<span id="deleting-objects"></span><h2>Suppression d’objets<a class="headerlink" href="#deleting-objects" title="Lien permanent vers ce titre">¶</a></h2>
<dl class="method">
<dt id="django.db.models.Model.delete">
<code class="descclassname">Model.</code><code class="descname">delete</code>(<em>using=DEFAULT_DB_ALIAS</em>, <em>keep_parents=False</em>)<a class="headerlink" href="#django.db.models.Model.delete" title="Lien permanent vers cette définition">¶</a></dt>
<dd></dd></dl>

<p>Effectue une instruction SQL <code class="docutils literal notranslate"><span class="pre">DELETE</span></code> pour l’objet. Cela ne fait que supprimer l’objet dans la base de données&nbsp;; l’instance Python existe toujours et ses champs contiennent encore les données. Cette méthode renvoie le nombre d’objets supprimés ainsi qu’un dictionnaire avec le nombre de suppressions par type d’objet.</p>
<p>Pour plus de détails, y compris sur la suppression d’objets en vrac, consultez <a class="reference internal" href="../../topics/db/queries.html#topics-db-queries-delete"><span class="std std-ref">Suppression d’objets</span></a>.</p>
<p>Si vous avez besoin d’un comportement de suppression personnalisé, vous pouvez surcharger la méthode <code class="docutils literal notranslate"><span class="pre">delete()</span></code>. Voir <a class="reference internal" href="../../topics/db/models.html#overriding-model-methods"><span class="std std-ref">Surcharge des méthodes de modèles prédéfinies</span></a> pour plus de détails.</p>
<p>Il peut arriver parfois qu’avec l”<a class="reference internal" href="../../topics/db/models.html#multi-table-inheritance"><span class="std std-ref">héritage multi-table</span></a>, on ne veuille supprimer que les données d’un modèle enfant. En indiquant <code class="docutils literal notranslate"><span class="pre">keep_parents=True</span></code>, les données du modèle parent sont conservées.</p>
</div>
<div class="section" id="s-pickling-objects">
<span id="pickling-objects"></span><h2>Sérialisation «&nbsp;pickle&nbsp;» d’objets<a class="headerlink" href="#pickling-objects" title="Lien permanent vers ce titre">¶</a></h2>
<p>Lorsqu’on utilise <a class="reference external" href="https://docs.python.org/3/library/pickle.html#module-pickle" title="(disponible dans Python v3.9)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">pickle</span></code></a> sur un modèle, son état actuel est sérialisé. Lors de la désérialisation, il contiendra l’instance de modèle telle qu’elle était au moment de sa sérialisation, et non pas dans l’état actuel des données de la base de données.</p>
<div class="admonition-you-can-t-share-pickles-between-versions admonition">
<p class="first admonition-title">Il  n’est pas possible de partager des sérialisations «&nbsp;pickle&nbsp;» entre différentes versions</p>
<p>Des sérialisations «&nbsp;pickle&nbsp;» de modèles ne sont valables que pour la version de Django utilisée pour les générer. Si vous produisez du contenu «&nbsp;pickle&nbsp;» avec une version N de Django, il n’y a aucune garantie que ce contenu soit lisible par une version N+1 de Django. La sérialisation «&nbsp;pickle&nbsp;» ne doit pas être utilisée dans le cadre d’une stratégie d’archivage à long terme.</p>
<p class="last">Comme des erreurs de compatibilité de pickle peuvent être difficiles à diagnostiquer, comme par exemple des objets silencieusement corrompus, un avertissement <code class="docutils literal notranslate"><span class="pre">RuntimeWarning</span></code> est produit si vous essayer de désérialiser un modèle dans une version de Django différente de celle qui a été utilisée pour la sérialisation.</p>
</div>
</div>
<div class="section" id="s-other-model-instance-methods">
<span id="s-model-instance-methods"></span><span id="other-model-instance-methods"></span><span id="model-instance-methods"></span><h2>Autres méthodes d’instance de modèle<a class="headerlink" href="#other-model-instance-methods" title="Lien permanent vers ce titre">¶</a></h2>
<p>Quelques méthodes d’objet ont un rôle spécifique.</p>
<div class="section" id="s-str">
<span id="str"></span><h3><code class="docutils literal notranslate"><span class="pre">__str__()</span></code><a class="headerlink" href="#str" title="Lien permanent vers ce titre">¶</a></h3>
<dl class="method">
<dt id="django.db.models.Model.__str__">
<code class="descclassname">Model.</code><code class="descname">__str__</code>()<a class="headerlink" href="#django.db.models.Model.__str__" title="Lien permanent vers cette définition">¶</a></dt>
<dd></dd></dl>

<p>La méthode <code class="docutils literal notranslate"><span class="pre">__str__()</span></code> est appelée chaque fois que <code class="docutils literal notranslate"><span class="pre">str()</span></code> est appelée sur un objet. Django utilise <code class="docutils literal notranslate"><span class="pre">str(obj)</span></code> à plusieurs occasions. Plus particulièrement, pour afficher un objet dans le site d’administration de Django et pour produire la valeur insérée dans un gabarit lors de l’affichage d’un objet. Il est donc important de toujours renvoyer une représentation utile et intelligible du modèle en réponse à la méthode <code class="docutils literal notranslate"><span class="pre">__str__()</span></code>.</p>
<p>Par exemple&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="k">import</span> <span class="n">models</span>

<span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">first_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">last_name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s1">&#39;</span><span class="si">%s</span><span class="s1"> </span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">first_name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">last_name</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="s-eq">
<span id="eq"></span><h3><code class="docutils literal notranslate"><span class="pre">__eq__()</span></code><a class="headerlink" href="#eq" title="Lien permanent vers ce titre">¶</a></h3>
<dl class="method">
<dt id="django.db.models.Model.__eq__">
<code class="descclassname">Model.</code><code class="descname">__eq__</code>()<a class="headerlink" href="#django.db.models.Model.__eq__" title="Lien permanent vers cette définition">¶</a></dt>
<dd></dd></dl>

<p>La méthode d’égalité est définie telle que des instances avec la même valeur de clé primaire et la même classe concrète sont considérées comme égales, sauf pour les instances dont la valeur de clé primaire est <code class="docutils literal notranslate"><span class="pre">None</span></code> qui ne sont toujours égales qu’à elles-mêmes. Pour les modèles mandataires, la classe concrète est définie comme le premier parent non mandataire du modèle&nbsp;; pour tous les autres modèles, c’est simplement la classe du modèle.</p>
<p>Par exemple&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="k">import</span> <span class="n">models</span>

<span class="k">class</span> <span class="nc">MyModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="nb">id</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">AutoField</span><span class="p">(</span><span class="n">primary_key</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">MyProxyModel</span><span class="p">(</span><span class="n">MyModel</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">proxy</span> <span class="o">=</span> <span class="kc">True</span>

<span class="k">class</span> <span class="nc">MultitableInherited</span><span class="p">(</span><span class="n">MyModel</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="c1"># Primary keys compared</span>
<span class="n">MyModel</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="n">MyModel</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">MyModel</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="n">MyModel</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="c1"># Primary keys are None</span>
<span class="n">MyModel</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">!=</span> <span class="n">MyModel</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="c1"># Same instance</span>
<span class="n">instance</span> <span class="o">=</span> <span class="n">MyModel</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">instance</span> <span class="o">==</span> <span class="n">instance</span>
<span class="c1"># Proxy model</span>
<span class="n">MyModel</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">==</span> <span class="n">MyProxyModel</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># Multi-table inheritance</span>
<span class="n">MyModel</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="n">MultitableInherited</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="s-hash">
<span id="hash"></span><h3><code class="docutils literal notranslate"><span class="pre">__hash__()</span></code><a class="headerlink" href="#hash" title="Lien permanent vers ce titre">¶</a></h3>
<dl class="method">
<dt id="django.db.models.Model.__hash__">
<code class="descclassname">Model.</code><code class="descname">__hash__</code>()<a class="headerlink" href="#django.db.models.Model.__hash__" title="Lien permanent vers cette définition">¶</a></dt>
<dd></dd></dl>

<p>La méthode <code class="docutils literal notranslate"><span class="pre">__hash__</span></code> est basée sur la valeur de clé primaire de l’instance. Il s’agit en pratique de <code class="docutils literal notranslate"><span class="pre">hash(obj.pk)</span></code>. Si l’instance ne possède pas de valeur de clé primaire, une exception <code class="docutils literal notranslate"><span class="pre">TypeError</span></code> est générée (sinon la méthode <code class="docutils literal notranslate"><span class="pre">__hash__()</span></code> renverrait une valeur différente avant et après l’enregistrement de l’instance, alors que la modification de la valeur <a class="reference external" href="https://docs.python.org/3/reference/datamodel.html#object.__hash__" title="(disponible dans Python v3.9)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__hash__()</span></code></a> d’une instance est interdit en Python).</p>
</div>
<div class="section" id="s-get-absolute-url">
<span id="get-absolute-url"></span><h3><code class="docutils literal notranslate"><span class="pre">get_absolute_url()</span></code><a class="headerlink" href="#get-absolute-url" title="Lien permanent vers ce titre">¶</a></h3>
<dl class="method">
<dt id="django.db.models.Model.get_absolute_url">
<code class="descclassname">Model.</code><code class="descname">get_absolute_url</code>()<a class="headerlink" href="#django.db.models.Model.get_absolute_url" title="Lien permanent vers cette définition">¶</a></dt>
<dd></dd></dl>

<p>Définissez une méthode <code class="docutils literal notranslate"><span class="pre">get_absolute_url()</span></code> pour indiquer à Django la façon de calculer l’URL canonique d’un objet. Pour l’appelant, cette méthode doit renvoyer une chaîne pouvant être utilisée pour se référer à un objet par HTTP.</p>
<p>Par exemple&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_absolute_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="s2">&quot;/people/</span><span class="si">%i</span><span class="s2">/&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">id</span>
</pre></div>
</div>
<p>Bien que ce code soit correct et simple, ce n’est peut-être pas la manière la plus portable d’écrire ce genre de méthode. La fonction <a class="reference internal" href="../urlresolvers.html#django.urls.reverse" title="django.urls.reverse"><code class="xref py py-func docutils literal notranslate"><span class="pre">reverse()</span></code></a> est habituellement la meilleure approche.</p>
<p>Par exemple&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_absolute_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="kn">from</span> <span class="nn">django.urls</span> <span class="k">import</span> <span class="n">reverse</span>
    <span class="k">return</span> <span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;people.views.details&#39;</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">id</span><span class="p">)])</span>
</pre></div>
</div>
<p>Un endroit où Django utilise <code class="docutils literal notranslate"><span class="pre">get_absolute_url()</span></code> est l’application d’administration. Si un objet définit cette méthode, la page d’édition d’objet présentera un lien «&nbsp;Voir sur le site&nbsp;» qui vous amène directement sur la page d’affichage public de l’objet, telle qu’indiquée par <code class="docutils literal notranslate"><span class="pre">get_absolute_url()</span></code>.</p>
<p>De même, certaines autres parties de Django, comme le <a class="reference internal" href="../contrib/syndication.html"><span class="doc">système de flux de syndication</span></a>, utilisent <code class="docutils literal notranslate"><span class="pre">get_absolute_url()</span></code> lorsqu’elle est définie. Si le fait de posséder une URL unique pour chaque instance de modèle fait sens, vous devriez définir <code class="docutils literal notranslate"><span class="pre">get_absolute_url()</span></code>.</p>
<div class="admonition warning">
<p class="first admonition-title">Avertissement</p>
<p>Vous devriez éviter de construire des URL à partir de contenu utilisateur non validé, afin de réduire les possibilités de corruption de lien ou de redirection&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_absolute_url</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">return</span> <span class="s1">&#39;/</span><span class="si">%s</span><span class="s1">/&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
</pre></div>
</div>
<p class="last">Si <code class="docutils literal notranslate"><span class="pre">self.name</span></code> est <code class="docutils literal notranslate"><span class="pre">'/example.com'</span></code>, ceci renvoie <code class="docutils literal notranslate"><span class="pre">'//example.com/'</span></code> qui est aussi un protocole valide d’URL relative, mais ne correspond pas à <code class="docutils literal notranslate"><span class="pre">'/%2Fexample.com/'</span></code> qui était attendu.</p>
</div>
<p>L’utilisation de <code class="docutils literal notranslate"><span class="pre">get_absolute_url()</span></code> dans les gabarits est reconnu comme une bonne pratique, au lieu de figer les URL des objets à des chaînes fixes. Par exemple, ce code de gabarit est mauvais&nbsp;:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="c">&lt;!-- BAD template code. Avoid! --&gt;</span>
<span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/people/</span><span class="cp">{{</span> <span class="nv">object.id</span> <span class="cp">}}</span><span class="s">/&quot;</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">object.name</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>Ce code de gabarit est bien meilleur&nbsp;:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">object.get_absolute_url</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">object.name</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>Ici, la logique est que si vous modifiez la structure des URL de vos objets, même s’il ne s’agissait que d’une petite correction orthographique, il n’est pas acceptable de devoir rechercher tous les endroits où l’URL en question pourrait être écrite. On la définit une seule fois dans <code class="docutils literal notranslate"><span class="pre">get_absolute_url()</span></code> et tous les autres endroits du code peuvent alors référencer cette méthode.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>La chaîne renvoyée par <code class="docutils literal notranslate"><span class="pre">get_absolute_url()</span></code> ne <strong>doit</strong> contenir que des caractères ASCII (exigence de la spécification d’URI <span class="target" id="index-2"></span><a class="rfc reference external" href="https://tools.ietf.org/html/rfc2396.html#section-2"><strong>RFC 2396#section-2</strong></a>) et être codée en syntaxe URL, si nécessaire.</p>
<p class="last">Le code et les gabarits faisant appel à <code class="docutils literal notranslate"><span class="pre">get_absolute_url()</span></code> doivent pouvoir utiliser le résultat directement sans plus de traitement. Il peut être utile d’appeler la fonction <code class="docutils literal notranslate"><span class="pre">django.utils.encoding.iri_to_uri()</span></code> pour contribuer à cet objectif si vous utilisez des caractères en dehors de la plage ASCII.</p>
</div>
</div>
</div>
<div class="section" id="s-extra-instance-methods">
<span id="extra-instance-methods"></span><h2>Méthodes d’instances supplémentaires<a class="headerlink" href="#extra-instance-methods" title="Lien permanent vers ce titre">¶</a></h2>
<p>En plus de <a class="reference internal" href="#django.db.models.Model.save" title="django.db.models.Model.save"><code class="xref py py-meth docutils literal notranslate"><span class="pre">save()</span></code></a> et <a class="reference internal" href="#django.db.models.Model.delete" title="django.db.models.Model.delete"><code class="xref py py-meth docutils literal notranslate"><span class="pre">delete()</span></code></a>, un objet de modèle peut posséder certaines des méthodes suivantes&nbsp;:</p>
<dl class="method">
<dt id="django.db.models.Model.get_FOO_display">
<code class="descclassname">Model.</code><code class="descname">get_FOO_display</code>()<a class="headerlink" href="#django.db.models.Model.get_FOO_display" title="Lien permanent vers cette définition">¶</a></dt>
<dd></dd></dl>

<p>Pour chaque champ ayant le paramètre <a class="reference internal" href="fields.html#django.db.models.Field.choices" title="django.db.models.Field.choices"><code class="xref py py-attr docutils literal notranslate"><span class="pre">choices</span></code></a>, l’objet dispose d’une méthode <code class="docutils literal notranslate"><span class="pre">get_FOO_display()</span></code>, où <code class="docutils literal notranslate"><span class="pre">FOO</span></code> est le nom du champ. Cette méthode renvoie une valeur «&nbsp;intelligible&nbsp;» pour ce champ.</p>
<p>Par exemple&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="k">import</span> <span class="n">models</span>

<span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">SHIRT_SIZES</span> <span class="o">=</span> <span class="p">(</span>
        <span class="p">(</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="s1">&#39;Small&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s1">&#39;Medium&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="s1">&#39;Large&#39;</span><span class="p">),</span>
    <span class="p">)</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">60</span><span class="p">)</span>
    <span class="n">shirt_size</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">choices</span><span class="o">=</span><span class="n">SHIRT_SIZES</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">p</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Fred Flintstone&quot;</span><span class="p">,</span> <span class="n">shirt_size</span><span class="o">=</span><span class="s2">&quot;L&quot;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">shirt_size</span>
<span class="go">&#39;L&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">p</span><span class="o">.</span><span class="n">get_shirt_size_display</span><span class="p">()</span>
<span class="go">&#39;Large&#39;</span>
</pre></div>
</div>
<div class="versionchanged">
<span class="title">Changed in Django 3.1:</span> <p>La prise en charge des champs <a class="reference internal" href="../contrib/postgres/fields.html#django.contrib.postgres.fields.ArrayField" title="django.contrib.postgres.fields.ArrayField"><code class="xref py py-class docutils literal notranslate"><span class="pre">ArrayField</span></code></a> et <a class="reference internal" href="../contrib/postgres/fields.html#django.contrib.postgres.fields.RangeField" title="django.contrib.postgres.fields.RangeField"><code class="xref py py-class docutils literal notranslate"><span class="pre">RangeField</span></code></a> a été ajoutée.</p>
</div>
<dl class="method">
<dt id="django.db.models.Model.get_next_by_FOO">
<code class="descclassname">Model.</code><code class="descname">get_next_by_FOO</code>(<em>**kwargs</em>)<a class="headerlink" href="#django.db.models.Model.get_next_by_FOO" title="Lien permanent vers cette définition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="django.db.models.Model.get_previous_by_FOO">
<code class="descclassname">Model.</code><code class="descname">get_previous_by_FOO</code>(<em>**kwargs</em>)<a class="headerlink" href="#django.db.models.Model.get_previous_by_FOO" title="Lien permanent vers cette définition">¶</a></dt>
<dd></dd></dl>

<p>Pour chaque champ <a class="reference internal" href="fields.html#django.db.models.DateField" title="django.db.models.DateField"><code class="xref py py-class docutils literal notranslate"><span class="pre">DateField</span></code></a> et <a class="reference internal" href="fields.html#django.db.models.DateTimeField" title="django.db.models.DateTimeField"><code class="xref py py-class docutils literal notranslate"><span class="pre">DateTimeField</span></code></a> ne possédant pas le paramètre <a class="reference internal" href="fields.html#django.db.models.Field.null" title="django.db.models.Field.null"><code class="xref py py-attr docutils literal notranslate"><span class="pre">null=True</span></code></a>, l’objet disposera de méthodes <code class="docutils literal notranslate"><span class="pre">get_next_by_FOO()</span></code> et <code class="docutils literal notranslate"><span class="pre">get_previous_by_FOO()</span></code>, où <code class="docutils literal notranslate"><span class="pre">FOO</span></code> est le nom du champ. Celles-ci renvoient respectivement l’objet suivant et l’objet précédent en fonction du champ date, générant une exception <a class="reference internal" href="class.html#django.db.models.Model.DoesNotExist" title="django.db.models.Model.DoesNotExist"><code class="xref py py-exc docutils literal notranslate"><span class="pre">DoesNotExist</span></code></a> le cas échéant.</p>
<p>Ces deux méthodes effectuent leurs requêtes en utilisant le gestionnaire par défaut du modèle. Si vous avez besoin d’émuler le filtrage d’un gestionnaire personnalisé ou que vous vouliez effectuer un filtrage personnalisé unique, ces deux méthodes acceptent aussi des paramètres nommés facultatifs qui devraient correspondre au format décrit dans <a class="reference internal" href="querysets.html#field-lookups"><span class="std std-ref">Recherches dans les champs</span></a>.</p>
<p>Notez qu’en cas de valeurs datées identiques, ces méthodes emploient la clé primaire pour déterminer l’objet choisi. Cela permet de garantir qu’aucun objet ne sera omis ou dupliqué. Cela signifie également qu’il n’est pas possible d’utiliser ces méthodes pour des objets non enregistrés.</p>
<div class="admonition-overriding-extra-instance-methods admonition">
<p class="first admonition-title">Surcharge de méthodes d’instance supplémentaires</p>
<p class="last">Dans la plupart des cas, la surcharge ou l’héritage des méthodes <code class="docutils literal notranslate"><span class="pre">get_FOO_display()</span></code>, <code class="docutils literal notranslate"><span class="pre">get_next_by_FOO()</span></code> et <code class="docutils literal notranslate"><span class="pre">get_previous_by_FOO()</span></code> fonctionne comme attendu. Toutefois, comme celles-ci sont ajoutées par la métaclasse, il n’est en pratique pas possible de considérer toutes les structures d’héritage possibles. Dans les cas plus complexes, vous devriez surcharger <code class="docutils literal notranslate"><span class="pre">Field.contribute_to_class()</span></code> afin de définir les méthodes dont vous avez besoin.</p>
</div>
</div>
<div class="section" id="s-other-attributes">
<span id="other-attributes"></span><h2>Autres attributs<a class="headerlink" href="#other-attributes" title="Lien permanent vers ce titre">¶</a></h2>
<div class="section" id="s-state">
<span id="state"></span><h3><code class="docutils literal notranslate"><span class="pre">_state</span></code><a class="headerlink" href="#state" title="Lien permanent vers ce titre">¶</a></h3>
<dl class="attribute">
<dt id="django.db.models.Model._state">
<code class="descclassname">Model.</code><code class="descname">_state</code><a class="headerlink" href="#django.db.models.Model._state" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>L’attribut <code class="docutils literal notranslate"><span class="pre">_state</span></code> fait référence à un objet <code class="docutils literal notranslate"><span class="pre">ModelState</span></code> qui suit le cycle de vie de l’instance du modèle.</p>
<p>L’objet <code class="docutils literal notranslate"><span class="pre">ModelState</span></code> a deux attributs : <code class="docutils literal notranslate"><span class="pre">adding</span></code>, un drapeau qui vaut <code class="docutils literal notranslate"><span class="pre">True</span></code> si le modèle n’a pas été enregistré en base de données, et <code class="docutils literal notranslate"><span class="pre">db</span></code>, une chaîne faisant référence à l’alias de base de données depuis laquelle l’instance a été chargée ou enregistrée.</p>
<p>Les nouvelles instances créées ont <code class="docutils literal notranslate"><span class="pre">adding=True</span></code> et <code class="docutils literal notranslate"><span class="pre">db=None</span></code>, car elles sont sur le point d’être enregistrées. Les instances récupérées depuis un <code class="docutils literal notranslate"><span class="pre">QuerySet</span></code> auront <code class="docutils literal notranslate"><span class="pre">adding=False</span></code> et <code class="docutils literal notranslate"><span class="pre">db</span></code>  défini à l’alias de la base de données associée.</p>
</dd></dl>

</div>
</div>
</div>


          </div>
        </div>
      </div>
      
        
          <div class="yui-b" id="sidebar">
            
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../contents.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Référence des instances de modèles</a><ul>
<li><a class="reference internal" href="#creating-objects">Création d’objets</a><ul>
<li><a class="reference internal" href="#customizing-model-loading">Personnalisation du chargement des modèles</a></li>
</ul>
</li>
<li><a class="reference internal" href="#refreshing-objects-from-database">Actualisation des objets à partir de la base de données</a></li>
<li><a class="reference internal" href="#validating-objects">Validation d’objets</a></li>
<li><a class="reference internal" href="#saving-objects">Enregistrement d’objets</a><ul>
<li><a class="reference internal" href="#auto-incrementing-primary-keys">Incrémentation automatique des clés primaires</a><ul>
<li><a class="reference internal" href="#the-pk-property">La propriété <code class="docutils literal notranslate"><span class="pre">pk</span></code></a></li>
<li><a class="reference internal" href="#explicitly-specifying-auto-primary-key-values">Définition explicite des valeurs de clés primaires</a></li>
</ul>
</li>
<li><a class="reference internal" href="#what-happens-when-you-save">Que se passe-t-il lors de l’enregistrement&nbsp;?</a></li>
<li><a class="reference internal" href="#how-django-knows-to-update-vs-insert">Comment Django distingue UPDATE de INSERT</a><ul>
<li><a class="reference internal" href="#forcing-an-insert-or-update">Contrainte d’insertion ou de mise à jour</a></li>
</ul>
</li>
<li><a class="reference internal" href="#updating-attributes-based-on-existing-fields">Mise à jour d’attributs basés sur des champs existants</a></li>
<li><a class="reference internal" href="#specifying-which-fields-to-save">Indication des champs à enregistrer</a></li>
</ul>
</li>
<li><a class="reference internal" href="#deleting-objects">Suppression d’objets</a></li>
<li><a class="reference internal" href="#pickling-objects">Sérialisation «&nbsp;pickle&nbsp;» d’objets</a></li>
<li><a class="reference internal" href="#other-model-instance-methods">Autres méthodes d’instance de modèle</a><ul>
<li><a class="reference internal" href="#str"><code class="docutils literal notranslate"><span class="pre">__str__()</span></code></a></li>
<li><a class="reference internal" href="#eq"><code class="docutils literal notranslate"><span class="pre">__eq__()</span></code></a></li>
<li><a class="reference internal" href="#hash"><code class="docutils literal notranslate"><span class="pre">__hash__()</span></code></a></li>
<li><a class="reference internal" href="#get-absolute-url"><code class="docutils literal notranslate"><span class="pre">get_absolute_url()</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#extra-instance-methods">Méthodes d’instances supplémentaires</a></li>
<li><a class="reference internal" href="#other-attributes">Autres attributs</a><ul>
<li><a class="reference internal" href="#state"><code class="docutils literal notranslate"><span class="pre">_state</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Sujet précédent</h4>
  <p class="topless"><a href="options.html"
                        title="Chapitre précédent">Options <code class="docutils literal notranslate"><span class="pre">Meta</span></code> des modèles</a></p>
  <h4>Sujet suivant</h4>
  <p class="topless"><a href="querysets.html"
                        title="Chapitre suivant">Référence de l’API <code class="docutils literal notranslate"><span class="pre">QuerySet</span></code></a></p>
  <div role="note" aria-label="source link">
    <h3>Cette page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/ref/models/instances.txt"
            rel="nofollow">Montrer le code source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Recherche rapide</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
              <h3>Last update:</h3>
              <p class="topless">oct. 29, 2020</p>
          </div>
        
      
    </div>

    <div id="ft">
      <div class="nav">
    &laquo; <a href="options.html" title="Options &lt;code class=&#34;docutils literal notranslate&#34;&gt;&lt;span class=&#34;pre&#34;&gt;Meta&lt;/span&gt;&lt;/code&gt; des modèles">previous</a>
     |
    <a href="../index.html" title="Référence de l’API" accesskey="U">up</a>
   |
    <a href="querysets.html" title="Référence de l’API &lt;code class=&#34;docutils literal notranslate&#34;&gt;&lt;span class=&#34;pre&#34;&gt;QuerySet&lt;/span&gt;&lt;/code&gt;">next</a> &raquo;</div>
    </div>
  </div>

      <div class="clearer"></div>
    </div>
  </body>
</html>