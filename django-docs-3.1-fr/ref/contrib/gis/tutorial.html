
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="fr">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Tutoriel GeoDjango &#8212; Documentation Django 3.1.3.dev</title>
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../../_static/translations.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Recherche" href="../../../search.html" />
    <link rel="next" title="Installation de GeoDjango" href="install/index.html" />
    <link rel="prev" title="GeoDjango" href="index.html" />



 
<script src="../../../templatebuiltins.js"></script>
<script>
(function($) {
    if (!django_template_builtins) {
       // templatebuiltins.js missing, do nothing.
       return;
    }
    $(document).ready(function() {
        // Hyperlink Django template tags and filters
        var base = "../../templates/builtins.html";
        if (base == "#") {
            // Special case for builtins.html itself
            base = "";
        }
        // Tags are keywords, class '.k'
        $("div.highlight\\-html\\+django span.k").each(function(i, elem) {
             var tagname = $(elem).text();
             if ($.inArray(tagname, django_template_builtins.ttags) != -1) {
                 var fragment = tagname.replace(/_/, '-');
                 $(elem).html("<a href='" + base + "#" + fragment + "'>" + tagname + "</a>");
             }
        });
        // Filters are functions, class '.nf'
        $("div.highlight\\-html\\+django span.nf").each(function(i, elem) {
             var filtername = $(elem).text();
             if ($.inArray(filtername, django_template_builtins.tfilters) != -1) {
                 var fragment = filtername.replace(/_/, '-');
                 $(elem).html("<a href='" + base + "#" + fragment + "'>" + filtername + "</a>");
             }
        });
    });
})(jQuery);(function($) {
    $(document).ready(function() {
        $(".c-tab-unix").on("click", function() {
            $("section.c-content-unix").show();
            $("section.c-content-win").hide();
            $(".c-tab-unix").prop("checked", true);
        });
        $(".c-tab-win").on("click", function() {
            $("section.c-content-win").show();
            $("section.c-content-unix").hide();
            $(".c-tab-win").prop("checked", true);
        });
    });
})(jQuery);</script>
<link rel="stylesheet" href="../../../_static/console-tabs.css" type="text/css" />
  </head><body>

    <div class="document">
  <div id="custom-doc" class="yui-t6">
    <div id="hd">
      <h1><a href="../../../index.html">Documentation Django 3.1.3.dev</a></h1>
      <div id="global-nav">
        <a title="Home page" href="../../../index.html">Home</a>  |
        <a title="Table of contents" href="../../../contents.html">Table of contents</a>  |
        <a title="Global index" href="../../../genindex.html">Index</a>  |
        <a title="Module index" href="../../../py-modindex.html">Modules</a>
      </div>
      <div class="nav">
    &laquo; <a href="index.html" title="GeoDjango">previous</a>
     |
    <a href="../../index.html" title="Référence de l’API" accesskey="U">up</a>
   |
    <a href="install/index.html" title="Installation de GeoDjango">next</a> &raquo;</div>
    </div>

    <div id="bd">
      <div id="yui-main">
        <div class="yui-b">
          <div class="yui-g" id="ref-contrib-gis-tutorial">
            
  <div class="section" id="s-geodjango-tutorial">
<span id="geodjango-tutorial"></span><h1>Tutoriel GeoDjango<a class="headerlink" href="#geodjango-tutorial" title="Lien permanent vers ce titre">¶</a></h1>
<div class="section" id="s-introduction">
<span id="introduction"></span><h2>Introduction<a class="headerlink" href="#introduction" title="Lien permanent vers ce titre">¶</a></h2>
<p>GeoDjango est un module contribué de Django qui le transforme en un système géographique Web de grande envergure. L’objectif de GeoDjango est de faciliter le plus possible la création d’applications Web géographiques telles que des services basés sur la géolocalisation. Ses fonctionnalités comprennent&nbsp;:</p>
<ul class="simple">
<li>Des champs de modèle Django pour les objets géométriques <a class="reference external" href="https://www.opengeospatial.org/">OGC</a> rz les données matricielles.</li>
<li>Des extensions de l’ORM de Django pour les requêtes et les manipulations des données spatiales.</li>
<li>Des interfaces Python faiblement liées et de haut niveau pour les opérations géométriques SIG et matricielles et la manipulation de données dans divers formats.</li>
<li>L’édition de champs géométriques dans l’interface d’administration.</li>
</ul>
<p>Ce tutoriel part du principe que Django vous est familier&nbsp;; si donc vous débutez avec Django, commencez par lire le <a class="reference internal" href="../../../intro/tutorial01.html"><span class="doc">tutoriel normal</span></a> pour vous familiariser avec Django.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">GeoDjango requiert des dépendances supplémentaires par rapport à Django, consultez la <a class="reference internal" href="install/index.html"><span class="doc">documentation d’installation</span></a> pour plus de détails.</p>
</div>
<p>Ce tutoriel va vous guider dans les création d’une application Web géographique pour visualiser les <a class="reference internal" href="#id3">frontières mondiales</a>. <a class="footnote-reference" href="#id11" id="id1">[1]</a> Une partie du code de ce tutoriel est emprunté ou s’inspire du projet des <a class="reference external" href="https://thematicmapping.org/downloads/world_borders.php">applications de base GeoDjango</a>. <a class="footnote-reference" href="#id12" id="id2">[2]</a></p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Suivez dans l’ordre les sections de ce tutoriel afin d’obtenir des instructions pas à pas.</p>
</div>
</div>
<div class="section" id="s-setting-up">
<span id="setting-up"></span><h2>Mise en route<a class="headerlink" href="#setting-up" title="Lien permanent vers ce titre">¶</a></h2>
<div class="section" id="s-create-a-spatial-database">
<span id="create-a-spatial-database"></span><h3>Création d’une base de données spatiale<a class="headerlink" href="#create-a-spatial-database" title="Lien permanent vers ce titre">¶</a></h3>
<p>En règle générale, aucune configuration spéciale n’est requise, ce qui fait que vous pouvez créer une base de données comme pour n’importe quel autre projet. Nous fournissons quelques astuces pour des bases de données précises&nbsp;:</p>
<ul class="simple">
<li><a class="reference internal" href="install/postgis.html"><span class="doc">Installation de PostGIS</span></a></li>
<li><a class="reference internal" href="install/spatialite.html"><span class="doc">Installation de SpatiaLite</span></a></li>
</ul>
</div>
<div class="section" id="s-create-a-new-project">
<span id="create-a-new-project"></span><h3>Création d’un nouveau projet<a class="headerlink" href="#create-a-new-project" title="Lien permanent vers ce titre">¶</a></h3>
<p>Utilisez le script standard <code class="docutils literal notranslate"><span class="pre">django-admin</span></code> pour créer un projet nommé <code class="docutils literal notranslate"><span class="pre">geodjango</span></code>:</p>
<div class="console-block" id="console-block-0">
<input class="c-tab-unix" id="c-tab-0-unix" type="radio" name="console-0" checked>
<label for="c-tab-0-unix" title="Linux/macOS">&#xf17c/&#xf179</label>
<input class="c-tab-win" id="c-tab-0-win" type="radio" name="console-0">
<label for="c-tab-0-win" title="Windows">&#xf17a</label>
<section class="c-content-unix" id="c-content-0-unix">
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> django-admin startproject geodjango
</pre></div>
</div>
</section>
<section class="c-content-win" id="c-content-0-win">
<div class="highlight"><pre><span></span><span class="gp">...\&gt;</span> django-admin startproject geodjango
</pre></div>
</section>
</div>
<p>Ceci va initialiser un nouveau projet. Créez maintenant une application Django <code class="docutils literal notranslate"><span class="pre">world</span></code> à l’intérieur du projet <code class="docutils literal notranslate"><span class="pre">geodjango</span></code>:</p>
<div class="console-block" id="console-block-1">
<input class="c-tab-unix" id="c-tab-1-unix" type="radio" name="console-1" checked>
<label for="c-tab-1-unix" title="Linux/macOS">&#xf17c/&#xf179</label>
<input class="c-tab-win" id="c-tab-1-win" type="radio" name="console-1">
<label for="c-tab-1-win" title="Windows">&#xf17a</label>
<section class="c-content-unix" id="c-content-1-unix">
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">cd</span> geodjango
<span class="gp">$</span> python manage.py startapp world
</pre></div>
</div>
</section>
<section class="c-content-win" id="c-content-1-win">
<div class="highlight"><pre><span></span><span class="gp">...\&gt;</span> <span class="k">cd</span> geodjango
<span class="gp">...\&gt;</span> py manage.py startapp world
</pre></div>
</section>
</div>
</div>
<div class="section" id="s-configure-settings-py">
<span id="configure-settings-py"></span><h3>Configuration de <code class="docutils literal notranslate"><span class="pre">settings.py</span></code><a class="headerlink" href="#configure-settings-py" title="Lien permanent vers ce titre">¶</a></h3>
<p>Les réglages du projet <code class="docutils literal notranslate"><span class="pre">geodjango</span></code> sont dans le fichier <code class="docutils literal notranslate"><span class="pre">geodjango/settings.py</span></code>. Modifiez les réglages de la connexion de base de données pour qu’ils correspondent à votre configuration&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">DATABASES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;default&#39;</span><span class="p">:</span> <span class="p">{</span>
         <span class="s1">&#39;ENGINE&#39;</span><span class="p">:</span> <span class="s1">&#39;django.contrib.gis.db.backends.postgis&#39;</span><span class="p">,</span>
         <span class="s1">&#39;NAME&#39;</span><span class="p">:</span> <span class="s1">&#39;geodjango&#39;</span><span class="p">,</span>
         <span class="s1">&#39;USER&#39;</span><span class="p">:</span> <span class="s1">&#39;geo&#39;</span><span class="p">,</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
<p>De plus, modifiez le réglage <a class="reference internal" href="../../settings.html#std:setting-INSTALLED_APPS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">INSTALLED_APPS</span></code></a> pour qu’il contienne <a class="reference internal" href="../admin/index.html#module-django.contrib.admin" title="django.contrib.admin: Django's admin site."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.admin</span></code></a>, <a class="reference internal" href="index.html#module-django.contrib.gis" title="django.contrib.gis: Geographic Information System (GIS) extensions for Django"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.gis</span></code></a> et <code class="docutils literal notranslate"><span class="pre">world</span></code> (l’application que vous venez de créer)&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;django.contrib.admin&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.auth&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.contenttypes&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.sessions&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.messages&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.staticfiles&#39;</span><span class="p">,</span>
    <span class="s1">&#39;django.contrib.gis&#39;</span><span class="p">,</span>
    <span class="s1">&#39;world&#39;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="s-geographic-data">
<span id="geographic-data"></span><h2>Données géographiques<a class="headerlink" href="#geographic-data" title="Lien permanent vers ce titre">¶</a></h2>
<div class="section" id="s-worldborders">
<span id="s-id3"></span><span id="worldborders"></span><span id="id3"></span><h3>Frontières mondiales<a class="headerlink" href="#worldborders" title="Lien permanent vers ce titre">¶</a></h3>
<p>Les données des frontières mondiales sont disponibles dans ce <a class="reference external" href="https://thematicmapping.org/downloads/TM_WORLD_BORDERS-0.3.zip">fichier zip</a>. Créez un répertoire <code class="docutils literal notranslate"><span class="pre">data</span></code> dans l’application <code class="docutils literal notranslate"><span class="pre">world</span></code>, téléchargez les données des frontières mondiales et décompressez le fichier. Sur les plates-formes GNU/Linux, utilisez les commandes suivantes&nbsp;:</p>
<div class="console-block" id="console-block-2">
<input class="c-tab-unix" id="c-tab-2-unix" type="radio" name="console-2" checked>
<label for="c-tab-2-unix" title="Linux/macOS">&#xf17c/&#xf179</label>
<input class="c-tab-win" id="c-tab-2-win" type="radio" name="console-2">
<label for="c-tab-2-win" title="Windows">&#xf17a</label>
<section class="c-content-unix" id="c-content-2-unix">
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> mkdir world/data
<span class="gp">$</span> <span class="nb">cd</span> world/data
<span class="gp">$</span> wget https://thematicmapping.org/downloads/TM_WORLD_BORDERS-0.3.zip
<span class="gp">$</span> unzip TM_WORLD_BORDERS-0.3.zip
<span class="gp">$</span> <span class="nb">cd</span> ../..
</pre></div>
</div>
</section>
<section class="c-content-win" id="c-content-2-win">
<div class="highlight"><pre><span></span><span class="gp">...\&gt;</span> <span class="k">mkdir</span> world\data
<span class="gp">...\&gt;</span> <span class="k">cd</span> world\data
<span class="gp">...\&gt;</span> wget https://thematicmapping.org/downloads/TM_WORLD_BORDERS-0.3.zip
<span class="gp">...\&gt;</span> unzip TM_WORLD_BORDERS-0.3.zip
<span class="gp">...\&gt;</span> <span class="k">cd</span> ..\..
</pre></div>
</section>
</div>
<p>Le fichier ZIP des frontières mondiales contient un ensemble de fichiers de données formant ensemble ce qu’on appelle un <a class="reference external" href="https://en.wikipedia.org/wiki/Shapefile">Shapefile ESRI</a>, l’un des formats de données géospatiales les plus utilisés. Après décompression, le jeu de données des frontières mondiales contient des fichiers avec les extensions suivantes&nbsp;:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">.shp</span></code>: contient les données vectorielles des objets géométriques des frontières mondiales.</li>
<li><code class="docutils literal notranslate"><span class="pre">.shx</span></code>: fichier d’index spatial des objets géométriques stockés dans les fichiers</li>
<li><code class="docutils literal notranslate"><span class="pre">.dbf</span></code>: fichier de base de données contenant les données d’attributs non géométriques (par ex. des champs de nombres entiers ou de texte).</li>
<li><code class="docutils literal notranslate"><span class="pre">.prj</span></code>: contient les informations de référence spatiale pour les données géographiques stockées dans le shapefile.</li>
</ul>
</div>
<div class="section" id="s-use-ogrinfo-to-examine-spatial-data">
<span id="use-ogrinfo-to-examine-spatial-data"></span><h3>Utilisation de <code class="docutils literal notranslate"><span class="pre">ogrinfo</span></code> pour examiner les données spatiales<a class="headerlink" href="#use-ogrinfo-to-examine-spatial-data" title="Lien permanent vers ce titre">¶</a></h3>
<p>L’utilitaire GDAL <code class="docutils literal notranslate"><span class="pre">ogrinfo</span></code> permet d’examiner les métadonnées des shapefiles ou d’autres sources de données vectorielles&nbsp;:</p>
<div class="console-block" id="console-block-3">
<input class="c-tab-unix" id="c-tab-3-unix" type="radio" name="console-3" checked>
<label for="c-tab-3-unix" title="Linux/macOS">&#xf17c/&#xf179</label>
<input class="c-tab-win" id="c-tab-3-win" type="radio" name="console-3">
<label for="c-tab-3-win" title="Windows">&#xf17a</label>
<section class="c-content-unix" id="c-content-3-unix">
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ogrinfo world/data/TM_WORLD_BORDERS-0.3.shp
<span class="go">INFO: Open of `world/data/TM_WORLD_BORDERS-0.3.shp&#39;</span>
<span class="go">      using driver `ESRI Shapefile&#39; successful.</span>
<span class="go">1: TM_WORLD_BORDERS-0.3 (Polygon)</span>
</pre></div>
</div>
</section>
<section class="c-content-win" id="c-content-3-win">
<div class="highlight"><pre><span></span><span class="gp">...\&gt;</span> ogrinfo world\data\TM_WORLD_BORDERS-0.3.shp
<span class="go">INFO: Open of `world/data/TM_WORLD_BORDERS-0.3.shp&#39;</span>
<span class="go">      using driver `ESRI Shapefile&#39; successful.</span>
<span class="go">1: TM_WORLD_BORDERS-0.3 (Polygon)</span>
</pre></div>
</section>
</div>
<p><code class="docutils literal notranslate"><span class="pre">ogrinfo</span></code> nous indique que le shapefile possède une couche et que celle-ci contient des données de type polygone. Pour en savoir plus, nous indiquons le nom de la couche et nous utilisons l’option <code class="docutils literal notranslate"><span class="pre">-so</span></code> pour n’afficher que le résumé des informations importantes&nbsp;:</p>
<div class="console-block" id="console-block-4">
<input class="c-tab-unix" id="c-tab-4-unix" type="radio" name="console-4" checked>
<label for="c-tab-4-unix" title="Linux/macOS">&#xf17c/&#xf179</label>
<input class="c-tab-win" id="c-tab-4-win" type="radio" name="console-4">
<label for="c-tab-4-win" title="Windows">&#xf17a</label>
<section class="c-content-unix" id="c-content-4-unix">
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ogrinfo -so world/data/TM_WORLD_BORDERS-0.3.shp TM_WORLD_BORDERS-0.3
<span class="go">INFO: Open of `world/data/TM_WORLD_BORDERS-0.3.shp&#39;</span>
<span class="go">      using driver `ESRI Shapefile&#39; successful.</span>

<span class="go">Layer name: TM_WORLD_BORDERS-0.3</span>
<span class="go">Geometry: Polygon</span>
<span class="go">Feature Count: 246</span>
<span class="go">Extent: (-180.000000, -90.000000) - (180.000000, 83.623596)</span>
<span class="go">Layer SRS WKT:</span>
<span class="go">GEOGCS[&quot;GCS_WGS_1984&quot;,</span>
<span class="go">    DATUM[&quot;WGS_1984&quot;,</span>
<span class="go">        SPHEROID[&quot;WGS_1984&quot;,6378137.0,298.257223563]],</span>
<span class="go">    PRIMEM[&quot;Greenwich&quot;,0.0],</span>
<span class="go">    UNIT[&quot;Degree&quot;,0.0174532925199433]]</span>
<span class="go">FIPS: String (2.0)</span>
<span class="go">ISO2: String (2.0)</span>
<span class="go">ISO3: String (3.0)</span>
<span class="go">UN: Integer (3.0)</span>
<span class="go">NAME: String (50.0)</span>
<span class="go">AREA: Integer (7.0)</span>
<span class="go">POP2005: Integer (10.0)</span>
<span class="go">REGION: Integer (3.0)</span>
<span class="go">SUBREGION: Integer (3.0)</span>
<span class="go">LON: Real (8.3)</span>
<span class="go">LAT: Real (7.3)</span>
</pre></div>
</div>
</section>
<section class="c-content-win" id="c-content-4-win">
<div class="highlight"><pre><span></span><span class="gp">...\&gt;</span> ogrinfo -so world\data\TM_WORLD_BORDERS-0.3.shp TM_WORLD_BORDERS-0.3
<span class="go">INFO: Open of `world/data/TM_WORLD_BORDERS-0.3.shp&#39;</span>
<span class="go">      using driver `ESRI Shapefile&#39; successful.</span>

<span class="go">Layer name: TM_WORLD_BORDERS-0.3</span>
<span class="go">Geometry: Polygon</span>
<span class="go">Feature Count: 246</span>
<span class="go">Extent: (-180.000000, -90.000000) - (180.000000, 83.623596)</span>
<span class="go">Layer SRS WKT:</span>
<span class="go">GEOGCS[&quot;GCS_WGS_1984&quot;,</span>
<span class="go">    DATUM[&quot;WGS_1984&quot;,</span>
<span class="go">        SPHEROID[&quot;WGS_1984&quot;,6378137.0,298.257223563]],</span>
<span class="go">    PRIMEM[&quot;Greenwich&quot;,0.0],</span>
<span class="go">    UNIT[&quot;Degree&quot;,0.0174532925199433]]</span>
<span class="go">FIPS: String (2.0)</span>
<span class="go">ISO2: String (2.0)</span>
<span class="go">ISO3: String (3.0)</span>
<span class="go">UN: Integer (3.0)</span>
<span class="go">NAME: String (50.0)</span>
<span class="go">AREA: Integer (7.0)</span>
<span class="go">POP2005: Integer (10.0)</span>
<span class="go">REGION: Integer (3.0)</span>
<span class="go">SUBREGION: Integer (3.0)</span>
<span class="go">LON: Real (8.3)</span>
<span class="go">LAT: Real (7.3)</span>
</pre></div>
</section>
</div>
<p>Ce résumé d’informations détaillé nous indique le nombre d’objets dans la couche (246), les limites géographiques des données, le système de référence spatial («&nbsp;SRS WKT&nbsp;») ainsi que le type d’information de chaque champ d’attribut. Par exemple, <code class="docutils literal notranslate"><span class="pre">FIPS:</span> <span class="pre">String</span> <span class="pre">(2.0)</span></code> indique que la longueur maximale du champ textuel <code class="docutils literal notranslate"><span class="pre">FIPS</span></code> est de 2 caractères. De même, <code class="docutils literal notranslate"><span class="pre">LON:</span> <span class="pre">Real</span> <span class="pre">(8.3)</span></code> correspond à un champ nombre en virgule flottante contenant un maximum de 8 chiffres avant la virgule et 3 après.</p>
</div>
</div>
<div class="section" id="s-geographic-models">
<span id="geographic-models"></span><h2>Modèles géographiques<a class="headerlink" href="#geographic-models" title="Lien permanent vers ce titre">¶</a></h2>
<div class="section" id="s-defining-a-geographic-model">
<span id="defining-a-geographic-model"></span><h3>Définition d’un modèle géographique<a class="headerlink" href="#defining-a-geographic-model" title="Lien permanent vers ce titre">¶</a></h3>
<p>Après avoir examiné le jeu de données à l’aide de <code class="docutils literal notranslate"><span class="pre">ogrinfo</span></code>, créez un modèle GeoDjango pour représenter ces données&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.gis.db</span> <span class="k">import</span> <span class="n">models</span>

<span class="k">class</span> <span class="nc">WorldBorder</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="c1"># Regular Django fields corresponding to the attributes in the</span>
    <span class="c1"># world borders shapefile.</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">area</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>
    <span class="n">pop2005</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="s1">&#39;Population 2005&#39;</span><span class="p">)</span>
    <span class="n">fips</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="s1">&#39;FIPS Code&#39;</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">null</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">iso2</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="s1">&#39;2 Digit ISO&#39;</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">iso3</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="s1">&#39;3 Digit ISO&#39;</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">un</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="s1">&#39;United Nations Code&#39;</span><span class="p">)</span>
    <span class="n">region</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="s1">&#39;Region Code&#39;</span><span class="p">)</span>
    <span class="n">subregion</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">(</span><span class="s1">&#39;Sub-Region Code&#39;</span><span class="p">)</span>
    <span class="n">lon</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">FloatField</span><span class="p">()</span>
    <span class="n">lat</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">FloatField</span><span class="p">()</span>

    <span class="c1"># GeoDjango-specific: a geometry field (MultiPolygonField)</span>
    <span class="n">mpoly</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">MultiPolygonField</span><span class="p">()</span>

    <span class="c1"># Returns the string representation of the model.</span>
    <span class="k">def</span> <span class="nf">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
</pre></div>
</div>
<p>Notez que le module <code class="docutils literal notranslate"><span class="pre">models</span></code> est importé à partir de <code class="docutils literal notranslate"><span class="pre">django.contrib.gis.db</span></code>.</p>
<p>Le système de référence spatial par défaut des champs géométriques est WGS84 (ce qui implique une valeur de <a class="reference external" href="https://en.wikipedia.org/wiki/SRID">SRID</a> de 4326)&nbsp;; en d’autres termes, les coordonnées du champ sont des couples longitude/latitude en degrés. Pour utiliser un système de coordonnées différent, définissez le SRID du champ géométrique avec le paramètre <code class="docutils literal notranslate"><span class="pre">srid</span></code>. Utilisez un nombre entier représentant le code EPSG du système de coordonnées.</p>
</div>
<div class="section" id="s-run-migrate">
<span id="run-migrate"></span><h3>Exécutez <code class="docutils literal notranslate"><span class="pre">migrate</span></code><a class="headerlink" href="#run-migrate" title="Lien permanent vers ce titre">¶</a></h3>
<p>Après avoir défini le modèle, vous devez le synchroniser avec la base de données. Créez tout d’abord une migration de base de données&nbsp;:</p>
<div class="console-block" id="console-block-5">
<input class="c-tab-unix" id="c-tab-5-unix" type="radio" name="console-5" checked>
<label for="c-tab-5-unix" title="Linux/macOS">&#xf17c/&#xf179</label>
<input class="c-tab-win" id="c-tab-5-win" type="radio" name="console-5">
<label for="c-tab-5-win" title="Windows">&#xf17a</label>
<section class="c-content-unix" id="c-content-5-unix">
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> python manage.py makemigrations
<span class="go">Migrations for &#39;world&#39;:</span>
<span class="go">  world/migrations/0001_initial.py:</span>
<span class="go">    - Create model WorldBorder</span>
</pre></div>
</div>
</section>
<section class="c-content-win" id="c-content-5-win">
<div class="highlight"><pre><span></span><span class="gp">...\&gt;</span> py manage.py makemigrations
<span class="go">Migrations for &#39;world&#39;:</span>
<span class="go">  world/migrations/0001_initial.py:</span>
<span class="go">    - Create model WorldBorder</span>
</pre></div>
</section>
</div>
<p>Examinons le code SQL qui générera la table du modèle <code class="docutils literal notranslate"><span class="pre">WorldBorder</span></code>:</p>
<div class="console-block" id="console-block-6">
<input class="c-tab-unix" id="c-tab-6-unix" type="radio" name="console-6" checked>
<label for="c-tab-6-unix" title="Linux/macOS">&#xf17c/&#xf179</label>
<input class="c-tab-win" id="c-tab-6-win" type="radio" name="console-6">
<label for="c-tab-6-win" title="Windows">&#xf17a</label>
<section class="c-content-unix" id="c-content-6-unix">
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> python manage.py sqlmigrate world <span class="m">0001</span>
</pre></div>
</div>
</section>
<section class="c-content-win" id="c-content-6-win">
<div class="highlight"><pre><span></span><span class="gp">...\&gt;</span> py manage.py sqlmigrate world 0001
</pre></div>
</section>
</div>
<p>Cette commande devrait produire le résultat suivant&nbsp;:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">BEGIN;</span>
<span class="go">--</span>
<span class="go">-- Create model WorldBorder</span>
<span class="go">--</span>
<span class="go">CREATE TABLE &quot;world_worldborder&quot; (</span>
<span class="go">    &quot;id&quot; serial NOT NULL PRIMARY KEY,</span>
<span class="go">    &quot;name&quot; varchar(50) NOT NULL,</span>
<span class="go">    &quot;area&quot; integer NOT NULL,</span>
<span class="go">    &quot;pop2005&quot; integer NOT NULL,</span>
<span class="go">    &quot;fips&quot; varchar(2) NOT NULL,</span>
<span class="go">    &quot;iso2&quot; varchar(2) NOT NULL,</span>
<span class="go">    &quot;iso3&quot; varchar(3) NOT NULL,</span>
<span class="go">    &quot;un&quot; integer NOT NULL,</span>
<span class="go">    &quot;region&quot; integer NOT NULL,</span>
<span class="go">    &quot;subregion&quot; integer NOT NULL,</span>
<span class="go">    &quot;lon&quot; double precision NOT NULL,</span>
<span class="go">    &quot;lat&quot; double precision NOT NULL</span>
<span class="go">    &quot;mpoly&quot; geometry(MULTIPOLYGON,4326) NOT NULL</span>
<span class="go">)</span>
<span class="go">;</span>
<span class="go">CREATE INDEX &quot;world_worldborder_mpoly_id&quot; ON &quot;world_worldborder&quot; USING GIST ( &quot;mpoly&quot; );</span>
<span class="go">COMMIT;</span>
</pre></div>
</div>
<p>Si cela vous semble correct, exécutez <a class="reference internal" href="../../django-admin.html#django-admin-migrate"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">migrate</span></code></a> pour créer la table dans la base de données&nbsp;:</p>
<div class="console-block" id="console-block-8">
<input class="c-tab-unix" id="c-tab-8-unix" type="radio" name="console-8" checked>
<label for="c-tab-8-unix" title="Linux/macOS">&#xf17c/&#xf179</label>
<input class="c-tab-win" id="c-tab-8-win" type="radio" name="console-8">
<label for="c-tab-8-win" title="Windows">&#xf17a</label>
<section class="c-content-unix" id="c-content-8-unix">
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> python manage.py migrate
<span class="go">Operations to perform:</span>
<span class="go">  Apply all migrations: admin, auth, contenttypes, sessions, world</span>
<span class="go">Running migrations:</span>
<span class="go">  ...</span>
<span class="go">  Applying world.0001_initial... OK</span>
</pre></div>
</div>
</section>
<section class="c-content-win" id="c-content-8-win">
<div class="highlight"><pre><span></span><span class="gp">...\&gt;</span> py manage.py migrate
<span class="go">Operations to perform:</span>
<span class="go">  Apply all migrations: admin, auth, contenttypes, sessions, world</span>
<span class="go">Running migrations:</span>
<span class="go">  ...</span>
<span class="go">  Applying world.0001_initial... OK</span>
</pre></div>
</section>
</div>
</div>
</div>
<div class="section" id="s-importing-spatial-data">
<span id="importing-spatial-data"></span><h2>Importation de données spatiales<a class="headerlink" href="#importing-spatial-data" title="Lien permanent vers ce titre">¶</a></h2>
<p>Cette section présente la manière d’importer le fichier des frontières mondiales dans une base de données via les modèles GeoDjango en utilisant l”<a class="reference internal" href="layermapping.html"><span class="doc">Utilitaire d’importation de données LayerMapping</span></a>.</p>
<p>Il existe plusieurs façons d’importer des données dans une base de données spatiale&nbsp;; en plus des outils inclus avec GeoDjango, il est aussi possible d’utiliser&nbsp;:</p>
<ul class="simple">
<li><a class="reference external" href="https://gdal.org/programs/ogr2ogr.html">ogr2ogr</a>: un utilitaire en ligne de commande inclus dans GDAL et qui peut importer de nombreux formats de données vectorielles dans des bases de données PostGIS, MySQL et Oracle.</li>
<li><a class="reference external" href="https://postgis.net/docs/using_postgis_dbmanagement.html#shp2pgsql_usage">shp2pgsql</a>: cet utilitaire inclus dans PostGIS importe des shapefiles ESRI dans PostGIS.</li>
</ul>
<div class="section" id="s-gdal-interface">
<span id="s-gdalinterface"></span><span id="gdal-interface"></span><span id="gdalinterface"></span><h3>Interface GDAL<a class="headerlink" href="#gdal-interface" title="Lien permanent vers ce titre">¶</a></h3>
<p>Vous avez précédemment utilisé <code class="docutils literal notranslate"><span class="pre">ogrinfo</span></code> pour examiner le contenu du fichier des frontières mondiales. GeoDjango contient également une interface Python vers la puissante bibliothèque OGR de GDAL qui est capable de traiter toutes les sources de données vectorielles prises en charge par OGR.</p>
<p>Premièrement, lancez le shell Django&nbsp;:</p>
<div class="console-block" id="console-block-9">
<input class="c-tab-unix" id="c-tab-9-unix" type="radio" name="console-9" checked>
<label for="c-tab-9-unix" title="Linux/macOS">&#xf17c/&#xf179</label>
<input class="c-tab-win" id="c-tab-9-win" type="radio" name="console-9">
<label for="c-tab-9-win" title="Windows">&#xf17a</label>
<section class="c-content-unix" id="c-content-9-unix">
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> python manage.py shell
</pre></div>
</div>
</section>
<section class="c-content-win" id="c-content-9-win">
<div class="highlight"><pre><span></span><span class="gp">...\&gt;</span> py manage.py shell
</pre></div>
</section>
</div>
<p>Si vous avez téléchargé les données <a class="reference internal" href="#worldborders"><span class="std std-ref">Frontières mondiales</span></a> précédemment dans ce tutoriel, vous pouvez déterminer son chemin en utilisant <a class="reference external" href="https://docs.python.org/3/library/pathlib.html#pathlib.Path" title="(disponible dans Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">pathlib.Path</span></code></a> de Python&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="k">import</span> <span class="n">Path</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">world</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">world_shp</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">world</span><span class="o">.</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s1">&#39;data&#39;</span> <span class="o">/</span> <span class="s1">&#39;TM_WORLD_BORDERS-0.3.shp&#39;</span>
</pre></div>
</div>
<p>Ouvrez maintenant le fichier shapefile des frontières mondiales en utilisant l’interface <a class="reference internal" href="gdal.html#django.contrib.gis.gdal.DataSource" title="django.contrib.gis.gdal.DataSource"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataSource</span></code></a> de GeoDjango&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.contrib.gis.gdal</span> <span class="k">import</span> <span class="n">DataSource</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ds</span> <span class="o">=</span> <span class="n">DataSource</span><span class="p">(</span><span class="n">world_shp</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">ds</span><span class="p">)</span>
<span class="go">/ ... /geodjango/world/data/TM_WORLD_BORDERS-0.3.shp (ESRI Shapefile)</span>
</pre></div>
</div>
<p>Les objets des sources de données peuvent posséder plusieurs couches de contenu géospatial&nbsp;; cependant, les fichiers shapefile ne peuvent contenir qu’une seule couche&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="p">))</span>
<span class="go">1</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">lyr</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">lyr</span><span class="p">)</span>
<span class="go">TM_WORLD_BORDERS-0.3</span>
</pre></div>
</div>
<p>Vous pouvez voir le type géométrique de la couche ainsi que le nombre d’objets qu’elle contient&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">lyr</span><span class="o">.</span><span class="n">geom_type</span><span class="p">)</span>
<span class="go">Polygon</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lyr</span><span class="p">))</span>
<span class="go">246</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Malheureusement, le format de données shapefile ne permet pas de plus grande précision concernant le type géométrique. Ce fichier shapefile, comme beaucoup d’autres, contient en réalité des objets géométriques <code class="docutils literal notranslate"><span class="pre">MultiPolygon</span></code>, et non pas des <code class="docutils literal notranslate"><span class="pre">Polygon</span></code>. Il est important d’utiliser un type de champ plus général dans les modèles&nbsp;: un champ <code class="docutils literal notranslate"><span class="pre">MultiPolygonField</span></code> de GeoDjango acceptera un objet <code class="docutils literal notranslate"><span class="pre">Polygon</span></code>, mais un champ <code class="docutils literal notranslate"><span class="pre">PolygonField</span></code> n’acceptera pas un objet géométrique de type <code class="docutils literal notranslate"><span class="pre">MultiPolygon</span></code>. C’est pourquoi le modèle <code class="docutils literal notranslate"><span class="pre">WorldBorder</span></code> défini ci-dessus utilise un champ</p>
</div>
<p>Il est aussi possible qu’un système de référence spatial soit associé à l’objet <a class="reference internal" href="gdal.html#django.contrib.gis.gdal.Layer" title="django.contrib.gis.gdal.Layer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Layer</span></code></a>. Si c’est le cas, l’attribut <code class="docutils literal notranslate"><span class="pre">srs</span></code> renvoie un objet <a class="reference internal" href="gdal.html#django.contrib.gis.gdal.SpatialReference" title="django.contrib.gis.gdal.SpatialReference"><code class="xref py py-class docutils literal notranslate"><span class="pre">SpatialReference</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">srs</span> <span class="o">=</span> <span class="n">lyr</span><span class="o">.</span><span class="n">srs</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">srs</span><span class="p">)</span>
<span class="go">GEOGCS[&quot;GCS_WGS_1984&quot;,</span>
<span class="go">    DATUM[&quot;WGS_1984&quot;,</span>
<span class="go">        SPHEROID[&quot;WGS_1984&quot;,6378137.0,298.257223563]],</span>
<span class="go">    PRIMEM[&quot;Greenwich&quot;,0.0],</span>
<span class="go">    UNIT[&quot;Degree&quot;,0.0174532925199433]]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">srs</span><span class="o">.</span><span class="n">proj4</span> <span class="c1"># PROJ.4 representation</span>
<span class="go">&#39;+proj=longlat +ellps=WGS84 +datum=WGS84 +no_defs &#39;</span>
</pre></div>
</div>
<p>Ce fichier shapefile utilise le système de référence spatial bien connu WGS84&nbsp;; en d’autres termes, les données sont représentées par des couples longitude/latitude en degrés.</p>
<p>De plus, les fichiers shapefile peuvent aussi contenir des champs d’attributs comportant des données supplémentaires. Voici ces champs pour la couche <code class="docutils literal notranslate"><span class="pre">World</span> <span class="pre">Borders</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">lyr</span><span class="o">.</span><span class="n">fields</span><span class="p">)</span>
<span class="go">[&#39;FIPS&#39;, &#39;ISO2&#39;, &#39;ISO3&#39;, &#39;UN&#39;, &#39;NAME&#39;, &#39;AREA&#39;, &#39;POP2005&#39;, &#39;REGION&#39;, &#39;SUBREGION&#39;, &#39;LON&#39;, &#39;LAT&#39;]</span>
</pre></div>
</div>
<p>Le code suivant permet d’examiner le type OGR (par ex. nombre entier ou chaîne de caractères) associé à chaque champ&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="p">[</span><span class="n">fld</span><span class="o">.</span><span class="vm">__name__</span> <span class="k">for</span> <span class="n">fld</span> <span class="ow">in</span> <span class="n">lyr</span><span class="o">.</span><span class="n">field_types</span><span class="p">]</span>
<span class="go">[&#39;OFTString&#39;, &#39;OFTString&#39;, &#39;OFTString&#39;, &#39;OFTInteger&#39;, &#39;OFTString&#39;, &#39;OFTInteger&#39;, &#39;OFTInteger&#39;, &#39;OFTInteger&#39;, &#39;OFTInteger&#39;, &#39;OFTReal&#39;, &#39;OFTReal&#39;]</span>
</pre></div>
</div>
<p>Il est possible de parcourir chaque objet de la couche et d’extraire des informations à la fois de la géométrie des objets (accessible par l’attribut <code class="docutils literal notranslate"><span class="pre">geom</span></code>) et des champs d’attribut des objets (dont les <strong>valeurs</strong> sont accessibles par la méthode <code class="docutils literal notranslate"><span class="pre">get()</span></code>)&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="k">for</span> <span class="n">feat</span> <span class="ow">in</span> <span class="n">lyr</span><span class="p">:</span>
<span class="gp">... </span>   <span class="nb">print</span><span class="p">(</span><span class="n">feat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NAME&#39;</span><span class="p">),</span> <span class="n">feat</span><span class="o">.</span><span class="n">geom</span><span class="o">.</span><span class="n">num_points</span><span class="p">)</span>
<span class="gp">...</span>
<span class="go">Guernsey 18</span>
<span class="go">Jersey 26</span>
<span class="go">South Georgia South Sandwich Islands 338</span>
<span class="go">Taiwan 363</span>
</pre></div>
</div>
<p>Les objets <a class="reference internal" href="gdal.html#django.contrib.gis.gdal.Layer" title="django.contrib.gis.gdal.Layer"><code class="xref py py-class docutils literal notranslate"><span class="pre">Layer</span></code></a> peuvent être segmentés&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">lyr</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span>
<span class="go">[&lt;django.contrib.gis.gdal.feature.Feature object at 0x2f47690&gt;, &lt;django.contrib.gis.gdal.feature.Feature object at 0x2f47650&gt;]</span>
</pre></div>
</div>
<p>Et des objets individuels peuvent être récupérés par leur identifiant d’objet&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">feat</span> <span class="o">=</span> <span class="n">lyr</span><span class="p">[</span><span class="mi">234</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">feat</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;NAME&#39;</span><span class="p">))</span>
<span class="go">San Marino</span>
</pre></div>
</div>
<p>Les objets géométriques des frontières peuvent être exportés en tant que WKT ou GeoJSON&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">geom</span> <span class="o">=</span> <span class="n">feat</span><span class="o">.</span><span class="n">geom</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">geom</span><span class="o">.</span><span class="n">wkt</span><span class="p">)</span>
<span class="go">POLYGON ((12.415798 43.957954,12.450554 ...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">geom</span><span class="o">.</span><span class="n">json</span><span class="p">)</span>
<span class="go">{ &quot;type&quot;: &quot;Polygon&quot;, &quot;coordinates&quot;: [ [ [ 12.415798, 43.957954 ], [ 12.450554, 43.979721 ], ...</span>
</pre></div>
</div>
</div>
<div class="section" id="s-layermapping">
<span id="layermapping"></span><h3>Cartographie des couches (<code class="docutils literal notranslate"><span class="pre">LayerMapping</span></code>)<a class="headerlink" href="#layermapping" title="Lien permanent vers ce titre">¶</a></h3>
<p>Pour importer les données, utilisez un objet LayerMapping dans un script Python. Créez un fichier nommé <code class="docutils literal notranslate"><span class="pre">load.py</span></code> dans l’application <code class="docutils literal notranslate"><span class="pre">world</span></code> et insérez-y le code suivant&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="k">import</span> <span class="n">Path</span>
<span class="kn">from</span> <span class="nn">django.contrib.gis.utils</span> <span class="k">import</span> <span class="n">LayerMapping</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="k">import</span> <span class="n">WorldBorder</span>

<span class="n">world_mapping</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;fips&#39;</span> <span class="p">:</span> <span class="s1">&#39;FIPS&#39;</span><span class="p">,</span>
    <span class="s1">&#39;iso2&#39;</span> <span class="p">:</span> <span class="s1">&#39;ISO2&#39;</span><span class="p">,</span>
    <span class="s1">&#39;iso3&#39;</span> <span class="p">:</span> <span class="s1">&#39;ISO3&#39;</span><span class="p">,</span>
    <span class="s1">&#39;un&#39;</span> <span class="p">:</span> <span class="s1">&#39;UN&#39;</span><span class="p">,</span>
    <span class="s1">&#39;name&#39;</span> <span class="p">:</span> <span class="s1">&#39;NAME&#39;</span><span class="p">,</span>
    <span class="s1">&#39;area&#39;</span> <span class="p">:</span> <span class="s1">&#39;AREA&#39;</span><span class="p">,</span>
    <span class="s1">&#39;pop2005&#39;</span> <span class="p">:</span> <span class="s1">&#39;POP2005&#39;</span><span class="p">,</span>
    <span class="s1">&#39;region&#39;</span> <span class="p">:</span> <span class="s1">&#39;REGION&#39;</span><span class="p">,</span>
    <span class="s1">&#39;subregion&#39;</span> <span class="p">:</span> <span class="s1">&#39;SUBREGION&#39;</span><span class="p">,</span>
    <span class="s1">&#39;lon&#39;</span> <span class="p">:</span> <span class="s1">&#39;LON&#39;</span><span class="p">,</span>
    <span class="s1">&#39;lat&#39;</span> <span class="p">:</span> <span class="s1">&#39;LAT&#39;</span><span class="p">,</span>
    <span class="s1">&#39;mpoly&#39;</span> <span class="p">:</span> <span class="s1">&#39;MULTIPOLYGON&#39;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">world_shp</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span><span class="o">.</span><span class="n">resolve</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s1">&#39;data&#39;</span> <span class="o">/</span> <span class="s1">&#39;TM_WORLD_BORDERS-0.3.shp&#39;</span>

<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="n">lm</span> <span class="o">=</span> <span class="n">LayerMapping</span><span class="p">(</span><span class="n">WorldBorder</span><span class="p">,</span> <span class="n">world_shp</span><span class="p">,</span> <span class="n">world_mapping</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">lm</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">strict</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
</pre></div>
</div>
<p>Quelques notes au sujet du procédé&nbsp;:</p>
<ul class="simple">
<li>Chaque clé du dictionnaire <code class="docutils literal notranslate"><span class="pre">world_mapping</span></code> correspond à un champ du modèle <code class="docutils literal notranslate"><span class="pre">WorldBorder</span></code>. La valeur est le nom du champ du shapefile duquel les données seront chargées.</li>
<li>La clé <code class="docutils literal notranslate"><span class="pre">mpoly</span></code> du champ géométrique est <code class="docutils literal notranslate"><span class="pre">MULTIPOLYGON</span></code>, le type géométrique que GeoDjango utilisera pour importer le champ. Même de simples polygones dans le fichier shapefile seront automatiquement convertis en collections avant leur insertion dans la base de données.</li>
<li>Le chemin vers le fichier shapefile n’est pas absolu&nbsp;; en d’autres termes, si vous déplacez l’application <code class="docutils literal notranslate"><span class="pre">world</span></code> (contenant le sous-répertoire <code class="docutils literal notranslate"><span class="pre">data</span></code>) vers un autre emplacement, le script fonctionne toujours.</li>
<li>Le paramètre <code class="docutils literal notranslate"><span class="pre">transform</span></code> est défini à <code class="docutils literal notranslate"><span class="pre">False</span></code> car les données du fichier shapefile ne doivent pas être converties, elles sont déjà au format WGS84 (SRID=4326).</li>
</ul>
<p>Après cela, appelez le shell Django à partir du répertoire de projet <code class="docutils literal notranslate"><span class="pre">geodjango</span></code>:</p>
<div class="console-block" id="console-block-10">
<input class="c-tab-unix" id="c-tab-10-unix" type="radio" name="console-10" checked>
<label for="c-tab-10-unix" title="Linux/macOS">&#xf17c/&#xf179</label>
<input class="c-tab-win" id="c-tab-10-win" type="radio" name="console-10">
<label for="c-tab-10-win" title="Windows">&#xf17a</label>
<section class="c-content-unix" id="c-content-10-unix">
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> python manage.py shell
</pre></div>
</div>
</section>
<section class="c-content-win" id="c-content-10-win">
<div class="highlight"><pre><span></span><span class="gp">...\&gt;</span> py manage.py shell
</pre></div>
</section>
</div>
<p>Puis, importez le module <code class="docutils literal notranslate"><span class="pre">load</span></code>, appelez la routine <code class="docutils literal notranslate"><span class="pre">run</span></code> et observez <code class="docutils literal notranslate"><span class="pre">LayerMapping</span></code> effectuant tout le travail&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">world</span> <span class="k">import</span> <span class="n">load</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">load</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="s-try-ogrinspect">
<span id="s-ogrinspect-intro"></span><span id="try-ogrinspect"></span><span id="ogrinspect-intro"></span><h3>Utilisation de <code class="docutils literal notranslate"><span class="pre">ogrinspect</span></code><a class="headerlink" href="#try-ogrinspect" title="Lien permanent vers ce titre">¶</a></h3>
<p>Maintenant que vous avez vu comment définir des modèles géographiques et importer des données avec l”<a class="reference internal" href="layermapping.html"><span class="doc">Utilitaire d’importation de données LayerMapping</span></a>, il est possible d’automatiser davantage ce processus à l’aide de la commande de gestion <a class="reference internal" href="commands.html#django-admin-ogrinspect"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">ogrinspect</span></code></a>. La commande <a class="reference internal" href="commands.html#django-admin-ogrinspect"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">ogrinspect</span></code></a> inspecte une source de données vectorielle prise en charge par GDAL (par ex. un shapefile) et génère automatiquement une définition de modèle ainsi qu’un dictionnaire <code class="docutils literal notranslate"><span class="pre">LayerMapping</span></code>.</p>
<p>L’utilisation générale de la commande correspond à ceci&nbsp;:</p>
<div class="console-block" id="console-block-11">
<input class="c-tab-unix" id="c-tab-11-unix" type="radio" name="console-11" checked>
<label for="c-tab-11-unix" title="Linux/macOS">&#xf17c/&#xf179</label>
<input class="c-tab-win" id="c-tab-11-win" type="radio" name="console-11">
<label for="c-tab-11-win" title="Windows">&#xf17a</label>
<section class="c-content-unix" id="c-content-11-unix">
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> python manage.py ogrinspect <span class="o">[</span>options<span class="o">]</span> &lt;data_source&gt; &lt;model_name&gt; <span class="o">[</span>options<span class="o">]</span>
</pre></div>
</div>
</section>
<section class="c-content-win" id="c-content-11-win">
<div class="highlight"><pre><span></span><span class="gp">...\&gt;</span> py manage.py ogrinspect [options] <span class="p">&lt;</span>data_source<span class="p">&gt;</span> &lt;model_name<span class="p">&gt;</span> [options]
</pre></div>
</section>
</div>
<p><code class="docutils literal notranslate"><span class="pre">data_source</span></code> est le chemin vers la source de données prise en charge par GDAL et <code class="docutils literal notranslate"><span class="pre">model_name</span></code> est le nom à utiliser pour le modèle. Les options en ligne de commande peuvent être utilisées pour définir plus finement la manière dont le modèle doit être généré.</p>
<p>Par exemple, la commande suivante reproduit presque le modèle <code class="docutils literal notranslate"><span class="pre">WorldBorder</span></code> et le dictionnaire de correspondance créés ci-dessus, de façon automatique&nbsp;:</p>
<div class="console-block" id="console-block-12">
<input class="c-tab-unix" id="c-tab-12-unix" type="radio" name="console-12" checked>
<label for="c-tab-12-unix" title="Linux/macOS">&#xf17c/&#xf179</label>
<input class="c-tab-win" id="c-tab-12-win" type="radio" name="console-12">
<label for="c-tab-12-win" title="Windows">&#xf17a</label>
<section class="c-content-unix" id="c-content-12-unix">
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> python manage.py ogrinspect world/data/TM_WORLD_BORDERS-0.3.shp WorldBorder <span class="se">\</span>
    --srid<span class="o">=</span><span class="m">4326</span> --mapping --multi
</pre></div>
</div>
</section>
<section class="c-content-win" id="c-content-12-win">
<div class="highlight"><pre><span></span><span class="gp">...\&gt;</span> py manage.py ogrinspect world\data\TM_WORLD_BORDERS-0.3.shp WorldBorder \
    --srid=4326 --mapping --multi
</pre></div>
</section>
</div>
<p>Quelques notes sur les options de ligne de commande indiquées ci-dessus&nbsp;:</p>
<ul class="simple">
<li>L’option <code class="docutils literal notranslate"><span class="pre">--srid=4326</span></code> définit le SRID du champ géographique.</li>
<li>L’option <code class="docutils literal notranslate"><span class="pre">--mapping</span></code> indique à <code class="docutils literal notranslate"><span class="pre">ogrinspect</span></code> de générer aussi un dictionnaire de correspondance à l’usage de <a class="reference internal" href="layermapping.html#django.contrib.gis.utils.LayerMapping" title="django.contrib.gis.utils.LayerMapping"><code class="xref py py-class docutils literal notranslate"><span class="pre">LayerMapping</span></code></a>.</li>
<li>L’option <code class="docutils literal notranslate"><span class="pre">--multi</span></code> est indiquée pour que le champ géographique utilise <a class="reference internal" href="model-api.html#django.contrib.gis.db.models.MultiPolygonField" title="django.contrib.gis.db.models.MultiPolygonField"><code class="xref py py-class docutils literal notranslate"><span class="pre">MultiPolygonField</span></code></a> au lieu d’un simple <a class="reference internal" href="model-api.html#django.contrib.gis.db.models.PolygonField" title="django.contrib.gis.db.models.PolygonField"><code class="xref py py-class docutils literal notranslate"><span class="pre">PolygonField</span></code></a>.</li>
</ul>
<p>La commande produit le résultat suivant, qui peut être directement copié dans un fichier <code class="docutils literal notranslate"><span class="pre">models.py</span></code> d’une application GeoDjango&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># This is an auto-generated Django model module created by ogrinspect.</span>
<span class="kn">from</span> <span class="nn">django.contrib.gis.db</span> <span class="k">import</span> <span class="n">models</span>

<span class="k">class</span> <span class="nc">WorldBorder</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">fips</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">iso2</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">iso3</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">un</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">max_length</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
    <span class="n">area</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>
    <span class="n">pop2005</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>
    <span class="n">region</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>
    <span class="n">subregion</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">IntegerField</span><span class="p">()</span>
    <span class="n">lon</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">FloatField</span><span class="p">()</span>
    <span class="n">lat</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">FloatField</span><span class="p">()</span>
    <span class="n">geom</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">MultiPolygonField</span><span class="p">(</span><span class="n">srid</span><span class="o">=</span><span class="mi">4326</span><span class="p">)</span>

<span class="c1"># Auto-generated `LayerMapping` dictionary for WorldBorder model</span>
<span class="n">worldborders_mapping</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;fips&#39;</span> <span class="p">:</span> <span class="s1">&#39;FIPS&#39;</span><span class="p">,</span>
    <span class="s1">&#39;iso2&#39;</span> <span class="p">:</span> <span class="s1">&#39;ISO2&#39;</span><span class="p">,</span>
    <span class="s1">&#39;iso3&#39;</span> <span class="p">:</span> <span class="s1">&#39;ISO3&#39;</span><span class="p">,</span>
    <span class="s1">&#39;un&#39;</span> <span class="p">:</span> <span class="s1">&#39;UN&#39;</span><span class="p">,</span>
    <span class="s1">&#39;name&#39;</span> <span class="p">:</span> <span class="s1">&#39;NAME&#39;</span><span class="p">,</span>
    <span class="s1">&#39;area&#39;</span> <span class="p">:</span> <span class="s1">&#39;AREA&#39;</span><span class="p">,</span>
    <span class="s1">&#39;pop2005&#39;</span> <span class="p">:</span> <span class="s1">&#39;POP2005&#39;</span><span class="p">,</span>
    <span class="s1">&#39;region&#39;</span> <span class="p">:</span> <span class="s1">&#39;REGION&#39;</span><span class="p">,</span>
    <span class="s1">&#39;subregion&#39;</span> <span class="p">:</span> <span class="s1">&#39;SUBREGION&#39;</span><span class="p">,</span>
    <span class="s1">&#39;lon&#39;</span> <span class="p">:</span> <span class="s1">&#39;LON&#39;</span><span class="p">,</span>
    <span class="s1">&#39;lat&#39;</span> <span class="p">:</span> <span class="s1">&#39;LAT&#39;</span><span class="p">,</span>
    <span class="s1">&#39;geom&#39;</span> <span class="p">:</span> <span class="s1">&#39;MULTIPOLYGON&#39;</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="s-spatial-queries">
<span id="spatial-queries"></span><h2>Requêtes spatiales<a class="headerlink" href="#spatial-queries" title="Lien permanent vers ce titre">¶</a></h2>
<div class="section" id="s-spatial-lookups">
<span id="spatial-lookups"></span><h3>Recherches spatiales<a class="headerlink" href="#spatial-lookups" title="Lien permanent vers ce titre">¶</a></h3>
<p>GeoDjango ajoute des recherches spatiales à l’ORM de Django. Par exemple, vous pouvez chercher le pays de la table <code class="docutils literal notranslate"><span class="pre">WorldBorder</span></code> qui contient un point particulier. Commencez par lancer un shell de commande&nbsp;:</p>
<div class="console-block" id="console-block-13">
<input class="c-tab-unix" id="c-tab-13-unix" type="radio" name="console-13" checked>
<label for="c-tab-13-unix" title="Linux/macOS">&#xf17c/&#xf179</label>
<input class="c-tab-win" id="c-tab-13-win" type="radio" name="console-13">
<label for="c-tab-13-win" title="Windows">&#xf17a</label>
<section class="c-content-unix" id="c-content-13-unix">
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> python manage.py shell
</pre></div>
</div>
</section>
<section class="c-content-win" id="c-content-13-win">
<div class="highlight"><pre><span></span><span class="gp">...\&gt;</span> py manage.py shell
</pre></div>
</section>
</div>
<p>Définissez maintenant un point d’intérêt <a class="footnote-reference" href="#id13" id="id7">[3]</a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pnt_wkt</span> <span class="o">=</span> <span class="s1">&#39;POINT(-95.3385 29.7245)&#39;</span>
</pre></div>
</div>
<p>La chaîne <code class="docutils literal notranslate"><span class="pre">pnt_wkt</span></code> représente le point situé à la longitude -95.3385 degrés et la latitude 29.7245 degrés. La syntaxe géométrique est dans un format connu sous le nom de Well Known Text (WKT), un standard émis par le consortium Open Geospatial (OGC). <a class="footnote-reference" href="#id14" id="id8">[4]</a> Importez le modèle <code class="docutils literal notranslate"><span class="pre">WorldBorder</span></code> et lancez une recherche <code class="docutils literal notranslate"><span class="pre">contains</span></code> avec <code class="docutils literal notranslate"><span class="pre">pnt_wkt</span></code> en paramètre&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">world.models</span> <span class="k">import</span> <span class="n">WorldBorder</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">WorldBorder</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">mpoly__contains</span><span class="o">=</span><span class="n">pnt_wkt</span><span class="p">)</span>
<span class="go">&lt;QuerySet [&lt;WorldBorder: United States&gt;]&gt;</span>
</pre></div>
</div>
<p>Vous venez d’obtenir un <code class="docutils literal notranslate"><span class="pre">QuerySet</span></code> contenant un seul modèle&nbsp;: la frontière des États-Unis (exactement ce que l’on espérait).</p>
<p>De la même façon, vous pouvez aussi utiliser un <a class="reference internal" href="geos.html"><span class="doc">objet géométrique GEOS</span></a>. Ici, vous pouvez combiner une requête spatiale <code class="docutils literal notranslate"><span class="pre">intersects</span></code> avec la méthode <code class="docutils literal notranslate"><span class="pre">get</span></code> pour obtenir la seule instance de Saint-Marin au lieu d’un queryset&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.contrib.gis.geos</span> <span class="k">import</span> <span class="n">Point</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pnt</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mf">12.4604</span><span class="p">,</span> <span class="mf">43.9420</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">WorldBorder</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">mpoly__intersects</span><span class="o">=</span><span class="n">pnt</span><span class="p">)</span>
<span class="go">&lt;WorldBorder: San Marino&gt;</span>
</pre></div>
</div>
<p>Les recherches <code class="docutils literal notranslate"><span class="pre">contains</span></code> et <code class="docutils literal notranslate"><span class="pre">intersects</span></code> ne sont qu’un sous-ensemble des recherches possibles, consultez la documentation <a class="reference internal" href="db-api.html"><span class="doc">API de base de données GeoDjango</span></a> pour plus de détails.</p>
</div>
<div class="section" id="s-automatic-spatial-transformations">
<span id="s-id9"></span><span id="automatic-spatial-transformations"></span><span id="id9"></span><h3>Transformations spatiales automatiques<a class="headerlink" href="#automatic-spatial-transformations" title="Lien permanent vers ce titre">¶</a></h3>
<p>Lors de l’exécution de requêtes spatiales, GeoDjango transforme automatiquement les objets géométriques s’ils sont dans un système de coordonnées différent. Dans l’exemple suivant, les coordonnées seront exprimées en <a class="reference external" href="https://spatialreference.org/ref/epsg/32140/">SRID EPSG 32140</a>, un système de coordonnées <strong>purement</strong> spécifique au Texas du Sud et en mètres, pas en degrés&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.contrib.gis.geos</span> <span class="k">import</span> <span class="n">GEOSGeometry</span><span class="p">,</span> <span class="n">Point</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pnt</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mf">954158.1</span><span class="p">,</span> <span class="mf">4215137.1</span><span class="p">,</span> <span class="n">srid</span><span class="o">=</span><span class="mi">32140</span><span class="p">)</span>
</pre></div>
</div>
<p>Notez que <code class="docutils literal notranslate"><span class="pre">pnt</span></code> peut aussi être construit avec EWKT, une forme «&nbsp;étendue&nbsp;» de WKT qui contient le SRID&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pnt</span> <span class="o">=</span> <span class="n">GEOSGeometry</span><span class="p">(</span><span class="s1">&#39;SRID=32140;POINT(954158.1 4215137.1)&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>L’ORM de GeoDjango adapte automatiquement les valeurs géométriques dans le code de transformation SQL adéquat, permettant au développeur de travailler à un haut niveau d’abstraction&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">qs</span> <span class="o">=</span> <span class="n">WorldBorder</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">mpoly__intersects</span><span class="o">=</span><span class="n">pnt</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">qs</span><span class="o">.</span><span class="n">query</span><span class="p">)</span> <span class="c1"># Generating the SQL</span>
<span class="go">SELECT &quot;world_worldborder&quot;.&quot;id&quot;, &quot;world_worldborder&quot;.&quot;name&quot;, &quot;world_worldborder&quot;.&quot;area&quot;,</span>
<span class="go">&quot;world_worldborder&quot;.&quot;pop2005&quot;, &quot;world_worldborder&quot;.&quot;fips&quot;, &quot;world_worldborder&quot;.&quot;iso2&quot;,</span>
<span class="go">&quot;world_worldborder&quot;.&quot;iso3&quot;, &quot;world_worldborder&quot;.&quot;un&quot;, &quot;world_worldborder&quot;.&quot;region&quot;,</span>
<span class="go">&quot;world_worldborder&quot;.&quot;subregion&quot;, &quot;world_worldborder&quot;.&quot;lon&quot;, &quot;world_worldborder&quot;.&quot;lat&quot;,</span>
<span class="go">&quot;world_worldborder&quot;.&quot;mpoly&quot; FROM &quot;world_worldborder&quot;</span>
<span class="go">WHERE ST_Intersects(&quot;world_worldborder&quot;.&quot;mpoly&quot;, ST_Transform(%s, 4326))</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">qs</span> <span class="c1"># printing evaluates the queryset</span>
<span class="go">&lt;QuerySet [&lt;WorldBorder: United States&gt;]&gt;</span>
</pre></div>
</div>
<div class="admonition-raw-queries admonition" id="gis-raw-sql">
<p class="first admonition-title">Requêtes brutes</p>
<p>Lors de l’utilisation de <a class="reference internal" href="../../../topics/db/sql.html"><span class="doc">requêtes brutes</span></a>, vous devez entourer vos champs géométriques afin que la valeur du champ soit reconnue par GEOS</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="k">import</span> <span class="n">connection</span>
<span class="c1"># or if you&#39;re querying a non-default database:</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="k">import</span> <span class="n">connections</span>
<span class="n">connection</span> <span class="o">=</span> <span class="n">connections</span><span class="p">[</span><span class="s1">&#39;your_gis_db_alias&#39;</span><span class="p">]</span>

<span class="n">City</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">raw</span><span class="p">(</span><span class="s1">&#39;SELECT id, name, </span><span class="si">%s</span><span class="s1"> as point from myapp_city&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">connection</span><span class="o">.</span><span class="n">ops</span><span class="o">.</span><span class="n">select</span> <span class="o">%</span> <span class="s1">&#39;point&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p class="last">Les requêtes brutes ne devraient être utilisées que lorsque l’on sait exactement ce que l’on fait.</p>
</div>
</div>
<div class="section" id="s-lazy-geometries">
<span id="lazy-geometries"></span><h3>Objets géométriques différés<a class="headerlink" href="#lazy-geometries" title="Lien permanent vers ce titre">¶</a></h3>
<p>GeoDjango charge les objets géométriques dans une représentation textuelle standardisée. Lors du premier accès au champ géométrique, GeoDjango crée un objet <a class="reference internal" href="geos.html#django.contrib.gis.geos.GEOSGeometry" title="django.contrib.gis.geos.GEOSGeometry"><code class="xref py py-class docutils literal notranslate"><span class="pre">GEOSGeometry</span></code></a> exposant des fonctionnalités puissantes comme des propriétés de sérialisation pour des formats géospatiaux populaires&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">sm</span> <span class="o">=</span> <span class="n">WorldBorder</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;San Marino&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sm</span><span class="o">.</span><span class="n">mpoly</span>
<span class="go">&lt;MultiPolygon object at 0x24c6798&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sm</span><span class="o">.</span><span class="n">mpoly</span><span class="o">.</span><span class="n">wkt</span> <span class="c1"># WKT</span>
<span class="go">MULTIPOLYGON (((12.4157980000000006 43.9579540000000009, 12.4505540000000003 43.9797209999999978, ...</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sm</span><span class="o">.</span><span class="n">mpoly</span><span class="o">.</span><span class="n">wkb</span> <span class="c1"># WKB (as Python binary buffer)</span>
<span class="go">&lt;read-only buffer for 0x1fe2c70, size -1, offset 0 at 0x2564c40&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sm</span><span class="o">.</span><span class="n">mpoly</span><span class="o">.</span><span class="n">geojson</span> <span class="c1"># GeoJSON</span>
<span class="go">&#39;{ &quot;type&quot;: &quot;MultiPolygon&quot;, &quot;coordinates&quot;: [ [ [ [ 12.415798, 43.957954 ], [ 12.450554, 43.979721 ], ...</span>
</pre></div>
</div>
<p>Cela comprend aussi l’accès à toutes les opérations géométriques avancées fournies par la bibliothèque GEOS&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pnt</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="mf">12.4604</span><span class="p">,</span> <span class="mf">43.9420</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">sm</span><span class="o">.</span><span class="n">mpoly</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">pnt</span><span class="p">)</span>
<span class="go">True</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">pnt</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">sm</span><span class="o">.</span><span class="n">mpoly</span><span class="p">)</span>
<span class="go">False</span>
</pre></div>
</div>
</div>
<div class="section" id="s-geographic-annotations">
<span id="geographic-annotations"></span><h3>Annotations géographiques<a class="headerlink" href="#geographic-annotations" title="Lien permanent vers ce titre">¶</a></h3>
<p>GeoDjango propose également un ensemble d’annotations géographiques pour calculer les distances et diverses autres opérations (intersection, différence, etc.). Voir la documentation <a class="reference internal" href="functions.html"><span class="doc">Fonctions de base de données géographiques</span></a>.</p>
</div>
</div>
<div class="section" id="s-putting-your-data-on-the-map">
<span id="putting-your-data-on-the-map"></span><h2>Placement des données sur une carte<a class="headerlink" href="#putting-your-data-on-the-map" title="Lien permanent vers ce titre">¶</a></h2>
<div class="section" id="s-geographic-admin">
<span id="geographic-admin"></span><h3>Interface d’administration géographique<a class="headerlink" href="#geographic-admin" title="Lien permanent vers ce titre">¶</a></h3>
<p>GeoDjango étend l”<a class="reference internal" href="../admin/index.html"><span class="doc">application d’administration de Django</span></a> avec la prise en charge de l’édition des champs géométriques.</p>
<div class="section" id="s-basics">
<span id="basics"></span><h4>Généralités<a class="headerlink" href="#basics" title="Lien permanent vers ce titre">¶</a></h4>
<p>GeoDjango étend aussi l’administration de Django en permettant aux utilisateurs de créer et modifier des objets géométriques sur une carte active JavaScript (basée sur <a class="reference external" href="https://openlayers.org/">OpenLayers</a>).</p>
<p>Mettons-nous au travail. Créez un fichier nommé <code class="docutils literal notranslate"><span class="pre">admin.py</span></code> dans l’application <code class="docutils literal notranslate"><span class="pre">world</span></code> et placez-y le code suivant&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.gis</span> <span class="k">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">.models</span> <span class="k">import</span> <span class="n">WorldBorder</span>

<span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">WorldBorder</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">GeoModelAdmin</span><span class="p">)</span>
</pre></div>
</div>
<p>Puis, modifiez <code class="docutils literal notranslate"><span class="pre">urls.py</span></code> dans le dossier d’application <code class="docutils literal notranslate"><span class="pre">geodjango</span></code> comme ceci&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.gis</span> <span class="k">import</span> <span class="n">admin</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="k">import</span> <span class="n">include</span><span class="p">,</span> <span class="n">path</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;admin/&#39;</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">urls</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Créez un utilisateur administrateur&nbsp;:</p>
<div class="console-block" id="console-block-14">
<input class="c-tab-unix" id="c-tab-14-unix" type="radio" name="console-14" checked>
<label for="c-tab-14-unix" title="Linux/macOS">&#xf17c/&#xf179</label>
<input class="c-tab-win" id="c-tab-14-win" type="radio" name="console-14">
<label for="c-tab-14-win" title="Windows">&#xf17a</label>
<section class="c-content-unix" id="c-content-14-unix">
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> python manage.py createsuperuser
</pre></div>
</div>
</section>
<section class="c-content-win" id="c-content-14-win">
<div class="highlight"><pre><span></span><span class="gp">...\&gt;</span> py manage.py createsuperuser
</pre></div>
</section>
</div>
<p>Puis, démarrez le serveur de développement Django&nbsp;:</p>
<div class="console-block" id="console-block-15">
<input class="c-tab-unix" id="c-tab-15-unix" type="radio" name="console-15" checked>
<label for="c-tab-15-unix" title="Linux/macOS">&#xf17c/&#xf179</label>
<input class="c-tab-win" id="c-tab-15-win" type="radio" name="console-15">
<label for="c-tab-15-win" title="Windows">&#xf17a</label>
<section class="c-content-unix" id="c-content-15-unix">
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> python manage.py runserver
</pre></div>
</div>
</section>
<section class="c-content-win" id="c-content-15-win">
<div class="highlight"><pre><span></span><span class="gp">...\&gt;</span> py manage.py runserver
</pre></div>
</section>
</div>
<p>Pour terminer, allez à l’adresse <code class="docutils literal notranslate"><span class="pre">http://localhost:8000/admin/</span></code> et connectez-vous avec l’utilisateur que vous venez de créer. Parcourez l’un des objets <code class="docutils literal notranslate"><span class="pre">WorldBorder</span></code> et constatez que les frontières peuvent être modifiées en cliquant sur un polygone et en faisant glisser ses arêtes à la position souhaitée.</p>
</div>
<div class="section" id="s-osmgeoadmin">
<span id="s-osmgeoadmin-intro"></span><span id="osmgeoadmin"></span><span id="osmgeoadmin-intro"></span><h4><code class="docutils literal notranslate"><span class="pre">OSMGeoAdmin</span></code><a class="headerlink" href="#osmgeoadmin" title="Lien permanent vers ce titre">¶</a></h4>
<p>Avec <a class="reference internal" href="admin.html#django.contrib.gis.admin.OSMGeoAdmin" title="django.contrib.gis.admin.OSMGeoAdmin"><code class="xref py py-class docutils literal notranslate"><span class="pre">OSMGeoAdmin</span></code></a>, GeoDjango utilise une couche <a class="reference external" href="https://www.openstreetmap.org/">Open Street Map</a> dans l’interface d’administration. Cela donne plus de contexte (y compris les détails des rues et des voies de communication) que l’interface disponible avec  <a class="reference internal" href="admin.html#django.contrib.gis.admin.GeoModelAdmin" title="django.contrib.gis.admin.GeoModelAdmin"><code class="xref py py-class docutils literal notranslate"><span class="pre">GeoModelAdmin</span></code></a> (qui utilise le jeu de données WMS <a class="reference external" href="https://earth-info.nga.mil/publications/vmap0.html">Vector Map Level 0</a> hébergé sur <a class="reference external" href="https://www.osgeo.org/">OSGeo</a>).</p>
<p>Les fichiers de projections PROJ.4 doivent être installés (voir les <a class="reference internal" href="install/geolibs.html#proj4"><span class="std std-ref">instructions d’installation de PROJ.4</span></a> pour plus de détails).</p>
<p>Si cette exigence est satisfaite, remplacez la classe <code class="docutils literal notranslate"><span class="pre">GeoModelAdmin</span></code> par <code class="docutils literal notranslate"><span class="pre">OSMGeoAdmin</span></code> dans le fichier <code class="docutils literal notranslate"><span class="pre">admin.py</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">admin</span><span class="o">.</span><span class="n">site</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">WorldBorder</span><span class="p">,</span> <span class="n">admin</span><span class="o">.</span><span class="n">OSMGeoAdmin</span><span class="p">)</span>
</pre></div>
</div>
<p class="rubric">Notes de bas de page</p>
<table class="docutils footnote" frame="void" id="id11" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id1">[1]</a></td><td>Un merci particulier à Bjørn Sandvik de <a class="reference external" href="https://thematicmapping.org/">thematicmapping.org</a> pour la mise à disposition et la maintenance de ce jeu de données.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id12" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id2">[2]</a></td><td>Les applications GeoDjango de base ont été écrites par Dane Springmeyer, Josh Livni et Christopher Schmidt.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id13" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id7">[3]</a></td><td>Ce point correspond à <a class="reference external" href="https://www.law.uh.edu/">University of Houston Law Center</a>.</td></tr>
</tbody>
</table>
<table class="docutils footnote" frame="void" id="id14" rules="none">
<colgroup><col class="label" /><col /></colgroup>
<tbody valign="top">
<tr><td class="label"><a class="fn-backref" href="#id8">[4]</a></td><td>Open Geospatial Consortium, Inc., <a class="reference external" href="https://www.opengeospatial.org/standards/sfs">OpenGIS Simple Feature Specification
For SQL</a>.</td></tr>
</tbody>
</table>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      
        
          <div class="yui-b" id="sidebar">
            
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../../contents.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Tutoriel GeoDjango</a><ul>
<li><a class="reference internal" href="#introduction">Introduction</a></li>
<li><a class="reference internal" href="#setting-up">Mise en route</a><ul>
<li><a class="reference internal" href="#create-a-spatial-database">Création d’une base de données spatiale</a></li>
<li><a class="reference internal" href="#create-a-new-project">Création d’un nouveau projet</a></li>
<li><a class="reference internal" href="#configure-settings-py">Configuration de <code class="docutils literal notranslate"><span class="pre">settings.py</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#geographic-data">Données géographiques</a><ul>
<li><a class="reference internal" href="#worldborders">Frontières mondiales</a></li>
<li><a class="reference internal" href="#use-ogrinfo-to-examine-spatial-data">Utilisation de <code class="docutils literal notranslate"><span class="pre">ogrinfo</span></code> pour examiner les données spatiales</a></li>
</ul>
</li>
<li><a class="reference internal" href="#geographic-models">Modèles géographiques</a><ul>
<li><a class="reference internal" href="#defining-a-geographic-model">Définition d’un modèle géographique</a></li>
<li><a class="reference internal" href="#run-migrate">Exécutez <code class="docutils literal notranslate"><span class="pre">migrate</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#importing-spatial-data">Importation de données spatiales</a><ul>
<li><a class="reference internal" href="#gdal-interface">Interface GDAL</a></li>
<li><a class="reference internal" href="#layermapping">Cartographie des couches (<code class="docutils literal notranslate"><span class="pre">LayerMapping</span></code>)</a></li>
<li><a class="reference internal" href="#try-ogrinspect">Utilisation de <code class="docutils literal notranslate"><span class="pre">ogrinspect</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#spatial-queries">Requêtes spatiales</a><ul>
<li><a class="reference internal" href="#spatial-lookups">Recherches spatiales</a></li>
<li><a class="reference internal" href="#automatic-spatial-transformations">Transformations spatiales automatiques</a></li>
<li><a class="reference internal" href="#lazy-geometries">Objets géométriques différés</a></li>
<li><a class="reference internal" href="#geographic-annotations">Annotations géographiques</a></li>
</ul>
</li>
<li><a class="reference internal" href="#putting-your-data-on-the-map">Placement des données sur une carte</a><ul>
<li><a class="reference internal" href="#geographic-admin">Interface d’administration géographique</a><ul>
<li><a class="reference internal" href="#basics">Généralités</a></li>
<li><a class="reference internal" href="#osmgeoadmin"><code class="docutils literal notranslate"><span class="pre">OSMGeoAdmin</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Sujet précédent</h4>
  <p class="topless"><a href="index.html"
                        title="Chapitre précédent">GeoDjango</a></p>
  <h4>Sujet suivant</h4>
  <p class="topless"><a href="install/index.html"
                        title="Chapitre suivant">Installation de GeoDjango</a></p>
  <div role="note" aria-label="source link">
    <h3>Cette page</h3>
    <ul class="this-page-menu">
      <li><a href="../../../_sources/ref/contrib/gis/tutorial.txt"
            rel="nofollow">Montrer le code source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Recherche rapide</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
              <h3>Last update:</h3>
              <p class="topless">oct. 29, 2020</p>
          </div>
        
      
    </div>

    <div id="ft">
      <div class="nav">
    &laquo; <a href="index.html" title="GeoDjango">previous</a>
     |
    <a href="../../index.html" title="Référence de l’API" accesskey="U">up</a>
   |
    <a href="install/index.html" title="Installation de GeoDjango">next</a> &raquo;</div>
    </div>
  </div>

      <div class="clearer"></div>
    </div>
  </body>
</html>