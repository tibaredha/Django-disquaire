
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="fr">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Le système des plans de site (sitemap) &#8212; Documentation Django 3.1.3.dev</title>
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../_static/translations.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Recherche" href="../../search.html" />
    <link rel="next" title="L’infrastructure des « sites »" href="sites.html" />
    <link rel="prev" title="L’application de redirection" href="redirects.html" />



 
<script src="../../templatebuiltins.js"></script>
<script>
(function($) {
    if (!django_template_builtins) {
       // templatebuiltins.js missing, do nothing.
       return;
    }
    $(document).ready(function() {
        // Hyperlink Django template tags and filters
        var base = "../templates/builtins.html";
        if (base == "#") {
            // Special case for builtins.html itself
            base = "";
        }
        // Tags are keywords, class '.k'
        $("div.highlight\\-html\\+django span.k").each(function(i, elem) {
             var tagname = $(elem).text();
             if ($.inArray(tagname, django_template_builtins.ttags) != -1) {
                 var fragment = tagname.replace(/_/, '-');
                 $(elem).html("<a href='" + base + "#" + fragment + "'>" + tagname + "</a>");
             }
        });
        // Filters are functions, class '.nf'
        $("div.highlight\\-html\\+django span.nf").each(function(i, elem) {
             var filtername = $(elem).text();
             if ($.inArray(filtername, django_template_builtins.tfilters) != -1) {
                 var fragment = filtername.replace(/_/, '-');
                 $(elem).html("<a href='" + base + "#" + fragment + "'>" + filtername + "</a>");
             }
        });
    });
})(jQuery);</script>

  </head><body>

    <div class="document">
  <div id="custom-doc" class="yui-t6">
    <div id="hd">
      <h1><a href="../../index.html">Documentation Django 3.1.3.dev</a></h1>
      <div id="global-nav">
        <a title="Home page" href="../../index.html">Home</a>  |
        <a title="Table of contents" href="../../contents.html">Table of contents</a>  |
        <a title="Global index" href="../../genindex.html">Index</a>  |
        <a title="Module index" href="../../py-modindex.html">Modules</a>
      </div>
      <div class="nav">
    &laquo; <a href="redirects.html" title="L’application de redirection">previous</a>
     |
    <a href="../index.html" title="Référence de l’API" accesskey="U">up</a>
   |
    <a href="sites.html" title="L’infrastructure des «&amp;nbsp;sites&amp;nbsp;»">next</a> &raquo;</div>
    </div>

    <div id="bd">
      <div id="yui-main">
        <div class="yui-b">
          <div class="yui-g" id="ref-contrib-sitemaps">
            
  <div class="section" id="s-module-django.contrib.sitemaps">
<span id="s-the-sitemap-framework"></span><span id="module-django.contrib.sitemaps"></span><span id="the-sitemap-framework"></span><h1>Le système des plans de site (<code class="docutils literal notranslate"><span class="pre">sitemap</span></code>)<a class="headerlink" href="#module-django.contrib.sitemaps" title="Lien permanent vers ce titre">¶</a></h1>
<p>Django est livré avec un système de génération de plans de site à haut niveau qui permet de créer des fichiers XML <a class="reference external" href="https://www.sitemaps.org/">sitemap</a>.</p>
<div class="section" id="s-overview">
<span id="overview"></span><h2>Aperçu<a class="headerlink" href="#overview" title="Lien permanent vers ce titre">¶</a></h2>
<p>Un plan de site «&nbsp;sitemap&nbsp;» est un fichier XML sur un site Web indiquant aux robots des moteurs de recherche à quelle fréquence les pages changent et comment certaines pages «&nbsp;importantes&nbsp;» sont en relation avec d’autres pages du site. Cette information aide les moteurs de recherche à indexer un site.</p>
<p>L’application sitemap de Django automatise la création de ce fichier XML en permettant d’exprimer cette information sous forme de code Python.</p>
<p>Cela fonctionne un peu comme le <a class="reference internal" href="syndication.html"><span class="doc">système de syndication</span></a> de Django. Pour créer un plan de site, écrivez une classe <a class="reference internal" href="#django.contrib.sitemaps.Sitemap" title="django.contrib.sitemaps.Sitemap"><code class="xref py py-class docutils literal notranslate"><span class="pre">Sitemap</span></code></a> et référencez-la dans la <a class="reference internal" href="../../topics/http/urls.html"><span class="doc">configuration d’URL</span></a>.</p>
</div>
<div class="section" id="s-installation">
<span id="installation"></span><h2>Installation<a class="headerlink" href="#installation" title="Lien permanent vers ce titre">¶</a></h2>
<p>Pour installer l’application sitemap, procédez comme suit&nbsp;:</p>
<ol class="arabic simple">
<li>Ajoutez <code class="docutils literal notranslate"><span class="pre">'django.contrib.sitemaps'</span></code> au réglage <a class="reference internal" href="../settings.html#std:setting-INSTALLED_APPS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">INSTALLED_APPS</span></code></a>.</li>
<li>Vérifiez la présence d’un moteur <code class="docutils literal notranslate"><span class="pre">DjangoTemplates``dont</span> <span class="pre">l'option</span> <span class="pre">``APP_DIRS</span></code> vaut <code class="docutils literal notranslate"><span class="pre">True</span></code> dans le réglage <a class="reference internal" href="../settings.html#std:setting-TEMPLATES"><code class="xref std std-setting docutils literal notranslate"><span class="pre">TEMPLATES</span></code></a>. Il y est par défaut, de sorte que vous aurez uniquement besoin de l’ajouter si vous avez modifié ce réglage.</li>
<li>Assurez-vous d’avoir installé le <a class="reference internal" href="sites.html#module-django.contrib.sites" title="django.contrib.sites: Lets you operate multiple websites from the same database and Django project"><code class="xref py py-mod docutils literal notranslate"><span class="pre">gestionnaire</span> <span class="pre">de</span> <span class="pre">sites</span></code></a>.</li>
</ol>
<p>(Remarque&nbsp;: l’application sitemap n’installe aucune table de base de données. La seule raison pour laquelle elle doit être présente dans <a class="reference internal" href="../settings.html#std:setting-INSTALLED_APPS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">INSTALLED_APPS</span></code></a> est que la fonction de chargement des gabarits <a class="reference internal" href="../templates/api.html#django.template.loaders.app_directories.Loader" title="django.template.loaders.app_directories.Loader"><code class="xref py py-func docutils literal notranslate"><span class="pre">Loader()</span></code></a> doit pouvoir trouver les gabarits par défaut.)</p>
</div>
<div class="section" id="s-initialization">
<span id="initialization"></span><h2>Initialisation<a class="headerlink" href="#initialization" title="Lien permanent vers ce titre">¶</a></h2>
<dl class="function">
<dt id="django.contrib.sitemaps.views.sitemap">
<code class="descclassname">views.</code><code class="descname">sitemap</code>(<em>request</em>, <em>sitemaps</em>, <em>section=None</em>, <em>template_name='sitemap.xml'</em>, <em>content_type='application/xml'</em>)<a class="headerlink" href="#django.contrib.sitemaps.views.sitemap" title="Lien permanent vers cette définition">¶</a></dt>
<dd></dd></dl>

<p>Pour activer la génération du plan du site d’un site Django, ajoutez cette ligne à la <a class="reference internal" href="../../topics/http/urls.html"><span class="doc">configuration d’URL</span></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.sitemaps.views</span> <span class="k">import</span> <span class="n">sitemap</span>

<span class="n">path</span><span class="p">(</span><span class="s1">&#39;sitemap.xml&#39;</span><span class="p">,</span> <span class="n">sitemap</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;sitemaps&#39;</span><span class="p">:</span> <span class="n">sitemaps</span><span class="p">},</span>
     <span class="n">name</span><span class="o">=</span><span class="s1">&#39;django.contrib.sitemaps.views.sitemap&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Cela indique à Django de construire un plan de site lorsqu’un client accède à <code class="file docutils literal notranslate"><span class="pre">/sitemap.xml</span></code>.</p>
<p>Le nom du fichier sitemap n’est pas important, mais l’emplacement l’est. Les moteurs de recherche n’indexeront que les liens du plan de site à partir du niveau actuel de l’URL et en-dessous. Par exemple, si <code class="file docutils literal notranslate"><span class="pre">sitemap.xml</span></code> réside dans le répertoire racine, il peut faire référence à n’importe quelle URL du site. Cependant, si le fichier sitemap réside dans <code class="file docutils literal notranslate"><span class="pre">/content/sitemap.xml</span></code>, il ne peut référencer que des URL qui commencent par <code class="file docutils literal notranslate"><span class="pre">/content/</span></code>.</p>
<p>La vue <code class="docutils literal notranslate"><span class="pre">sitemap</span></code> accepte un paramètre supplémentaire obligatoire&nbsp;: <code class="docutils literal notranslate"><span class="pre">{'sitemaps':</span> <span class="pre">sitemaps}</span></code>. <code class="docutils literal notranslate"><span class="pre">sitemaps</span></code> doit être un dictionnaire qui associe une étiquette de section courte (par exemple, <code class="docutils literal notranslate"><span class="pre">blog</span></code> ou <code class="docutils literal notranslate"><span class="pre">nouvelles</span></code>) à sa classe <a class="reference internal" href="#django.contrib.sitemaps.Sitemap" title="django.contrib.sitemaps.Sitemap"><code class="xref py py-class docutils literal notranslate"><span class="pre">Sitemap</span></code></a> (par exemple, <code class="docutils literal notranslate"><span class="pre">BlogSitemap</span></code> ou <code class="docutils literal notranslate"><span class="pre">NewsSitemap</span></code>). Il peut également s’appliquer à une <em>instance</em> de classe <a class="reference internal" href="#django.contrib.sitemaps.Sitemap" title="django.contrib.sitemaps.Sitemap"><code class="xref py py-class docutils literal notranslate"><span class="pre">Sitemap</span></code></a> (par exemple, <code class="docutils literal notranslate"><span class="pre">BlogSitemap(ma_variable)</span></code>).</p>
</div>
<div class="section" id="s-sitemap-classes">
<span id="sitemap-classes"></span><h2>Classes <code class="docutils literal notranslate"><span class="pre">Sitemap</span></code><a class="headerlink" href="#sitemap-classes" title="Lien permanent vers ce titre">¶</a></h2>
<p>Une classe <a class="reference internal" href="#django.contrib.sitemaps.Sitemap" title="django.contrib.sitemaps.Sitemap"><code class="xref py py-class docutils literal notranslate"><span class="pre">Sitemap</span></code></a> est une classe Python qui représente une «&nbsp;section&nbsp;» d’entrées dans votre plan de site. Par exemple, une classe <a class="reference internal" href="#django.contrib.sitemaps.Sitemap" title="django.contrib.sitemaps.Sitemap"><code class="xref py py-class docutils literal notranslate"><span class="pre">Sitemap</span></code></a> pourrait représenter toutes les entrées de votre blog, tandis qu’une autre pourrait représenter tous les évènements d’un calendrier d’évènements.</p>
<p>Dans le cas le plus simple, toutes ces sections sont regroupées dans un seul <code class="file docutils literal notranslate"><span class="pre">sitemap.xml</span></code>, mais il est également possible d’utiliser le système pour générer un index de sitemap qui référence d’autres fichiers sitemap individuels, un par section (voir <a class="reference internal" href="#creating-a-sitemap-index">Création d’un index de plan de site</a> ci-dessous).</p>
<p>Les classes <a class="reference internal" href="#django.contrib.sitemaps.Sitemap" title="django.contrib.sitemaps.Sitemap"><code class="xref py py-class docutils literal notranslate"><span class="pre">Sitemap</span></code></a> doivent être des sous-classes de <code class="docutils literal notranslate"><span class="pre">django.contrib.sitemaps.Sitemap</span></code>. Elles peuvent résider n’importe où dans votre code source.</p>
</div>
<div class="section" id="s-an-example">
<span id="an-example"></span><h2>Un exemple<a class="headerlink" href="#an-example" title="Lien permanent vers ce titre">¶</a></h2>
<p>Supposons que vous avez un système de blog, avec un modèle <code class="docutils literal notranslate"><span class="pre">Entry</span></code>. Vous souhaitez que le plan de site contienne les liens vers tous les articles de blog. Voici à quoi la classe de plan de site pourrait ressembler&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.sitemaps</span> <span class="k">import</span> <span class="n">Sitemap</span>
<span class="kn">from</span> <span class="nn">blog.models</span> <span class="k">import</span> <span class="n">Entry</span>

<span class="k">class</span> <span class="nc">BlogSitemap</span><span class="p">(</span><span class="n">Sitemap</span><span class="p">):</span>
    <span class="n">changefreq</span> <span class="o">=</span> <span class="s2">&quot;never&quot;</span>
    <span class="n">priority</span> <span class="o">=</span> <span class="mf">0.5</span>

    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">is_draft</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">lastmod</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">pub_date</span>
</pre></div>
</div>
<p>Remarque&nbsp;:</p>
<ul class="simple">
<li><a class="reference internal" href="#django.contrib.sitemaps.Sitemap.changefreq" title="django.contrib.sitemaps.Sitemap.changefreq"><code class="xref py py-attr docutils literal notranslate"><span class="pre">changefreq</span></code></a> et <a class="reference internal" href="#django.contrib.sitemaps.Sitemap.priority" title="django.contrib.sitemaps.Sitemap.priority"><code class="xref py py-attr docutils literal notranslate"><span class="pre">priority</span></code></a> sont des attributs de classe correspondant respectivement aux éléments <code class="docutils literal notranslate"><span class="pre">&lt;changefreq&gt;</span></code> et <code class="docutils literal notranslate"><span class="pre">&lt;priority&gt;</span></code>. Il est possible qu’ils correspondent à des fonctions, comme pour <a class="reference internal" href="#django.contrib.sitemaps.Sitemap.lastmod" title="django.contrib.sitemaps.Sitemap.lastmod"><code class="xref py py-attr docutils literal notranslate"><span class="pre">lastmod</span></code></a> dans l’exemple ci-dessus.</li>
<li><a class="reference internal" href="#django.contrib.sitemaps.Sitemap.items" title="django.contrib.sitemaps.Sitemap.items"><code class="xref py py-attr docutils literal notranslate"><span class="pre">items()</span></code></a> est une méthode qui renvoie une <span class="xref std std-term">séquence</span> ou une requête <code class="docutils literal notranslate"><span class="pre">QuerySet</span></code> d’objets. Les objets renvoyés seront transmis à toute méthode exécutable correspondant à une propriété de sitemap (<a class="reference internal" href="#django.contrib.sitemaps.Sitemap.location" title="django.contrib.sitemaps.Sitemap.location"><code class="xref py py-attr docutils literal notranslate"><span class="pre">location</span></code></a>, <a class="reference internal" href="#django.contrib.sitemaps.Sitemap.lastmod" title="django.contrib.sitemaps.Sitemap.lastmod"><code class="xref py py-attr docutils literal notranslate"><span class="pre">lastmod</span></code></a>, <a class="reference internal" href="#django.contrib.sitemaps.Sitemap.changefreq" title="django.contrib.sitemaps.Sitemap.changefreq"><code class="xref py py-attr docutils literal notranslate"><span class="pre">changefreq</span></code></a> et <a class="reference internal" href="#django.contrib.sitemaps.Sitemap.priority" title="django.contrib.sitemaps.Sitemap.priority"><code class="xref py py-attr docutils literal notranslate"><span class="pre">priority</span></code></a>).</li>
<li><a class="reference internal" href="#django.contrib.sitemaps.Sitemap.lastmod" title="django.contrib.sitemaps.Sitemap.lastmod"><code class="xref py py-attr docutils literal notranslate"><span class="pre">lastmod</span></code></a> doit renvoyer un objet <a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(disponible dans Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime</span></code></a>.</li>
<li>Il n’y a pas de méthode <a class="reference internal" href="#django.contrib.sitemaps.Sitemap.location" title="django.contrib.sitemaps.Sitemap.location"><code class="xref py py-attr docutils literal notranslate"><span class="pre">location</span></code></a> dans cet exemple, mais vous pouvez la fournir afin de préciser l’URL de l’objet. Par défaut, <a class="reference internal" href="#django.contrib.sitemaps.Sitemap.location" title="django.contrib.sitemaps.Sitemap.location"><code class="xref py py-attr docutils literal notranslate"><span class="pre">location()</span></code></a> appelle <code class="docutils literal notranslate"><span class="pre">get_absolute_url()</span></code> pour chaque objet et renvoie le résultat.</li>
</ul>
</div>
<div class="section" id="s-sitemap-class-reference">
<span id="sitemap-class-reference"></span><h2>Référence de la classe <code class="docutils literal notranslate"><span class="pre">Sitemap</span></code><a class="headerlink" href="#sitemap-class-reference" title="Lien permanent vers ce titre">¶</a></h2>
<dl class="class">
<dt id="django.contrib.sitemaps.Sitemap">
<em class="property">class </em><code class="descname">Sitemap</code><a class="headerlink" href="#django.contrib.sitemaps.Sitemap" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>Une classe <code class="docutils literal notranslate"><span class="pre">Sitemap</span></code> peut définir les méthodes/attributs suivants&nbsp;:</p>
<dl class="attribute">
<dt id="django.contrib.sitemaps.Sitemap.items">
<code class="descname">items</code><a class="headerlink" href="#django.contrib.sitemaps.Sitemap.items" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p><strong>Obligatoire.</strong> Une méthode qui renvoie une <span class="xref std std-term">séquence</span> ou une requête <code class="docutils literal notranslate"><span class="pre">QuerySet</span></code> d’objets. Le système ne se soucie pas de quel <em>type</em> d’objet il s’agit&nbsp;; tout ce qui compte, c’est que ces objets sont transmis aux méthodes <a class="reference internal" href="#django.contrib.sitemaps.Sitemap.location" title="django.contrib.sitemaps.Sitemap.location"><code class="xref py py-attr docutils literal notranslate"><span class="pre">location()</span></code></a>, <a class="reference internal" href="#django.contrib.sitemaps.Sitemap.lastmod" title="django.contrib.sitemaps.Sitemap.lastmod"><code class="xref py py-attr docutils literal notranslate"><span class="pre">lastmod()</span></code></a>, <a class="reference internal" href="#django.contrib.sitemaps.Sitemap.changefreq" title="django.contrib.sitemaps.Sitemap.changefreq"><code class="xref py py-attr docutils literal notranslate"><span class="pre">changefreq()</span></code></a> et <a class="reference internal" href="#django.contrib.sitemaps.Sitemap.priority" title="django.contrib.sitemaps.Sitemap.priority"><code class="xref py py-attr docutils literal notranslate"><span class="pre">priority()</span></code></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="django.contrib.sitemaps.Sitemap.location">
<code class="descname">location</code><a class="headerlink" href="#django.contrib.sitemaps.Sitemap.location" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p><strong>Facultatif.</strong> Soit une méthode, soit un attribut.</p>
<p>Si c’est une méthode, elle doit renvoyer le chemin absolu pour le dit objet renvoyé par <a class="reference internal" href="#django.contrib.sitemaps.Sitemap.items" title="django.contrib.sitemaps.Sitemap.items"><code class="xref py py-attr docutils literal notranslate"><span class="pre">items()</span></code></a>.</p>
<p>Si c’est un attribut, sa valeur doit être une chaîne représentant un chemin absolu à utiliser pour <em>chaque</em> objet renvoyé par <a class="reference internal" href="#django.contrib.sitemaps.Sitemap.items" title="django.contrib.sitemaps.Sitemap.items"><code class="xref py py-attr docutils literal notranslate"><span class="pre">items()</span></code></a>.</p>
<p>Dans les deux cas, «&nbsp;chemin absolu&nbsp;» signifie une URL qui ne comprend ni le protocole ni le domaine. Exemples&nbsp;:</p>
<ul class="simple">
<li>Bon&nbsp;: <code class="file docutils literal notranslate"><span class="pre">'/foo/bar/'</span></code></li>
<li>Mauvais&nbsp;: <code class="file docutils literal notranslate"><span class="pre">'example.com/foo/bar/'</span></code></li>
<li>Mauvais&nbsp;: <code class="file docutils literal notranslate"><span class="pre">'https://example.com/foo/bar/'</span></code></li>
</ul>
<p>Si <a class="reference internal" href="#django.contrib.sitemaps.Sitemap.location" title="django.contrib.sitemaps.Sitemap.location"><code class="xref py py-attr docutils literal notranslate"><span class="pre">location</span></code></a> n’est pas fourni, le système appelle la méthode <code class="docutils literal notranslate"><span class="pre">get_absolute_url()</span></code> de chaque objet renvoyé par <a class="reference internal" href="#django.contrib.sitemaps.Sitemap.items" title="django.contrib.sitemaps.Sitemap.items"><code class="xref py py-attr docutils literal notranslate"><span class="pre">items()</span></code></a>.</p>
<p>Pour indiquer un protocole autre que <code class="docutils literal notranslate"><span class="pre">'http'</span></code>, utilisez <a class="reference internal" href="#django.contrib.sitemaps.Sitemap.protocol" title="django.contrib.sitemaps.Sitemap.protocol"><code class="xref py py-attr docutils literal notranslate"><span class="pre">protocol</span></code></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="django.contrib.sitemaps.Sitemap.lastmod">
<code class="descname">lastmod</code><a class="headerlink" href="#django.contrib.sitemaps.Sitemap.lastmod" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p><strong>Facultatif.</strong> Soit une méthode, soit un attribut.</p>
<p>Si c’est une méthode, elle doit accepter un paramètre, un objet renvoyé par <a class="reference internal" href="#django.contrib.sitemaps.Sitemap.items" title="django.contrib.sitemaps.Sitemap.items"><code class="xref py py-attr docutils literal notranslate"><span class="pre">items()</span></code></a>, et renvoyer la date/heure de dernière modification de cet objet, en tant que <a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(disponible dans Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime</span></code></a>.</p>
<p>Si c’est un attribut, sa valeur doit être un objet <a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.datetime" title="(disponible dans Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime</span></code></a> représentant la date/heure de dernière modification pour <em>chaque</em> objet renvoyé par <a class="reference internal" href="#django.contrib.sitemaps.Sitemap.items" title="django.contrib.sitemaps.Sitemap.items"><code class="xref py py-attr docutils literal notranslate"><span class="pre">items()</span></code></a>.</p>
<p>Si tous les éléments d’un plan de site possèdent <a class="reference internal" href="#django.contrib.sitemaps.Sitemap.lastmod" title="django.contrib.sitemaps.Sitemap.lastmod"><code class="xref py py-attr docutils literal notranslate"><span class="pre">lastmod</span></code></a>, le plan de site généré par <a class="reference internal" href="#django.contrib.sitemaps.views.sitemap" title="django.contrib.sitemaps.views.sitemap"><code class="xref py py-func docutils literal notranslate"><span class="pre">views.sitemap()</span></code></a> comportera un en-tête <code class="docutils literal notranslate"><span class="pre">Last-Modified</span></code> égal à la valeur <code class="docutils literal notranslate"><span class="pre">lastmod</span></code> la plus récente. Vous pouvez activer l’intergiciel <a class="reference internal" href="../middleware.html#django.middleware.http.ConditionalGetMiddleware" title="django.middleware.http.ConditionalGetMiddleware"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConditionalGetMiddleware</span></code></a> pour que Django réponde de manière appropriée aux requêtes contenant un en-tête <code class="docutils literal notranslate"><span class="pre">If-Modified-Since</span></code>, ce qui évitera d’envoyer le plan de site si celui-ci n’a pas changé.</p>
</dd></dl>

<dl class="attribute">
<dt id="django.contrib.sitemaps.Sitemap.changefreq">
<code class="descname">changefreq</code><a class="headerlink" href="#django.contrib.sitemaps.Sitemap.changefreq" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p><strong>Facultatif.</strong> Soit une méthode, soit un attribut.</p>
<p>Si c’est une méthode, elle doit accepter un paramètre, un objet renvoyé par <a class="reference internal" href="#django.contrib.sitemaps.Sitemap.items" title="django.contrib.sitemaps.Sitemap.items"><code class="xref py py-attr docutils literal notranslate"><span class="pre">items()</span></code></a>, et renvoyer la fréquence de modification de cet objet, en tant que chaîne.</p>
<p>Si c’est un attribut, sa valeur doit être une chaîne représentant la fréquence de modification de <em>chaque</em> objet renvoyé par <a class="reference internal" href="#django.contrib.sitemaps.Sitemap.items" title="django.contrib.sitemaps.Sitemap.items"><code class="xref py py-attr docutils literal notranslate"><span class="pre">items()</span></code></a>.</p>
<p>Les valeurs possibles pour <a class="reference internal" href="#django.contrib.sitemaps.Sitemap.changefreq" title="django.contrib.sitemaps.Sitemap.changefreq"><code class="xref py py-attr docutils literal notranslate"><span class="pre">changefreq</span></code></a>, que ce soit une méthode ou un attribut, sont&nbsp;:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">'always'</span></code> (toujours)</li>
<li><code class="docutils literal notranslate"><span class="pre">'hourly'</span></code> (chaque heure)</li>
<li><code class="docutils literal notranslate"><span class="pre">'daily'</span></code> (quotidiennement)</li>
<li><code class="docutils literal notranslate"><span class="pre">'weekly'</span></code> (chaque semaine)</li>
<li><code class="docutils literal notranslate"><span class="pre">'monthly'</span></code> (chaque mois)</li>
<li><code class="docutils literal notranslate"><span class="pre">'yearly'</span></code> (annuellement)</li>
<li><code class="docutils literal notranslate"><span class="pre">'never'</span></code> (jamais)</li>
</ul>
</dd></dl>

<dl class="attribute">
<dt id="django.contrib.sitemaps.Sitemap.priority">
<code class="descname">priority</code><a class="headerlink" href="#django.contrib.sitemaps.Sitemap.priority" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p><strong>Facultatif.</strong> Soit une méthode, soit un attribut.</p>
<p>Si c’est une méthode, elle doit accepter un paramètre, un objet renvoyé par <a class="reference internal" href="#django.contrib.sitemaps.Sitemap.items" title="django.contrib.sitemaps.Sitemap.items"><code class="xref py py-attr docutils literal notranslate"><span class="pre">items()</span></code></a>, et renvoyer la priorité de cet objet, en tant que chaîne ou nombre à virgule.</p>
<p>Si c’est un attribut, sa valeur doit être une chaîne ou un nombre à virgule représentant la priorité de <em>chaque</em> objet renvoyé par <a class="reference internal" href="#django.contrib.sitemaps.Sitemap.items" title="django.contrib.sitemaps.Sitemap.items"><code class="xref py py-attr docutils literal notranslate"><span class="pre">items()</span></code></a>.</p>
<p>Exemples de valeurs pour <a class="reference internal" href="#django.contrib.sitemaps.Sitemap.priority" title="django.contrib.sitemaps.Sitemap.priority"><code class="xref py py-attr docutils literal notranslate"><span class="pre">priority</span></code></a>: <code class="docutils literal notranslate"><span class="pre">0.4</span></code>, <code class="docutils literal notranslate"><span class="pre">1.0</span></code>. La priorité par défaut d’une page est de <code class="docutils literal notranslate"><span class="pre">0.5</span></code>. Voir la <a class="reference external" href="https://www.sitemaps.org/protocol.html#prioritydef">documentation de sitemaps.org</a> pour plus d’informations.</p>
</dd></dl>

<dl class="attribute">
<dt id="django.contrib.sitemaps.Sitemap.protocol">
<code class="descname">protocol</code><a class="headerlink" href="#django.contrib.sitemaps.Sitemap.protocol" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p><strong>Facultatif.</strong></p>
<p>Cet attribut définit le protocole (<code class="docutils literal notranslate"><span class="pre">'http'</span></code> ou <code class="docutils literal notranslate"><span class="pre">'https'</span></code>) des URL dans le plan du site. S’il n’est pas défini, le protocole avec lequel le plan du site a été demandé sera utilisé. Si le plan du site est construit en dehors du contexte d’une requête, la valeur par défaut est <code class="docutils literal notranslate"><span class="pre">'http'</span></code>.</p>
</dd></dl>

<dl class="attribute">
<dt id="django.contrib.sitemaps.Sitemap.limit">
<code class="descname">limit</code><a class="headerlink" href="#django.contrib.sitemaps.Sitemap.limit" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p><strong>Facultatif.</strong></p>
<p>Cet attribut définit le nombre maximum d’URL incluses sur chaque page du plan de site. Sa valeur ne doit pas dépasser la valeur par défaut de <code class="docutils literal notranslate"><span class="pre">50000</span></code>, qui est la valeur limite supérieure autorisée par le <a class="reference external" href="https://www.sitemaps.org/protocol.html#index">protocole des plans de site</a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="django.contrib.sitemaps.Sitemap.i18n">
<code class="descname">i18n</code><a class="headerlink" href="#django.contrib.sitemaps.Sitemap.i18n" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p><strong>Facultatif.</strong></p>
<p>Un attribut booléen qui définit si les URL de ce plan de site doivent être générées en utilisant toutes les langues de <a class="reference internal" href="../settings.html#std:setting-LANGUAGES"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LANGUAGES</span></code></a>. La valeur par défaut est <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="s-shortcuts">
<span id="shortcuts"></span><h2>Raccourcis<a class="headerlink" href="#shortcuts" title="Lien permanent vers ce titre">¶</a></h2>
<p>L’infrastructure sitemap fournit une classe pratique pour un cas courant&nbsp;:</p>
<dl class="class">
<dt id="django.contrib.sitemaps.GenericSitemap">
<em class="property">class </em><code class="descname">GenericSitemap</code>(<em>info_dict</em>, <em>priority=None</em>, <em>changefreq=None</em>, <em>protocol=None</em>)<a class="headerlink" href="#django.contrib.sitemaps.GenericSitemap" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>La classe <a class="reference internal" href="#django.contrib.sitemaps.GenericSitemap" title="django.contrib.sitemaps.GenericSitemap"><code class="xref py py-class docutils literal notranslate"><span class="pre">django.contrib.sitemaps.GenericSitemap</span></code></a> permet de créer un plan du site en lui passant un dictionnaire qui doit contenir au minimum une entrée <code class="docutils literal notranslate"><span class="pre">queryset</span></code>. Ce jeu de requête sera utilisé pour générer les éléments du plan du site. Le dictionnaire peut aussi contenir une clé <code class="docutils literal notranslate"><span class="pre">date_field</span></code> qui définit un champ de date pour les objets récupérés par <code class="docutils literal notranslate"><span class="pre">queryset</span></code>. Ce champ sera utilisé pour l’attribut <a class="reference internal" href="#django.contrib.sitemaps.Sitemap.lastmod" title="django.contrib.sitemaps.Sitemap.lastmod"><code class="xref py py-attr docutils literal notranslate"><span class="pre">lastmod</span></code></a> dans le plan du site généré.</p>
<p>Les paramètres nommés <a class="reference internal" href="#django.contrib.sitemaps.Sitemap.priority" title="django.contrib.sitemaps.Sitemap.priority"><code class="xref py py-attr docutils literal notranslate"><span class="pre">priority</span></code></a>, <a class="reference internal" href="#django.contrib.sitemaps.Sitemap.changefreq" title="django.contrib.sitemaps.Sitemap.changefreq"><code class="xref py py-attr docutils literal notranslate"><span class="pre">changefreq</span></code></a> et <a class="reference internal" href="#django.contrib.sitemaps.Sitemap.protocol" title="django.contrib.sitemaps.Sitemap.protocol"><code class="xref py py-attr docutils literal notranslate"><span class="pre">protocol</span></code></a> permettent de définir ces attributs pour toutes les URL.</p>
</dd></dl>

<div class="section" id="s-example">
<span id="example"></span><h3>Exemple<a class="headerlink" href="#example" title="Lien permanent vers ce titre">¶</a></h3>
<p>Voici un exemple de <a class="reference internal" href="../../topics/http/urls.html"><span class="doc">configuration d’URL</span></a> utilisant <a class="reference internal" href="#django.contrib.sitemaps.GenericSitemap" title="django.contrib.sitemaps.GenericSitemap"><code class="xref py py-class docutils literal notranslate"><span class="pre">GenericSitemap</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.sitemaps</span> <span class="k">import</span> <span class="n">GenericSitemap</span>
<span class="kn">from</span> <span class="nn">django.contrib.sitemaps.views</span> <span class="k">import</span> <span class="n">sitemap</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="k">import</span> <span class="n">path</span>
<span class="kn">from</span> <span class="nn">blog.models</span> <span class="k">import</span> <span class="n">Entry</span>

<span class="n">info_dict</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;queryset&#39;</span><span class="p">:</span> <span class="n">Entry</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span>
    <span class="s1">&#39;date_field&#39;</span><span class="p">:</span> <span class="s1">&#39;pub_date&#39;</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="c1"># some generic view using info_dict</span>
    <span class="c1"># ...</span>

    <span class="c1"># the sitemap</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;sitemap.xml&#39;</span><span class="p">,</span> <span class="n">sitemap</span><span class="p">,</span>
         <span class="p">{</span><span class="s1">&#39;sitemaps&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;blog&#39;</span><span class="p">:</span> <span class="n">GenericSitemap</span><span class="p">(</span><span class="n">info_dict</span><span class="p">,</span> <span class="n">priority</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)}},</span>
         <span class="n">name</span><span class="o">=</span><span class="s1">&#39;django.contrib.sitemaps.views.sitemap&#39;</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="s-sitemap-for-static-views">
<span id="sitemap-for-static-views"></span><h2>Plan de site pour les vues statiques<a class="headerlink" href="#sitemap-for-static-views" title="Lien permanent vers ce titre">¶</a></h2>
<p>Il peut souvent être nécessaire de faire indexer par les robots des moteurs de recherche des vues qui ne sont ni des pages de détail d’un objet, ni des pages statiques. La solution est de fournir une liste explicite de noms d’URL pour ces vues dans <code class="docutils literal notranslate"><span class="pre">items</span></code> et d’appeler <a class="reference internal" href="../urlresolvers.html#django.urls.reverse" title="django.urls.reverse"><code class="xref py py-func docutils literal notranslate"><span class="pre">reverse()</span></code></a> dans la méthode <code class="docutils literal notranslate"><span class="pre">location</span></code> du sitemap. Par exemple&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># sitemaps.py</span>
<span class="kn">from</span> <span class="nn">django.contrib</span> <span class="k">import</span> <span class="n">sitemaps</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="k">import</span> <span class="n">reverse</span>

<span class="k">class</span> <span class="nc">StaticViewSitemap</span><span class="p">(</span><span class="n">sitemaps</span><span class="o">.</span><span class="n">Sitemap</span><span class="p">):</span>
    <span class="n">priority</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">changefreq</span> <span class="o">=</span> <span class="s1">&#39;daily&#39;</span>

    <span class="k">def</span> <span class="nf">items</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="s1">&#39;main&#39;</span><span class="p">,</span> <span class="s1">&#39;about&#39;</span><span class="p">,</span> <span class="s1">&#39;license&#39;</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">location</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">reverse</span><span class="p">(</span><span class="n">item</span><span class="p">)</span>

<span class="c1"># urls.py</span>
<span class="kn">from</span> <span class="nn">django.contrib.sitemaps.views</span> <span class="k">import</span> <span class="n">sitemap</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="k">import</span> <span class="n">path</span>

<span class="kn">from</span> <span class="nn">.sitemaps</span> <span class="k">import</span> <span class="n">StaticViewSitemap</span>
<span class="kn">from</span> <span class="nn">.</span> <span class="k">import</span> <span class="n">views</span>

<span class="n">sitemaps</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;static&#39;</span><span class="p">:</span> <span class="n">StaticViewSitemap</span><span class="p">,</span>
<span class="p">}</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">main</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;main&#39;</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;about/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">about</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;about&#39;</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;license/&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">license</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;license&#39;</span><span class="p">),</span>
    <span class="c1"># ...</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;sitemap.xml&#39;</span><span class="p">,</span> <span class="n">sitemap</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;sitemaps&#39;</span><span class="p">:</span> <span class="n">sitemaps</span><span class="p">},</span>
         <span class="n">name</span><span class="o">=</span><span class="s1">&#39;django.contrib.sitemaps.views.sitemap&#39;</span><span class="p">)</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="s-creating-a-sitemap-index">
<span id="creating-a-sitemap-index"></span><h2>Création d’un index de plan de site<a class="headerlink" href="#creating-a-sitemap-index" title="Lien permanent vers ce titre">¶</a></h2>
<dl class="function">
<dt id="django.contrib.sitemaps.views.index">
<code class="descclassname">views.</code><code class="descname">index</code>(<em>request</em>, <em>sitemaps</em>, <em>template_name='sitemap_index.xml'</em>, <em>content_type='application/xml'</em>, <em>sitemap_url_name='django.contrib.sitemaps.views.sitemap'</em>)<a class="headerlink" href="#django.contrib.sitemaps.views.index" title="Lien permanent vers cette définition">¶</a></dt>
<dd></dd></dl>

<p>Le système sitemap a également la possibilité de créer un index de plan de site qui référence des fichiers sitemap individuels, un pour chaque section définie dans le dictionnaire <code class="docutils literal notranslate"><span class="pre">sitemaps</span></code>. Les seules différences dans l’utilisation sont les suivantes&nbsp;:</p>
<ul class="simple">
<li>Vous utilisez deux vues dans la configuration d’URL&nbsp;: <a class="reference internal" href="#django.contrib.sitemaps.views.index" title="django.contrib.sitemaps.views.index"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.contrib.sitemaps.views.index()</span></code></a> et <a class="reference internal" href="#django.contrib.sitemaps.views.sitemap" title="django.contrib.sitemaps.views.sitemap"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.contrib.sitemaps.views.sitemap()</span></code></a>.</li>
<li>La vue <a class="reference internal" href="#django.contrib.sitemaps.views.sitemap" title="django.contrib.sitemaps.views.sitemap"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.contrib.sitemaps.views.sitemap()</span></code></a> doit accepter un paramètre nommé <code class="docutils literal notranslate"><span class="pre">section</span></code>.</li>
</ul>
<p>Voici à quoi ressembleraient les lignes appropriées de la configuration d’URL pour l’exemple ci-dessus&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.sitemaps</span> <span class="k">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;sitemap.xml&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;sitemaps&#39;</span><span class="p">:</span> <span class="n">sitemaps</span><span class="p">}),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;sitemap-&lt;section&gt;.xml&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">sitemap</span><span class="p">,</span> <span class="p">{</span><span class="s1">&#39;sitemaps&#39;</span><span class="p">:</span> <span class="n">sitemaps</span><span class="p">},</span>
         <span class="n">name</span><span class="o">=</span><span class="s1">&#39;django.contrib.sitemaps.views.sitemap&#39;</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Cela générera automatiquement un fichier <code class="file docutils literal notranslate"><span class="pre">sitemap.xml</span></code> faisant référence à la fois à <code class="file docutils literal notranslate"><span class="pre">sitemap-flatpages.xml</span></code> et à <code class="file docutils literal notranslate"><span class="pre">sitemap-blog.xml</span></code>. Les classes <a class="reference internal" href="#django.contrib.sitemaps.Sitemap" title="django.contrib.sitemaps.Sitemap"><code class="xref py py-class docutils literal notranslate"><span class="pre">Sitemap</span></code></a> et le dictionnaire <code class="docutils literal notranslate"><span class="pre">sitemaps</span></code> ne changent aucunement.</p>
<p>Vous devriez créer un fichier d’index lorsqu’un plan de site contient plus de 50 000 URL. Dans ce cas, Django pagine automatiquement le plan du site et l’index reflétera cette situation.</p>
<p>Si vous n’utilisez pas la vue sitemap ordinaire – par exemple, si elle est enveloppée par un décorateur de mise en cache – vous devez nommer votre vue sitemap et passer <code class="docutils literal notranslate"><span class="pre">sitemap_url_name</span></code> à la vue d’index&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.sitemaps</span> <span class="k">import</span> <span class="n">views</span> <span class="k">as</span> <span class="n">sitemaps_views</span>
<span class="kn">from</span> <span class="nn">django.views.decorators.cache</span> <span class="k">import</span> <span class="n">cache_page</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;sitemap.xml&#39;</span><span class="p">,</span>
         <span class="n">cache_page</span><span class="p">(</span><span class="mi">86400</span><span class="p">)(</span><span class="n">sitemaps_views</span><span class="o">.</span><span class="n">index</span><span class="p">),</span>
         <span class="p">{</span><span class="s1">&#39;sitemaps&#39;</span><span class="p">:</span> <span class="n">sitemaps</span><span class="p">,</span> <span class="s1">&#39;sitemap_url_name&#39;</span><span class="p">:</span> <span class="s1">&#39;sitemaps&#39;</span><span class="p">}),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;sitemap-&lt;section&gt;.xml&#39;</span><span class="p">,</span>
         <span class="n">cache_page</span><span class="p">(</span><span class="mi">86400</span><span class="p">)(</span><span class="n">sitemaps_views</span><span class="o">.</span><span class="n">sitemap</span><span class="p">),</span>
         <span class="p">{</span><span class="s1">&#39;sitemaps&#39;</span><span class="p">:</span> <span class="n">sitemaps</span><span class="p">},</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;sitemaps&#39;</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="s-template-customization">
<span id="template-customization"></span><h2>Personnalisation de gabarit<a class="headerlink" href="#template-customization" title="Lien permanent vers ce titre">¶</a></h2>
<p>Si vous souhaitez utiliser un gabarit différent pour chaque plan de site ou d’index de plan de site disponible sur un site, vous pouvez l’indiquer en passant un paramètre <code class="docutils literal notranslate"><span class="pre">template_name</span></code> aux vues <code class="docutils literal notranslate"><span class="pre">sitemap</span></code> et <code class="docutils literal notranslate"><span class="pre">index</span></code> via la configuration d’URL&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.sitemaps</span> <span class="k">import</span> <span class="n">views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;custom-sitemap.xml&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="p">{</span>
        <span class="s1">&#39;sitemaps&#39;</span><span class="p">:</span> <span class="n">sitemaps</span><span class="p">,</span>
        <span class="s1">&#39;template_name&#39;</span><span class="p">:</span> <span class="s1">&#39;custom_sitemap.html&#39;</span>
    <span class="p">}),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;custom-sitemap-&lt;section&gt;.xml&#39;</span><span class="p">,</span> <span class="n">views</span><span class="o">.</span><span class="n">sitemap</span><span class="p">,</span> <span class="p">{</span>
        <span class="s1">&#39;sitemaps&#39;</span><span class="p">:</span> <span class="n">sitemaps</span><span class="p">,</span>
        <span class="s1">&#39;template_name&#39;</span><span class="p">:</span> <span class="s1">&#39;custom_sitemap.html&#39;</span>
    <span class="p">},</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;django.contrib.sitemaps.views.sitemap&#39;</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Ces vues renvoient des instances <a class="reference internal" href="../template-response.html#django.template.response.TemplateResponse" title="django.template.response.TemplateResponse"><code class="xref py py-class docutils literal notranslate"><span class="pre">TemplateResponse</span></code></a> permettant de personnaliser facilement les données de réponse avant le processus de rendu. Pour plus de détails, consultez la <a class="reference internal" href="../template-response.html"><span class="doc">documentation de TemplateResponse</span></a>.</p>
<div class="section" id="s-context-variables">
<span id="context-variables"></span><h3>Variables de contexte<a class="headerlink" href="#context-variables" title="Lien permanent vers ce titre">¶</a></h3>
<p>Lors de la personnalisation des gabarits pour les vues <a class="reference internal" href="#django.contrib.sitemaps.views.index" title="django.contrib.sitemaps.views.index"><code class="xref py py-func docutils literal notranslate"><span class="pre">index()</span></code></a> et <a class="reference internal" href="#django.contrib.sitemaps.views.sitemap" title="django.contrib.sitemaps.views.sitemap"><code class="xref py py-func docutils literal notranslate"><span class="pre">sitemap()</span></code></a>, vous pouvez compter sur les variables de contexte suivantes.</p>
</div>
<div class="section" id="s-index">
<span id="index"></span><h3>Accueil<a class="headerlink" href="#index" title="Lien permanent vers ce titre">¶</a></h3>
<p>La variable <code class="docutils literal notranslate"><span class="pre">sitemaps</span></code> est une liste des URL absolues vers chacun des plans du site.</p>
</div>
<div class="section" id="s-id1">
<span id="id1"></span><h3>Sitemap<a class="headerlink" href="#id1" title="Lien permanent vers ce titre">¶</a></h3>
<p>La variable <code class="docutils literal notranslate"><span class="pre">urlset</span></code> est une liste d’URL devant apparaître dans le plan du site. Chaque URL expose des attributs tels que définis dans la classe <a class="reference internal" href="#django.contrib.sitemaps.Sitemap" title="django.contrib.sitemaps.Sitemap"><code class="xref py py-class docutils literal notranslate"><span class="pre">Sitemap</span></code></a>:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">changefreq</span></code> (fréquence de modification)</li>
<li><code class="docutils literal notranslate"><span class="pre">item</span></code> (élément)</li>
<li><code class="docutils literal notranslate"><span class="pre">lastmod</span></code> (date de dernière modification)</li>
<li><code class="docutils literal notranslate"><span class="pre">location</span></code> (adresse)</li>
<li><code class="docutils literal notranslate"><span class="pre">priority</span></code> (priorité)</li>
</ul>
<p>L’attribut <code class="docutils literal notranslate"><span class="pre">item</span></code> a été ajouté pour chaque URL afin de permettre une personnalisation plus souple des gabarits, comme pour les <a class="reference external" href="https://support.google.com/news/publisher/answer/74288?hl=en">Google news sitemaps</a>. En supposant que <a class="reference internal" href="#django.contrib.sitemaps.Sitemap.items" title="django.contrib.sitemaps.Sitemap.items"><code class="xref py py-attr docutils literal notranslate"><span class="pre">items()</span></code></a> de <code class="docutils literal notranslate"><span class="pre">Sitemap</span></code> renvoie une liste d’éléments avec des champs <code class="docutils literal notranslate"><span class="pre">publication_date</span></code> et <code class="docutils literal notranslate"><span class="pre">tags</span></code>, le code ci-dessous devrait générer un plan de site compatible avec Google News&nbsp;:</p>
<div class="highlight-xml+django notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;urlset</span>
  <span class="na">xmlns=</span><span class="s">&quot;https://www.sitemaps.org/schemas/sitemap/0.9&quot;</span>
  <span class="na">xmlns:news=</span><span class="s">&quot;http://www.google.com/schemas/sitemap-news/0.9&quot;</span><span class="nt">&gt;</span>
<span class="cp">{%</span> <span class="k">spaceless</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">for</span> <span class="nv">url</span> <span class="k">in</span> <span class="nv">urlset</span> <span class="cp">%}</span>
  <span class="nt">&lt;url&gt;</span>
    <span class="nt">&lt;loc&gt;</span><span class="cp">{{</span> <span class="nv">url.location</span> <span class="cp">}}</span><span class="nt">&lt;/loc&gt;</span>
    <span class="cp">{%</span> <span class="k">if</span> <span class="nv">url.lastmod</span> <span class="cp">%}</span><span class="nt">&lt;lastmod&gt;</span><span class="cp">{{</span> <span class="nv">url.lastmod</span><span class="o">|</span><span class="nf">date</span><span class="s2">:&quot;Y-m-d&quot;</span> <span class="cp">}}</span><span class="nt">&lt;/lastmod&gt;</span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">if</span> <span class="nv">url.changefreq</span> <span class="cp">%}</span><span class="nt">&lt;changefreq&gt;</span><span class="cp">{{</span> <span class="nv">url.changefreq</span> <span class="cp">}}</span><span class="nt">&lt;/changefreq&gt;</span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">if</span> <span class="nv">url.priority</span> <span class="cp">%}</span><span class="nt">&lt;priority&gt;</span><span class="cp">{{</span> <span class="nv">url.priority</span> <span class="cp">}}</span><span class="nt">&lt;/priority&gt;</span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
    <span class="nt">&lt;news:news&gt;</span>
      <span class="cp">{%</span> <span class="k">if</span> <span class="nv">url.item.publication_date</span> <span class="cp">%}</span><span class="nt">&lt;news:publication_date&gt;</span><span class="cp">{{</span> <span class="nv">url.item.publication_date</span><span class="o">|</span><span class="nf">date</span><span class="s2">:&quot;Y-m-d&quot;</span> <span class="cp">}}</span><span class="nt">&lt;/news:publication_date&gt;</span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
      <span class="cp">{%</span> <span class="k">if</span> <span class="nv">url.item.tags</span> <span class="cp">%}</span><span class="nt">&lt;news:keywords&gt;</span><span class="cp">{{</span> <span class="nv">url.item.tags</span> <span class="cp">}}</span><span class="nt">&lt;/news:keywords&gt;</span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
    <span class="nt">&lt;/news:news&gt;</span>
   <span class="nt">&lt;/url&gt;</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endspaceless</span> <span class="cp">%}</span>
<span class="nt">&lt;/urlset&gt;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="s-pinging-google">
<span id="pinging-google"></span><h2>Signalement à Google<a class="headerlink" href="#pinging-google" title="Lien permanent vers ce titre">¶</a></h2>
<p>Lorsqu’un plan de site change, il peut être souhaitable de le signaler à Google, afin qu’il sache qu’il doit réindexer le site. Le système sitemaps fournit une fonction pour faire exactement cela&nbsp;: <a class="reference internal" href="#django.contrib.sitemaps.ping_google" title="django.contrib.sitemaps.ping_google"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.contrib.sitemaps.ping_google()</span></code></a>.</p>
<dl class="function">
<dt id="django.contrib.sitemaps.ping_google">
<code class="descname">ping_google</code>(<em>sitemap_url=None</em>, <em>ping_url=PING_URL</em>, <em>sitemap_uses_https=True</em>)<a class="headerlink" href="#django.contrib.sitemaps.ping_google" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p><code class="docutils literal notranslate"><span class="pre">ping_google</span></code> accepte ces paramètres facultatifs :</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">sitemap_url</span></code> - le chemin absolu vers le plan du site (par exemple, <code class="file docutils literal notranslate"><span class="pre">'/sitemap.xml'</span></code>). Si ce paramètre n’est pas fourni, <code class="docutils literal notranslate"><span class="pre">ping_google</span></code> tente de trouver lui-même le plan du site en effectuant une recherche inverse dans la configuration d’URL.</li>
<li><code class="docutils literal notranslate"><span class="pre">ping_url</span></code> - contient par défaut le lien vers l’outil de Ping de Google : <a class="reference external" href="https://www.google.com/webmasters/tools/ping">https://www.google.com/webmasters/tools/ping</a>.</li>
<li><code class="docutils literal notranslate"><span class="pre">sitemap_uses_https</span></code> - définissez-le à <code class="docutils literal notranslate"><span class="pre">False</span></code> si votre site utilise <code class="docutils literal notranslate"><span class="pre">http</span></code> au lieu de <code class="docutils literal notranslate"><span class="pre">https</span></code>.</li>
</ul>
<p><a class="reference internal" href="#django.contrib.sitemaps.ping_google" title="django.contrib.sitemaps.ping_google"><code class="xref py py-func docutils literal notranslate"><span class="pre">ping_google()</span></code></a> génère l’exception <code class="docutils literal notranslate"><span class="pre">django.contrib.sitemaps.SitemapNotFound</span></code> si elle ne peut pas déterminer l’URL du plan du site.</p>
</dd></dl>

<div class="admonition-register-with-google-first admonition">
<p class="first admonition-title">Inscription préalable chez Google !</p>
<p class="last">La commande <a class="reference internal" href="#django.contrib.sitemaps.ping_google" title="django.contrib.sitemaps.ping_google"><code class="xref py py-func docutils literal notranslate"><span class="pre">ping_google()</span></code></a> ne fonctionne que si vous avez inscrit le site avec <a class="reference external" href="https://www.google.com/webmasters/tools/">Google Webmaster Tools</a>.</p>
</div>
<p>Une façon utile d’appeler <a class="reference internal" href="#django.contrib.sitemaps.ping_google" title="django.contrib.sitemaps.ping_google"><code class="xref py py-func docutils literal notranslate"><span class="pre">ping_google()</span></code></a> est de le faire à partir de la méthode <code class="docutils literal notranslate"><span class="pre">save()</span></code> d’un modèle&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.sitemaps</span> <span class="k">import</span> <span class="n">ping_google</span>

<span class="k">class</span> <span class="nc">Entry</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="c1"># ...</span>
    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">force_insert</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">force_update</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">force_insert</span><span class="p">,</span> <span class="n">force_update</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">ping_google</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="c1"># Bare &#39;except&#39; because we could get a variety</span>
            <span class="c1"># of HTTP-related exceptions.</span>
            <span class="k">pass</span>
</pre></div>
</div>
<p>Toutefois, une solution plus efficace serait d’appeler <a class="reference internal" href="#django.contrib.sitemaps.ping_google" title="django.contrib.sitemaps.ping_google"><code class="xref py py-func docutils literal notranslate"><span class="pre">ping_google()</span></code></a> à partir d’un script cron ou de tout autre tâche planifiée. La fonction effectue une requête HTTP vers les serveurs de Google, il n’est donc pas forcément souhaitable d’introduire cette charge réseau chaque fois que <code class="docutils literal notranslate"><span class="pre">save()</span></code> est appelée.</p>
<div class="section" id="s-pinging-google-via-manage-py">
<span id="pinging-google-via-manage-py"></span><h3>Signalement à Google via <code class="docutils literal notranslate"><span class="pre">manage.py</span></code><a class="headerlink" href="#pinging-google-via-manage-py" title="Lien permanent vers ce titre">¶</a></h3>
<dl class="django-admin">
<dt id="django-admin-ping_google">
<code class="descname">django-admin ping_google [sitemap_url]</code><a class="headerlink" href="#django-admin-ping_google" title="Lien permanent vers cette définition">¶</a></dt>
<dd></dd></dl>

<p>Une fois l’application sitemaps ajoutée à un projet, il est aussi possible de prévenir Google en utilisant la commande de gestion <code class="docutils literal notranslate"><span class="pre">ping_google</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">manage</span><span class="o">.</span><span class="n">py</span> <span class="n">ping_google</span> <span class="p">[</span><span class="o">/</span><span class="n">sitemap</span><span class="o">.</span><span class="n">xml</span><span class="p">]</span>
</pre></div>
</div>
<dl class="django-admin-option">
<dt id="cmdoption-ping-google-sitemap-uses-http">
<code class="descname">--sitemap-uses-http</code><code class="descclassname"></code><a class="headerlink" href="#cmdoption-ping-google-sitemap-uses-http" title="Lien permanent vers cette définition">¶</a></dt>
<dd></dd></dl>

<p>Utilisez cette option si votre plan de site utilise <code class="docutils literal notranslate"><span class="pre">http</span></code> au lieu de <code class="docutils literal notranslate"><span class="pre">https</span></code>.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      
        
          <div class="yui-b" id="sidebar">
            
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../contents.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Le système des plans de site (<code class="docutils literal notranslate"><span class="pre">sitemap</span></code>)</a><ul>
<li><a class="reference internal" href="#overview">Aperçu</a></li>
<li><a class="reference internal" href="#installation">Installation</a></li>
<li><a class="reference internal" href="#initialization">Initialisation</a></li>
<li><a class="reference internal" href="#sitemap-classes">Classes <code class="docutils literal notranslate"><span class="pre">Sitemap</span></code></a></li>
<li><a class="reference internal" href="#an-example">Un exemple</a></li>
<li><a class="reference internal" href="#sitemap-class-reference">Référence de la classe <code class="docutils literal notranslate"><span class="pre">Sitemap</span></code></a></li>
<li><a class="reference internal" href="#shortcuts">Raccourcis</a><ul>
<li><a class="reference internal" href="#example">Exemple</a></li>
</ul>
</li>
<li><a class="reference internal" href="#sitemap-for-static-views">Plan de site pour les vues statiques</a></li>
<li><a class="reference internal" href="#creating-a-sitemap-index">Création d’un index de plan de site</a></li>
<li><a class="reference internal" href="#template-customization">Personnalisation de gabarit</a><ul>
<li><a class="reference internal" href="#context-variables">Variables de contexte</a></li>
<li><a class="reference internal" href="#index">Accueil</a></li>
<li><a class="reference internal" href="#id1">Sitemap</a></li>
</ul>
</li>
<li><a class="reference internal" href="#pinging-google">Signalement à Google</a><ul>
<li><a class="reference internal" href="#pinging-google-via-manage-py">Signalement à Google via <code class="docutils literal notranslate"><span class="pre">manage.py</span></code></a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Sujet précédent</h4>
  <p class="topless"><a href="redirects.html"
                        title="Chapitre précédent">L’application de redirection</a></p>
  <h4>Sujet suivant</h4>
  <p class="topless"><a href="sites.html"
                        title="Chapitre suivant">L’infrastructure des «&nbsp;sites&nbsp;»</a></p>
  <div role="note" aria-label="source link">
    <h3>Cette page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/ref/contrib/sitemaps.txt"
            rel="nofollow">Montrer le code source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Recherche rapide</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
              <h3>Last update:</h3>
              <p class="topless">oct. 29, 2020</p>
          </div>
        
      
    </div>

    <div id="ft">
      <div class="nav">
    &laquo; <a href="redirects.html" title="L’application de redirection">previous</a>
     |
    <a href="../index.html" title="Référence de l’API" accesskey="U">up</a>
   |
    <a href="sites.html" title="L’infrastructure des «&amp;nbsp;sites&amp;nbsp;»">next</a> &raquo;</div>
    </div>
  </div>

      <div class="clearer"></div>
    </div>
  </body>
</html>