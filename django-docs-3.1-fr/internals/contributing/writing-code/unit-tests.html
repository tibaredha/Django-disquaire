
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="fr">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Les tests unitaires &#8212; Documentation Django 3.1.3.dev</title>
    <link rel="stylesheet" href="../../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../../_static/translations.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Recherche" href="../../../search.html" />
    <link rel="next" title="Soumission de correctifs" href="submitting-patches.html" />
    <link rel="prev" title="Style de code" href="coding-style.html" />



 
<script src="../../../templatebuiltins.js"></script>
<script>
(function($) {
    if (!django_template_builtins) {
       // templatebuiltins.js missing, do nothing.
       return;
    }
    $(document).ready(function() {
        // Hyperlink Django template tags and filters
        var base = "../../../ref/templates/builtins.html";
        if (base == "#") {
            // Special case for builtins.html itself
            base = "";
        }
        // Tags are keywords, class '.k'
        $("div.highlight\\-html\\+django span.k").each(function(i, elem) {
             var tagname = $(elem).text();
             if ($.inArray(tagname, django_template_builtins.ttags) != -1) {
                 var fragment = tagname.replace(/_/, '-');
                 $(elem).html("<a href='" + base + "#" + fragment + "'>" + tagname + "</a>");
             }
        });
        // Filters are functions, class '.nf'
        $("div.highlight\\-html\\+django span.nf").each(function(i, elem) {
             var filtername = $(elem).text();
             if ($.inArray(filtername, django_template_builtins.tfilters) != -1) {
                 var fragment = filtername.replace(/_/, '-');
                 $(elem).html("<a href='" + base + "#" + fragment + "'>" + filtername + "</a>");
             }
        });
    });
})(jQuery);(function($) {
    $(document).ready(function() {
        $(".c-tab-unix").on("click", function() {
            $("section.c-content-unix").show();
            $("section.c-content-win").hide();
            $(".c-tab-unix").prop("checked", true);
        });
        $(".c-tab-win").on("click", function() {
            $("section.c-content-win").show();
            $("section.c-content-unix").hide();
            $(".c-tab-win").prop("checked", true);
        });
    });
})(jQuery);</script>
<link rel="stylesheet" href="../../../_static/console-tabs.css" type="text/css" />
  </head><body>

    <div class="document">
  <div id="custom-doc" class="yui-t6">
    <div id="hd">
      <h1><a href="../../../index.html">Documentation Django 3.1.3.dev</a></h1>
      <div id="global-nav">
        <a title="Home page" href="../../../index.html">Home</a>  |
        <a title="Table of contents" href="../../../contents.html">Table of contents</a>  |
        <a title="Global index" href="../../../genindex.html">Index</a>  |
        <a title="Module index" href="../../../py-modindex.html">Modules</a>
      </div>
      <div class="nav">
    &laquo; <a href="coding-style.html" title="Style de code">previous</a>
     |
    <a href="../../index.html" title="Fonctionnement interne du projet Django" accesskey="U">up</a>
   |
    <a href="submitting-patches.html" title="Soumission de correctifs">next</a> &raquo;</div>
    </div>

    <div id="bd">
      <div id="yui-main">
        <div class="yui-b">
          <div class="yui-g" id="internals-contributing-writing-code-unit-tests">
            
  <div class="section" id="s-unit-tests">
<span id="unit-tests"></span><h1>Les tests unitaires<a class="headerlink" href="#unit-tests" title="Lien permanent vers ce titre">¶</a></h1>
<p>Django est livré avec sa propre suite de tests, dans le répertoire <code class="docutils literal notranslate"><span class="pre">tests</span></code> de la base de code. Notre politique est de nous assurer que tous les tests passent en tout temps.</p>
<p>Nous apprécions toute contribution à la suite de tests !</p>
<p>Les tests de Django utilisent tous l’infrastructure de tests livrée avec Django pour tester les applications. Consultez <a class="reference internal" href="../../../topics/testing/overview.html"><span class="doc">Écriture et lancement de tests</span></a> pour une explication sur la façon d’écrire de nouveaux tests.</p>
<div class="section" id="s-running-the-unit-tests">
<span id="s-running-unit-tests"></span><span id="running-the-unit-tests"></span><span id="running-unit-tests"></span><h2>Lancement des tests unitaires<a class="headerlink" href="#running-the-unit-tests" title="Lien permanent vers ce titre">¶</a></h2>
<div class="section" id="s-quickstart">
<span id="quickstart"></span><h3>Démarrage rapide<a class="headerlink" href="#quickstart" title="Lien permanent vers ce titre">¶</a></h3>
<p>Tout d’abord, créez votre <a class="reference external" href="https://github.com/django/django/fork">fork de Django sur GitHub</a>.</p>
<p>Ensuite, créez et activez un environnement virtuel. Si vous n’êtes pas familier avec cette procédure, lisez le <a class="reference internal" href="../../../intro/contributing.html"><span class="doc">tutoriel de contribution</span></a>.</p>
<p>Puis, créez un clone local de votre fork, installez quelques dépendances et lancez la suite de tests :</p>
<div class="console-block" id="console-block-0">
<input class="c-tab-unix" id="c-tab-0-unix" type="radio" name="console-0" checked>
<label for="c-tab-0-unix" title="Linux/macOS">&#xf17c/&#xf179</label>
<input class="c-tab-win" id="c-tab-0-win" type="radio" name="console-0">
<label for="c-tab-0-win" title="Windows">&#xf17a</label>
<section class="c-content-unix" id="c-content-0-unix">
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> git clone https://github.com/YourGitHubName/django.git django-repo
<span class="gp">$</span> <span class="nb">cd</span> django-repo/tests
<span class="gp">$</span> python -m pip install -e ..
<span class="gp">$</span> python -m pip install -r requirements/py3.txt
<span class="gp">$</span> ./runtests.py
</pre></div>
</div>
</section>
<section class="c-content-win" id="c-content-0-win">
<div class="highlight"><pre><span></span><span class="gp">...\&gt;</span> git clone https://github.com/YourGitHubName/django.git django-repo
<span class="gp">...\&gt;</span> <span class="k">cd</span> django-repo\tests
<span class="gp">...\&gt;</span> py -m pip install -e ..
<span class="gp">...\&gt;</span> py -m pip install -r requirements\py3.txt
<span class="gp">...\&gt;</span> runtests.py 
</pre></div>
</section>
</div>
<p>L’installation des dépendances nécessite probablement l’installation de paquets de votre système d’exploitation. Il est généralement possible de savoir quels paquets installer en faisant une recherche Web à propos des dernières lignes du message d’erreur. Essayez d’ajouter le nom de votre système d’exploitation à la requête si nécessaire.</p>
<p>Si vous avez des soucis d’installation des dépendances, vous pouvez omettre cette étape. Voir <a class="reference internal" href="#running-unit-tests-dependencies"><span class="std std-ref">Lancement de tous les tests</span></a> pour des détails sur l’installation des dépendances facultatives des tests. Si l’une des dépendances facultatives n’est pas installée, les tests qui l’exigent seront passés (skipped).</p>
<p>Le lancement des tests exige un module de réglages Django définissant la base de données à utiliser. Pour faciliter le démarrage, Django fournit et utilise un module de réglages d’exemple utilisant la base de données SQLite. Voir <a class="reference internal" href="#running-unit-tests-settings"><span class="std std-ref">Utilisation d’un autre module de réglages settings</span></a> pour apprendre comment utiliser un module de réglages différent pour lancer les tests avec une autre base de données.</p>
<p>Des problèmes ? Voir <a class="reference internal" href="#troubleshooting-unit-tests"><span class="std std-ref">Dépannage</span></a> pour certaines problématiques courantes.</p>
</div>
<div class="section" id="s-running-tests-using-tox">
<span id="running-tests-using-tox"></span><h3>Lancement des tests avec <code class="docutils literal notranslate"><span class="pre">tox</span></code><a class="headerlink" href="#running-tests-using-tox" title="Lien permanent vers ce titre">¶</a></h3>
<p><a class="reference external" href="https://tox.readthedocs.io/">Tox</a> est un outil pour exécuter des tests dans différents environnement virtuels. Django contient un fichier <code class="docutils literal notranslate"><span class="pre">tox.ini</span></code> basique qui automatise certains contrôles que notre serveur de construction effectue pour les requêtes de contribution. Pour exécuter les tests unitaires et autres contrôles (tels que l”<a class="reference internal" href="coding-style.html#coding-style-imports"><span class="std std-ref">ordre des importations</span></a>, la <a class="reference internal" href="../writing-documentation.html#documentation-spelling-check"><span class="std std-ref">correction orthographique de la documentation</span></a> et la <a class="reference internal" href="coding-style.html#coding-style-python"><span class="std std-ref">mise en forme du code</span></a>), installez et lancez la commande <code class="docutils literal notranslate"><span class="pre">tox</span></code> depuis n’importe quel endroit de l’arborescence source de Django :</p>
<div class="console-block" id="console-block-1">
<input class="c-tab-unix" id="c-tab-1-unix" type="radio" name="console-1" checked>
<label for="c-tab-1-unix" title="Linux/macOS">&#xf17c/&#xf179</label>
<input class="c-tab-win" id="c-tab-1-win" type="radio" name="console-1">
<label for="c-tab-1-win" title="Windows">&#xf17a</label>
<section class="c-content-unix" id="c-content-1-unix">
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> python -m pip install tox
<span class="gp">$</span> tox
</pre></div>
</div>
</section>
<section class="c-content-win" id="c-content-1-win">
<div class="highlight"><pre><span></span><span class="gp">...\&gt;</span> py -m pip install tox
<span class="gp">...\&gt;</span> tox
</pre></div>
</section>
</div>
<p>Par défaut, <code class="docutils literal notranslate"><span class="pre">tox</span></code> lance la suite de tests avec le fichier de réglages inclu pour SQLite, <code class="docutils literal notranslate"><span class="pre">flake8</span></code>, <code class="docutils literal notranslate"><span class="pre">isort</span></code> et la correction orthographique de la documentation. En plus des dépendances système mentionnées ailleurs dans cette documentation, la commande <code class="docutils literal notranslate"><span class="pre">python3</span></code> doit se trouver dans votre chemin et être liée à la version appropriée de Python. Une liste des environnements par défaut peut être listée comme suit :</p>
<div class="console-block" id="console-block-2">
<input class="c-tab-unix" id="c-tab-2-unix" type="radio" name="console-2" checked>
<label for="c-tab-2-unix" title="Linux/macOS">&#xf17c/&#xf179</label>
<input class="c-tab-win" id="c-tab-2-win" type="radio" name="console-2">
<label for="c-tab-2-win" title="Windows">&#xf17a</label>
<section class="c-content-unix" id="c-content-2-unix">
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> tox -l
<span class="go">py3</span>
<span class="go">flake8</span>
<span class="go">docs</span>
<span class="go">isort&gt;=5.1.0</span>
</pre></div>
</div>
</section>
<section class="c-content-win" id="c-content-2-win">
<div class="highlight"><pre><span></span><span class="gp">...\&gt;</span> tox -l
<span class="go">py3</span>
<span class="go">flake8</span>
<span class="go">docs</span>
<span class="gp">isort&gt;</span>=5.1.0
</pre></div>
</section>
</div>
<div class="section" id="s-testing-other-python-versions-and-database-backends">
<span id="testing-other-python-versions-and-database-backends"></span><h4>Test avec d’autres versions de Python et de moteurs de base de données<a class="headerlink" href="#testing-other-python-versions-and-database-backends" title="Lien permanent vers ce titre">¶</a></h4>
<p>En plus des environnements par défaut, <code class="docutils literal notranslate"><span class="pre">tox</span></code> prend en charge le lancement des tests unitaires pour d’autres versions de Python et de moteurs de base de données. Comme la suite de tests de Django ne livre pas de fichier de réglages pour les bases de données autres que SQLite, vous devez donc <a class="reference internal" href="#running-unit-tests-settings"><span class="std std-ref">créer et fournir vos propres réglages de tests</span></a>. Par exemple, pour lancer les tests avec Python 3.7 en utilisant PostgreSQL :</p>
<div class="console-block" id="console-block-3">
<input class="c-tab-unix" id="c-tab-3-unix" type="radio" name="console-3" checked>
<label for="c-tab-3-unix" title="Linux/macOS">&#xf17c/&#xf179</label>
<input class="c-tab-win" id="c-tab-3-win" type="radio" name="console-3">
<label for="c-tab-3-win" title="Windows">&#xf17a</label>
<section class="c-content-unix" id="c-content-3-unix">
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> tox -e py37-postgres -- --settings<span class="o">=</span>my_postgres_settings
</pre></div>
</div>
</section>
<section class="c-content-win" id="c-content-3-win">
<div class="highlight"><pre><span></span><span class="gp">...\&gt;</span> tox -e py37-postgres -- --settings=my_postgres_settings
</pre></div>
</section>
</div>
<p>Cette commande configure un environnement virtuel Python 3.7, installe les dépendances de la suite de tests de Django (y compris celles pour PostgreSQL) et appelle <code class="docutils literal notranslate"><span class="pre">runtests.py</span></code> avec les paramètres fournis (dans ce cas, <code class="docutils literal notranslate"><span class="pre">--settings=my_postgres_settings</span></code>).</p>
<p>Le reste de cette documentation  montre des commandes pour lancer les tests sans <code class="docutils literal notranslate"><span class="pre">tox</span></code>. Cependant, toute option transmise à <code class="docutils literal notranslate"><span class="pre">runtests.py</span></code> peut également être transmise à <code class="docutils literal notranslate"><span class="pre">tox</span></code> en préfixant la liste des paramètres par <code class="docutils literal notranslate"><span class="pre">--</span></code>, comme ci-dessus.</p>
<p>Tox respecte également la variable d’environnement <span class="target" id="index-6"></span><a class="reference internal" href="../../../topics/settings.html#envvar-DJANGO_SETTINGS_MODULE"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">DJANGO_SETTINGS_MODULE</span></code></a> quand elle est définie. Par exemple, la commande ci-dessous est équivalente à la précédente :</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nv">DJANGO_SETTINGS_MODULE</span><span class="o">=</span>my_postgres_settings tox -e py35-postgres
</pre></div>
</div>
<p>Les utilisateurs de Windows devraient écrire :</p>
<div class="highlight-doscon notranslate"><div class="highlight"><pre><span></span><span class="gp">...\&gt;</span> <span class="k">set</span> <span class="nv">DJANGO_SETTINGS_MODULE</span><span class="p">=</span>my_postgres_settings
<span class="gp">...\&gt;</span> tox -e py35-postgres
</pre></div>
</div>
</div>
<div class="section" id="s-running-the-javascript-tests">
<span id="running-the-javascript-tests"></span><h4>Lancement des tests JavaScript<a class="headerlink" href="#running-the-javascript-tests" title="Lien permanent vers ce titre">¶</a></h4>
<p>Django contient un ensemble de <a class="reference internal" href="javascript.html#javascript-tests"><span class="std std-ref">tests unitaires JavaScript</span></a> ciblant des fonctions de certaines applications contrib. Les tests JavaScript ne sont pas lancés par défaut avec <code class="docutils literal notranslate"><span class="pre">tox</span></code> car ils ont besoin que <code class="docutils literal notranslate"><span class="pre">Node.js</span></code> soit installé et ne sont pas nécessaires pour la majorité des correctifs. Pour lancer les tests JavaScript en utilisant <code class="docutils literal notranslate"><span class="pre">tox</span></code>:</p>
<div class="console-block" id="console-block-4">
<input class="c-tab-unix" id="c-tab-4-unix" type="radio" name="console-4" checked>
<label for="c-tab-4-unix" title="Linux/macOS">&#xf17c/&#xf179</label>
<input class="c-tab-win" id="c-tab-4-win" type="radio" name="console-4">
<label for="c-tab-4-win" title="Windows">&#xf17a</label>
<section class="c-content-unix" id="c-content-4-unix">
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> tox -e javascript
</pre></div>
</div>
</section>
<section class="c-content-win" id="c-content-4-win">
<div class="highlight"><pre><span></span><span class="gp">...\&gt;</span> tox -e javascript
</pre></div>
</section>
</div>
<p>Cette commande exécute <code class="docutils literal notranslate"><span class="pre">npm</span> <span class="pre">install</span></code> pour s’assurer que les logiciels exigés par les tests sont à jour, puis lance <code class="docutils literal notranslate"><span class="pre">npm</span> <span class="pre">test</span></code>.</p>
</div>
</div>
<div class="section" id="s-running-tests-using-django-docker-box">
<span id="running-tests-using-django-docker-box"></span><h3>Lancement des tests avec <code class="docutils literal notranslate"><span class="pre">django-docker-box</span></code><a class="headerlink" href="#running-tests-using-django-docker-box" title="Lien permanent vers ce titre">¶</a></h3>
<p><a class="reference external" href="https://github.com/django/django-docker-box">django-docker-box</a> permet de lancer la suite de tests de Django en combinant toutes les bases de données prises en charge et les versions de Python. Consultez la page du projet <a class="reference external" href="https://github.com/django/django-docker-box">django-docker-box</a> pour des instructions d’installation et d’utilisation.</p>
</div>
<div class="section" id="s-using-another-settings-module">
<span id="s-running-unit-tests-settings"></span><span id="using-another-settings-module"></span><span id="running-unit-tests-settings"></span><h3>Utilisation d’un autre module de réglages <code class="docutils literal notranslate"><span class="pre">settings</span></code><a class="headerlink" href="#using-another-settings-module" title="Lien permanent vers ce titre">¶</a></h3>
<p>Le module de réglages inclus (<code class="docutils literal notranslate"><span class="pre">tests/test_sqlite.py</span></code>) permet de lancer la suite de tests avec SQLite. Si vous souhaitez lancer les tests avec une autre base de données, vous devez définir votre propre fichier de réglages. Certains tests, comme ceux de <code class="docutils literal notranslate"><span class="pre">contrib.postgres</span></code>, sont spécifique à un moteur de base de données spécifique et seront omis quand une autre base de données est utilisée.</p>
<p>Pour lancer les tests avec des réglages différents, assurez-vous que le module se trouve dans le chemin <span class="target" id="index-7"></span><a class="reference external" href="https://docs.python.org/3/using/cmdline.html#envvar-PYTHONPATH" title="(disponible dans Python v3.9)"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">PYTHONPATH</span></code></a> et indiquez ce module avec <code class="docutils literal notranslate"><span class="pre">--settings</span></code>.</p>
<p>Le réglage <a class="reference internal" href="../../../ref/settings.html#std:setting-DATABASES"><code class="xref std std-setting docutils literal notranslate"><span class="pre">DATABASES</span></code></a> dans tout module de réglages pour les tests doit définir deux bases de données :</p>
<ul class="simple">
<li>Une base de données <code class="docutils literal notranslate"><span class="pre">default</span></code>. Celle-ci doit utiliser le moteur que vous souhaitez tester de manière principale.</li>
<li>Une base de données avec l’alias <code class="docutils literal notranslate"><span class="pre">other</span></code>. Celle-ci est utilisée pour tester les requêtes qui sont dirigées vers d’autres bases de données. Elle devrait utiliser le même moteur que la base de données <code class="docutils literal notranslate"><span class="pre">default</span></code>, mais elle doit avoir un autre nom.</li>
</ul>
<p>Si vous utilisez un moteur autre que SQLite, il est nécessaire de fournir d’autres détails pour chaque base de données :</p>
<ul class="simple">
<li>L’option <a class="reference internal" href="../../../ref/settings.html#std:setting-USER"><code class="xref std std-setting docutils literal notranslate"><span class="pre">USER</span></code></a> doit indiquer un compte utilisateur existant pour la base de données. Cet utilisateur a besoin de la permission d’exécuter <code class="docutils literal notranslate"><span class="pre">CREATE</span> <span class="pre">DATABASE</span></code> afin de pouvoir créer la base de données de test.</li>
<li>L’option <a class="reference internal" href="../../../ref/settings.html#std:setting-PASSWORD"><code class="xref std std-setting docutils literal notranslate"><span class="pre">PASSWORD</span></code></a> doit indiquer le mot de passe à utiliser pour l’utilisateur <a class="reference internal" href="../../../ref/settings.html#std:setting-USER"><code class="xref std std-setting docutils literal notranslate"><span class="pre">USER</span></code></a>.</li>
</ul>
<p>Les noms des bases de données de test sont composés par le préfixe <code class="docutils literal notranslate"><span class="pre">test_</span></code> devant les réglages <a class="reference internal" href="../../../ref/settings.html#std:setting-NAME"><code class="xref std std-setting docutils literal notranslate"><span class="pre">NAME</span></code></a> des bases de données définies dans <a class="reference internal" href="../../../ref/settings.html#std:setting-DATABASES"><code class="xref std std-setting docutils literal notranslate"><span class="pre">DATABASES</span></code></a>. Ces bases de données de test sont détruites lorsque les tests sont terminés.</p>
<p>Vous devez aussi vous assurer que votre base de données utilise UTF-8 comme jeu de caractères par défaut. Si votre serveur de base de données n’utilise pas le jeu de caractères UTF-8 par défaut, vous devrez inclure une valeur pour le réglage <a class="reference internal" href="../../../ref/settings.html#std:setting-TEST_CHARSET"><code class="xref std std-setting docutils literal notranslate"><span class="pre">CHARSET</span></code></a> du dictionnaire des réglages de test pour la base de données concernée.</p>
</div>
<div class="section" id="s-running-only-some-of-the-tests">
<span id="s-runtests-specifying-labels"></span><span id="running-only-some-of-the-tests"></span><span id="runtests-specifying-labels"></span><h3>Lancement de tests spécifiques<a class="headerlink" href="#running-only-some-of-the-tests" title="Lien permanent vers ce titre">¶</a></h3>
<p>La suite de tests complète de Django prend un certain temps à s’exécuter, et le lancement de tous les tests pourrait être superflu si par exemple vous avez juste ajouté un test à Django et que vous voulez le lancer rapidement sans tout le reste des tests. Il est possible de lancer un sous-ensemble des tests unitaires en ajoutant les noms des modules de test à <code class="docutils literal notranslate"><span class="pre">runtests.py</span></code> dans la ligne de commande.</p>
<p>Par exemple, si vous souhaitez lancer les tests uniquement pour les relations génériques et la régionalisation, saisissez :</p>
<div class="console-block" id="console-block-5">
<input class="c-tab-unix" id="c-tab-5-unix" type="radio" name="console-5" checked>
<label for="c-tab-5-unix" title="Linux/macOS">&#xf17c/&#xf179</label>
<input class="c-tab-win" id="c-tab-5-win" type="radio" name="console-5">
<label for="c-tab-5-win" title="Windows">&#xf17a</label>
<section class="c-content-unix" id="c-content-5-unix">
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ./runtests.py --settings<span class="o">=</span>path.to.settings generic_relations i18n
</pre></div>
</div>
</section>
<section class="c-content-win" id="c-content-5-win">
<div class="highlight"><pre><span></span><span class="gp">...\&gt;</span> runtests.py --settings=path.to.settings generic_relations i18n
</pre></div>
</section>
</div>
<p>Comment trouver les noms des tests individuels ? Regardez dans <code class="docutils literal notranslate"><span class="pre">tests/</span></code> — chaque nom de répertoire est le nom d’un module de tests.</p>
<p>Si vous souhaitez lancer uniquement une classe précise de tests, vous pouvez indiquer une liste de chemins vers les classes de test concernées. Par exemple, pour lancer les tests <code class="docutils literal notranslate"><span class="pre">TranslationTests</span></code> du module <code class="docutils literal notranslate"><span class="pre">i18n</span></code>, saisissez :</p>
<div class="console-block" id="console-block-6">
<input class="c-tab-unix" id="c-tab-6-unix" type="radio" name="console-6" checked>
<label for="c-tab-6-unix" title="Linux/macOS">&#xf17c/&#xf179</label>
<input class="c-tab-win" id="c-tab-6-win" type="radio" name="console-6">
<label for="c-tab-6-win" title="Windows">&#xf17a</label>
<section class="c-content-unix" id="c-content-6-unix">
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ./runtests.py --settings<span class="o">=</span>path.to.settings i18n.tests.TranslationTests
</pre></div>
</div>
</section>
<section class="c-content-win" id="c-content-6-win">
<div class="highlight"><pre><span></span><span class="gp">...\&gt;</span> runtests.py --settings=path.to.settings i18n.tests.TranslationTests
</pre></div>
</section>
</div>
<p>Pour aller encore plus loin, vous pouvez indiquer une méthode de test individuelle comme ceci :</p>
<div class="console-block" id="console-block-7">
<input class="c-tab-unix" id="c-tab-7-unix" type="radio" name="console-7" checked>
<label for="c-tab-7-unix" title="Linux/macOS">&#xf17c/&#xf179</label>
<input class="c-tab-win" id="c-tab-7-win" type="radio" name="console-7">
<label for="c-tab-7-win" title="Windows">&#xf17a</label>
<section class="c-content-unix" id="c-content-7-unix">
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ./runtests.py --settings<span class="o">=</span>path.to.settings i18n.tests.TranslationTests.test_lazy_objects
</pre></div>
</div>
</section>
<section class="c-content-win" id="c-content-7-win">
<div class="highlight"><pre><span></span><span class="gp">...\&gt;</span> runtests.py --settings=path.to.settings i18n.tests.TranslationTests.test_lazy_objects
</pre></div>
</section>
</div>
<p>Vous pouvez lancer les tests en commençant par un module de premier niveau avec l’option <code class="docutils literal notranslate"><span class="pre">--start-at</span></code>. Par exemple :</p>
<div class="console-block" id="console-block-8">
<input class="c-tab-unix" id="c-tab-8-unix" type="radio" name="console-8" checked>
<label for="c-tab-8-unix" title="Linux/macOS">&#xf17c/&#xf179</label>
<input class="c-tab-win" id="c-tab-8-win" type="radio" name="console-8">
<label for="c-tab-8-win" title="Windows">&#xf17a</label>
<section class="c-content-unix" id="c-content-8-unix">
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ./runtests.py --start-at<span class="o">=</span>wsgi
</pre></div>
</div>
</section>
<section class="c-content-win" id="c-content-8-win">
<div class="highlight"><pre><span></span><span class="gp">...\&gt;</span> runtests.py --start-at=wsgi
</pre></div>
</section>
</div>
<p>Vous pouvez aussi lancer les tests en commençant après un module de premier niveau avec l’option <code class="docutils literal notranslate"><span class="pre">--start-after</span></code>. Par exemple :</p>
<div class="console-block" id="console-block-9">
<input class="c-tab-unix" id="c-tab-9-unix" type="radio" name="console-9" checked>
<label for="c-tab-9-unix" title="Linux/macOS">&#xf17c/&#xf179</label>
<input class="c-tab-win" id="c-tab-9-win" type="radio" name="console-9">
<label for="c-tab-9-win" title="Windows">&#xf17a</label>
<section class="c-content-unix" id="c-content-9-unix">
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ./runtests.py --start-after<span class="o">=</span>wsgi
</pre></div>
</div>
</section>
<section class="c-content-win" id="c-content-9-win">
<div class="highlight"><pre><span></span><span class="gp">...\&gt;</span> runtests.py --start-after=wsgi
</pre></div>
</section>
</div>
<p>Notez que l’option <code class="docutils literal notranslate"><span class="pre">--reverse</span></code> n’a pas d’influence sur les options <code class="docutils literal notranslate"><span class="pre">--start-at</span></code> et <code class="docutils literal notranslate"><span class="pre">--start-after</span></code>. De plus, ces options ne peuvent pas être utilisées quand vous indiquez des noms de tests.</p>
</div>
<div class="section" id="s-running-the-selenium-tests">
<span id="running-the-selenium-tests"></span><h3>Lancement des tests Selenium<a class="headerlink" href="#running-the-selenium-tests" title="Lien permanent vers ce titre">¶</a></h3>
<p>Certains tests requièrent Selenium et un navigateur Web. Pour lancer ces tests, vous devez installer le paquet  <a class="reference external" href="https://pypi.org/project/selenium/">selenium</a> et lancer les tests avec l’option <code class="docutils literal notranslate"><span class="pre">--selenium=&lt;NAVIGATEURS&gt;</span></code>. Par exemple, si Firefox et Google Chrome sont installés :</p>
<div class="console-block" id="console-block-10">
<input class="c-tab-unix" id="c-tab-10-unix" type="radio" name="console-10" checked>
<label for="c-tab-10-unix" title="Linux/macOS">&#xf17c/&#xf179</label>
<input class="c-tab-win" id="c-tab-10-win" type="radio" name="console-10">
<label for="c-tab-10-win" title="Windows">&#xf17a</label>
<section class="c-content-unix" id="c-content-10-unix">
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ./runtests.py --selenium<span class="o">=</span>firefox,chrome
</pre></div>
</div>
</section>
<section class="c-content-win" id="c-content-10-win">
<div class="highlight"><pre><span></span><span class="gp">...\&gt;</span> runtests.py --selenium=firefox,chrome
</pre></div>
</section>
</div>
<p>Consultez le paquet <a class="reference external" href="https://github.com/SeleniumHQ/selenium/tree/master/py/selenium/webdriver">selenium.webdriver</a> pour obtenir la liste des navigateurs disponibles.</p>
<p>L’indication de <code class="docutils literal notranslate"><span class="pre">--selenium</span></code> définit automatiquement <code class="docutils literal notranslate"><span class="pre">--tags=selenium</span></code> pour ne lancer que les tests exigeant selenium.</p>
<p>Certains navigateurs (par ex. Chrome ou Firefox) prennent en charge les tests sans interface, ce qui peut être plus rapide et plus stable. Ajoutez l’option <code class="docutils literal notranslate"><span class="pre">--headless</span></code> pour activer ce mode.</p>
</div>
<div class="section" id="s-running-all-the-tests">
<span id="s-running-unit-tests-dependencies"></span><span id="running-all-the-tests"></span><span id="running-unit-tests-dependencies"></span><h3>Lancement de tous les tests<a class="headerlink" href="#running-all-the-tests" title="Lien permanent vers ce titre">¶</a></h3>
<p>Si vous souhaitez lancer la suite de tests complète, vous devrez installer un certain nombre de dépendances :</p>
<ul class="simple">
<li><a class="reference external" href="https://pypi.org/project/argon2_cffi/">argon2-cffi</a> 16.1.0+</li>
<li><a class="reference external" href="https://pypi.org/project/asgiref/">asgiref</a> 3.2.10+ (obligatoire)</li>
<li><a class="reference external" href="https://pypi.org/project/bcrypt/">bcrypt</a></li>
<li><a class="reference external" href="https://pypi.org/project/docutils/">docutils</a></li>
<li><a class="reference external" href="https://pypi.org/project/geoip2/">geoip2</a></li>
<li><a class="reference external" href="https://pypi.org/project/jinja2/">jinja2</a> 2.7+</li>
<li><a class="reference external" href="https://pypi.org/project/numpy/">numpy</a></li>
<li><a class="reference external" href="https://pypi.org/project/Pillow/">Pillow</a> 6.2.0+</li>
<li><a class="reference external" href="https://pyyaml.org/wiki/PyYAML">PyYAML</a></li>
<li><a class="reference external" href="https://pypi.org/project/pytz/">pytz</a> (obligatoire)</li>
<li><a class="reference external" href="https://pypi.org/project/pywatchman/">pywatchman</a></li>
<li><a class="reference external" href="https://pypi.org/project/setuptools/">setuptools</a></li>
<li><a class="reference external" href="https://memcached.org/">memcached</a>, plus une <a class="reference internal" href="../../../topics/cache.html#memcached"><span class="std std-ref">liaison Python prise en charge</span></a></li>
<li><a class="reference external" href="https://www.gnu.org/software/gettext/manual/gettext.html">gettext</a> (<a class="reference internal" href="../../../topics/i18n/translation.html#gettext-on-windows"><span class="std std-ref">gettext et Windows</span></a>)</li>
<li><a class="reference external" href="https://pypi.org/project/selenium/">selenium</a></li>
<li><a class="reference external" href="https://pypi.org/project/sqlparse/">sqlparse</a> 0.2.2+ (obligatoire)</li>
<li><a class="reference external" href="https://pypi.org/project/tblib/">tblib</a> 1.5.0+</li>
</ul>
<p>Vous pouvez trouver ces dépendances dans des <a class="reference external" href="https://pip.pypa.io/en/latest/user_guide/#requirements-files">fichiers de dépendances pip</a> dans le répertoire <code class="docutils literal notranslate"><span class="pre">tests/requirements</span></code> du code source de Django et vous pouvez les installer comme ceci :</p>
<div class="console-block" id="console-block-11">
<input class="c-tab-unix" id="c-tab-11-unix" type="radio" name="console-11" checked>
<label for="c-tab-11-unix" title="Linux/macOS">&#xf17c/&#xf179</label>
<input class="c-tab-win" id="c-tab-11-win" type="radio" name="console-11">
<label for="c-tab-11-win" title="Windows">&#xf17a</label>
<section class="c-content-unix" id="c-content-11-unix">
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> python -m pip install -r tests/requirements/py3.txt
</pre></div>
</div>
</section>
<section class="c-content-win" id="c-content-11-win">
<div class="highlight"><pre><span></span><span class="gp">...\&gt;</span> py -m pip install -r tests\requirements\py3.txt
</pre></div>
</section>
</div>
<p>Si vous rencontrez une erreur durant l’installation, il est possible qu’une dépendance pour un ou plusieurs paquets Python manque sur votre système. Consultez la documentation du paquet problématique ou recherchez sur le Web avec le message d’erreur obtenu.</p>
<p>Vous pouvez également installer les adaptateurs de base de données de votre choix en utilisant <code class="docutils literal notranslate"><span class="pre">oracle.txt</span></code>, <code class="docutils literal notranslate"><span class="pre">mysql.txt</span></code> ou <code class="docutils literal notranslate"><span class="pre">postgres.txt</span></code>.</p>
<p>Si vous souhaitez tester le moteur de cache <code class="docutils literal notranslate"><span class="pre">memcached</span></code>, vous devrez aussi définir un réglage <a class="reference internal" href="../../../ref/settings.html#std:setting-CACHES"><code class="xref std std-setting docutils literal notranslate"><span class="pre">CACHES</span></code></a> pointant sur votre instance de memcached.</p>
<p>Pour lancer les tests GeoDjango, il vous faudra <a class="reference internal" href="../../../ref/contrib/gis/install/index.html"><span class="doc">configurer une base de données spatiale et installer les bibliothèques géospatiales</span></a>.</p>
<p>Ces dépendances sont facultatives. Si l’une d’entre elle est absente, les tests correspondants seront sautés.</p>
<p>Pour exécuter certains tests <code class="docutils literal notranslate"><span class="pre">autoreload</span></code>, il vous faudra installer le service <a class="reference external" href="https://facebook.github.io/watchman/">Watchman</a>.</p>
</div>
<div class="section" id="s-code-coverage">
<span id="code-coverage"></span><h3>La couverture de code<a class="headerlink" href="#code-coverage" title="Lien permanent vers ce titre">¶</a></h3>
<p>Les contributeurs sont encouragés à exécuter la couverture de code sur la suite de tests pour identifier les zones qui ont besoin de tests supplémentaires. L’installation et l’utilisation de l’outil de couverture sont décrites dans <a class="reference internal" href="../../../topics/testing/advanced.html#topics-testing-code-coverage"><span class="std std-ref">test de couverture du code</span></a>.</p>
<p>La couverture de tests doit être lancé dans un seul processus pour obtenir des statistiques correctes. Pour lancer la couverture sur la suite de tests de Django avec les réglages de test standard :</p>
<div class="console-block" id="console-block-12">
<input class="c-tab-unix" id="c-tab-12-unix" type="radio" name="console-12" checked>
<label for="c-tab-12-unix" title="Linux/macOS">&#xf17c/&#xf179</label>
<input class="c-tab-win" id="c-tab-12-win" type="radio" name="console-12">
<label for="c-tab-12-win" title="Windows">&#xf17a</label>
<section class="c-content-unix" id="c-content-12-unix">
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> coverage run ./runtests.py --settings<span class="o">=</span>test_sqlite --parallel<span class="o">=</span><span class="m">1</span>
</pre></div>
</div>
</section>
<section class="c-content-win" id="c-content-12-win">
<div class="highlight"><pre><span></span><span class="gp">...\&gt;</span> coverage run runtests.py --settings=test_sqlite --parallel=1
</pre></div>
</section>
</div>
<p>Après avoir lancé la couverture des tests, produisez le rapport HTML en exécutant :</p>
<div class="console-block" id="console-block-13">
<input class="c-tab-unix" id="c-tab-13-unix" type="radio" name="console-13" checked>
<label for="c-tab-13-unix" title="Linux/macOS">&#xf17c/&#xf179</label>
<input class="c-tab-win" id="c-tab-13-win" type="radio" name="console-13">
<label for="c-tab-13-win" title="Windows">&#xf17a</label>
<section class="c-content-unix" id="c-content-13-unix">
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> coverage html
</pre></div>
</div>
</section>
<section class="c-content-win" id="c-content-13-win">
<div class="highlight"><pre><span></span><span class="gp">...\&gt;</span> coverage html
</pre></div>
</section>
</div>
<p>Lors de l’exécution de la couverture des tests Django, le fichier de réglages inclus <code class="docutils literal notranslate"><span class="pre">coveragerc</span></code> définit coverage_html` comme répertoire de sortie pour le rapport et exclut également plusieurs répertoires non pertinents pour les résultats (code de test ou code externe inclus dans Django).</p>
</div>
</div>
<div class="section" id="s-contrib-apps">
<span id="s-id1"></span><span id="contrib-apps"></span><span id="id1"></span><h2>Applications contrib<a class="headerlink" href="#contrib-apps" title="Lien permanent vers ce titre">¶</a></h2>
<p>Les tests des applications contribuées se trouvent dans le répertoire <code class="docutils literal notranslate"><span class="pre">tests/</span></code>, typiquement sous <code class="docutils literal notranslate"><span class="pre">&lt;nom_app&gt;_tests</span></code>. Par exemple, les tests de <code class="docutils literal notranslate"><span class="pre">contrib.auth</span></code> se trouvent dans <code class="docutils literal notranslate"><span class="pre">tests/auth_tests</span></code>.</p>
</div>
<div class="section" id="s-troubleshooting">
<span id="s-troubleshooting-unit-tests"></span><span id="troubleshooting"></span><span id="troubleshooting-unit-tests"></span><h2>Dépannage<a class="headerlink" href="#troubleshooting" title="Lien permanent vers ce titre">¶</a></h2>
<div class="section" id="s-test-suite-hangs-or-shows-failures-on-master-branch">
<span id="test-suite-hangs-or-shows-failures-on-master-branch"></span><h3>Test suite hangs or shows failures on <code class="docutils literal notranslate"><span class="pre">master</span></code> branch<a class="headerlink" href="#test-suite-hangs-or-shows-failures-on-master-branch" title="Lien permanent vers ce titre">¶</a></h3>
<p>Ensure you have the latest point release of a <a class="reference internal" href="../../../faq/install.html#faq-python-version-support"><span class="std std-ref">supported Python version</span></a>, since there are often bugs in earlier versions
that may cause the test suite to fail or hang.</p>
<p>On <strong>macOS</strong> (High Sierra and newer versions), you might see this message
logged, after which the tests hang:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">objc</span><span class="p">[</span><span class="mi">42074</span><span class="p">]:</span> <span class="o">+</span><span class="p">[</span><span class="n">__NSPlaceholderDate</span> <span class="n">initialize</span><span class="p">]</span> <span class="n">may</span> <span class="n">have</span> <span class="n">been</span> <span class="ow">in</span> <span class="n">progress</span> <span class="ow">in</span>
<span class="n">another</span> <span class="n">thread</span> <span class="n">when</span> <span class="n">fork</span><span class="p">()</span> <span class="n">was</span> <span class="n">called</span><span class="o">.</span>
</pre></div>
</div>
<p>To avoid this set a <code class="docutils literal notranslate"><span class="pre">OBJC_DISABLE_INITIALIZE_FORK_SAFETY</span></code> environment
variable, for example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ OBJC_DISABLE_INITIALIZE_FORK_SAFETY=YES ./runtests.py
</pre></div>
</div>
<p>Or add <code class="docutils literal notranslate"><span class="pre">export</span> <span class="pre">OBJC_DISABLE_INITIALIZE_FORK_SAFETY=YES</span></code> to your shell’s
startup file (e.g. <code class="docutils literal notranslate"><span class="pre">~/.profile</span></code>).</p>
</div>
<div class="section" id="s-many-test-failures-with-unicodeencodeerror">
<span id="many-test-failures-with-unicodeencodeerror"></span><h3>Nombreux échecs de tests avec <code class="docutils literal notranslate"><span class="pre">UnicodeEncodeError</span></code><a class="headerlink" href="#many-test-failures-with-unicodeencodeerror" title="Lien permanent vers ce titre">¶</a></h3>
<p>Si le paquet <code class="docutils literal notranslate"><span class="pre">locales</span></code> n’est pas installé, certains tests échoueront avec une exception <code class="docutils literal notranslate"><span class="pre">UnicodeEncodeError</span></code>.</p>
<p>You can resolve this on Debian-based systems, for example, by running:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> apt-get install locales
<span class="gp">$</span> dpkg-reconfigure locales
</pre></div>
</div>
<p>You can resolve this for macOS systems by configuring your shell’s locale:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> <span class="nb">export</span> <span class="nv">LANG</span><span class="o">=</span><span class="s2">&quot;en_US.UTF-8&quot;</span>
<span class="gp">$</span> <span class="nb">export</span> <span class="nv">LC_ALL</span><span class="o">=</span><span class="s2">&quot;en_US.UTF-8&quot;</span>
</pre></div>
</div>
<p>Lancez la commande <code class="docutils literal notranslate"><span class="pre">locale</span></code> pour confirmer la modification. Une autre possibilité est d’ajouter ces commandes d’exportation au fichier de démarrage du shell (par ex. <code class="docutils literal notranslate"><span class="pre">~/.bashrc</span></code> pour Bash) afin d’éviter de devoir les retaper.</p>
</div>
<div class="section" id="s-tests-that-only-fail-in-combination">
<span id="tests-that-only-fail-in-combination"></span><h3>Tests qui n’échouent que lorsqu’ils sont combinés<a class="headerlink" href="#tests-that-only-fail-in-combination" title="Lien permanent vers ce titre">¶</a></h3>
<p>Dans le cas où un test passe lorsqu’il est lancé seul mais échoue lorsque la suite de tests entière est lancée, nous disposons de certains outils pour aider à analyser le problème.</p>
<p>L’option <code class="docutils literal notranslate"><span class="pre">--bisect</span></code> de <code class="docutils literal notranslate"><span class="pre">runtests.py</span></code> va exécuter le test en échec en divisant par deux le groupe de tests avec lesquels il est exécuté lors de chaque itération, ce qui rend souvent possible l’identification d’un petit nombre de tests qui pourraient être liés à cet échec.</p>
<p>Par exemple, supposons que le test en échec qui fonctionne lorsqu’il est lancé seul est <code class="docutils literal notranslate"><span class="pre">ModelTest.test_eq</span></code>. Alors, avec :</p>
<div class="console-block" id="console-block-14">
<input class="c-tab-unix" id="c-tab-14-unix" type="radio" name="console-14" checked>
<label for="c-tab-14-unix" title="Linux/macOS">&#xf17c/&#xf179</label>
<input class="c-tab-win" id="c-tab-14-win" type="radio" name="console-14">
<label for="c-tab-14-win" title="Windows">&#xf17a</label>
<section class="c-content-unix" id="c-content-14-unix">
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ./runtests.py --bisect basic.tests.ModelTest.test_eq
</pre></div>
</div>
</section>
<section class="c-content-win" id="c-content-14-win">
<div class="highlight"><pre><span></span><span class="gp">...\&gt;</span> runtests.py --bisect basic.tests.ModelTest.test_eq
</pre></div>
</section>
</div>
<p>on va essayer de déterminer un test qui interfère avec notre test cible. Pour commencer, le test est exécuté avec la première moitié de la suite de tests. Si un échec survient, cette première moitié est partagée en deux groupes et chaque groupe est ensuite exécuté avec le test cible. Si aucun échec ne survient avec la première moitié de la suite de tests, c’est la seconde moitié qui est exécutée avec le test cible et de nouveau partagée selon le procédé ci-dessus. Ceci se répète jusqu’à ce que le groupe de tests avec échec soit le plus petit possible.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">--pair</span></code> option runs the given test alongside every other test from the
suite, letting you check if another test has side-effects that cause the
failure. So:</p>
<div class="console-block" id="console-block-15">
<input class="c-tab-unix" id="c-tab-15-unix" type="radio" name="console-15" checked>
<label for="c-tab-15-unix" title="Linux/macOS">&#xf17c/&#xf179</label>
<input class="c-tab-win" id="c-tab-15-win" type="radio" name="console-15">
<label for="c-tab-15-win" title="Windows">&#xf17a</label>
<section class="c-content-unix" id="c-content-15-unix">
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ./runtests.py --pair basic.tests.ModelTest.test_eq
</pre></div>
</div>
</section>
<section class="c-content-win" id="c-content-15-win">
<div class="highlight"><pre><span></span><span class="gp">...\&gt;</span> runtests.py --pair basic.tests.ModelTest.test_eq
</pre></div>
</section>
</div>
<p>will pair <code class="docutils literal notranslate"><span class="pre">test_eq</span></code> with every test label.</p>
<p>With both <code class="docutils literal notranslate"><span class="pre">--bisect</span></code> and <code class="docutils literal notranslate"><span class="pre">--pair</span></code>, if you already suspect which cases
might be responsible for the failure, you may limit tests to be cross-analyzed
by <a class="reference internal" href="#runtests-specifying-labels"><span class="std std-ref">specifying further test labels</span></a> after
the first one:</p>
<div class="console-block" id="console-block-16">
<input class="c-tab-unix" id="c-tab-16-unix" type="radio" name="console-16" checked>
<label for="c-tab-16-unix" title="Linux/macOS">&#xf17c/&#xf179</label>
<input class="c-tab-win" id="c-tab-16-win" type="radio" name="console-16">
<label for="c-tab-16-win" title="Windows">&#xf17a</label>
<section class="c-content-unix" id="c-content-16-unix">
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ./runtests.py --pair basic.tests.ModelTest.test_eq queries transactions
</pre></div>
</div>
</section>
<section class="c-content-win" id="c-content-16-win">
<div class="highlight"><pre><span></span><span class="gp">...\&gt;</span> runtests.py --pair basic.tests.ModelTest.test_eq queries transactions
</pre></div>
</section>
</div>
<p>You can also try running any set of tests in reverse using the <code class="docutils literal notranslate"><span class="pre">--reverse</span></code>
option in order to verify that executing tests in a different order does not
cause any trouble:</p>
<div class="console-block" id="console-block-17">
<input class="c-tab-unix" id="c-tab-17-unix" type="radio" name="console-17" checked>
<label for="c-tab-17-unix" title="Linux/macOS">&#xf17c/&#xf179</label>
<input class="c-tab-win" id="c-tab-17-win" type="radio" name="console-17">
<label for="c-tab-17-win" title="Windows">&#xf17a</label>
<section class="c-content-unix" id="c-content-17-unix">
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ./runtests.py basic --reverse
</pre></div>
</div>
</section>
<section class="c-content-win" id="c-content-17-win">
<div class="highlight"><pre><span></span><span class="gp">...\&gt;</span> runtests.py basic --reverse
</pre></div>
</section>
</div>
</div>
<div class="section" id="s-seeing-the-sql-queries-run-during-a-test">
<span id="seeing-the-sql-queries-run-during-a-test"></span><h3>Affichage des requêtes SQL durant un test<a class="headerlink" href="#seeing-the-sql-queries-run-during-a-test" title="Lien permanent vers ce titre">¶</a></h3>
<p>Si vous souhaitez examiner les instructions SQL exécutées dans des tests en échec, vous pouvez activer la <a class="reference internal" href="../../../topics/logging.html#django-db-logger"><span class="std std-ref">journalisation SQL</span></a> en précisant l’option <code class="docutils literal notranslate"><span class="pre">--debug-sql</span></code>. Si vous combinez cela avec <code class="docutils literal notranslate"><span class="pre">--verbosity=2</span></code>, toutes les requêtes SQL seront affichées :</p>
<div class="console-block" id="console-block-18">
<input class="c-tab-unix" id="c-tab-18-unix" type="radio" name="console-18" checked>
<label for="c-tab-18-unix" title="Linux/macOS">&#xf17c/&#xf179</label>
<input class="c-tab-win" id="c-tab-18-win" type="radio" name="console-18">
<label for="c-tab-18-win" title="Windows">&#xf17a</label>
<section class="c-content-unix" id="c-content-18-unix">
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ./runtests.py basic --debug-sql
</pre></div>
</div>
</section>
<section class="c-content-win" id="c-content-18-win">
<div class="highlight"><pre><span></span><span class="gp">...\&gt;</span> runtests.py basic --debug-sql
</pre></div>
</section>
</div>
</div>
<div class="section" id="s-seeing-the-full-traceback-of-a-test-failure">
<span id="seeing-the-full-traceback-of-a-test-failure"></span><h3>Affichage de la trace d’erreur complète d’un échec de test<a class="headerlink" href="#seeing-the-full-traceback-of-a-test-failure" title="Lien permanent vers ce titre">¶</a></h3>
<p>Par défaut, les tests sont exécutés en parallèle avec un processus par cœur. Cependant, lorsque les tests sont exécutés en parallèle, vous ne verrez qu’une trace d’erreur tronquée pour chaque échec de test. Vous pouvez ajuster ce comportement avec l’option <code class="docutils literal notranslate"><span class="pre">--parallel</span></code>:</p>
<div class="console-block" id="console-block-19">
<input class="c-tab-unix" id="c-tab-19-unix" type="radio" name="console-19" checked>
<label for="c-tab-19-unix" title="Linux/macOS">&#xf17c/&#xf179</label>
<input class="c-tab-win" id="c-tab-19-win" type="radio" name="console-19">
<label for="c-tab-19-win" title="Windows">&#xf17a</label>
<section class="c-content-unix" id="c-content-19-unix">
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$</span> ./runtests.py basic --parallel<span class="o">=</span><span class="m">1</span>
</pre></div>
</div>
</section>
<section class="c-content-win" id="c-content-19-win">
<div class="highlight"><pre><span></span><span class="gp">...\&gt;</span> runtests.py basic --parallel=1
</pre></div>
</section>
</div>
<p>Vous pouvez également utiliser la variable d’environnement <span class="target" id="index-8"></span><a class="reference internal" href="../../../ref/django-admin.html#envvar-DJANGO_TEST_PROCESSES"><code class="xref std std-envvar docutils literal notranslate"><span class="pre">DJANGO_TEST_PROCESSES</span></code></a> à cet effet.</p>
</div>
</div>
<div class="section" id="s-tips-for-writing-tests">
<span id="tips-for-writing-tests"></span><h2>Astuces d’écriture de tests<a class="headerlink" href="#tips-for-writing-tests" title="Lien permanent vers ce titre">¶</a></h2>
<div class="section" id="s-isolating-model-registration">
<span id="isolating-model-registration"></span><h3>Isolation de l’inscription des modèles<a class="headerlink" href="#isolating-model-registration" title="Lien permanent vers ce titre">¶</a></h3>
<p>Pour éviter de polluer le registre global <a class="reference internal" href="../../../ref/applications.html#django.apps.apps" title="django.apps.apps"><code class="xref py py-attr docutils literal notranslate"><span class="pre">apps</span></code></a> et empêcher des créations de table non désirées, les modèles définis dans une méthode de test devraient être liés à une instance <code class="docutils literal notranslate"><span class="pre">Apps</span></code> temporaire</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.apps.registry</span> <span class="kn">import</span> <span class="n">Apps</span>
<span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">SimpleTestCase</span>

<span class="k">class</span> <span class="nc">TestModelDefinition</span><span class="p">(</span><span class="n">SimpleTestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_model_definition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">test_apps</span> <span class="o">=</span> <span class="n">Apps</span><span class="p">([</span><span class="s1">&#39;app_label&#39;</span><span class="p">])</span>

        <span class="k">class</span> <span class="nc">TestModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
            <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
                <span class="n">apps</span> <span class="o">=</span> <span class="n">test_apps</span>
        <span class="o">...</span>
</pre></div>
</div>
<dl class="function">
<dt id="django.test.utils.isolate_apps">
<code class="descclassname">django.test.utils.</code><code class="descname">isolate_apps</code>(<em>*app_labels</em>, <em>attr_name=None</em>, <em>kwarg_name=None</em>)<a class="headerlink" href="#django.test.utils.isolate_apps" title="Lien permanent vers cette définition">¶</a></dt>
<dd></dd></dl>

<p>Comme ce procédé implique plusieurs lignes de code, Django fournit un décorateur <a class="reference internal" href="#django.test.utils.isolate_apps" title="django.test.utils.isolate_apps"><code class="xref py py-func docutils literal notranslate"><span class="pre">isolate_apps()</span></code></a>. Il est utilisé comme suit</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">SimpleTestCase</span>
<span class="kn">from</span> <span class="nn">django.test.utils</span> <span class="kn">import</span> <span class="n">isolate_apps</span>

<span class="k">class</span> <span class="nc">TestModelDefinition</span><span class="p">(</span><span class="n">SimpleTestCase</span><span class="p">):</span>
    <span class="nd">@isolate_apps</span><span class="p">(</span><span class="s1">&#39;app_label&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_model_definition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">TestModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="o">...</span>
</pre></div>
</div>
<div class="admonition-setting-app-label admonition">
<p class="first admonition-title">Définition de <code class="docutils literal notranslate"><span class="pre">app_label</span></code></p>
<p>Les modèles définis dans une méthode de test sans <a class="reference internal" href="../../../ref/models/options.html#django.db.models.Options.app_label" title="django.db.models.Options.app_label"><code class="xref py py-attr docutils literal notranslate"><span class="pre">app_label</span></code></a> explicite reçoivent automatiquement l’étiquette de l’application dans laquelle leur classe de test est située.</p>
<p>Dans l’optique de s’assurer que les modèles définis dans le contexte d’instances <a class="reference internal" href="#django.test.utils.isolate_apps" title="django.test.utils.isolate_apps"><code class="xref py py-func docutils literal notranslate"><span class="pre">isolate_apps()</span></code></a> sont correctement installées, vous devriez transmettre l’ensemble des <code class="docutils literal notranslate"><span class="pre">app_label</span></code> ciblées en tant que paramètres :</p>
<div class="literal-block-wrapper last docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">tests/app_label/tests.py</span><a class="headerlink" href="#id2" title="Lien permanent vers ce code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">SimpleTestCase</span>
<span class="kn">from</span> <span class="nn">django.test.utils</span> <span class="kn">import</span> <span class="n">isolate_apps</span>

<span class="k">class</span> <span class="nc">TestModelDefinition</span><span class="p">(</span><span class="n">SimpleTestCase</span><span class="p">):</span>
    <span class="nd">@isolate_apps</span><span class="p">(</span><span class="s1">&#39;app_label&#39;</span><span class="p">,</span> <span class="s1">&#39;other_app_label&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_model_definition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># This model automatically receives app_label=&#39;app_label&#39;</span>
        <span class="k">class</span> <span class="nc">TestModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
            <span class="k">pass</span>

        <span class="k">class</span> <span class="nc">OtherAppModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
            <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
                <span class="n">app_label</span> <span class="o">=</span> <span class="s1">&#39;other_app_label&#39;</span>
        <span class="o">...</span>
</pre></div>
</div>
</div>
</div>
<p>Le décorateur peut aussi être appliqué à des classes&nbsp;:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">SimpleTestCase</span>
<span class="kn">from</span> <span class="nn">django.test.utils</span> <span class="kn">import</span> <span class="n">isolate_apps</span>

<span class="nd">@isolate_apps</span><span class="p">(</span><span class="s1">&#39;app_label&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TestModelDefinition</span><span class="p">(</span><span class="n">SimpleTestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_model_definition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">TestModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="o">...</span>
</pre></div>
</div>
<p>L’instance temporaire <code class="docutils literal notranslate"><span class="pre">Apps</span></code> utilisée pour isoler l’inscription du modèle peut être récupérée comme un attribut lorsqu’utilisée en tant que décorateur de classe au moyen du paramètre <code class="docutils literal notranslate"><span class="pre">attr_name</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">SimpleTestCase</span>
<span class="kn">from</span> <span class="nn">django.test.utils</span> <span class="kn">import</span> <span class="n">isolate_apps</span>

<span class="nd">@isolate_apps</span><span class="p">(</span><span class="s1">&#39;app_label&#39;</span><span class="p">,</span> <span class="n">attr_name</span><span class="o">=</span><span class="s1">&#39;apps&#39;</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TestModelDefinition</span><span class="p">(</span><span class="n">SimpleTestCase</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_model_definition</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">TestModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">apps</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="s1">&#39;app_label&#39;</span><span class="p">,</span> <span class="s1">&#39;TestModel&#39;</span><span class="p">),</span> <span class="n">TestModel</span><span class="p">)</span>
</pre></div>
</div>
<p>Ou en tant que paramètre de la méthode de test lorsqu’utilisée comme décoratrice de méthode au moyen du paramètre <code class="docutils literal notranslate"><span class="pre">kwarg_name</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="kn">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.test</span> <span class="kn">import</span> <span class="n">SimpleTestCase</span>
<span class="kn">from</span> <span class="nn">django.test.utils</span> <span class="kn">import</span> <span class="n">isolate_apps</span>

<span class="k">class</span> <span class="nc">TestModelDefinition</span><span class="p">(</span><span class="n">SimpleTestCase</span><span class="p">):</span>
    <span class="nd">@isolate_apps</span><span class="p">(</span><span class="s1">&#39;app_label&#39;</span><span class="p">,</span> <span class="n">kwarg_name</span><span class="o">=</span><span class="s1">&#39;apps&#39;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">test_model_definition</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">apps</span><span class="p">):</span>
        <span class="k">class</span> <span class="nc">TestModel</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
            <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">assertIs</span><span class="p">(</span><span class="n">apps</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="s1">&#39;app_label&#39;</span><span class="p">,</span> <span class="s1">&#39;TestModel&#39;</span><span class="p">),</span> <span class="n">TestModel</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      
        
          <div class="yui-b" id="sidebar">
            
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../../contents.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Les tests unitaires</a><ul>
<li><a class="reference internal" href="#running-the-unit-tests">Lancement des tests unitaires</a><ul>
<li><a class="reference internal" href="#quickstart">Démarrage rapide</a></li>
<li><a class="reference internal" href="#running-tests-using-tox">Lancement des tests avec <code class="docutils literal notranslate"><span class="pre">tox</span></code></a><ul>
<li><a class="reference internal" href="#testing-other-python-versions-and-database-backends">Test avec d’autres versions de Python et de moteurs de base de données</a></li>
<li><a class="reference internal" href="#running-the-javascript-tests">Lancement des tests JavaScript</a></li>
</ul>
</li>
<li><a class="reference internal" href="#running-tests-using-django-docker-box">Lancement des tests avec <code class="docutils literal notranslate"><span class="pre">django-docker-box</span></code></a></li>
<li><a class="reference internal" href="#using-another-settings-module">Utilisation d’un autre module de réglages <code class="docutils literal notranslate"><span class="pre">settings</span></code></a></li>
<li><a class="reference internal" href="#running-only-some-of-the-tests">Lancement de tests spécifiques</a></li>
<li><a class="reference internal" href="#running-the-selenium-tests">Lancement des tests Selenium</a></li>
<li><a class="reference internal" href="#running-all-the-tests">Lancement de tous les tests</a></li>
<li><a class="reference internal" href="#code-coverage">La couverture de code</a></li>
</ul>
</li>
<li><a class="reference internal" href="#contrib-apps">Applications contrib</a></li>
<li><a class="reference internal" href="#troubleshooting">Dépannage</a><ul>
<li><a class="reference internal" href="#test-suite-hangs-or-shows-failures-on-master-branch">Test suite hangs or shows failures on <code class="docutils literal notranslate"><span class="pre">master</span></code> branch</a></li>
<li><a class="reference internal" href="#many-test-failures-with-unicodeencodeerror">Nombreux échecs de tests avec <code class="docutils literal notranslate"><span class="pre">UnicodeEncodeError</span></code></a></li>
<li><a class="reference internal" href="#tests-that-only-fail-in-combination">Tests qui n’échouent que lorsqu’ils sont combinés</a></li>
<li><a class="reference internal" href="#seeing-the-sql-queries-run-during-a-test">Affichage des requêtes SQL durant un test</a></li>
<li><a class="reference internal" href="#seeing-the-full-traceback-of-a-test-failure">Affichage de la trace d’erreur complète d’un échec de test</a></li>
</ul>
</li>
<li><a class="reference internal" href="#tips-for-writing-tests">Astuces d’écriture de tests</a><ul>
<li><a class="reference internal" href="#isolating-model-registration">Isolation de l’inscription des modèles</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Sujet précédent</h4>
  <p class="topless"><a href="coding-style.html"
                        title="Chapitre précédent">Style de code</a></p>
  <h4>Sujet suivant</h4>
  <p class="topless"><a href="submitting-patches.html"
                        title="Chapitre suivant">Soumission de correctifs</a></p>
  <div role="note" aria-label="source link">
    <h3>Cette page</h3>
    <ul class="this-page-menu">
      <li><a href="../../../_sources/internals/contributing/writing-code/unit-tests.txt"
            rel="nofollow">Montrer le code source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Recherche rapide</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
              <h3>Last update:</h3>
              <p class="topless">oct. 29, 2020</p>
          </div>
        
      
    </div>

    <div id="ft">
      <div class="nav">
    &laquo; <a href="coding-style.html" title="Style de code">previous</a>
     |
    <a href="../../index.html" title="Fonctionnement interne du projet Django" accesskey="U">up</a>
   |
    <a href="submitting-patches.html" title="Soumission de correctifs">next</a> &raquo;</div>
    </div>
  </div>

      <div class="clearer"></div>
    </div>
  </body>
</html>