
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="fr">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Notes de publication de Django 2.2 &#8212; Documentation Django 3.1.3.dev</title>
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script type="text/javascript" src="../_static/translations.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Recherche" href="../search.html" />
    <link rel="next" title="Notes de publication de Django 2.1.15" href="2.1.15.html" />
    <link rel="prev" title="Notes de publication de Django 2.2.1" href="2.2.1.html" />



 
<script src="../templatebuiltins.js"></script>
<script>
(function($) {
    if (!django_template_builtins) {
       // templatebuiltins.js missing, do nothing.
       return;
    }
    $(document).ready(function() {
        // Hyperlink Django template tags and filters
        var base = "../ref/templates/builtins.html";
        if (base == "#") {
            // Special case for builtins.html itself
            base = "";
        }
        // Tags are keywords, class '.k'
        $("div.highlight\\-html\\+django span.k").each(function(i, elem) {
             var tagname = $(elem).text();
             if ($.inArray(tagname, django_template_builtins.ttags) != -1) {
                 var fragment = tagname.replace(/_/, '-');
                 $(elem).html("<a href='" + base + "#" + fragment + "'>" + tagname + "</a>");
             }
        });
        // Filters are functions, class '.nf'
        $("div.highlight\\-html\\+django span.nf").each(function(i, elem) {
             var filtername = $(elem).text();
             if ($.inArray(filtername, django_template_builtins.tfilters) != -1) {
                 var fragment = filtername.replace(/_/, '-');
                 $(elem).html("<a href='" + base + "#" + fragment + "'>" + filtername + "</a>");
             }
        });
    });
})(jQuery);</script>

  </head><body>

    <div class="document">
  <div id="custom-doc" class="yui-t6">
    <div id="hd">
      <h1><a href="../index.html">Documentation Django 3.1.3.dev</a></h1>
      <div id="global-nav">
        <a title="Home page" href="../index.html">Home</a>  |
        <a title="Table of contents" href="../contents.html">Table of contents</a>  |
        <a title="Global index" href="../genindex.html">Index</a>  |
        <a title="Module index" href="../py-modindex.html">Modules</a>
      </div>
      <div class="nav">
    &laquo; <a href="2.2.1.html" title="Notes de publication de Django 2.2.1">previous</a>
     |
    <a href="index.html" title="Notes de publication" accesskey="U">up</a>
   |
    <a href="2.1.15.html" title="Notes de publication de Django 2.1.15">next</a> &raquo;</div>
    </div>

    <div id="bd">
      <div id="yui-main">
        <div class="yui-b">
          <div class="yui-g" id="releases-2.2">
            
  <div class="section" id="s-django-2-2-release-notes">
<span id="django-2-2-release-notes"></span><h1>Notes de publication de Django 2.2<a class="headerlink" href="#django-2-2-release-notes" title="Lien permanent vers ce titre">¶</a></h1>
<p><em>1er avril 2019</em></p>
<p>Bienvenue dans Django 2.2&nbsp;!</p>
<p>Ces notes de publications couvrent les <a class="reference internal" href="#whats-new-2-2"><span class="std std-ref">nouvelles fonctionnalités</span></a>, ainsi que certaines <a class="reference internal" href="#backwards-incompatible-2-2"><span class="std std-ref">modifications non rétrocompatibles</span></a> dont il faut être au courant lors la mise à jour depuis Django 2.1 ou des versions plus anciennes. Nous avons commencé <a class="reference internal" href="#deprecated-features-2-2"><span class="std std-ref">le processus d’obsolescence de certaines fonctionnalités</span></a>.</p>
<p>Voir le guide <a class="reference internal" href="../howto/upgrade-version.html"><span class="doc">Mise à jour de Django à une version plus récente</span></a> si vous mettez à jour un projet existant.</p>
<p>Django 2.2 is designated as a <a class="reference internal" href="../internals/release-process.html#term-long-term-support-release"><span class="xref std std-term">long-term support release</span></a>. It will receive security updates for at least
three years after its release. Support for the previous LTS, Django 1.11, will
end in April 2020.</p>
<div class="section" id="s-python-compatibility">
<span id="python-compatibility"></span><h2>Compatibilité Python<a class="headerlink" href="#python-compatibility" title="Lien permanent vers ce titre">¶</a></h2>
<p>Django 2.2 supports Python 3.5, 3.6, 3.7, 3.8 (as of 2.2.8), and 3.9 (as of
2.2.17). We <strong>highly recommend</strong> and only officially support the latest release
of each series.</p>
</div>
<div class="section" id="s-what-s-new-in-django-2-2">
<span id="s-whats-new-2-2"></span><span id="what-s-new-in-django-2-2"></span><span id="whats-new-2-2"></span><h2>Quoi de neuf dans Django 2.2<a class="headerlink" href="#what-s-new-in-django-2-2" title="Lien permanent vers ce titre">¶</a></h2>
<div class="section" id="s-constraints">
<span id="constraints"></span><h3>Contraintes<a class="headerlink" href="#constraints" title="Lien permanent vers ce titre">¶</a></h3>
<p>Les nouvelles classes class:~django.db.models.CheckConstraint and <a class="reference internal" href="../ref/models/constraints.html#django.db.models.UniqueConstraint" title="django.db.models.UniqueConstraint"><code class="xref py py-class docutils literal notranslate"><span class="pre">UniqueConstraint</span></code></a> permettent d’ajouter des contraintes de base de données personnalisées. Ces contraintes peuvent être ajoutées aux modèles en utilisant l’option <a class="reference internal" href="../ref/models/options.html#django.db.models.Options.constraints" title="django.db.models.Options.constraints"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Meta.constraints</span></code></a>.</p>
</div>
<div class="section" id="s-minor-features">
<span id="minor-features"></span><h3>Fonctionnalités mineures<a class="headerlink" href="#minor-features" title="Lien permanent vers ce titre">¶</a></h3>
<div class="section" id="s-django-contrib-admin">
<span id="django-contrib-admin"></span><h4><a class="reference internal" href="../ref/contrib/admin/index.html#module-django.contrib.admin" title="django.contrib.admin: Django's admin site."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.admin</span></code></a><a class="headerlink" href="#django-contrib-admin" title="Lien permanent vers ce titre">¶</a></h4>
<ul class="simple">
<li>Une classe CSS a été ajoutée aux en-têtes de colonnes de <a class="reference internal" href="../ref/contrib/admin/index.html#django.contrib.admin.TabularInline" title="django.contrib.admin.TabularInline"><code class="xref py py-class docutils literal notranslate"><span class="pre">TabularInline</span></code></a>.</li>
</ul>
</div>
<div class="section" id="s-django-contrib-auth">
<span id="django-contrib-auth"></span><h4><a class="reference internal" href="../topics/auth/index.html#module-django.contrib.auth" title="django.contrib.auth: Django's authentication framework."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.auth</span></code></a><a class="headerlink" href="#django-contrib-auth" title="Lien permanent vers ce titre">¶</a></h4>
<ul class="simple">
<li>La requête <code class="docutils literal notranslate"><span class="pre">HttpRequest</span></code> est dorénavant transmise comme premier paramètre positionnel à <a class="reference internal" href="../ref/contrib/auth.html#django.contrib.auth.backends.RemoteUserBackend.configure_user" title="django.contrib.auth.backends.RemoteUserBackend.configure_user"><code class="xref py py-meth docutils literal notranslate"><span class="pre">RemoteUserBackend.configure_user()</span></code></a>, si celle-ci l’accepte.</li>
</ul>
</div>
<div class="section" id="s-django-contrib-gis">
<span id="django-contrib-gis"></span><h4><a class="reference internal" href="../ref/contrib/gis/index.html#module-django.contrib.gis" title="django.contrib.gis: Geographic Information System (GIS) extensions for Django"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.gis</span></code></a><a class="headerlink" href="#django-contrib-gis" title="Lien permanent vers ce titre">¶</a></h4>
<ul class="simple">
<li>La prise en charge de la fonction <a class="reference internal" href="../ref/contrib/gis/functions.html#django.contrib.gis.db.models.functions.Envelope" title="django.contrib.gis.db.models.functions.Envelope"><code class="xref py py-class docutils literal notranslate"><span class="pre">Envelope</span></code></a> a été ajoutée pour Oracle.</li>
<li>La prise en charge des expressions de recherche <a class="reference internal" href="../ref/contrib/gis/geoquerysets.html#std:fieldlookup-coveredby"><code class="xref std std-lookup docutils literal notranslate"><span class="pre">coveredby</span></code></a> and <a class="reference internal" href="../ref/contrib/gis/geoquerysets.html#std:fieldlookup-covers"><code class="xref std std-lookup docutils literal notranslate"><span class="pre">covers</span></code></a> a été ajoutée pour SpatiaLite.</li>
</ul>
</div>
<div class="section" id="s-django-contrib-postgres">
<span id="django-contrib-postgres"></span><h4><a class="reference internal" href="../ref/contrib/postgres/index.html#module-django.contrib.postgres" title="django.contrib.postgres: PostgreSQL-specific fields and features"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.postgres</span></code></a><a class="headerlink" href="#django-contrib-postgres" title="Lien permanent vers ce titre">¶</a></h4>
<ul class="simple">
<li>Le nouveau paramètre <code class="docutils literal notranslate"><span class="pre">ordering</span></code> de <a class="reference internal" href="../ref/contrib/postgres/aggregates.html#django.contrib.postgres.aggregates.ArrayAgg" title="django.contrib.postgres.aggregates.ArrayAgg"><code class="xref py py-class docutils literal notranslate"><span class="pre">ArrayAgg</span></code></a> et <a class="reference internal" href="../ref/contrib/postgres/aggregates.html#django.contrib.postgres.aggregates.StringAgg" title="django.contrib.postgres.aggregates.StringAgg"><code class="xref py py-class docutils literal notranslate"><span class="pre">StringAgg</span></code></a> détermine l’ordre des éléments agrégés.</li>
<li>Les nouvelles classes <a class="reference internal" href="../ref/contrib/postgres/indexes.html#django.contrib.postgres.indexes.BTreeIndex" title="django.contrib.postgres.indexes.BTreeIndex"><code class="xref py py-class docutils literal notranslate"><span class="pre">BTreeIndex</span></code></a>, <a class="reference internal" href="../ref/contrib/postgres/indexes.html#django.contrib.postgres.indexes.HashIndex" title="django.contrib.postgres.indexes.HashIndex"><code class="xref py py-class docutils literal notranslate"><span class="pre">HashIndex</span></code></a> et <a class="reference internal" href="../ref/contrib/postgres/indexes.html#django.contrib.postgres.indexes.SpGistIndex" title="django.contrib.postgres.indexes.SpGistIndex"><code class="xref py py-class docutils literal notranslate"><span class="pre">SpGistIndex</span></code></a> permettent de créer des index <code class="docutils literal notranslate"><span class="pre">B-Tree</span></code>, <code class="docutils literal notranslate"><span class="pre">hash</span></code> et <code class="docutils literal notranslate"><span class="pre">SP-GiST</span></code> dans la base de données.</li>
<li><a class="reference internal" href="../ref/contrib/postgres/indexes.html#django.contrib.postgres.indexes.BrinIndex" title="django.contrib.postgres.indexes.BrinIndex"><code class="xref py py-class docutils literal notranslate"><span class="pre">BrinIndex</span></code></a> possède maintenant le paramètre <code class="docutils literal notranslate"><span class="pre">autosummarize</span></code>.</li>
<li>Le nouveau paramètre <code class="docutils literal notranslate"><span class="pre">search_type</span></code> de <a class="reference internal" href="../ref/contrib/postgres/search.html#django.contrib.postgres.search.SearchQuery" title="django.contrib.postgres.search.SearchQuery"><code class="xref py py-class docutils literal notranslate"><span class="pre">SearchQuery</span></code></a> permet de rechercher une phrase ou une expression brute.</li>
</ul>
</div>
<div class="section" id="s-django-contrib-staticfiles">
<span id="django-contrib-staticfiles"></span><h4><a class="reference internal" href="../ref/contrib/staticfiles.html#module-django.contrib.staticfiles" title="django.contrib.staticfiles: An app for handling static files."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.staticfiles</span></code></a><a class="headerlink" href="#django-contrib-staticfiles" title="Lien permanent vers ce titre">¶</a></h4>
<ul class="simple">
<li>La correspondance de chemins a été ajoutée à l’option <a class="reference internal" href="../ref/contrib/staticfiles.html#cmdoption-collectstatic-ignore"><code class="xref std std-option docutils literal notranslate"><span class="pre">collectstatic</span> <span class="pre">--ignore</span></code></a>  afin de pouvoir utiliser des motifs du genre <code class="docutils literal notranslate"><span class="pre">/vendor/*.js</span></code>.</li>
</ul>
</div>
<div class="section" id="s-database-backends">
<span id="database-backends"></span><h4>Moteurs de base de données<a class="headerlink" href="#database-backends" title="Lien permanent vers ce titre">¶</a></h4>
<ul class="simple">
<li>Avec SQLite, la diffusion en flux des résultats a été ajoutée pour <a class="reference internal" href="../ref/models/querysets.html#django.db.models.query.QuerySet.iterator" title="django.db.models.query.QuerySet.iterator"><code class="xref py py-meth docutils literal notranslate"><span class="pre">QuerySet.iterator()</span></code></a>.</li>
</ul>
</div>
<div class="section" id="s-generic-views">
<span id="generic-views"></span><h4>Vues génériques<a class="headerlink" href="#generic-views" title="Lien permanent vers ce titre">¶</a></h4>
<ul class="simple">
<li>Le nouveau point d’entrée <a class="reference internal" href="../ref/class-based-views/base.html#django.views.generic.base.View.setup" title="django.views.generic.base.View.setup"><code class="xref py py-meth docutils literal notranslate"><span class="pre">View.setup</span></code></a> initialise les attributs des vues avant d’appeler <a class="reference internal" href="../ref/class-based-views/base.html#django.views.generic.base.View.dispatch" title="django.views.generic.base.View.dispatch"><code class="xref py py-meth docutils literal notranslate"><span class="pre">dispatch()</span></code></a>. Cela permet aux classes mixin de configurer les attributs d’instance pour une réutilisation dans les classes enfants.</li>
</ul>
</div>
<div class="section" id="s-internationalization">
<span id="internationalization"></span><h4>Internationalisation<a class="headerlink" href="#internationalization" title="Lien permanent vers ce titre">¶</a></h4>
<ul class="simple">
<li>La prise en charge des traductions en arménien a été ajoutée.</li>
</ul>
</div>
<div class="section" id="s-management-commands">
<span id="management-commands"></span><h4>Commandes d’administration<a class="headerlink" href="#management-commands" title="Lien permanent vers ce titre">¶</a></h4>
<ul class="simple">
<li>La nouvelle option option:–force-color force la coloration des résultats de commandes.</li>
<li><a class="reference internal" href="../ref/django-admin.html#django-admin-inspectdb"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">inspectdb</span></code></a> crée dorénavant des modèles pour les tables étrangères avec PostgreSQL.</li>
<li><a class="reference internal" href="../ref/django-admin.html#cmdoption-inspectdb-include-views"><code class="xref std std-option docutils literal notranslate"><span class="pre">inspectdb</span> <span class="pre">--include-views</span></code></a> crée dorénavant des modèles pour les vues matérialisées avec Oracle et PostgreSQL.</li>
<li>La nouvelle option <a class="reference internal" href="../ref/django-admin.html#cmdoption-inspectdb-include-partitions"><code class="xref std std-option docutils literal notranslate"><span class="pre">inspectdb</span> <span class="pre">--include-partitions</span></code></a> permet de créer des modèles pour les tables de partitions avec PostgreSQL. Dans les versions précédentes, les modèles étaient créés comme tables enfants au lieu de parents.</li>
<li><a class="reference internal" href="../ref/django-admin.html#django-admin-inspectdb"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">inspectdb</span></code></a> sait dorénavant découvrir les champs <a class="reference internal" href="../ref/models/fields.html#django.db.models.DurationField" title="django.db.models.DurationField"><code class="xref py py-class docutils literal notranslate"><span class="pre">DurationField</span></code></a> avec Oracle et PostgreSQL, ainsi que les champs <a class="reference internal" href="../ref/models/fields.html#django.db.models.AutoField" title="django.db.models.AutoField"><code class="xref py py-class docutils literal notranslate"><span class="pre">AutoField</span></code></a> avec SQLite.</li>
<li>Avec Oracle, <a class="reference internal" href="../ref/django-admin.html#django-admin-dbshell"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">dbshell</span></code></a> est envelopéé dans <code class="docutils literal notranslate"><span class="pre">rlwrap</span></code>, si disponible. <code class="docutils literal notranslate"><span class="pre">rlwrap</span></code> fournit un historique des commandes et permet d’éditer les saisies au clavier.</li>
<li>La nouvelle option <a class="reference internal" href="../ref/django-admin.html#cmdoption-makemigrations-no-header"><code class="xref std std-option docutils literal notranslate"><span class="pre">makemigrations</span> <span class="pre">--no-header</span></code></a> permet d’éviter les commentaires en en-tête dans les fichiers de migration générés. Cette option est aussi disponible pour <a class="reference internal" href="../ref/django-admin.html#django-admin-squashmigrations"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">squashmigrations</span></code></a>.</li>
<li><a class="reference internal" href="../ref/django-admin.html#django-admin-runserver"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">runserver</span></code></a> peut dorénavant exploiter <a class="reference external" href="https://facebook.github.io/watchman/">Watchman</a> pour améliorer les performances lors de la surveillance de modification pour de nombreux fichiers.</li>
</ul>
</div>
<div class="section" id="s-migrations">
<span id="migrations"></span><h4>Migrations<a class="headerlink" href="#migrations" title="Lien permanent vers ce titre">¶</a></h4>
<ul class="simple">
<li>La nouvelle option <a class="reference internal" href="../ref/django-admin.html#cmdoption-migrate-plan"><code class="xref std std-option docutils literal notranslate"><span class="pre">migrate</span> <span class="pre">--plan</span></code></a> imprime la liste des opérations de migration qui seront effectuées.</li>
<li><code class="docutils literal notranslate"><span class="pre">NoneType</span></code> peut maintenant être sérialisé dans les migrations.</li>
<li>Il est maintenant possible d”<a class="reference internal" href="../topics/migrations.html#custom-migration-serializers"><span class="std std-ref">inscrire des sérialiseurs personnalisés</span></a> pour les migrations.</li>
</ul>
</div>
<div class="section" id="s-models">
<span id="models"></span><h4>Modèles<a class="headerlink" href="#models" title="Lien permanent vers ce titre">¶</a></h4>
<ul class="simple">
<li>La prise en charge des opérateurs de classes PostgreSQL (<a class="reference internal" href="../ref/models/indexes.html#django.db.models.Index.opclasses" title="django.db.models.Index.opclasses"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Index.opclasses</span></code></a>) a été ajoutée.</li>
<li>La prise en charge des index partiels (<a class="reference internal" href="../ref/models/indexes.html#django.db.models.Index.condition" title="django.db.models.Index.condition"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Index.condition</span></code></a>) a été ajoutée.</li>
<li>Les fonctions de base de données class:~django.db.models.functions.NullIf et <a class="reference internal" href="../ref/models/database-functions.html#django.db.models.functions.Reverse" title="django.db.models.functions.Reverse"><code class="xref py py-class docutils literal notranslate"><span class="pre">Reverse</span></code></a> ont été ajoutées, de même que de nombreuses <a class="reference internal" href="../ref/models/database-functions.html#math-functions"><span class="std std-ref">fonctions de base de données mathématiques</span></a>.</li>
<li>La définition du nouveau paramètre <code class="docutils literal notranslate"><span class="pre">ignore_conflicts</span></code> de <a class="reference internal" href="../ref/models/querysets.html#django.db.models.query.QuerySet.bulk_create" title="django.db.models.query.QuerySet.bulk_create"><code class="xref py py-meth docutils literal notranslate"><span class="pre">QuerySet.bulk_create()</span></code></a> à <code class="docutils literal notranslate"><span class="pre">True</span></code> indique à la base de données d’ignorer les insertions de lignes qui ne passent pas les contrôles d’unicité et autres contrôles.</li>
<li>La nouvelle fonction <a class="reference internal" href="../ref/models/database-functions.html#django.db.models.functions.ExtractIsoYear" title="django.db.models.functions.ExtractIsoYear"><code class="xref py py-class docutils literal notranslate"><span class="pre">ExtractIsoYear</span></code></a> extrait les années avec numéro de semaine ISO-8601 des champs <a class="reference internal" href="../ref/models/fields.html#django.db.models.DateField" title="django.db.models.DateField"><code class="xref py py-class docutils literal notranslate"><span class="pre">DateField</span></code></a> et <a class="reference internal" href="../ref/models/fields.html#django.db.models.DateTimeField" title="django.db.models.DateTimeField"><code class="xref py py-class docutils literal notranslate"><span class="pre">DateTimeField</span></code></a>, et la nouvelle expression de requête <a class="reference internal" href="../ref/models/querysets.html#std:fieldlookup-iso_year"><code class="xref std std-lookup docutils literal notranslate"><span class="pre">iso_year</span></code></a> permet d’interroger selon une année avec numéro de semaine ISO-8601.</li>
<li>La nouvelle méthode <a class="reference internal" href="../ref/models/querysets.html#django.db.models.query.QuerySet.bulk_update" title="django.db.models.query.QuerySet.bulk_update"><code class="xref py py-meth docutils literal notranslate"><span class="pre">QuerySet.bulk_update()</span></code></a> permet de mettre à jour efficacement des champs spécifiques sur plusieurs instances de modèles.</li>
<li>Django ne démarre plus automatiquement une transaction lors de l’exécution d’une seule requête, telle que <code class="docutils literal notranslate"><span class="pre">Model.save()</span></code>, <code class="docutils literal notranslate"><span class="pre">QuerySet.update()</span></code> et <code class="docutils literal notranslate"><span class="pre">Model.delete()</span></code>. Cela améliore la performance en mode commit automatique en diminuant le nombre d’aller-retour vers la base de données.</li>
<li>La prise en charge des fonctions <a class="reference internal" href="../ref/models/querysets.html#django.db.models.StdDev" title="django.db.models.StdDev"><code class="xref py py-class docutils literal notranslate"><span class="pre">StdDev</span></code></a> et <a class="reference internal" href="../ref/models/querysets.html#django.db.models.Variance" title="django.db.models.Variance"><code class="xref py py-class docutils literal notranslate"><span class="pre">Variance</span></code></a> a été ajoutée pour SQLite.</li>
<li>La gestion des agrégats avec <code class="docutils literal notranslate"><span class="pre">DISTINCT</span></code> a été ajoutée à la classe <a class="reference internal" href="../ref/models/expressions.html#django.db.models.Aggregate" title="django.db.models.Aggregate"><code class="xref py py-class docutils literal notranslate"><span class="pre">Aggregate</span></code></a>. La définition de <a class="reference internal" href="../ref/models/expressions.html#django.db.models.Aggregate.allow_distinct" title="django.db.models.Aggregate.allow_distinct"><code class="xref py py-attr docutils literal notranslate"><span class="pre">allow_distinct</span> <span class="pre">=</span> <span class="pre">True</span></code></a> comme attribut de classe sur des sous-classes de <code class="docutils literal notranslate"><span class="pre">Aggregate</span></code> permet d’indiquer un paramètre nommé <code class="docutils literal notranslate"><span class="pre">distinct</span></code> lors de l’initialisation pour s’assurer que la fonction d’agrégat n’est appelée que pour chaque valeur distincte de <code class="docutils literal notranslate"><span class="pre">expressions</span></code>.</li>
<li>Les méthodes <a class="reference internal" href="../ref/models/relations.html#django.db.models.fields.related.RelatedManager.add" title="django.db.models.fields.related.RelatedManager.add"><code class="xref py py-meth docutils literal notranslate"><span class="pre">RelatedManager.add()</span></code></a>, <a class="reference internal" href="../ref/models/relations.html#django.db.models.fields.related.RelatedManager.create" title="django.db.models.fields.related.RelatedManager.create"><code class="xref py py-meth docutils literal notranslate"><span class="pre">create()</span></code></a>, <a class="reference internal" href="../ref/models/relations.html#django.db.models.fields.related.RelatedManager.remove" title="django.db.models.fields.related.RelatedManager.remove"><code class="xref py py-meth docutils literal notranslate"><span class="pre">remove()</span></code></a>, <a class="reference internal" href="../ref/models/relations.html#django.db.models.fields.related.RelatedManager.set" title="django.db.models.fields.related.RelatedManager.set"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set()</span></code></a>, <code class="docutils literal notranslate"><span class="pre">get_or_create()</span></code> et <code class="docutils literal notranslate"><span class="pre">update_or_create()</span></code> sont dorénavant autorisées sur des relations plusieurs-à-plusieurs avec modèle intermédiaire. Le nouveau paramètre <code class="docutils literal notranslate"><span class="pre">through_defaults</span></code> est utilisé pour indiquer des valeurs à définir sur la ou les instances de modèle intermédiaire.</li>
</ul>
</div>
<div class="section" id="s-requests-and-responses">
<span id="requests-and-responses"></span><h4>Requêtes et réponses<a class="headerlink" href="#requests-and-responses" title="Lien permanent vers ce titre">¶</a></h4>
<ul class="simple">
<li>L’attribut <a class="reference internal" href="../ref/request-response.html#django.http.HttpRequest.headers" title="django.http.HttpRequest.headers"><code class="xref py py-attr docutils literal notranslate"><span class="pre">HttpRequest.headers</span></code></a> a été ajouté pour permettre un accès simplifié aux en-têtes de requêtes.</li>
</ul>
</div>
<div class="section" id="s-serialization">
<span id="serialization"></span><h4>Sérialisation<a class="headerlink" href="#serialization" title="Lien permanent vers ce titre">¶</a></h4>
<ul class="simple">
<li>Il est dorénavant possible de désérialiser des données en utilisant des clés naturelles contenant des <a class="reference internal" href="../topics/serialization.html#natural-keys-and-forward-references"><span class="std std-ref">références en aval</span></a> en passant <code class="docutils literal notranslate"><span class="pre">handle_forward_references=True</span></code> à <code class="docutils literal notranslate"><span class="pre">serializers.deserialize()</span></code>. De plus, <a class="reference internal" href="../ref/django-admin.html#django-admin-loaddata"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">loaddata</span></code></a> gère automatiquement les références en aval.</li>
</ul>
</div>
<div class="section" id="s-tests">
<span id="tests"></span><h4>Tests<a class="headerlink" href="#tests" title="Lien permanent vers ce titre">¶</a></h4>
<ul class="simple">
<li>La nouvelle assertion <a class="reference internal" href="../topics/testing/tools.html#django.test.SimpleTestCase.assertURLEqual" title="django.test.SimpleTestCase.assertURLEqual"><code class="xref py py-meth docutils literal notranslate"><span class="pre">SimpleTestCase.assertURLEqual()</span></code></a> vérifie l’égalité avec une URL donnée en ignorant l’ordre des paramètres de la chaîne de requête. <a class="reference internal" href="../topics/testing/tools.html#django.test.SimpleTestCase.assertRedirects" title="django.test.SimpleTestCase.assertRedirects"><code class="xref py py-meth docutils literal notranslate"><span class="pre">assertRedirects()</span></code></a> utilise cette nouvelle assertion.</li>
<li>Le client de test <a class="reference internal" href="../topics/testing/tools.html#django.test.Client" title="django.test.Client"><code class="xref py py-class docutils literal notranslate"><span class="pre">Client</span></code></a> prend dorénavant en charge automatiquement la sérialisation JSON des listes et tuples <code class="docutils literal notranslate"><span class="pre">data</span></code> lorsque <code class="docutils literal notranslate"><span class="pre">content_type='application/json'</span></code>.</li>
<li>Le nouveau réglage de base de données de test <a class="reference internal" href="../ref/settings.html#std:setting-TEST_ORACLE_MANAGED_FILES"><code class="xref std std-setting docutils literal notranslate"><span class="pre">ORACLE_MANAGED_FILES</span></code></a> permet d’utiliser des espaces de tables Oracle Managed Files (OMF).</li>
<li>Les contraintes de base de données différables sont dorénavant appliquées à la fin de chaque test <a class="reference internal" href="../topics/testing/tools.html#django.test.TestCase" title="django.test.TestCase"><code class="xref py py-class docutils literal notranslate"><span class="pre">TestCase</span></code></a> avec SQLite 3.20+, tout comme c’est déjà le cas pour les autres moteurs qui prennent en charge ce type de contraintes. Ces contrôles ne sont pas appliqués pour les versions plus anciennes de SQLite car ils nécessiteraient de coûteuses introspections de tables.</li>
<li><a class="reference internal" href="../topics/testing/advanced.html#django.test.runner.DiscoverRunner" title="django.test.runner.DiscoverRunner"><code class="xref py py-class docutils literal notranslate"><span class="pre">DiscoverRunner</span></code></a> ne configure plus les bases de données qui ne sont pas <a class="reference internal" href="../topics/testing/tools.html#testing-multi-db"><span class="std std-ref">référencées par les tests</span></a>.</li>
</ul>
</div>
<div class="section" id="s-urls">
<span id="urls"></span><h4>URL<a class="headerlink" href="#urls" title="Lien permanent vers ce titre">¶</a></h4>
<ul class="simple">
<li>Le nouvel attribut <a class="reference internal" href="../ref/urlresolvers.html#django.urls.ResolverMatch.route" title="django.urls.ResolverMatch.route"><code class="xref py py-attr docutils literal notranslate"><span class="pre">ResolverMatch.route</span></code></a> stocke la route du motif d’URL correspondant.</li>
</ul>
</div>
<div class="section" id="s-validators">
<span id="validators"></span><h4>Validateurs<a class="headerlink" href="#validators" title="Lien permanent vers ce titre">¶</a></h4>
<ul class="simple">
<li><a class="reference internal" href="../ref/validators.html#django.core.validators.MaxValueValidator" title="django.core.validators.MaxValueValidator"><code class="xref py py-class docutils literal notranslate"><span class="pre">MaxValueValidator</span></code></a>, <a class="reference internal" href="../ref/validators.html#django.core.validators.MinValueValidator" title="django.core.validators.MinValueValidator"><code class="xref py py-class docutils literal notranslate"><span class="pre">MinValueValidator</span></code></a>, <a class="reference internal" href="../ref/validators.html#django.core.validators.MinLengthValidator" title="django.core.validators.MinLengthValidator"><code class="xref py py-class docutils literal notranslate"><span class="pre">MinLengthValidator</span></code></a> et <a class="reference internal" href="../ref/validators.html#django.core.validators.MaxLengthValidator" title="django.core.validators.MaxLengthValidator"><code class="xref py py-class docutils literal notranslate"><span class="pre">MaxLengthValidator</span></code></a> acceptent maintenant une valeur <code class="docutils literal notranslate"><span class="pre">limit_value</span></code> exécutable.</li>
</ul>
</div>
</div>
</div>
<div class="section" id="s-backwards-incompatible-changes-in-2-2">
<span id="s-backwards-incompatible-2-2"></span><span id="backwards-incompatible-changes-in-2-2"></span><span id="backwards-incompatible-2-2"></span><h2>Changements incompatibles avec les anciennes versions dans Django 2.2<a class="headerlink" href="#backwards-incompatible-changes-in-2-2" title="Lien permanent vers ce titre">¶</a></h2>
<div class="section" id="s-database-backend-api">
<span id="database-backend-api"></span><h3>API de moteur de base de données<a class="headerlink" href="#database-backend-api" title="Lien permanent vers ce titre">¶</a></h3>
<p>Cette section décrit des modifications qui pourraient être nécessaires dans des moteurs de base de données tiers.</p>
<ul class="simple">
<li>Les moteurs de base de données de tierce-partie doivent implémenter la prise en charge des contraintes de vérification sur les tables ou définir <code class="docutils literal notranslate"><span class="pre">DatabaseFeatures.supports_table_check_constraints</span></code> à <code class="docutils literal notranslate"><span class="pre">False</span></code>.</li>
<li>Les moteurs de base de données de tierce-partie doivent implémenter la capacité d’ignorer les contraintes ou erreurs d’unicité lors d’insertions, ou  définir <code class="docutils literal notranslate"><span class="pre">DatabaseFeatures.supports_ignore_conflicts</span></code> à <code class="docutils literal notranslate"><span class="pre">False</span></code>.</li>
<li>Les moteurs de base de données de tierce-partie doivent implémenter l’introspection pour <code class="docutils literal notranslate"><span class="pre">DurationField</span></code> ou définir <code class="docutils literal notranslate"><span class="pre">DatabaseFeatures.can_introspect_duration_field</span></code> à <code class="docutils literal notranslate"><span class="pre">False</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">DatabaseFeatures.uses_savepoints</span></code> vaut dorénavant <code class="docutils literal notranslate"><span class="pre">True</span></code> par défaut.</li>
<li>Les moteurs de base de données de tierce-partie doivent implémenter la prise en charge des index partiels ou définir <code class="docutils literal notranslate"><span class="pre">DatabaseFeatures.supports_partial_indexes</span></code> à <code class="docutils literal notranslate"><span class="pre">False</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">DatabaseIntrospection.table_name_converter()</span></code> et <code class="docutils literal notranslate"><span class="pre">column_name_converter()</span></code> ont été supprimées. Les moteurs de base de données de tierce-partie peuvent devoir implémenter <code class="docutils literal notranslate"><span class="pre">DatabaseIntrospection.identifier_converter()</span></code> à la place. Dans ce cas, les noms de contraintes renvoyés par <code class="docutils literal notranslate"><span class="pre">DatabaseIntrospection.get_constraints()</span></code> doivent être normalisés par <code class="docutils literal notranslate"><span class="pre">identifier_converter()</span></code>.</li>
<li>La génération SQL des index a été déplacée de <a class="reference internal" href="../ref/models/indexes.html#django.db.models.Index" title="django.db.models.Index"><code class="xref py py-class docutils literal notranslate"><span class="pre">Index</span></code></a> vers <code class="docutils literal notranslate"><span class="pre">SchemaEditor</span></code> et ces méthodes de <code class="docutils literal notranslate"><span class="pre">SchemaEditor</span></code> ont été ajoutées :<ul>
<li><code class="docutils literal notranslate"><span class="pre">_create_primary_key_sql()</span></code> et <code class="docutils literal notranslate"><span class="pre">_delete_primary_key_sql()</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">_delete_index_sql()</span></code> (en réponse à <code class="docutils literal notranslate"><span class="pre">_create_index_sql()</span></code>)</li>
<li><code class="docutils literal notranslate"><span class="pre">_delete_unique_sql</span></code> (en réponse à <code class="docutils literal notranslate"><span class="pre">_create_unique_sql()</span></code>)</li>
<li><code class="docutils literal notranslate"><span class="pre">_delete_fk_sql()</span></code> (en réponse à <code class="docutils literal notranslate"><span class="pre">_create_fk_sql()</span></code>)</li>
<li><code class="docutils literal notranslate"><span class="pre">_create_check_sql()</span></code> et <code class="docutils literal notranslate"><span class="pre">_delete_check_sql()</span></code></li>
</ul>
</li>
<li>Le troisième paramètre de <code class="docutils literal notranslate"><span class="pre">DatabaseWrapper.__init__()</span></code>, <code class="docutils literal notranslate"><span class="pre">allow_thread_sharing</span></code>, a été supprimé.</li>
</ul>
</div>
<div class="section" id="s-admin-actions-are-no-longer-collected-from-base-modeladmin-classes">
<span id="admin-actions-are-no-longer-collected-from-base-modeladmin-classes"></span><h3>Les actions d’administration ne sont plus collectées à partir des classes <code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code> de base<a class="headerlink" href="#admin-actions-are-no-longer-collected-from-base-modeladmin-classes" title="Lien permanent vers ce titre">¶</a></h3>
<p>Par exemple, dans les anciennes versions de Django</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib</span> <span class="k">import</span> <span class="n">admin</span>

<span class="k">class</span> <span class="nc">BaseAdmin</span><span class="p">(</span><span class="n">admin</span><span class="o">.</span><span class="n">ModelAdmin</span><span class="p">):</span>
    <span class="n">actions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">]</span>

<span class="k">class</span> <span class="nc">SubAdmin</span><span class="p">(</span><span class="n">BaseAdmin</span><span class="p">):</span>
    <span class="n">actions</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">SubAdmin</span></code> disposait des actions <code class="docutils literal notranslate"><span class="pre">'a'</span></code> et <code class="docutils literal notranslate"><span class="pre">'b'</span></code>.</p>
<p>Dorénavant les <code class="docutils literal notranslate"><span class="pre">actions</span></code> suivent l’héritage Python standard. Pour obtenir le même résultat qu’auparavant</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">SubAdmin</span><span class="p">(</span><span class="n">BaseAdmin</span><span class="p">):</span>
    <span class="n">actions</span> <span class="o">=</span> <span class="n">BaseAdmin</span><span class="o">.</span><span class="n">actions</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;b&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="s-id1">
<span id="id1"></span><h3><a class="reference internal" href="../ref/contrib/gis/index.html#module-django.contrib.gis" title="django.contrib.gis: Geographic Information System (GIS) extensions for Django"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.gis</span></code></a><a class="headerlink" href="#id1" title="Lien permanent vers ce titre">¶</a></h3>
<ul class="simple">
<li>La prise en charge de GDAL 1.9 et 1.10 a été abandonnée.</li>
</ul>
</div>
<div class="section" id="s-transactiontestcase-serialized-data-loading">
<span id="transactiontestcase-serialized-data-loading"></span><h3>Chargement de données <code class="docutils literal notranslate"><span class="pre">TransactionTestCase</span></code> sérialisées<a class="headerlink" href="#transactiontestcase-serialized-data-loading" title="Lien permanent vers ce titre">¶</a></h3>
<p>Les migrations de données initiales sont dorénavant chargées dans <a class="reference internal" href="../topics/testing/tools.html#django.test.TransactionTestCase" title="django.test.TransactionTestCase"><code class="xref py py-class docutils literal notranslate"><span class="pre">TransactionTestCase</span></code></a> à la fin du test, après la réinitialisation de la base de données. Dans les anciennes versions, ces données étaient chargées au début du test mais cela perturbait le fonctionnement de l’option <a class="reference internal" href="../ref/django-admin.html#cmdoption-test-keepdb"><code class="xref std std-option docutils literal notranslate"><span class="pre">test</span> <span class="pre">--keepdb</span></code></a> (la base de données était vide à la fin de tous les tests). Cette modification ne devrait pas avoir d’impacts sur vos tests pour autant que vous n’avez pas personnalisé le fonctionnement interne de <a class="reference internal" href="../topics/testing/tools.html#django.test.TransactionTestCase" title="django.test.TransactionTestCase"><code class="xref py py-class docutils literal notranslate"><span class="pre">TransactionTestCase</span></code></a>.</p>
</div>
<div class="section" id="s-sqlparse-is-required-dependency">
<span id="sqlparse-is-required-dependency"></span><h3><code class="docutils literal notranslate"><span class="pre">sqlparse</span></code> devient une dépendance obligatoire<a class="headerlink" href="#sqlparse-is-required-dependency" title="Lien permanent vers ce titre">¶</a></h3>
<p>To simplify a few parts of Django’s database handling, <a class="reference external" href="https://pypi.org/project/sqlparse/">sqlparse 0.2.2+</a> is now a required dependency. It’s
automatically installed along with Django.</p>
</div>
<div class="section" id="s-cached-property-aliases">
<span id="cached-property-aliases"></span><h3>Alias de <code class="docutils literal notranslate"><span class="pre">cached_property</span></code><a class="headerlink" href="#cached-property-aliases" title="Lien permanent vers ce titre">¶</a></h3>
<p>Dans les utilisations telles que</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.utils.functional</span> <span class="k">import</span> <span class="n">cached_property</span>

<span class="k">class</span> <span class="nc">A</span><span class="p">:</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">base</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="o">...</span>

    <span class="n">alias</span> <span class="o">=</span> <span class="n">base</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">alias</span></code> n’est pas mis en cache. Là où le problème peut être détecté (Python à partir de 3.6), une telle utilisation produit maintenant une exception <code class="docutils literal notranslate"><span class="pre">TypeError:</span> <span class="pre">Cannot</span> <span class="pre">assign</span> <span class="pre">the</span> <span class="pre">same</span> <span class="pre">cached_property</span> <span class="pre">to</span> <span class="pre">two</span> <span class="pre">different</span> <span class="pre">names</span> <span class="pre">('base'</span> <span class="pre">and</span> <span class="pre">'alias').</span></code></p>
<p>Utilisez plutôt ceci</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">operator</span>

<span class="k">class</span> <span class="nc">A</span><span class="p">:</span>

    <span class="o">...</span>

    <span class="n">alias</span> <span class="o">=</span> <span class="nb">property</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">attrgetter</span><span class="p">(</span><span class="s1">&#39;base&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="s-permissions-for-proxy-models">
<span id="permissions-for-proxy-models"></span><h3>Permissions pour les modèles mandataires<a class="headerlink" href="#permissions-for-proxy-models" title="Lien permanent vers ce titre">¶</a></h3>
<p>Les <a class="reference internal" href="../topics/auth/default.html#proxy-models-permissions-topic"><span class="std std-ref">permissions pour les modèles mandataires</span></a> sont dorénavant créées en utilisant le type de contenu du modèle mandataire plutôt que celui de leur modèle concret. Une migration va mettre à jour les permissions existantes lors de l’exécution de <a class="reference internal" href="../ref/django-admin.html#django-admin-migrate"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">migrate</span></code></a>.</p>
<p>Dans le site d’administration, la modification est transparente pour les modèles mandataires ayant la même étiquette <code class="docutils literal notranslate"><span class="pre">app_label</span></code> que leur modèle concret. Cependant, dans les anciennes versions, les utilisateurs ayant des permissions pour un modèle mandataire avec une étiquette <code class="docutils literal notranslate"><span class="pre">app_label</span></code>&nbsp;<em>différente</em> de celle du modèle concret n’avaient pas accès au modèle dans le site d’administration. Ceci est maintenant résolu, mais il peut valoir la peine d’auditer les attributions de permissions pour les modèles concernés (<code class="docutils literal notranslate"><span class="pre">[add|view|change|delete]_monmandataire</span></code>) avant la mise à jour pour être certain que les nouveaux accès soient corrects.</p>
<p>Pour terminer, les chaînes de permission des modèles mandataires doivent être mises à jour afin d’utiliser leur propre étiquette <code class="docutils literal notranslate"><span class="pre">app_label</span></code>. Par exemple, pour <code class="docutils literal notranslate"><span class="pre">app.MonModeleMandataire</span></code> héritant de <code class="docutils literal notranslate"><span class="pre">autre_app.ModeleConcret</span></code>, mettez à jour <code class="docutils literal notranslate"><span class="pre">user.has_perm('autre_app.add_monmodelemandataire')</span></code> en <code class="docutils literal notranslate"><span class="pre">user.has_perm('app.add_monmodelemandataire')</span></code>.</p>
</div>
<div class="section" id="s-merging-of-form-media-assets">
<span id="merging-of-form-media-assets"></span><h3>Fusion des fichiers statiques <code class="docutils literal notranslate"><span class="pre">Media</span></code> des formulaires<a class="headerlink" href="#merging-of-form-media-assets" title="Lien permanent vers ce titre">¶</a></h3>
<p>Les fichiers statiques <code class="docutils literal notranslate"><span class="pre">Media</span></code> des formulaires sont dorénavant fusionnés en utilisant un algorithme de tri topologique, car l’ancien algorithme de fusion par paires était insuffisant à certains égards. Les fichiers CSS et JavaScript qui n’incluent pas leurs dépendances pourraient maintenant être triées de manière incorrecte (là où l’ancien algorithme aurait produit un résultat correct par coïncidence).</p>
<p>Auditer chaque classe <code class="docutils literal notranslate"><span class="pre">Media</span></code> à la recherche de dépendances manquantes. Par exemple, les composants dépendants de <code class="docutils literal notranslate"><span class="pre">django.jQuery</span></code> doivent indiquer <code class="docutils literal notranslate"><span class="pre">js=['admin/js/jquery.init.js',</span> <span class="pre">...]</span></code> dans la <a class="reference internal" href="../topics/forms/media.html#assets-as-a-static-definition"><span class="std std-ref">déclaration des fichiers statiques de formulaires</span></a>.</p>
</div>
<div class="section" id="s-miscellaneous">
<span id="miscellaneous"></span><h3>Divers<a class="headerlink" href="#miscellaneous" title="Lien permanent vers ce titre">¶</a></h3>
<ul>
<li><p class="first">Pour améliorer la lisibilité, le champ de formulaire <code class="docutils literal notranslate"><span class="pre">UUIDField</span></code> affiche dorénavant les valeurs avec tirets, par exemple <code class="docutils literal notranslate"><span class="pre">550e8400-e29b-41d4-a716-446655440000</span></code> au lieu de <code class="docutils literal notranslate"><span class="pre">550e8400e29b41d4a716446655440000</span></code>.</p>
</li>
<li><p class="first">Avec SQLite, <code class="docutils literal notranslate"><span class="pre">PositiveIntegerField</span></code> et <code class="docutils literal notranslate"><span class="pre">PositiveSmallIntegerField</span></code> incluent dorénavant une contrainte de vérification pour éviter des valeurs négatives dans la base de données. Si des données non valides existent actuellement et que vous lancez une migration qui recrée une table, vous verrez apparaître des erreurs du type <code class="docutils literal notranslate"><span class="pre">CHECK</span> <span class="pre">constraint</span> <span class="pre">failed</span></code>.</p>
</li>
<li><p class="first">Par cohérence avec les serveurs WSGI, le client de test définit dorénavant l’en-tête <code class="docutils literal notranslate"><span class="pre">Content-Length</span></code> comme chaîne au lieu de nombre entier.</p>
</li>
<li><p class="first">La valeur de renvoi de <a class="reference internal" href="../ref/utils.html#django.utils.text.slugify" title="django.utils.text.slugify"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.utils.text.slugify()</span></code></a> n’est plus marquée comme  HTML sécurisé.</p>
</li>
<li><p class="first">Le caractère de troncature par défaut utilisé par les filtres de gabarit <a class="reference internal" href="../ref/templates/builtins.html#std:templatefilter-urlizetrunc"><code class="xref std std-tfilter docutils literal notranslate"><span class="pre">urlizetrunc</span></code></a>, <a class="reference internal" href="../ref/templates/builtins.html#std:templatefilter-truncatechars"><code class="xref std std-tfilter docutils literal notranslate"><span class="pre">truncatechars</span></code></a>, <a class="reference internal" href="../ref/templates/builtins.html#std:templatefilter-truncatechars_html"><code class="xref std std-tfilter docutils literal notranslate"><span class="pre">truncatechars_html</span></code></a>, <a class="reference internal" href="../ref/templates/builtins.html#std:templatefilter-truncatewords"><code class="xref std std-tfilter docutils literal notranslate"><span class="pre">truncatewords</span></code></a> et <a class="reference internal" href="../ref/templates/builtins.html#std:templatefilter-truncatewords_html"><code class="xref std std-tfilter docutils literal notranslate"><span class="pre">truncatewords_html</span></code></a> est désormais le caractère « points de suspension » réel (<code class="docutils literal notranslate"><span class="pre">…</span></code>) au lieu de 3 points. Il se peut que vous deviez mettre à jour certaines comparaisons dans les résultats de tests.</p>
</li>
<li><p class="first">La prise en charge des chemins d’octets dans le chargeur de gabarits depuis le système de fichiers a été supprimée.</p>
</li>
<li><p class="first"><a class="reference internal" href="../ref/utils.html#django.utils.http.urlsafe_base64_encode" title="django.utils.http.urlsafe_base64_encode"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.utils.http.urlsafe_base64_encode()</span></code></a> renvoie dorénavant une chaîne au lieu d’une chaîne d’octets, et <a class="reference internal" href="../ref/utils.html#django.utils.http.urlsafe_base64_decode" title="django.utils.http.urlsafe_base64_decode"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.utils.http.urlsafe_base64_decode()</span></code></a> n’accepte plus une chaîne d’octets en paramètre.</p>
</li>
<li><p class="first">La prise en charge de <code class="docutils literal notranslate"><span class="pre">cx_Oracle</span></code> &lt; 6.0 a été abandonnée.</p>
</li>
<li><p class="first">La version minimum de <code class="docutils literal notranslate"><span class="pre">mysqlclient</span></code> prise en charge est passée de 1.3.7 à 1.3.13.</p>
</li>
<li><p class="first">La version minimum de SQLite prise en charge est passée de 3.7.15 à 3.8.3.</p>
</li>
<li><p class="first">Dans le but de fournir des données de requêtes un peu plus sémantiques, <code class="docutils literal notranslate"><span class="pre">NullBooleanSelect</span></code> produit dorénavant les valeurs d”<code class="docutils literal notranslate"><span class="pre">&lt;option&gt;</span></code>&nbsp;<code class="docutils literal notranslate"><span class="pre">unknown</span></code>, <code class="docutils literal notranslate"><span class="pre">true</span></code> et <code class="docutils literal notranslate"><span class="pre">false</span></code> au lieu de <code class="docutils literal notranslate"><span class="pre">1</span></code>, <code class="docutils literal notranslate"><span class="pre">2</span></code> et <code class="docutils literal notranslate"><span class="pre">3</span></code>. Par rétrocompatibilité, les données avec les anciennes valeurs sont toujours acceptées.</p>
</li>
<li><p class="first">La longueur maximale <code class="docutils literal notranslate"><span class="pre">max_length</span></code> de <a class="reference internal" href="../ref/contrib/auth.html#django.contrib.auth.models.Group.name" title="django.contrib.auth.models.Group.name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">Group.name</span></code></a> a passé de 80 à 150 caractères.</p>
</li>
<li><p class="first">Les tests qui violent les contraintes de base de données différables produisent dorénavant des erreurs avec SQLite 3.20+, tout comme avec les autres moteurs qui gèrent aussi ces contraintes.</p>
</li>
<li><p class="first">Pour intercepter les erreurs d’utilisation, le client de test <a class="reference internal" href="../topics/testing/tools.html#django.test.Client" title="django.test.Client"><code class="xref py py-class docutils literal notranslate"><span class="pre">Client</span></code></a> ainsi que <a class="reference internal" href="../ref/utils.html#django.utils.http.urlencode" title="django.utils.http.urlencode"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.utils.http.urlencode()</span></code></a> génèrent maintenant une exception <code class="docutils literal notranslate"><span class="pre">TypeError</span></code> si <code class="docutils literal notranslate"><span class="pre">None</span></code> est transmis comme valeur à coder, car <code class="docutils literal notranslate"><span class="pre">None</span></code> ne peut pas être codé dans les données GET et POST. Transmettez plutôt une chaîne vide, ou omettez entièrement la valeur.</p>
</li>
<li><p class="first">La commande de gestion <a class="reference internal" href="../ref/contrib/sitemaps.html#django-admin-ping_google"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">ping_google</span></code></a> utilise dorénavant <code class="docutils literal notranslate"><span class="pre">https</span></code> par défaut au lieu de <code class="docutils literal notranslate"><span class="pre">http</span></code> pour l’URL des cartes de sites. Si votre site est en http, utilisez la nouvelle option <a class="reference internal" href="../ref/contrib/sitemaps.html#cmdoption-ping-google-sitemap-uses-http"><code class="xref std std-option docutils literal notranslate"><span class="pre">ping_google</span> <span class="pre">--sitemap-uses-http</span></code></a>. Si vous employez la fonction <a class="reference internal" href="../ref/contrib/sitemaps.html#django.contrib.sitemaps.ping_google" title="django.contrib.sitemaps.ping_google"><code class="xref py py-func docutils literal notranslate"><span class="pre">ping_google()</span></code></a>, définissez le nouveau paramètre <code class="docutils literal notranslate"><span class="pre">sitemap_uses_https</span></code> à <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
</li>
<li><p class="first"><a class="reference internal" href="../ref/django-admin.html#django-admin-runserver"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">runserver</span></code></a> no longer supports <code class="docutils literal notranslate"><span class="pre">pyinotify</span></code> (replaced by Watchman).</p>
</li>
<li><p class="first">Les fonctions d’agrégat <a class="reference internal" href="../ref/models/querysets.html#django.db.models.Avg" title="django.db.models.Avg"><code class="xref py py-class docutils literal notranslate"><span class="pre">Avg</span></code></a>, <a class="reference internal" href="../ref/models/querysets.html#django.db.models.StdDev" title="django.db.models.StdDev"><code class="xref py py-class docutils literal notranslate"><span class="pre">StdDev</span></code></a> et <a class="reference internal" href="../ref/models/querysets.html#django.db.models.Variance" title="django.db.models.Variance"><code class="xref py py-class docutils literal notranslate"><span class="pre">Variance</span></code></a>&nbsp; renvoient dorénavant un nombre <code class="docutils literal notranslate"><span class="pre">Decimal</span></code> au lieu d’un <code class="docutils literal notranslate"><span class="pre">float</span></code> si la valeur d’entrée est un nombre <code class="docutils literal notranslate"><span class="pre">Decimal</span></code>.</p>
</li>
<li><p class="first">Les tests échoueront avec SQLite si les applications sans migrations ont des relations à des applications avec migrations. Ceci a toujours été une limitation documentée depuis l’introduction des migrations dans Django 1.7, mais les échecs sont désormais plus constants. Vous verrez des tests échouant avec des erreurs comme <code class="docutils literal notranslate"><span class="pre">no</span> <span class="pre">such</span> <span class="pre">table:</span> <span class="pre">&lt;app_label&gt;_&lt;model&gt;</span></code>. Cela s’est produit dans plusieurs applications tierces qui ont des modèles sans migrations dans leurs tests. Vous devez ajouter des migrations pour de tel modèles.</p>
</li>
<li><p class="first">Providing an integer in the <code class="docutils literal notranslate"><span class="pre">key</span></code> argument of the <a class="reference internal" href="../topics/cache.html#django.core.caches.cache.delete" title="django.core.caches.cache.delete"><code class="xref py py-meth docutils literal notranslate"><span class="pre">cache.delete()</span></code></a> or
<a class="reference internal" href="../topics/cache.html#django.core.caches.cache.get" title="django.core.caches.cache.get"><code class="xref py py-meth docutils literal notranslate"><span class="pre">cache.get()</span></code></a> now raises <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(disponible dans Python v3.9)"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ValueError</span></code></a>.</p>
</li>
<li><p class="first">Plural equations for some languages are changed, because the latest versions
from Transifex are incorporated.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The ability to handle <code class="docutils literal notranslate"><span class="pre">.po</span></code> files containing different plural equations
for the same language was added in Django 2.2.12.</p>
</div>
</li>
</ul>
</div>
</div>
<div class="section" id="s-features-deprecated-in-2-2">
<span id="s-deprecated-features-2-2"></span><span id="features-deprecated-in-2-2"></span><span id="deprecated-features-2-2"></span><h2>Fonctionnalités rendues obsolètes dans Django 2.2<a class="headerlink" href="#features-deprecated-in-2-2" title="Lien permanent vers ce titre">¶</a></h2>
<div class="section" id="s-model-meta-ordering-will-no-longer-affect-group-by-queries">
<span id="model-meta-ordering-will-no-longer-affect-group-by-queries"></span><h3>L’attribut <code class="docutils literal notranslate"><span class="pre">Meta.ordering</span></code> des modèles n’affectera plus les requêtes de type <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code><a class="headerlink" href="#model-meta-ordering-will-no-longer-affect-group-by-queries" title="Lien permanent vers ce titre">¶</a></h3>
<p>L’attribut <code class="docutils literal notranslate"><span class="pre">Meta.ordering</span></code> d’un modèle affectant les requêtes <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code> (telles que <code class="docutils literal notranslate"><span class="pre">.annotate().values()</span></code>) est une source fréquente de confusion. De telles requêtes émettent dorénavant un avertissement d’obsolescence avec le conseil d’ajouter <code class="docutils literal notranslate"><span class="pre">order_by()</span></code> pour conserver le comportement existant de la requête. <code class="docutils literal notranslate"><span class="pre">Meta.ordering</span></code> sera ignoré dans ces requêtes à partir de Django 3.1.</p>
</div>
<div class="section" id="s-id2">
<span id="id2"></span><h3>Divers<a class="headerlink" href="#id2" title="Lien permanent vers ce titre">¶</a></h3>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">django.utils.timezone.FixedOffset</span></code> a été rendu obsolète en faveur de <a class="reference external" href="https://docs.python.org/3/library/datetime.html#datetime.timezone" title="(disponible dans Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">datetime.timezone</span></code></a>.</li>
<li>L’alias non documenté <code class="docutils literal notranslate"><span class="pre">QuerySetPaginator</span></code> de <code class="docutils literal notranslate"><span class="pre">django.core.paginator.Paginator</span></code> a été rendu obsolète.</li>
<li>Le champ de modèle et de formulaire <code class="docutils literal notranslate"><span class="pre">FloatRangeField</span></code> dans <code class="docutils literal notranslate"><span class="pre">django.contrib.postgres</span></code> a été rendu obsolète en faveur d’un nouveau nom, <code class="docutils literal notranslate"><span class="pre">DecimalRangeField</span></code>, pour mieux refléter le type de données <code class="docutils literal notranslate"><span class="pre">numrange</span></code> utilisé au niveau de la base de données.</li>
<li>Le réglage <code class="docutils literal notranslate"><span class="pre">FILE_CHARSET</span></code> est obsolète. À partir de Django 3.1, les fichiers lus depuis le disque doivent être codés en UTF-8.</li>
<li><code class="docutils literal notranslate"><span class="pre">django.contrib.staticfiles.storage.CachedStaticFilesStorage</span></code> a été rendu obsolète en raison de ses problèmes insolubles. Remplacez-le plutôt par <code class="xref py py-class docutils literal notranslate"><span class="pre">ManifestStaticFilesStorage</span></code> ou un stockage en nuage de tierce partie.</li>
<li><a class="reference internal" href="../ref/contrib/auth.html#django.contrib.auth.backends.RemoteUserBackend.configure_user" title="django.contrib.auth.backends.RemoteUserBackend.configure_user"><code class="xref py py-meth docutils literal notranslate"><span class="pre">RemoteUserBackend.configure_user()</span></code></a> reçoit dorénavant <code class="docutils literal notranslate"><span class="pre">request</span></code> comme premier paramètre positionnel, s’il l’accepte. La prise en charge des méthodes surchargées n’acceptant pas ce paramètre sera supprimée dans Django 3.1.</li>
<li>The <code class="docutils literal notranslate"><span class="pre">SimpleTestCase.allow_database_queries</span></code>,
<code class="docutils literal notranslate"><span class="pre">TransactionTestCase.multi_db</span></code>, and <code class="docutils literal notranslate"><span class="pre">TestCase.multi_db</span></code>
attributes are deprecated in favor of <a class="reference internal" href="../topics/testing/tools.html#django.test.SimpleTestCase.databases" title="django.test.SimpleTestCase.databases"><code class="xref py py-attr docutils literal notranslate"><span class="pre">SimpleTestCase.databases</span></code></a>,
<a class="reference internal" href="../topics/testing/tools.html#django.test.TransactionTestCase.databases" title="django.test.TransactionTestCase.databases"><code class="xref py py-attr docutils literal notranslate"><span class="pre">TransactionTestCase.databases</span></code></a>, and <a class="reference internal" href="../topics/testing/tools.html#django.test.TestCase.databases" title="django.test.TestCase.databases"><code class="xref py py-attr docutils literal notranslate"><span class="pre">TestCase.databases</span></code></a>.
These new attributes allow databases dependencies to be declared in order to
prevent unexpected queries against non-default databases to leak state
between tests. The previous behavior of <code class="docutils literal notranslate"><span class="pre">allow_database_queries=True</span></code> and
<code class="docutils literal notranslate"><span class="pre">multi_db=True</span></code> can be achieved by setting <code class="docutils literal notranslate"><span class="pre">databases='__all__'</span></code>.</li>
</ul>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      
        
          <div class="yui-b" id="sidebar">
            
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../contents.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Notes de publication de Django 2.2</a><ul>
<li><a class="reference internal" href="#python-compatibility">Compatibilité Python</a></li>
<li><a class="reference internal" href="#what-s-new-in-django-2-2">Quoi de neuf dans Django 2.2</a><ul>
<li><a class="reference internal" href="#constraints">Contraintes</a></li>
<li><a class="reference internal" href="#minor-features">Fonctionnalités mineures</a><ul>
<li><a class="reference internal" href="#django-contrib-admin"><code class="docutils literal notranslate"><span class="pre">django.contrib.admin</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-auth"><code class="docutils literal notranslate"><span class="pre">django.contrib.auth</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-gis"><code class="docutils literal notranslate"><span class="pre">django.contrib.gis</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-postgres"><code class="docutils literal notranslate"><span class="pre">django.contrib.postgres</span></code></a></li>
<li><a class="reference internal" href="#django-contrib-staticfiles"><code class="docutils literal notranslate"><span class="pre">django.contrib.staticfiles</span></code></a></li>
<li><a class="reference internal" href="#database-backends">Moteurs de base de données</a></li>
<li><a class="reference internal" href="#generic-views">Vues génériques</a></li>
<li><a class="reference internal" href="#internationalization">Internationalisation</a></li>
<li><a class="reference internal" href="#management-commands">Commandes d’administration</a></li>
<li><a class="reference internal" href="#migrations">Migrations</a></li>
<li><a class="reference internal" href="#models">Modèles</a></li>
<li><a class="reference internal" href="#requests-and-responses">Requêtes et réponses</a></li>
<li><a class="reference internal" href="#serialization">Sérialisation</a></li>
<li><a class="reference internal" href="#tests">Tests</a></li>
<li><a class="reference internal" href="#urls">URL</a></li>
<li><a class="reference internal" href="#validators">Validateurs</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#backwards-incompatible-changes-in-2-2">Changements incompatibles avec les anciennes versions dans Django 2.2</a><ul>
<li><a class="reference internal" href="#database-backend-api">API de moteur de base de données</a></li>
<li><a class="reference internal" href="#admin-actions-are-no-longer-collected-from-base-modeladmin-classes">Les actions d’administration ne sont plus collectées à partir des classes <code class="docutils literal notranslate"><span class="pre">ModelAdmin</span></code> de base</a></li>
<li><a class="reference internal" href="#id1"><code class="docutils literal notranslate"><span class="pre">django.contrib.gis</span></code></a></li>
<li><a class="reference internal" href="#transactiontestcase-serialized-data-loading">Chargement de données <code class="docutils literal notranslate"><span class="pre">TransactionTestCase</span></code> sérialisées</a></li>
<li><a class="reference internal" href="#sqlparse-is-required-dependency"><code class="docutils literal notranslate"><span class="pre">sqlparse</span></code> devient une dépendance obligatoire</a></li>
<li><a class="reference internal" href="#cached-property-aliases">Alias de <code class="docutils literal notranslate"><span class="pre">cached_property</span></code></a></li>
<li><a class="reference internal" href="#permissions-for-proxy-models">Permissions pour les modèles mandataires</a></li>
<li><a class="reference internal" href="#merging-of-form-media-assets">Fusion des fichiers statiques <code class="docutils literal notranslate"><span class="pre">Media</span></code> des formulaires</a></li>
<li><a class="reference internal" href="#miscellaneous">Divers</a></li>
</ul>
</li>
<li><a class="reference internal" href="#features-deprecated-in-2-2">Fonctionnalités rendues obsolètes dans Django 2.2</a><ul>
<li><a class="reference internal" href="#model-meta-ordering-will-no-longer-affect-group-by-queries">L’attribut <code class="docutils literal notranslate"><span class="pre">Meta.ordering</span></code> des modèles n’affectera plus les requêtes de type <code class="docutils literal notranslate"><span class="pre">GROUP</span> <span class="pre">BY</span></code></a></li>
<li><a class="reference internal" href="#id2">Divers</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Sujet précédent</h4>
  <p class="topless"><a href="2.2.1.html"
                        title="Chapitre précédent">Notes de publication de Django 2.2.1</a></p>
  <h4>Sujet suivant</h4>
  <p class="topless"><a href="2.1.15.html"
                        title="Chapitre suivant">Notes de publication de Django 2.1.15</a></p>
  <div role="note" aria-label="source link">
    <h3>Cette page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/releases/2.2.txt"
            rel="nofollow">Montrer le code source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Recherche rapide</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
              <h3>Last update:</h3>
              <p class="topless">oct. 29, 2020</p>
          </div>
        
      
    </div>

    <div id="ft">
      <div class="nav">
    &laquo; <a href="2.2.1.html" title="Notes de publication de Django 2.2.1">previous</a>
     |
    <a href="index.html" title="Notes de publication" accesskey="U">up</a>
   |
    <a href="2.1.15.html" title="Notes de publication de Django 2.1.15">next</a> &raquo;</div>
    </div>
  </div>

      <div class="clearer"></div>
    </div>
  </body>
</html>