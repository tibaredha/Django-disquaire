
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="fr">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Utilisation du système d’authentification de Django &#8212; Documentation Django 3.1.3.dev</title>
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../_static/translations.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Recherche" href="../../search.html" />
    <link rel="next" title="Gestion des mots de passe dans Django" href="passwords.html" />
    <link rel="prev" title="Authentification des utilisateurs dans Django" href="index.html" />



 
<script src="../../templatebuiltins.js"></script>
<script>
(function($) {
    if (!django_template_builtins) {
       // templatebuiltins.js missing, do nothing.
       return;
    }
    $(document).ready(function() {
        // Hyperlink Django template tags and filters
        var base = "../../ref/templates/builtins.html";
        if (base == "#") {
            // Special case for builtins.html itself
            base = "";
        }
        // Tags are keywords, class '.k'
        $("div.highlight\\-html\\+django span.k").each(function(i, elem) {
             var tagname = $(elem).text();
             if ($.inArray(tagname, django_template_builtins.ttags) != -1) {
                 var fragment = tagname.replace(/_/, '-');
                 $(elem).html("<a href='" + base + "#" + fragment + "'>" + tagname + "</a>");
             }
        });
        // Filters are functions, class '.nf'
        $("div.highlight\\-html\\+django span.nf").each(function(i, elem) {
             var filtername = $(elem).text();
             if ($.inArray(filtername, django_template_builtins.tfilters) != -1) {
                 var fragment = filtername.replace(/_/, '-');
                 $(elem).html("<a href='" + base + "#" + fragment + "'>" + filtername + "</a>");
             }
        });
    });
})(jQuery);</script>

  </head><body>

    <div class="document">
  <div id="custom-doc" class="yui-t6">
    <div id="hd">
      <h1><a href="../../index.html">Documentation Django 3.1.3.dev</a></h1>
      <div id="global-nav">
        <a title="Home page" href="../../index.html">Home</a>  |
        <a title="Table of contents" href="../../contents.html">Table of contents</a>  |
        <a title="Global index" href="../../genindex.html">Index</a>  |
        <a title="Module index" href="../../py-modindex.html">Modules</a>
      </div>
      <div class="nav">
    &laquo; <a href="index.html" title="Authentification des utilisateurs dans Django">previous</a>
     |
    <a href="../index.html" title="Utilisation de Django" accesskey="U">up</a>
   |
    <a href="passwords.html" title="Gestion des mots de passe dans Django">next</a> &raquo;</div>
    </div>

    <div id="bd">
      <div id="yui-main">
        <div class="yui-b">
          <div class="yui-g" id="topics-auth-default">
            
  <div class="section" id="s-using-the-django-authentication-system">
<span id="using-the-django-authentication-system"></span><h1>Utilisation du système d’authentification de Django<a class="headerlink" href="#using-the-django-authentication-system" title="Lien permanent vers ce titre">¶</a></h1>
<p>Ce document présente l’utilisation du système d’authentification de Django dans sa configuration par défaut. Cette configuration a évolué afin de pouvoir répondre aux besoins les plus courants des projets, elle est capable de gérer une large palette de tâches, et elle possède une implémentation soigneuse des mots de passe et des permissions. Pour les projets où les besoins en terme d’authentification divergent de la configuration par défaut, Django permet d”<a class="reference internal" href="customizing.html"><span class="doc">étendre et de personnaliser</span></a> l’authentification de manière approfondie.</p>
<p>L’authentification de Django fournit à la fois l’authentification et l’autorisation, regroupés sous le terme général de système d’authentification, dans la mesure où ces fonctions sont assez étroitement liées.</p>
<div class="section" id="s-user-objects">
<span id="s-id1"></span><span id="user-objects"></span><span id="id1"></span><h2>Objets utilisateurs<a class="headerlink" href="#user-objects" title="Lien permanent vers ce titre">¶</a></h2>
<p>Les objets <a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User" title="django.contrib.auth.models.User"><code class="xref py py-class docutils literal notranslate"><span class="pre">User</span></code></a> se trouvent au cœur du système d’authentification. Ils représentent typiquement les personnes qui interagissent avec votre site et sont utilisés pour activer des fonctionnalités comme la restriction d’accès, l’enregistrement de profils utilisateurs, l’association de contenus avec leur créateur, etc. Une seule classe d’utilisateurs existe dans le système d’authentification de Django&nbsp;; cela signifie donc que les « super-utilisateurs » (<a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User.is_superuser" title="django.contrib.auth.models.User.is_superuser"><code class="xref py py-attr docutils literal notranslate"><span class="pre">'superusers'</span></code></a>) ou les membres des équipes d’administration du site ( <a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User.is_staff" title="django.contrib.auth.models.User.is_staff"><code class="xref py py-attr docutils literal notranslate"><span class="pre">'staff'</span></code></a>) ne sont que des objets utilisateur normaux ayant certains attributs définis, et non pas une classe différente d’objet utilisateur.</p>
<p>Les attributs principaux de l’utilisateur par défaut sont&nbsp;:</p>
<ul class="simple">
<li><a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User.username" title="django.contrib.auth.models.User.username"><code class="xref py py-attr docutils literal notranslate"><span class="pre">username</span></code></a></li>
<li><a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User.password" title="django.contrib.auth.models.User.password"><code class="xref py py-attr docutils literal notranslate"><span class="pre">password</span></code></a></li>
<li><a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User.email" title="django.contrib.auth.models.User.email"><code class="xref py py-attr docutils literal notranslate"><span class="pre">email</span></code></a></li>
<li><a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User.first_name" title="django.contrib.auth.models.User.first_name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">first_name</span></code></a></li>
<li><a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User.last_name" title="django.contrib.auth.models.User.last_name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">last_name</span></code></a></li>
</ul>
<p>Consultez la <a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User" title="django.contrib.auth.models.User"><code class="xref py py-class docutils literal notranslate"><span class="pre">documentation</span> <span class="pre">complète</span> <span class="pre">de</span> <span class="pre">l'API</span></code></a> pour une référence exhaustive&nbsp;; la documentation ci-après est plus orientée sur les tâches.</p>
<div class="section" id="s-creating-users">
<span id="s-topics-auth-creating-users"></span><span id="creating-users"></span><span id="topics-auth-creating-users"></span><h3>Création d’utilisateurs<a class="headerlink" href="#creating-users" title="Lien permanent vers ce titre">¶</a></h3>
<p>La manière la plus directe de créer des utilisateurs est d’utiliser la fonction utilitaire <a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.UserManager.create_user" title="django.contrib.auth.models.UserManager.create_user"><code class="xref py py-meth docutils literal notranslate"><span class="pre">create_user()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="k">import</span> <span class="n">User</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">user</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="s1">&#39;john&#39;</span><span class="p">,</span> <span class="s1">&#39;lennon@thebeatles.com&#39;</span><span class="p">,</span> <span class="s1">&#39;johnpassword&#39;</span><span class="p">)</span>

<span class="go"># At this point, user is a User object that has already been saved</span>
<span class="go"># to the database. You can continue to change its attributes</span>
<span class="go"># if you want to change other fields.</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">last_name</span> <span class="o">=</span> <span class="s1">&#39;Lennon&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">user</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p>Si vous avez installé l’interface d’administration de Django, vous pouvez aussi  <a class="reference internal" href="#auth-admin"><span class="std std-ref">créer des utilisateurs interactivement</span></a>.</p>
</div>
<div class="section" id="s-creating-superusers">
<span id="s-topics-auth-creating-superusers"></span><span id="creating-superusers"></span><span id="topics-auth-creating-superusers"></span><h3>Création de superutilisateurs<a class="headerlink" href="#creating-superusers" title="Lien permanent vers ce titre">¶</a></h3>
<p>Les superutilisateurs peuvent être créés à l’aide de la commande <a class="reference internal" href="../../ref/django-admin.html#django-admin-createsuperuser"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">createsuperuser</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python manage.py createsuperuser --username=joe --email=joe@example.com
</pre></div>
</div>
<p>Vous devrez saisir un mot de passe. Après l’avoir fait, l’utilisateur sera immédiatement créé. Si vous omettez les options <a class="reference internal" href="../../ref/django-admin.html#cmdoption-createsuperuser-username"><code class="xref std std-option docutils literal notranslate"><span class="pre">--username</span></code></a> ou <a class="reference internal" href="../../ref/django-admin.html#cmdoption-createsuperuser-email"><code class="xref std std-option docutils literal notranslate"><span class="pre">--email</span></code></a>, vous devrez aussi renseigner ces valeurs.</p>
</div>
<div class="section" id="s-changing-passwords">
<span id="changing-passwords"></span><h3>Modification des mots de passe<a class="headerlink" href="#changing-passwords" title="Lien permanent vers ce titre">¶</a></h3>
<p>Django ne stocke pas de mots de passe bruts (en clair) dans le modèle d’utilisateur, mais uniquement une empreinte hachée (voir la  <a class="reference internal" href="passwords.html"><span class="doc">documentation sur la façon dont sont gérés les mots de passe</span></a> pour des détails plus complets). C’est pourquoi il faut éviter de manipuler directement l’attribut <code class="docutils literal notranslate"><span class="pre">password</span></code> de l’utilisateur et qu’une fonction utilitaire est employée pour créer un utilisateur.</p>
<p>Pour changer le mot de passe d’un utilisateur, vous disposez de plusieurs options&nbsp;:</p>
<p><a class="reference internal" href="../../ref/django-admin.html#django-admin-changepassword"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">manage.py</span> <span class="pre">changepassword</span> <span class="pre">*nom</span> <span class="pre">d'utilisateur*</span></code></a> offre une méthode permettant de changer le mot de passe d’un utilisateur dans une ligne de commande. Vous serez invité à changer le mot de passe de l’utilisateur indiqué en le saisissant deux fois. Si les deux saisies correspondent, le nouveau mot de passe sera immédiatement défini. Si vous n’indiquez pas de nom d’utilisateur, la commande essaie de changer le mot de passe de l’utilisateur dont le nom correspond à l’utilisateur système en cours.</p>
<p>Il est aussi possible de changer un mot de passe de façon programmatique, en utilisant <a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User.set_password" title="django.contrib.auth.models.User.set_password"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set_password()</span></code></a>:</p>
<div class="highlight-pycon notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="kn">import</span> <span class="n">User</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">u</span> <span class="o">=</span> <span class="n">User</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s1">&#39;john&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">u</span><span class="o">.</span><span class="n">set_password</span><span class="p">(</span><span class="s1">&#39;new password&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">u</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>
</div>
<p>Si l’interface d’administration de Django est installée, vous pouvez aussi changer les mots de passe des utilisateurs dans les <a class="reference internal" href="#auth-admin"><span class="std std-ref">pages d’administration du système d’authentification</span></a>.</p>
<p>Django fournit également des <a class="reference internal" href="#built-in-auth-views"><span class="std std-ref">vues</span></a> et des <a class="reference internal" href="#built-in-auth-forms"><span class="std std-ref">formulaires</span></a> permettant aux utilisateurs de changer leur propre mot de passe.</p>
<p>Le changement de mot de passe d’un utilisateur déconnecte toutes ses sessions. Voir <a class="reference internal" href="#session-invalidation-on-password-change"><span class="std std-ref">Invalidation de session lors du changement de mot de passe</span></a> pour plus de détails.</p>
</div>
<div class="section" id="s-authenticating-users">
<span id="authenticating-users"></span><h3>Authentification des utilisateurs<a class="headerlink" href="#authenticating-users" title="Lien permanent vers ce titre">¶</a></h3>
<dl class="function">
<dt id="django.contrib.auth.authenticate">
<code class="descname">authenticate</code>(<em>request=None</em>, <em>**credentials</em>)<a class="headerlink" href="#django.contrib.auth.authenticate" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>Utilisez <a class="reference internal" href="#django.contrib.auth.authenticate" title="django.contrib.auth.authenticate"><code class="xref py py-func docutils literal notranslate"><span class="pre">authenticate()</span></code></a> pour vérifier un jeu de données d’authentification. Cette méthode accepte les données d’authentification sous forme de paramètres nommés, <code class="docutils literal notranslate"><span class="pre">username</span></code> et <code class="docutils literal notranslate"><span class="pre">password</span></code> pour la configuration par défaut, vérifie ces données avec chaque <a class="reference internal" href="customizing.html#authentication-backends"><span class="std std-ref">moteur d’authentification</span></a> et renvoie un objet <a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User" title="django.contrib.auth.models.User"><code class="xref py py-class docutils literal notranslate"><span class="pre">User</span></code></a> si l’authentification est valide pour un des moteurs. Si aucun moteur n’accepte l’authentification ou si un moteur génère <a class="reference internal" href="../../ref/exceptions.html#django.core.exceptions.PermissionDenied" title="django.core.exceptions.PermissionDenied"><code class="xref py py-class docutils literal notranslate"><span class="pre">PermissionDenied</span></code></a>, la méthode renvoie <code class="docutils literal notranslate"><span class="pre">None</span></code>. Par exemple&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="k">import</span> <span class="n">authenticate</span>
<span class="n">user</span> <span class="o">=</span> <span class="n">authenticate</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s1">&#39;john&#39;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s1">&#39;secret&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">user</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
    <span class="c1"># A backend authenticated the credentials</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># No backend authenticated the credentials</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">request</span></code> est un objet <a class="reference internal" href="../../ref/request-response.html#django.http.HttpRequest" title="django.http.HttpRequest"><code class="xref py py-class docutils literal notranslate"><span class="pre">HttpRequest</span></code></a> facultatif qui est transmis à la méthode <code class="docutils literal notranslate"><span class="pre">authenticate()</span></code> des moteurs d’authentification.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Ceci est une manière d’authentifier un jeu de données d’authentification à un bas niveau&nbsp;; par exemple, c’est ce qui est utilisé par <a class="reference internal" href="../../ref/middleware.html#django.contrib.auth.middleware.RemoteUserMiddleware" title="django.contrib.auth.middleware.RemoteUserMiddleware"><code class="xref py py-class docutils literal notranslate"><span class="pre">RemoteUserMiddleware</span></code></a>. Vous n’aurez probablement pas l’usage de cette méthode, sauf si vous écrivez votre propre système d’authentification. Si vous recherchez un moyen de connecter un utilisateur, utilisez plutôt la classe <a class="reference internal" href="#django.contrib.auth.views.LoginView" title="django.contrib.auth.views.LoginView"><code class="xref py py-class docutils literal notranslate"><span class="pre">LoginView</span></code></a>.</p>
</div>
</dd></dl>

</div>
</div>
<div class="section" id="s-permissions-and-authorization">
<span id="s-topic-authorization"></span><span id="permissions-and-authorization"></span><span id="topic-authorization"></span><h2>Permissions et autorisations<a class="headerlink" href="#permissions-and-authorization" title="Lien permanent vers ce titre">¶</a></h2>
<p>Django contient un système intégré de permissions. Il permet d’attribuer des permissions à des utilisateurs ou des groupes d’utilisateurs particuliers.</p>
<p>Ce système est utilisé par le site d’administration de Django, mais vous avez tout loisir de l’utiliser dans votre propre code.</p>
<p>Le site d’administration de Django utilise les permissions ainsi&nbsp;:</p>
<ul class="simple">
<li>L’accès à l’affichage d’un objet est limité aux utilisateurs possédant la permission « view » ou « change » pour ce type d’objet.</li>
<li>L’accès au formulaire d’ajout et l’ajout d’objet sont limités aux utilisateurs possédant la permission «&nbsp;add&nbsp;» pour ce type d’objet.</li>
<li>L’accès à la liste des objets pour modification, au formulaire de modification et la modification d’un objet sont limités aux utilisateurs possédant la permission «&nbsp;change&nbsp;» pour ce type d’objet.</li>
<li>L’accès à la suppression d’un objet est limité aux utilisateurs possédant la permission «&nbsp;delete&nbsp;» pour ce type d’objet.</li>
</ul>
<p>Les permissions peuvent non seulement être attribuées par type d’objet, mais aussi par instance d’objet spécifique. En utilisant les méthodes <a class="reference internal" href="../../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin.has_view_permission" title="django.contrib.admin.ModelAdmin.has_view_permission"><code class="xref py py-meth docutils literal notranslate"><span class="pre">has_view_permission()</span></code></a>, <a class="reference internal" href="../../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin.has_add_permission" title="django.contrib.admin.ModelAdmin.has_add_permission"><code class="xref py py-meth docutils literal notranslate"><span class="pre">has_add_permission()</span></code></a>, <a class="reference internal" href="../../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin.has_change_permission" title="django.contrib.admin.ModelAdmin.has_change_permission"><code class="xref py py-meth docutils literal notranslate"><span class="pre">has_change_permission()</span></code></a> et <a class="reference internal" href="../../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin.has_delete_permission" title="django.contrib.admin.ModelAdmin.has_delete_permission"><code class="xref py py-meth docutils literal notranslate"><span class="pre">has_delete_permission()</span></code></a> fournies par la classe <a class="reference internal" href="../../ref/contrib/admin/index.html#django.contrib.admin.ModelAdmin" title="django.contrib.admin.ModelAdmin"><code class="xref py py-class docutils literal notranslate"><span class="pre">ModelAdmin</span></code></a>, il est possible de personnaliser les permissions pour différentes instances d’objets du même type.</p>
<p>Les objets <a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User" title="django.contrib.auth.models.User"><code class="xref py py-class docutils literal notranslate"><span class="pre">User</span></code></a> possèdent deux champs plusieurs-à-plusieurs&nbsp;: <code class="docutils literal notranslate"><span class="pre">groups</span></code> et <code class="docutils literal notranslate"><span class="pre">user_permissions</span></code>. Les objets <a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User" title="django.contrib.auth.models.User"><code class="xref py py-class docutils literal notranslate"><span class="pre">User</span></code></a> peuvent accéder à leurs objets liés de la même façon que pour tout autre <a class="reference internal" href="../db/models.html"><span class="doc">modèle Django</span></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">myuser</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">set</span><span class="p">([</span><span class="n">group_list</span><span class="p">])</span>
<span class="n">myuser</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
<span class="n">myuser</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">group</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
<span class="n">myuser</span><span class="o">.</span><span class="n">groups</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
<span class="n">myuser</span><span class="o">.</span><span class="n">user_permissions</span><span class="o">.</span><span class="n">set</span><span class="p">([</span><span class="n">permission_list</span><span class="p">])</span>
<span class="n">myuser</span><span class="o">.</span><span class="n">user_permissions</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">permission</span><span class="p">,</span> <span class="n">permission</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
<span class="n">myuser</span><span class="o">.</span><span class="n">user_permissions</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">permission</span><span class="p">,</span> <span class="n">permission</span><span class="p">,</span> <span class="o">...</span><span class="p">)</span>
<span class="n">myuser</span><span class="o">.</span><span class="n">user_permissions</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
</pre></div>
</div>
<div class="section" id="s-default-permissions">
<span id="default-permissions"></span><h3>Permissions par défaut<a class="headerlink" href="#default-permissions" title="Lien permanent vers ce titre">¶</a></h3>
<p>Quand l’application <code class="docutils literal notranslate"><span class="pre">django.contrib.auth</span></code> figure dans le réglage <a class="reference internal" href="../../ref/settings.html#std:setting-INSTALLED_APPS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">INSTALLED_APPS</span></code></a>, elle s’assure que les quatre permissions par défaut («&nbsp;add&nbsp;», «&nbsp;change&nbsp;», «&nbsp;delete&nbsp;» et « view ») soient créées pour chaque modèle Django défini dans toutes les applications installées.</p>
<p>Ces permissions seront créées lorsque vous lancez <a class="reference internal" href="../../ref/django-admin.html#django-admin-migrate"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">manage.py</span> <span class="pre">migrate</span></code></a>; au premier lancement de <code class="docutils literal notranslate"><span class="pre">migrate</span></code> après l’ajout de <code class="docutils literal notranslate"><span class="pre">django.contrib.auth</span></code> à <a class="reference internal" href="../../ref/settings.html#std:setting-INSTALLED_APPS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">INSTALLED_APPS</span></code></a>, les permissions par défaut seront créées pour tous les modèles précédemment installés de même que pour tout nouveau modèle installé à ce moment-là. Par la suite, chaque nouvelle exécution de <a class="reference internal" href="../../ref/django-admin.html#django-admin-migrate"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">manage.py</span> <span class="pre">migrate</span></code></a> crée les permissions par défaut pour les nouveaux modèles (la fonction qui crée les permissions est connectée au signal <a class="reference internal" href="../../ref/signals.html#django.db.models.signals.post_migrate" title="django.db.models.signals.post_migrate"><code class="xref py py-data docutils literal notranslate"><span class="pre">post_migrate</span></code></a>).</p>
<p>En supposant qu’une application ait l’attribut <a class="reference internal" href="../../ref/models/options.html#django.db.models.Options.app_label" title="django.db.models.Options.app_label"><code class="xref py py-attr docutils literal notranslate"><span class="pre">app_label</span></code></a> <code class="docutils literal notranslate"><span class="pre">foo</span></code> et qu’un modèle soit nommé <code class="docutils literal notranslate"><span class="pre">Bar</span></code>, voici comment il faut tester les permissions de base&nbsp;:</p>
<ul class="simple">
<li>ajout&nbsp;: <code class="docutils literal notranslate"><span class="pre">user.has_perm('foo.add_bar')</span></code></li>
<li>modification&nbsp;: <code class="docutils literal notranslate"><span class="pre">user.has_perm('foo.change_bar')</span></code></li>
<li>suppression&nbsp;: <code class="docutils literal notranslate"><span class="pre">user.has_perm('foo.delete_bar')</span></code></li>
<li>affichage &nbsp;: <code class="docutils literal notranslate"><span class="pre">user.has_perm('foo.view_bar')</span></code></li>
</ul>
<p>Le modèle <a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.Permission" title="django.contrib.auth.models.Permission"><code class="xref py py-class docutils literal notranslate"><span class="pre">Permission</span></code></a> est rarement accédé directement.</p>
</div>
<div class="section" id="s-groups">
<span id="groups"></span><h3>Groupes<a class="headerlink" href="#groups" title="Lien permanent vers ce titre">¶</a></h3>
<p>Les modèles <a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.Group" title="django.contrib.auth.models.Group"><code class="xref py py-class docutils literal notranslate"><span class="pre">django.contrib.auth.models.Group</span></code></a> sont une manière générique de segmenter les utilisateurs afin de pouvoir leur attribuer des permissions ou de les désigner par un nom défini. Un utilisateur peut appartenir à autant de groupes que nécessaire.</p>
<p>Un utilisateur d’un groupe reçoit automatiquement les permissions attribuées à ce groupe. Par exemple, si le groupe <code class="docutils literal notranslate"><span class="pre">Éditeurs</span> <span class="pre">du</span> <span class="pre">site</span></code> possède la permission <code class="docutils literal notranslate"><span class="pre">can_edit_home_page</span></code>, tout utilisateur membre du groupe possédera cette permission.</p>
<p>Au-delà des permissions, les groupes sont un bon moyen de regrouper les utilisateurs sous un nom défini, afin de leur attribuer certaines fonctionnalités particulières. Par exemple, vous pourriez créer un groupe <code class="docutils literal notranslate"><span class="pre">Utilisateurs</span> <span class="pre">spéciaux</span></code> et écrire ensuite du code qui leur donne accès à une section réservée aux membres sur le site, ou leur envoyer des courriels s’adressant uniquement aux membres.</p>
</div>
<div class="section" id="s-programmatically-creating-permissions">
<span id="programmatically-creating-permissions"></span><h3>Création programmatique de permissions<a class="headerlink" href="#programmatically-creating-permissions" title="Lien permanent vers ce titre">¶</a></h3>
<p>Bien que des <a class="reference internal" href="customizing.html#custom-permissions"><span class="std std-ref">permissions personnalisées</span></a> puissent être définies dans la classe <code class="docutils literal notranslate"><span class="pre">Meta</span></code> d’un modèle, il est aussi possible de créer directement des permissions. Par exemple, vous pouvez créer la permission <code class="docutils literal notranslate"><span class="pre">can_publish</span></code> d’un modèle <code class="docutils literal notranslate"><span class="pre">BlogPost</span></code> dans <code class="docutils literal notranslate"><span class="pre">myapp</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">myapp.models</span> <span class="k">import</span> <span class="n">BlogPost</span>
<span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="k">import</span> <span class="n">Permission</span>
<span class="kn">from</span> <span class="nn">django.contrib.contenttypes.models</span> <span class="k">import</span> <span class="n">ContentType</span>

<span class="n">content_type</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">BlogPost</span><span class="p">)</span>
<span class="n">permission</span> <span class="o">=</span> <span class="n">Permission</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span>
    <span class="n">codename</span><span class="o">=</span><span class="s1">&#39;can_publish&#39;</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Can Publish Posts&#39;</span><span class="p">,</span>
    <span class="n">content_type</span><span class="o">=</span><span class="n">content_type</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
<p>La permission peut ensuite être attribuée à un <a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User" title="django.contrib.auth.models.User"><code class="xref py py-class docutils literal notranslate"><span class="pre">User</span></code></a> par son attribut <code class="docutils literal notranslate"><span class="pre">user_permissions</span></code> ou à un <a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.Group" title="django.contrib.auth.models.Group"><code class="xref py py-class docutils literal notranslate"><span class="pre">Group</span></code></a> par son attribut <code class="docutils literal notranslate"><span class="pre">permissions</span></code>.</p>
<div class="admonition-proxy-models-need-their-own-content-type admonition">
<p class="first admonition-title">Les modèles mandataires ont besoin de leur propre type de contenu</p>
<p>Si vous souhaitez créer des <a class="reference internal" href="#proxy-models-permissions-topic"><span class="std std-ref">permission pour un modèle mandataire</span></a>, passez <code class="docutils literal notranslate"><span class="pre">for_concrete_model=False</span></code> à <a class="reference internal" href="../../ref/contrib/contenttypes.html#django.contrib.contenttypes.models.ContentTypeManager.get_for_model" title="django.contrib.contenttypes.models.ContentTypeManager.get_for_model"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ContentTypeManager.get_for_model()</span></code></a> pour obtenir le type <code class="docutils literal notranslate"><span class="pre">ContentType</span></code> approprié</p>
<div class="last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">content_type</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">BlogPostProxy</span><span class="p">,</span> <span class="n">for_concrete_model</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="s-permission-caching">
<span id="permission-caching"></span><h3>Mise en cache des permissions<a class="headerlink" href="#permission-caching" title="Lien permanent vers ce titre">¶</a></h3>
<p>Le moteur <a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.backends.ModelBackend" title="django.contrib.auth.backends.ModelBackend"><code class="xref py py-class docutils literal notranslate"><span class="pre">ModelBackend</span></code></a> met en cache les permissions de l’objet utilisateur la première fois que ces permissions doivent être consultées. Cela convient généralement bien au cycle requête-réponse car en principe les permissions ne sont pas consultées immédiatement après avoir été ajoutées (dans l’interface d’administration par exemple). Si vous ajoutez des permissions et que vous les consultez immédiatement après, par exemple dans un test ou une vue, la solution la plus simple est de récupérer une nouvelle fois l’objet utilisateur à partir de la base de données. Par exemple&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.auth.models</span> <span class="k">import</span> <span class="n">Permission</span><span class="p">,</span> <span class="n">User</span>
<span class="kn">from</span> <span class="nn">django.contrib.contenttypes.models</span> <span class="k">import</span> <span class="n">ContentType</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="k">import</span> <span class="n">get_object_or_404</span>

<span class="kn">from</span> <span class="nn">myapp.models</span> <span class="k">import</span> <span class="n">BlogPost</span>

<span class="k">def</span> <span class="nf">user_gains_perms</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">user_id</span><span class="p">):</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">user_id</span><span class="p">)</span>
    <span class="c1"># any permission check will cache the current set of permissions</span>
    <span class="n">user</span><span class="o">.</span><span class="n">has_perm</span><span class="p">(</span><span class="s1">&#39;myapp.change_blogpost&#39;</span><span class="p">)</span>

    <span class="n">content_type</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">BlogPost</span><span class="p">)</span>
    <span class="n">permission</span> <span class="o">=</span> <span class="n">Permission</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get</span><span class="p">(</span>
        <span class="n">codename</span><span class="o">=</span><span class="s1">&#39;change_blogpost&#39;</span><span class="p">,</span>
        <span class="n">content_type</span><span class="o">=</span><span class="n">content_type</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">user</span><span class="o">.</span><span class="n">user_permissions</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">permission</span><span class="p">)</span>

    <span class="c1"># Checking the cached permission set</span>
    <span class="n">user</span><span class="o">.</span><span class="n">has_perm</span><span class="p">(</span><span class="s1">&#39;myapp.change_blogpost&#39;</span><span class="p">)</span>  <span class="c1"># False</span>

    <span class="c1"># Request new instance of User</span>
    <span class="c1"># Be aware that user.refresh_from_db() won&#39;t clear the cache.</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">get_object_or_404</span><span class="p">(</span><span class="n">User</span><span class="p">,</span> <span class="n">pk</span><span class="o">=</span><span class="n">user_id</span><span class="p">)</span>

    <span class="c1"># Permission cache is repopulated from the database</span>
    <span class="n">user</span><span class="o">.</span><span class="n">has_perm</span><span class="p">(</span><span class="s1">&#39;myapp.change_blogpost&#39;</span><span class="p">)</span>  <span class="c1"># True</span>

    <span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="s-proxy-models">
<span id="s-proxy-models-permissions-topic"></span><span id="proxy-models"></span><span id="proxy-models-permissions-topic"></span><h3>Modèles mandataires<a class="headerlink" href="#proxy-models" title="Lien permanent vers ce titre">¶</a></h3>
<p>Les modèles mandataires fonctionnent exactement de la même manière que les modèles concrets. Les permissions sont créées en utilisant le type de contenu propre au modèle mandataire. Les modèles mandataires n’héritent pas des permissions du modèle concret qu’ils étendent</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">permissions</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;can_eat_pizzas&#39;</span><span class="p">,</span> <span class="s1">&#39;Can eat pizzas&#39;</span><span class="p">)]</span>

<span class="k">class</span> <span class="nc">Student</span><span class="p">(</span><span class="n">Person</span><span class="p">):</span>
    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">proxy</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">permissions</span> <span class="o">=</span> <span class="p">[(</span><span class="s1">&#39;can_deliver_pizzas&#39;</span><span class="p">,</span> <span class="s1">&#39;Can deliver pizzas&#39;</span><span class="p">)]</span>

<span class="o">&gt;&gt;&gt;</span> <span class="c1"># Fetch the content type for the proxy model.</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">content_type</span> <span class="o">=</span> <span class="n">ContentType</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">get_for_model</span><span class="p">(</span><span class="n">Student</span><span class="p">,</span> <span class="n">for_concrete_model</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">student_permissions</span> <span class="o">=</span> <span class="n">Permission</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">content_type</span><span class="o">=</span><span class="n">content_type</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">codename</span> <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">student_permissions</span><span class="p">]</span>
<span class="p">[</span><span class="s1">&#39;add_student&#39;</span><span class="p">,</span> <span class="s1">&#39;change_student&#39;</span><span class="p">,</span> <span class="s1">&#39;delete_student&#39;</span><span class="p">,</span> <span class="s1">&#39;view_student&#39;</span><span class="p">,</span>
<span class="s1">&#39;can_deliver_pizzas&#39;</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="k">for</span> <span class="n">permission</span> <span class="ow">in</span> <span class="n">student_permissions</span><span class="p">:</span>
<span class="o">...</span>     <span class="n">user</span><span class="o">.</span><span class="n">user_permissions</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">permission</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">user</span><span class="o">.</span><span class="n">has_perm</span><span class="p">(</span><span class="s1">&#39;app.add_person&#39;</span><span class="p">)</span>
<span class="kc">False</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">user</span><span class="o">.</span><span class="n">has_perm</span><span class="p">(</span><span class="s1">&#39;app.can_eat_pizzas&#39;</span><span class="p">)</span>
<span class="kc">False</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">user</span><span class="o">.</span><span class="n">has_perms</span><span class="p">((</span><span class="s1">&#39;app.add_student&#39;</span><span class="p">,</span> <span class="s1">&#39;app.can_deliver_pizzas&#39;</span><span class="p">))</span>
<span class="kc">True</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="s-authentication-in-web-requests">
<span id="s-auth-web-requests"></span><span id="authentication-in-web-requests"></span><span id="auth-web-requests"></span><h2>Authentification dans les requêtes Web<a class="headerlink" href="#authentication-in-web-requests" title="Lien permanent vers ce titre">¶</a></h2>
<p>Django utilise les <a class="reference internal" href="../http/sessions.html"><span class="doc">sessions</span></a> et le système de middleware pour brancher le système d’authentification dans les <a class="reference internal" href="../../ref/request-response.html#django.http.HttpRequest" title="django.http.HttpRequest"><code class="xref py py-class docutils literal notranslate"><span class="pre">objets</span> <span class="pre">requête</span></code></a>.</p>
<p>Un attribut <a class="reference internal" href="../../ref/request-response.html#django.http.HttpRequest.user" title="django.http.HttpRequest.user"><code class="xref py py-attr docutils literal notranslate"><span class="pre">request.user</span></code></a> représentant l’utilisateur actuel est défini sur chaque objet requête. Si cet utilisateur ne s’est pas connecté, cet attribut sera constitué d’une instance de <a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.AnonymousUser" title="django.contrib.auth.models.AnonymousUser"><code class="xref py py-class docutils literal notranslate"><span class="pre">AnonymousUser</span></code></a>, sinon il s’agira d’une instance de <a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User" title="django.contrib.auth.models.User"><code class="xref py py-class docutils literal notranslate"><span class="pre">User</span></code></a>.</p>
<p>Vous pouvez les différencier par la méthode <a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User.is_authenticated" title="django.contrib.auth.models.User.is_authenticated"><code class="xref py py-attr docutils literal notranslate"><span class="pre">is_authenticated</span></code></a>, comme ceci&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">:</span>
    <span class="c1"># Do something for authenticated users.</span>
    <span class="o">...</span>
<span class="k">else</span><span class="p">:</span>
    <span class="c1"># Do something for anonymous users.</span>
    <span class="o">...</span>
</pre></div>
</div>
<div class="section" id="s-how-to-log-a-user-in">
<span id="s-id2"></span><span id="how-to-log-a-user-in"></span><span id="id2"></span><h3>Connexion d’un utilisateur<a class="headerlink" href="#how-to-log-a-user-in" title="Lien permanent vers ce titre">¶</a></h3>
<p>Si vous disposez d’un utilisateur authentifié que vous voulez faire correspondre à la session en cours, utilisez la fonction <a class="reference internal" href="#django.contrib.auth.login" title="django.contrib.auth.login"><code class="xref py py-func docutils literal notranslate"><span class="pre">login()</span></code></a>.</p>
<dl class="function">
<dt id="django.contrib.auth.login">
<code class="descname">login</code>(<em>request</em>, <em>user</em>, <em>backend=None</em>)<a class="headerlink" href="#django.contrib.auth.login" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>Pour connecter un utilisateur à partir d’une vue, utilisez  <a class="reference internal" href="#django.contrib.auth.login" title="django.contrib.auth.login"><code class="xref py py-func docutils literal notranslate"><span class="pre">login()</span></code></a>. Cette fonction accepte un objet <a class="reference internal" href="../../ref/request-response.html#django.http.HttpRequest" title="django.http.HttpRequest"><code class="xref py py-class docutils literal notranslate"><span class="pre">HttpRequest</span></code></a> et un objet <a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User" title="django.contrib.auth.models.User"><code class="xref py py-class docutils literal notranslate"><span class="pre">User</span></code></a>. <a class="reference internal" href="#django.contrib.auth.login" title="django.contrib.auth.login"><code class="xref py py-func docutils literal notranslate"><span class="pre">login()</span></code></a> enregistre l’identifiant de l’utilisateur dans la session en employant l’infrastructure des sessions de Django.</p>
<p>Notez que toute information définie durant la session anonyme d’un utilisateur est conservée dans la session à la suite du processus de connexion.</p>
<p>Cet exemple montre comment utiliser à la fois <a class="reference internal" href="#django.contrib.auth.authenticate" title="django.contrib.auth.authenticate"><code class="xref py py-func docutils literal notranslate"><span class="pre">authenticate()</span></code></a> et <a class="reference internal" href="#django.contrib.auth.login" title="django.contrib.auth.login"><code class="xref py py-func docutils literal notranslate"><span class="pre">login()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="k">import</span> <span class="n">authenticate</span><span class="p">,</span> <span class="n">login</span>

<span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">username</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s1">&#39;username&#39;</span><span class="p">]</span>
    <span class="n">password</span> <span class="o">=</span> <span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">]</span>
    <span class="n">user</span> <span class="o">=</span> <span class="n">authenticate</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">username</span><span class="o">=</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="n">password</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">user</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">login</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">user</span><span class="p">)</span>
        <span class="c1"># Redirect to a success page.</span>
        <span class="o">...</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># Return an &#39;invalid login&#39; error message.</span>
        <span class="o">...</span>
</pre></div>
</div>
</dd></dl>

<div class="section" id="s-selecting-the-authentication-backend">
<span id="selecting-the-authentication-backend"></span><h4>Choix du moteur d’authentification<a class="headerlink" href="#selecting-the-authentication-backend" title="Lien permanent vers ce titre">¶</a></h4>
<p>Lorsqu’un utilisateur se connecte, son identifiant et le moteur utilisé pour son authentification sont enregistrés dans la session de l’utilisateur. Cela permet au même <a class="reference internal" href="customizing.html#authentication-backends"><span class="std std-ref">moteur d’authentification</span></a> de récupérer les détails de l’utilisateur lors d’une prochaine requête. Le moteur d’authentification qui sera enregistré dans la session est choisi comme ceci&nbsp;:</p>
<ol class="arabic simple">
<li>Si le paramètre <code class="docutils literal notranslate"><span class="pre">backend</span></code> factultatif est fourni, c’est celui-là qui est utilisé.</li>
<li>Si un attribut <code class="docutils literal notranslate"><span class="pre">user.backend</span></code> existe, c’est celui-là qui est utilisé. Cela permet de combiner <a class="reference internal" href="#django.contrib.auth.authenticate" title="django.contrib.auth.authenticate"><code class="xref py py-func docutils literal notranslate"><span class="pre">authenticate()</span></code></a> et <a class="reference internal" href="#django.contrib.auth.login" title="django.contrib.auth.login"><code class="xref py py-func docutils literal notranslate"><span class="pre">login()</span></code></a>: <a class="reference internal" href="#django.contrib.auth.authenticate" title="django.contrib.auth.authenticate"><code class="xref py py-func docutils literal notranslate"><span class="pre">authenticate()</span></code></a> définit l’attribut <code class="docutils literal notranslate"><span class="pre">user.backend</span></code> sur l’objet utilisateur qu’il renvoie.</li>
<li>S’il n’y a qu’un seul moteur dans <a class="reference internal" href="../../ref/settings.html#std:setting-AUTHENTICATION_BACKENDS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">AUTHENTICATION_BACKENDS</span></code></a>, c’est celui-là qui est utilisé.</li>
<li>Sinon, une exception est produite.</li>
</ol>
<p>Dans les deux premiers cas, la valeur du paramètre <code class="docutils literal notranslate"><span class="pre">backend</span></code> ou l’attribut <code class="docutils literal notranslate"><span class="pre">user.backend</span></code> doit correspondre à une chaîne de chemin pointé (comme la syntaxe dans <a class="reference internal" href="../../ref/settings.html#std:setting-AUTHENTICATION_BACKENDS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">AUTHENTICATION_BACKENDS</span></code></a>), et non pas la classe de moteur réelle.</p>
</div>
</div>
<div class="section" id="s-how-to-log-a-user-out">
<span id="how-to-log-a-user-out"></span><h3>Déconnexion d’un utilisateur<a class="headerlink" href="#how-to-log-a-user-out" title="Lien permanent vers ce titre">¶</a></h3>
<dl class="function">
<dt id="django.contrib.auth.logout">
<code class="descname">logout</code>(<em>request</em>)<a class="headerlink" href="#django.contrib.auth.logout" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>Pour déconnecter un utilisateur qui a été connecté par <a class="reference internal" href="#django.contrib.auth.login" title="django.contrib.auth.login"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.contrib.auth.login()</span></code></a>, utilisez <a class="reference internal" href="#django.contrib.auth.logout" title="django.contrib.auth.logout"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.contrib.auth.logout()</span></code></a> depuis la vue. Cette fonction accepte un objet <a class="reference internal" href="../../ref/request-response.html#django.http.HttpRequest" title="django.http.HttpRequest"><code class="xref py py-class docutils literal notranslate"><span class="pre">HttpRequest</span></code></a> et ne renvoie aucune valeur. Exemple&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="k">import</span> <span class="n">logout</span>

<span class="k">def</span> <span class="nf">logout_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">logout</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
    <span class="c1"># Redirect to a success page.</span>
</pre></div>
</div>
<p>Notez que <a class="reference internal" href="#django.contrib.auth.logout" title="django.contrib.auth.logout"><code class="xref py py-func docutils literal notranslate"><span class="pre">logout()</span></code></a> ne signale pas d’erreur si l’utilisateur n’était pas connecté.</p>
<p>Lorsque vous appelez <a class="reference internal" href="#django.contrib.auth.logout" title="django.contrib.auth.logout"><code class="xref py py-func docutils literal notranslate"><span class="pre">logout()</span></code></a>, les données de session de la requête en cours sont complètement effacées. Ce comportement empêche une autre personne d’utiliser le même navigateur Web pour se connecter et obtenir accès aux données de session de l’utilisateur précédent. Si vous souhaitez placer des informations dans la session qui doivent être disponibles pour l’utilisateur immédiatement après une déconnexion, faites-le <em>après</em> avoir appelé <a class="reference internal" href="#django.contrib.auth.logout" title="django.contrib.auth.logout"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.contrib.auth.logout()</span></code></a>.</p>
</dd></dl>

</div>
<div class="section" id="s-limiting-access-to-logged-in-users">
<span id="limiting-access-to-logged-in-users"></span><h3>Restriction d’accès aux utilisateurs connectés<a class="headerlink" href="#limiting-access-to-logged-in-users" title="Lien permanent vers ce titre">¶</a></h3>
<div class="section" id="s-the-raw-way">
<span id="the-raw-way"></span><h4>La manière brute<a class="headerlink" href="#the-raw-way" title="Lien permanent vers ce titre">¶</a></h4>
<p>La manière directe de limiter l’accès à certaines pages est de vérifier <a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User.is_authenticated" title="django.contrib.auth.models.User.is_authenticated"><code class="xref py py-attr docutils literal notranslate"><span class="pre">request.user.is_authenticated</span></code></a> et de rediriger l’utilisateur vers la page de connexion le cas échéant&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.conf</span> <span class="k">import</span> <span class="n">settings</span>
<span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="k">import</span> <span class="n">redirect</span>

<span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">?next=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">LOGIN_URL</span><span class="p">,</span> <span class="n">request</span><span class="o">.</span><span class="n">path</span><span class="p">))</span>
    <span class="c1"># ...</span>
</pre></div>
</div>
<p>…ou d’afficher un message d’erreur&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="k">import</span> <span class="n">render</span>

<span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">is_authenticated</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;myapp/login_error.html&#39;</span><span class="p">)</span>
    <span class="c1"># ...</span>
</pre></div>
</div>
</div>
<div class="section" id="s-the-login-required-decorator">
<span id="the-login-required-decorator"></span><h4>Le décorateur <code class="docutils literal notranslate"><span class="pre">login_required</span></code><a class="headerlink" href="#the-login-required-decorator" title="Lien permanent vers ce titre">¶</a></h4>
<dl class="function">
<dt id="django.contrib.auth.decorators.login_required">
<code class="descname">login_required</code>(<em>redirect_field_name='next'</em>, <em>login_url=None</em>)<a class="headerlink" href="#django.contrib.auth.decorators.login_required" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>Comme raccourci, vous pouvez utiliser le décorateur <a class="reference internal" href="#django.contrib.auth.decorators.login_required" title="django.contrib.auth.decorators.login_required"><code class="xref py py-func docutils literal notranslate"><span class="pre">login_required()</span></code></a> bien pratique&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.auth.decorators</span> <span class="k">import</span> <span class="n">login_required</span>

<span class="nd">@login_required</span>
<span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p><a class="reference internal" href="#django.contrib.auth.decorators.login_required" title="django.contrib.auth.decorators.login_required"><code class="xref py py-func docutils literal notranslate"><span class="pre">login_required()</span></code></a> effectue ceci&nbsp;:</p>
<ul class="simple">
<li>Si l’utilisateur n’est pas connecté, il redirige vers <a class="reference internal" href="../../ref/settings.html#std:setting-LOGIN_URL"><code class="xref std std-setting docutils literal notranslate"><span class="pre">settings.LOGIN_URL</span></code></a> en transmettant le chemin absolu dans la chaîne de requête. Exemple&nbsp;: <code class="docutils literal notranslate"><span class="pre">/accounts/login/?next=/polls/3/</span></code>.</li>
<li>Si l’utilisateur est connecté, il exécute la vue normalement. Le code de la vue peut légitimement considérer l’utilisateur comme connecté.</li>
</ul>
<p>Par défaut, le chemin vers lequel l’utilisateur doit être redirigé après un processus de connexion réussi est stocké dans le paramètre de chaîne de requête nommé <code class="docutils literal notranslate"><span class="pre">&quot;next&quot;</span></code>. Si vous préférez que ce paramètre soit nommé différemment, <a class="reference internal" href="#django.contrib.auth.decorators.login_required" title="django.contrib.auth.decorators.login_required"><code class="xref py py-func docutils literal notranslate"><span class="pre">login_required()</span></code></a> accepte un paramètre facultatif <code class="docutils literal notranslate"><span class="pre">redirect_field_name</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.auth.decorators</span> <span class="k">import</span> <span class="n">login_required</span>

<span class="nd">@login_required</span><span class="p">(</span><span class="n">redirect_field_name</span><span class="o">=</span><span class="s1">&#39;my_redirect_field&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>Notez que si vous indiquez une valeur pour <code class="docutils literal notranslate"><span class="pre">redirect_field_name</span></code>, il faudra très probablement aussi personnaliser le gabarit de connexion, dans la mesure où la variable de contexte du gabarit qui stocke le chemin de redirection utilise la valeur de <code class="docutils literal notranslate"><span class="pre">redirect_field_name</span></code> comme clé à la place de <code class="docutils literal notranslate"><span class="pre">&quot;next&quot;</span></code> (la valeur par défaut).</p>
<p><a class="reference internal" href="#django.contrib.auth.decorators.login_required" title="django.contrib.auth.decorators.login_required"><code class="xref py py-func docutils literal notranslate"><span class="pre">login_required()</span></code></a> accepte également un paramètre facultatif <code class="docutils literal notranslate"><span class="pre">login_url</span></code>. Exemple&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.auth.decorators</span> <span class="k">import</span> <span class="n">login_required</span>

<span class="nd">@login_required</span><span class="p">(</span><span class="n">login_url</span><span class="o">=</span><span class="s1">&#39;/accounts/login/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>Notez que si vous ne renseignez pas le paramètre <code class="docutils literal notranslate"><span class="pre">login_url</span></code>, vous devez vous assurer que le réglage <a class="reference internal" href="../../ref/settings.html#std:setting-LOGIN_URL"><code class="xref std std-setting docutils literal notranslate"><span class="pre">settings.LOGIN_URL</span></code></a> et votre vue de connexion sont correctement liés. Par exemple, en utilisant les paramètres par défaut, ajoutez les lignes suivantes dans votre configuration d’URL&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="k">import</span> <span class="n">views</span> <span class="k">as</span> <span class="n">auth_views</span>

<span class="n">path</span><span class="p">(</span><span class="s1">&#39;accounts/login/&#39;</span><span class="p">,</span> <span class="n">auth_views</span><span class="o">.</span><span class="n">LoginView</span><span class="o">.</span><span class="n">as_view</span><span class="p">()),</span>
</pre></div>
</div>
<p>Le réglage <a class="reference internal" href="../../ref/settings.html#std:setting-LOGIN_URL"><code class="xref std std-setting docutils literal notranslate"><span class="pre">settings.LOGIN_URL</span></code></a> accepte également des noms de fonction vue et des <a class="reference internal" href="../http/urls.html#naming-url-patterns"><span class="std std-ref">motifs d’URL nommés</span></a>. Cela permet de déplacer librement la vue de connexion dans la configuration d’URL sans avoir besoin de mettre à jour le réglage.</p>
</dd></dl>

<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Le décorateur <code class="docutils literal notranslate"><span class="pre">login_required</span></code> ne vérifie PAS le drapeau <code class="docutils literal notranslate"><span class="pre">is_active</span></code> d’un utilisateur, mais le moteur <a class="reference internal" href="../../ref/settings.html#std:setting-AUTHENTICATION_BACKENDS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">AUTHENTICATION_BACKENDS</span></code></a> par défaut rejette les utilisateurs inactifs.</p>
</div>
<div class="admonition seealso">
<p class="first admonition-title">Voir aussi</p>
<p class="last">Si vous écrivez des vues personnalisées pour le site d’administration de Django (ou que vous avez besoin des mêmes contrôles d’autorisation que les vues intégrées utilisent), le décorateur <a class="reference internal" href="../../ref/contrib/admin/index.html#django.contrib.admin.views.decorators.staff_member_required" title="django.contrib.admin.views.decorators.staff_member_required"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.contrib.admin.views.decorators.staff_member_required()</span></code></a> pourrait vous être encore plus utile que <code class="docutils literal notranslate"><span class="pre">login_required()</span></code>.</p>
</div>
</div>
<div class="section" id="s-the-loginrequired-mixin">
<span id="the-loginrequired-mixin"></span><h4>La classe mixin <code class="docutils literal notranslate"><span class="pre">LoginRequired</span></code><a class="headerlink" href="#the-loginrequired-mixin" title="Lien permanent vers ce titre">¶</a></h4>
<p>Lors de l’utilisation des <a class="reference internal" href="../class-based-views/index.html"><span class="doc">vues fondées sur les classes</span></a>, vous pouvez obtenir le même comportement qu’avec <code class="docutils literal notranslate"><span class="pre">login_required</span></code> en utilisant <code class="docutils literal notranslate"><span class="pre">LoginRequiredMixin</span></code>. Cette classe mixin doit se trouver à la position la plus à gauche de la chaîne d’héritage.</p>
<dl class="class">
<dt id="django.contrib.auth.mixins.LoginRequiredMixin">
<em class="property">class </em><code class="descname">LoginRequiredMixin</code><a class="headerlink" href="#django.contrib.auth.mixins.LoginRequiredMixin" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>Si une vue utilise cette classe mixin, toutes les requêtes par des utilisateurs non authentifiés seront redirigées vers la page de connexion ou traitées comme des erreurs HTTP 403 Forbidden, selon le paramètre <a class="reference internal" href="#django.contrib.auth.mixins.AccessMixin.raise_exception" title="django.contrib.auth.mixins.AccessMixin.raise_exception"><code class="xref py py-attr docutils literal notranslate"><span class="pre">raise_exception</span></code></a>.</p>
<p>Vous pouvez définir n’importe lequel des paramètres de <a class="reference internal" href="#django.contrib.auth.mixins.AccessMixin" title="django.contrib.auth.mixins.AccessMixin"><code class="xref py py-class docutils literal notranslate"><span class="pre">AccessMixin</span></code></a> pour personnaliser le traitement des utilisateurs non authentifiés&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.auth.mixins</span> <span class="k">import</span> <span class="n">LoginRequiredMixin</span>

<span class="k">class</span> <span class="nc">MyView</span><span class="p">(</span><span class="n">LoginRequiredMixin</span><span class="p">,</span> <span class="n">View</span><span class="p">):</span>
    <span class="n">login_url</span> <span class="o">=</span> <span class="s1">&#39;/login/&#39;</span>
    <span class="n">redirect_field_name</span> <span class="o">=</span> <span class="s1">&#39;redirect_to&#39;</span>
</pre></div>
</div>
</dd></dl>

<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Comme pour le décorateur <code class="docutils literal notranslate"><span class="pre">login_required</span></code>, cette classe mixin ne vérifie PAS le drapeau <code class="docutils literal notranslate"><span class="pre">is_active</span></code> d’un utilisateur, mais le moteur <a class="reference internal" href="../../ref/settings.html#std:setting-AUTHENTICATION_BACKENDS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">AUTHENTICATION_BACKENDS</span></code></a> par défaut rejette les utilisateurs inactifs.</p>
</div>
</div>
<div class="section" id="s-limiting-access-to-logged-in-users-that-pass-a-test">
<span id="limiting-access-to-logged-in-users-that-pass-a-test"></span><h4>Restriction d’accès aux utilisateurs connectés passant un test<a class="headerlink" href="#limiting-access-to-logged-in-users-that-pass-a-test" title="Lien permanent vers ce titre">¶</a></h4>
<p>Pour limiter l’accès en fonction d’une certaine permission ou d’un test quelconque, le procédé est presque identique à celui décrit dans la section précédente.</p>
<p>Vous pouvez effectuer le test sur <a class="reference internal" href="../../ref/request-response.html#django.http.HttpRequest.user" title="django.http.HttpRequest.user"><code class="xref py py-attr docutils literal notranslate"><span class="pre">request.user</span></code></a> directement dans la vue. Par exemple, cette vue vérifie que l’utilisateur possède bien une adresse électronique dans le domaine prévu et, dans le cas contraire, redirige vers la page de connexion&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.shortcuts</span> <span class="k">import</span> <span class="n">redirect</span>

<span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;@example.com&#39;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">redirect</span><span class="p">(</span><span class="s1">&#39;/login/?next=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">request</span><span class="o">.</span><span class="n">path</span><span class="p">)</span>
    <span class="c1"># ...</span>
</pre></div>
</div>
<dl class="function">
<dt id="django.contrib.auth.decorators.user_passes_test">
<code class="descname">user_passes_test</code>(<em>test_func</em>, <em>login_url=None</em>, <em>redirect_field_name='next'</em>)<a class="headerlink" href="#django.contrib.auth.decorators.user_passes_test" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>Comme raccourci, vous pouvez utiliser le décorateur <code class="docutils literal notranslate"><span class="pre">user_passes_test</span></code> qui procède à une redirection lorsque la fonction décorée renvoie <code class="docutils literal notranslate"><span class="pre">False</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.auth.decorators</span> <span class="k">import</span> <span class="n">user_passes_test</span>

<span class="k">def</span> <span class="nf">email_check</span><span class="p">(</span><span class="n">user</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;@example.com&#39;</span><span class="p">)</span>

<span class="nd">@user_passes_test</span><span class="p">(</span><span class="n">email_check</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p><a class="reference internal" href="#django.contrib.auth.decorators.user_passes_test" title="django.contrib.auth.decorators.user_passes_test"><code class="xref py py-func docutils literal notranslate"><span class="pre">user_passes_test()</span></code></a> requiert un paramètre&nbsp;: un exécutable acceptant un objet <a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User" title="django.contrib.auth.models.User"><code class="xref py py-class docutils literal notranslate"><span class="pre">User</span></code></a> et renvoyant <code class="docutils literal notranslate"><span class="pre">True</span></code> si l’utilisateur est autorisé à voir la page. Notez que  <a class="reference internal" href="#django.contrib.auth.decorators.user_passes_test" title="django.contrib.auth.decorators.user_passes_test"><code class="xref py py-func docutils literal notranslate"><span class="pre">user_passes_test()</span></code></a> ne contrôle pas d’office que l’objet <a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User" title="django.contrib.auth.models.User"><code class="xref py py-class docutils literal notranslate"><span class="pre">User</span></code></a> n’est pas anonyme.</p>
<p><a class="reference internal" href="#django.contrib.auth.decorators.user_passes_test" title="django.contrib.auth.decorators.user_passes_test"><code class="xref py py-func docutils literal notranslate"><span class="pre">user_passes_test()</span></code></a> accepte deux paramètres facultatifs&nbsp;:</p>
<dl class="docutils">
<dt><code class="docutils literal notranslate"><span class="pre">login_url</span></code></dt>
<dd>Permet d’indiquer l’URL vers laquelle les utilisateurs ne passant pas le test seront redirigés. Cela peut être une page de connexion, la valeur par défaut étant <a class="reference internal" href="../../ref/settings.html#std:setting-LOGIN_URL"><code class="xref std std-setting docutils literal notranslate"><span class="pre">settings.LOGIN_URL</span></code></a>.</dd>
<dt><code class="docutils literal notranslate"><span class="pre">redirect_field_name</span></code></dt>
<dd>Comme pour <a class="reference internal" href="#django.contrib.auth.decorators.login_required" title="django.contrib.auth.decorators.login_required"><code class="xref py py-func docutils literal notranslate"><span class="pre">login_required()</span></code></a>. Si vous définissez ce paramètre à <code class="docutils literal notranslate"><span class="pre">None</span></code>, il ne sera pas présent dans l’URL, ce qui peut être intéressant si vous redirigez des utilisateurs qui ne passent pas le test vers une page ne servant pas à se connecter et où il n’y a pas de concept de «&nbsp;page suivante&nbsp;».</dd>
</dl>
<p>Par exemple&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nd">@user_passes_test</span><span class="p">(</span><span class="n">email_check</span><span class="p">,</span> <span class="n">login_url</span><span class="o">=</span><span class="s1">&#39;/login/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
</dd></dl>

<dl class="class">
<dt id="django.contrib.auth.mixins.UserPassesTestMixin">
<em class="property">class </em><code class="descname">UserPassesTestMixin</code><a class="headerlink" href="#django.contrib.auth.mixins.UserPassesTestMixin" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>Quand on utilise les <a class="reference internal" href="../class-based-views/index.html"><span class="doc">vues fondées sur les classes</span></a>, on peut utiliser la classe <code class="docutils literal notranslate"><span class="pre">UserPassesTestMixin</span></code> pour faire cela.</p>
<dl class="method">
<dt id="django.contrib.auth.mixins.UserPassesTestMixin.test_func">
<code class="descname">test_func</code>()<a class="headerlink" href="#django.contrib.auth.mixins.UserPassesTestMixin.test_func" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>Vous devez surcharger la méthode <code class="docutils literal notranslate"><span class="pre">test_func()</span></code> de la classe pour fournir le test qui sera effectué. De plus, vous pouvez définir n’importe lequel des paramètres de <a class="reference internal" href="#django.contrib.auth.mixins.AccessMixin" title="django.contrib.auth.mixins.AccessMixin"><code class="xref py py-class docutils literal notranslate"><span class="pre">AccessMixin</span></code></a> pour personnaliser le traitement des utilisateurs non authentifiés&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.auth.mixins</span> <span class="k">import</span> <span class="n">UserPassesTestMixin</span>

<span class="k">class</span> <span class="nc">MyView</span><span class="p">(</span><span class="n">UserPassesTestMixin</span><span class="p">,</span> <span class="n">View</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">test_func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;@example.com&#39;</span><span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<dl class="method">
<dt id="django.contrib.auth.mixins.UserPassesTestMixin.get_test_func">
<code class="descname">get_test_func</code>()<a class="headerlink" href="#django.contrib.auth.mixins.UserPassesTestMixin.get_test_func" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>Vous pouvez aussi surcharger la méthode <code class="docutils literal notranslate"><span class="pre">get_test_func()</span></code> si vous souhaitez que la classe mixin utilise une autre méthode pour cette vérification (au lieu de <a class="reference internal" href="#django.contrib.auth.mixins.UserPassesTestMixin.test_func" title="django.contrib.auth.mixins.UserPassesTestMixin.test_func"><code class="xref py py-meth docutils literal notranslate"><span class="pre">test_func()</span></code></a>).</p>
</dd></dl>

<div class="admonition-stacking-userpassestestmixin admonition">
<p class="first admonition-title">Accumulation de <code class="docutils literal notranslate"><span class="pre">UserPassesTestMixin</span></code></p>
<p>En raison de l’implémentation de <code class="docutils literal notranslate"><span class="pre">UserPassesTestMixin</span></code>, il n’est pas possible d’en combiner plusieurs dans la chaîne d’héritage. Le code suivant ne fonctionnera PAS&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TestMixin1</span><span class="p">(</span><span class="n">UserPassesTestMixin</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">email</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;@example.com&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">TestMixin2</span><span class="p">(</span><span class="n">UserPassesTestMixin</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">test_func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;django&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">MyView</span><span class="p">(</span><span class="n">TestMixin1</span><span class="p">,</span> <span class="n">TestMixin2</span><span class="p">,</span> <span class="n">View</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p class="last">Si <code class="docutils literal notranslate"><span class="pre">TestMixin1</span></code> appelait <code class="docutils literal notranslate"><span class="pre">super()</span></code> et prenait en compte le résultat, <code class="docutils literal notranslate"><span class="pre">TestMixin1</span></code> ne fonctionnerait plus de façon autonome.</p>
</div>
</dd></dl>

</div>
<div class="section" id="s-the-permission-required-decorator">
<span id="the-permission-required-decorator"></span><h4>Le décorateur <code class="docutils literal notranslate"><span class="pre">permission_required</span></code><a class="headerlink" href="#the-permission-required-decorator" title="Lien permanent vers ce titre">¶</a></h4>
<dl class="function">
<dt id="django.contrib.auth.decorators.permission_required">
<code class="descname">permission_required</code>(<em>perm</em>, <em>login_url=None</em>, <em>raise_exception=False</em>)<a class="headerlink" href="#django.contrib.auth.decorators.permission_required" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>Il est relativement courant de devoir vérifier que l’utilisateur dispose d’une certaine permission. À cet effet, Django fournit un raccourci&nbsp;: le décorateur <a class="reference internal" href="#django.contrib.auth.decorators.permission_required" title="django.contrib.auth.decorators.permission_required"><code class="xref py py-func docutils literal notranslate"><span class="pre">permission_required()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.auth.decorators</span> <span class="k">import</span> <span class="n">permission_required</span>

<span class="nd">@permission_required</span><span class="p">(</span><span class="s1">&#39;polls.add_choice&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>Comme pour la méthode <a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User.has_perm" title="django.contrib.auth.models.User.has_perm"><code class="xref py py-meth docutils literal notranslate"><span class="pre">has_perm()</span></code></a>, les noms de permission ont la forme <code class="docutils literal notranslate"><span class="pre">&quot;&lt;étiquette</span> <span class="pre">application&gt;.&lt;code</span> <span class="pre">permission&gt;&quot;</span></code> (par ex. <code class="docutils literal notranslate"><span class="pre">polls.add_choice</span></code> pour une permission d’un modèle de l’application <code class="docutils literal notranslate"><span class="pre">polls</span></code>).</p>
<p>Le décorateur accepte aussi une liste de permissions, auquel cas l’utilisateur doit posséder toutes les permissions de la liste afin d’avoir accès à la vue.</p>
<p>Notez que <a class="reference internal" href="#django.contrib.auth.decorators.permission_required" title="django.contrib.auth.decorators.permission_required"><code class="xref py py-func docutils literal notranslate"><span class="pre">permission_required()</span></code></a> accepte également un paramètre facultatif <code class="docutils literal notranslate"><span class="pre">login_url</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.auth.decorators</span> <span class="k">import</span> <span class="n">permission_required</span>

<span class="nd">@permission_required</span><span class="p">(</span><span class="s1">&#39;polls.add_choice&#39;</span><span class="p">,</span> <span class="n">login_url</span><span class="o">=</span><span class="s1">&#39;/loginpage/&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>Comme pour le décorateur <a class="reference internal" href="#django.contrib.auth.decorators.login_required" title="django.contrib.auth.decorators.login_required"><code class="xref py py-func docutils literal notranslate"><span class="pre">login_required()</span></code></a>, la valeur par défaut de <code class="docutils literal notranslate"><span class="pre">login_url</span></code> est <a class="reference internal" href="../../ref/settings.html#std:setting-LOGIN_URL"><code class="xref std std-setting docutils literal notranslate"><span class="pre">settings.LOGIN_URL</span></code></a>.</p>
<p>Si le paramètre <code class="docutils literal notranslate"><span class="pre">raise_exception</span></code> est présent, le décorateur génère une exception <a class="reference internal" href="../../ref/exceptions.html#django.core.exceptions.PermissionDenied" title="django.core.exceptions.PermissionDenied"><code class="xref py py-exc docutils literal notranslate"><span class="pre">PermissionDenied</span></code></a> (permission refusée), déclenchant la  <a class="reference internal" href="../../ref/views.html#http-forbidden-view"><span class="std std-ref">vue 403 (HTTP Forbidden)</span></a> au lieu de rediriger vers la page de connexion.</p>
<p>Si vous souhaitez utiliser <code class="docutils literal notranslate"><span class="pre">raise_exception</span></code> tout en laissant aux utilisateurs une chance de se connecter, vous pouvez ajouter le décorateur <a class="reference internal" href="#django.contrib.auth.decorators.login_required" title="django.contrib.auth.decorators.login_required"><code class="xref py py-func docutils literal notranslate"><span class="pre">login_required()</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.auth.decorators</span> <span class="k">import</span> <span class="n">login_required</span><span class="p">,</span> <span class="n">permission_required</span>

<span class="nd">@login_required</span>
<span class="nd">@permission_required</span><span class="p">(</span><span class="s1">&#39;polls.add_choice&#39;</span><span class="p">,</span> <span class="n">raise_exception</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="o">...</span>
</pre></div>
</div>
<p>Ceci évite aussi une boucle de redirection lorsque <code class="docutils literal notranslate"><span class="pre">redirect_authenticated_user=True</span></code> dans <a class="reference internal" href="#django.contrib.auth.views.LoginView" title="django.contrib.auth.views.LoginView"><code class="xref py py-class docutils literal notranslate"><span class="pre">LoginView</span></code></a> et que l’utilisateur connecté ne possède pas toutes les permissions requises.</p>
</dd></dl>

</div>
<div class="section" id="s-the-permissionrequiredmixin-mixin">
<span id="the-permissionrequiredmixin-mixin"></span><h4>La classe mixin <code class="docutils literal notranslate"><span class="pre">PermissionRequiredMixin</span></code><a class="headerlink" href="#the-permissionrequiredmixin-mixin" title="Lien permanent vers ce titre">¶</a></h4>
<p>Pour appliquer des contrôles de permission aux <a class="reference internal" href="../../ref/class-based-views/index.html"><span class="doc">vues fondées sur les classes</span></a>, vous pouvez utiliser la classe <code class="docutils literal notranslate"><span class="pre">PermissionRequiredMixin</span></code>:</p>
<dl class="class">
<dt id="django.contrib.auth.mixins.PermissionRequiredMixin">
<em class="property">class </em><code class="descname">PermissionRequiredMixin</code><a class="headerlink" href="#django.contrib.auth.mixins.PermissionRequiredMixin" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>Cette classe mixin, tout comme le décorateur <code class="docutils literal notranslate"><span class="pre">permission_required</span></code>, contrôle si l’utilisateur accédant à une vue possède toutes les permissions indiquées. La permission (ou une itération de permissions) doit être indiquée dans le paramètre <code class="docutils literal notranslate"><span class="pre">permission_required</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.auth.mixins</span> <span class="k">import</span> <span class="n">PermissionRequiredMixin</span>

<span class="k">class</span> <span class="nc">MyView</span><span class="p">(</span><span class="n">PermissionRequiredMixin</span><span class="p">,</span> <span class="n">View</span><span class="p">):</span>
    <span class="n">permission_required</span> <span class="o">=</span> <span class="s1">&#39;polls.add_choice&#39;</span>
    <span class="c1"># Or multiple of permissions:</span>
    <span class="n">permission_required</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;polls.view_choice&#39;</span><span class="p">,</span> <span class="s1">&#39;polls.change_choice&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Vous pouvez définir n’importe lequel des paramètres de <a class="reference internal" href="#django.contrib.auth.mixins.AccessMixin" title="django.contrib.auth.mixins.AccessMixin"><code class="xref py py-class docutils literal notranslate"><span class="pre">AccessMixin</span></code></a> pour personnaliser le traitement des utilisateurs non authentifiés.</p>
<p>Vous pouvez également surcharger ces méthodes&nbsp;:</p>
<dl class="method">
<dt id="django.contrib.auth.mixins.PermissionRequiredMixin.get_permission_required">
<code class="descname">get_permission_required</code>()<a class="headerlink" href="#django.contrib.auth.mixins.PermissionRequiredMixin.get_permission_required" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>Renvoie une itération de noms de permissions utilisés par la classe mixin. Il s’agit par défaut du contenu de l’attribut <code class="docutils literal notranslate"><span class="pre">permission_required</span></code>, converti en tuple si nécessaire.</p>
</dd></dl>

<dl class="method">
<dt id="django.contrib.auth.mixins.PermissionRequiredMixin.has_permission">
<code class="descname">has_permission</code>()<a class="headerlink" href="#django.contrib.auth.mixins.PermissionRequiredMixin.has_permission" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>Renvoie une valeur booléenne indiquant si l’utilisateur actuel a la permission d’exécuter la vue décorée. Par défaut, ceci renvoie le résultat de l’appel à <a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User.has_perms" title="django.contrib.auth.models.User.has_perms"><code class="xref py py-meth docutils literal notranslate"><span class="pre">has_perms()</span></code></a> avec la liste des permissions renvoyées par <a class="reference internal" href="#django.contrib.auth.mixins.PermissionRequiredMixin.get_permission_required" title="django.contrib.auth.mixins.PermissionRequiredMixin.get_permission_required"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_permission_required()</span></code></a>.</p>
</dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="s-redirecting-unauthorized-requests-in-class-based-views">
<span id="redirecting-unauthorized-requests-in-class-based-views"></span><h3>Redirection des requêtes non autorisées dans les vues fondées sur les classes<a class="headerlink" href="#redirecting-unauthorized-requests-in-class-based-views" title="Lien permanent vers ce titre">¶</a></h3>
<p>Pour faciliter la gestion des restrictions d’accès dans les <a class="reference internal" href="../../ref/class-based-views/index.html"><span class="doc">vues fondées sur les classes</span></a>, la classe <code class="docutils literal notranslate"><span class="pre">AccessMixin</span></code> peut être utilisée pour configurer le comportement d’une vue lorsque son accès est refusé. Les utilisateurs authentifiés reçoivent une réponse HTTP 403 Forbidden. Les utilisateurs anonymes sont redirigés vers la page de connexion ou reçoivent une réponse HTTP 403, en fonction de l’attribut <a class="reference internal" href="#django.contrib.auth.mixins.AccessMixin.raise_exception" title="django.contrib.auth.mixins.AccessMixin.raise_exception"><code class="xref py py-attr docutils literal notranslate"><span class="pre">raise_exception</span></code></a>.</p>
<dl class="class">
<dt id="django.contrib.auth.mixins.AccessMixin">
<em class="property">class </em><code class="descname">AccessMixin</code><a class="headerlink" href="#django.contrib.auth.mixins.AccessMixin" title="Lien permanent vers cette définition">¶</a></dt>
<dd><dl class="attribute">
<dt id="django.contrib.auth.mixins.AccessMixin.login_url">
<code class="descname">login_url</code><a class="headerlink" href="#django.contrib.auth.mixins.AccessMixin.login_url" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>Valeur de renvoi par défaut de <a class="reference internal" href="#django.contrib.auth.mixins.AccessMixin.get_login_url" title="django.contrib.auth.mixins.AccessMixin.get_login_url"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_login_url()</span></code></a>. Contient <code class="docutils literal notranslate"><span class="pre">None</span></code> par défaut auquel cas <a class="reference internal" href="#django.contrib.auth.mixins.AccessMixin.get_login_url" title="django.contrib.auth.mixins.AccessMixin.get_login_url"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_login_url()</span></code></a> se rabat sur le contenu de <a class="reference internal" href="../../ref/settings.html#std:setting-LOGIN_URL"><code class="xref std std-setting docutils literal notranslate"><span class="pre">settings.LOGIN_URL</span></code></a>.</p>
</dd></dl>

<dl class="attribute">
<dt id="django.contrib.auth.mixins.AccessMixin.permission_denied_message">
<code class="descname">permission_denied_message</code><a class="headerlink" href="#django.contrib.auth.mixins.AccessMixin.permission_denied_message" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>Valeur de renvoi par défaut de <a class="reference internal" href="#django.contrib.auth.mixins.AccessMixin.get_permission_denied_message" title="django.contrib.auth.mixins.AccessMixin.get_permission_denied_message"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_permission_denied_message()</span></code></a>. Contient une chaîne vide par défaut.</p>
</dd></dl>

<dl class="attribute">
<dt id="django.contrib.auth.mixins.AccessMixin.redirect_field_name">
<code class="descname">redirect_field_name</code><a class="headerlink" href="#django.contrib.auth.mixins.AccessMixin.redirect_field_name" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>Valeur de renvoi par défaut de <a class="reference internal" href="#django.contrib.auth.mixins.AccessMixin.get_redirect_field_name" title="django.contrib.auth.mixins.AccessMixin.get_redirect_field_name"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_redirect_field_name()</span></code></a>. Contient <code class="docutils literal notranslate"><span class="pre">&quot;next&quot;</span></code> par défaut.</p>
</dd></dl>

<dl class="attribute">
<dt id="django.contrib.auth.mixins.AccessMixin.raise_exception">
<code class="descname">raise_exception</code><a class="headerlink" href="#django.contrib.auth.mixins.AccessMixin.raise_exception" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>Si cet attribut est défini à <code class="docutils literal notranslate"><span class="pre">True</span></code>, une exception <a class="reference internal" href="../../ref/exceptions.html#django.core.exceptions.PermissionDenied" title="django.core.exceptions.PermissionDenied"><code class="xref py py-class docutils literal notranslate"><span class="pre">PermissionDenied</span></code></a> est produite lorsque les conditions ne sont pas remplies. Si la valeur est <code class="docutils literal notranslate"><span class="pre">False</span></code> (par défaut), les utilisateurs anonymes sont redirigés vers la page de connexion.</p>
</dd></dl>

<dl class="method">
<dt id="django.contrib.auth.mixins.AccessMixin.get_login_url">
<code class="descname">get_login_url</code>()<a class="headerlink" href="#django.contrib.auth.mixins.AccessMixin.get_login_url" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>Renvoie l’URL vers laquelle les utilisateurs ne passant pas le test seront redirigés. Renvoie <a class="reference internal" href="#django.contrib.auth.mixins.AccessMixin.login_url" title="django.contrib.auth.mixins.AccessMixin.login_url"><code class="xref py py-attr docutils literal notranslate"><span class="pre">login_url</span></code></a> le cas échéant, sinon <a class="reference internal" href="../../ref/settings.html#std:setting-LOGIN_URL"><code class="xref std std-setting docutils literal notranslate"><span class="pre">settings.LOGIN_URL</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="django.contrib.auth.mixins.AccessMixin.get_permission_denied_message">
<code class="descname">get_permission_denied_message</code>()<a class="headerlink" href="#django.contrib.auth.mixins.AccessMixin.get_permission_denied_message" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>Lorsque <a class="reference internal" href="#django.contrib.auth.mixins.AccessMixin.raise_exception" title="django.contrib.auth.mixins.AccessMixin.raise_exception"><code class="xref py py-attr docutils literal notranslate"><span class="pre">raise_exception</span></code></a> vaut <code class="docutils literal notranslate"><span class="pre">True</span></code>, cette méthode peut être utilisée pour contrôler le message d’erreur transmis au gestionnaire d’erreur pour y être affiché à destination de l’utilisateur. Par défaut, renvoie l’attribut <a class="reference internal" href="#django.contrib.auth.mixins.AccessMixin.permission_denied_message" title="django.contrib.auth.mixins.AccessMixin.permission_denied_message"><code class="xref py py-attr docutils literal notranslate"><span class="pre">permission_denied_message</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="django.contrib.auth.mixins.AccessMixin.get_redirect_field_name">
<code class="descname">get_redirect_field_name</code>()<a class="headerlink" href="#django.contrib.auth.mixins.AccessMixin.get_redirect_field_name" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>Renvoie le nom du paramètre de requête qui contiendra l’URL vers laquelle l’utilisateur sera redirigé à la suite d’une connexion réussie. Si cette valeur est <code class="docutils literal notranslate"><span class="pre">None</span></code>, aucun paramètre de requête ne sera ajouté. Renvoie par défaut l’attribut <a class="reference internal" href="#django.contrib.auth.mixins.AccessMixin.redirect_field_name" title="django.contrib.auth.mixins.AccessMixin.redirect_field_name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">redirect_field_name</span></code></a>.</p>
</dd></dl>

<dl class="method">
<dt id="django.contrib.auth.mixins.AccessMixin.handle_no_permission">
<code class="descname">handle_no_permission</code>()<a class="headerlink" href="#django.contrib.auth.mixins.AccessMixin.handle_no_permission" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>En fonction de la valeur de <code class="docutils literal notranslate"><span class="pre">raise_exception</span></code>, cette méthode peut soit générer une exception <a class="reference internal" href="../../ref/exceptions.html#django.core.exceptions.PermissionDenied" title="django.core.exceptions.PermissionDenied"><code class="xref py py-exc docutils literal notranslate"><span class="pre">PermissionDenied</span></code></a>, soit rediriger l’utilisateur vers <code class="docutils literal notranslate"><span class="pre">login_url</span></code>, incluant potentiellement <code class="docutils literal notranslate"><span class="pre">redirect_field_name</span></code> si celui-ci est défini.</p>
</dd></dl>

</dd></dl>

<div class="section" id="s-session-invalidation-on-password-change">
<span id="s-id3"></span><span id="session-invalidation-on-password-change"></span><span id="id3"></span><h4>Invalidation de session lors du changement de mot de passe<a class="headerlink" href="#session-invalidation-on-password-change" title="Lien permanent vers ce titre">¶</a></h4>
<p>Si votre <a class="reference internal" href="../../ref/settings.html#std:setting-AUTH_USER_MODEL"><code class="xref std std-setting docutils literal notranslate"><span class="pre">AUTH_USER_MODEL</span></code></a> hérite de <a class="reference internal" href="customizing.html#django.contrib.auth.models.AbstractBaseUser" title="django.contrib.auth.models.AbstractBaseUser"><code class="xref py py-class docutils literal notranslate"><span class="pre">AbstractBaseUser</span></code></a> ou implémente sa propre méthode <a class="reference internal" href="customizing.html#django.contrib.auth.models.AbstractBaseUser.get_session_auth_hash" title="django.contrib.auth.models.AbstractBaseUser.get_session_auth_hash"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_session_auth_hash()</span></code></a>,  les sessions authentifiées comprendront la valeur de hachage renvoyée par cette fonction. Dans le cas d’un <a class="reference internal" href="customizing.html#django.contrib.auth.models.AbstractBaseUser" title="django.contrib.auth.models.AbstractBaseUser"><code class="xref py py-class docutils literal notranslate"><span class="pre">AbstractBaseUser</span></code></a>, il s’agit d’une empreinte HMAC du champ de mot de passe. Django vérifie que la valeur de hachage dans la session de chaque requête correspond à celle qui est calculée durant la requête. Cela permet à un utilisateur de se déconnecter de l’ensemble de ses sessions en changeant son mot de passe.</p>
<p>Les vues fournies par défaut avec Django pour le changement de mot de passe, <a class="reference internal" href="#django.contrib.auth.views.PasswordChangeView" title="django.contrib.auth.views.PasswordChangeView"><code class="xref py py-class docutils literal notranslate"><span class="pre">PasswordChangeView</span></code></a> et <code class="docutils literal notranslate"><span class="pre">user_change_password</span></code> du module <a class="reference internal" href="index.html#module-django.contrib.auth" title="django.contrib.auth: Django's authentication framework."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.auth</span></code></a>, mettent à jour la session avec la valeur de hachage du nouveau mot de passe pour que l’utilisateur qui change son mot de passe ne soit pas déconnecté. Si vous avez une vue personnalisée pour le changement de mot de passe et que vous souhaitez avoir un comportement similaire, utilisez la fonction <a class="reference internal" href="#django.contrib.auth.update_session_auth_hash" title="django.contrib.auth.update_session_auth_hash"><code class="xref py py-func docutils literal notranslate"><span class="pre">update_session_auth_hash()</span></code></a>.</p>
<dl class="function">
<dt id="django.contrib.auth.update_session_auth_hash">
<code class="descname">update_session_auth_hash</code>(<em>request</em>, <em>user</em>)<a class="headerlink" href="#django.contrib.auth.update_session_auth_hash" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>Cette fonction accepte en entrée la requête actuelle ainsi que l’objet utilisateur mis à jour et à partir duquel la nouvelle valeur de hachage de la session sera calculée&nbsp;; elle met à jour la valeur de hachage de la session. Elle se charge aussi d’alterner la clé de session afin qu’un cookie de session volé soit invalidé&nbsp;:</p>
<p>Exemple d’utilisation&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="k">import</span> <span class="n">update_session_auth_hash</span>

<span class="k">def</span> <span class="nf">password_change</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;POST&#39;</span><span class="p">:</span>
        <span class="n">form</span> <span class="o">=</span> <span class="n">PasswordChangeForm</span><span class="p">(</span><span class="n">user</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">user</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">request</span><span class="o">.</span><span class="n">POST</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">form</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
            <span class="n">form</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
            <span class="n">update_session_auth_hash</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">form</span><span class="o">.</span><span class="n">user</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="o">...</span>
</pre></div>
</div>
</dd></dl>

<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Comme <a class="reference internal" href="customizing.html#django.contrib.auth.models.AbstractBaseUser.get_session_auth_hash" title="django.contrib.auth.models.AbstractBaseUser.get_session_auth_hash"><code class="xref py py-meth docutils literal notranslate"><span class="pre">get_session_auth_hash()</span></code></a> se base sur <a class="reference internal" href="../../ref/settings.html#std:setting-SECRET_KEY"><code class="xref std std-setting docutils literal notranslate"><span class="pre">SECRET_KEY</span></code></a>, la mise à jour de la clé secrète sur votre site invalide toutes les sessions existantes.</p>
</div>
</div>
</div>
<div class="section" id="s-module-django.contrib.auth.views">
<span id="s-authentication-views"></span><span id="s-built-in-auth-views"></span><span id="module-django.contrib.auth.views"></span><span id="authentication-views"></span><span id="built-in-auth-views"></span><h3>Vues d’authentification<a class="headerlink" href="#module-django.contrib.auth.views" title="Lien permanent vers ce titre">¶</a></h3>
<p>Django fournit plusieurs vues permettant de gérer la connexion, la déconnexion et le traitement des mots de passe. Elles font appel aux <a class="reference internal" href="#built-in-auth-forms"><span class="std std-ref">formulaires d’authentification intégrés</span></a>, mais vous pouvez leur transmettre aussi vos propres formulaires.</p>
<p>Django fournit pas de gabarit par défaut pour les vues d’authentification. Vous devez créer vos propres gabarits pour les vues que vous souhaitez utiliser. Le contexte de gabarit est documenté dans chaque vue, voir <a class="reference internal" href="#all-authentication-views"><span class="std std-ref">Toutes les vues d’authentification</span></a>.</p>
<div class="section" id="s-using-the-views">
<span id="s-id4"></span><span id="using-the-views"></span><span id="id4"></span><h4>Utilisation des vues<a class="headerlink" href="#using-the-views" title="Lien permanent vers ce titre">¶</a></h4>
<p>Il existe différentes méthodes pour mettre en œuvre ces vues dans votre projet. Le plus simple est d’inclure l’URLconf de <code class="docutils literal notranslate"><span class="pre">django.contrib.auth.urls</span></code> dans votre propre URLconf, par exemple</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;accounts/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s1">&#39;django.contrib.auth.urls&#39;</span><span class="p">)),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Cela comprendra les modèles d’URL suivants</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">accounts</span><span class="o">/</span><span class="n">login</span><span class="o">/</span> <span class="p">[</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;login&#39;</span><span class="p">]</span>
<span class="n">accounts</span><span class="o">/</span><span class="n">logout</span><span class="o">/</span> <span class="p">[</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;logout&#39;</span><span class="p">]</span>
<span class="n">accounts</span><span class="o">/</span><span class="n">password_change</span><span class="o">/</span> <span class="p">[</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;password_change&#39;</span><span class="p">]</span>
<span class="n">accounts</span><span class="o">/</span><span class="n">password_change</span><span class="o">/</span><span class="n">done</span><span class="o">/</span> <span class="p">[</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;password_change_done&#39;</span><span class="p">]</span>
<span class="n">accounts</span><span class="o">/</span><span class="n">password_reset</span><span class="o">/</span> <span class="p">[</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;password_reset&#39;</span><span class="p">]</span>
<span class="n">accounts</span><span class="o">/</span><span class="n">password_reset</span><span class="o">/</span><span class="n">done</span><span class="o">/</span> <span class="p">[</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;password_reset_done&#39;</span><span class="p">]</span>
<span class="n">accounts</span><span class="o">/</span><span class="n">reset</span><span class="o">/&lt;</span><span class="n">uidb64</span><span class="o">&gt;/&lt;</span><span class="n">token</span><span class="o">&gt;/</span> <span class="p">[</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;password_reset_confirm&#39;</span><span class="p">]</span>
<span class="n">accounts</span><span class="o">/</span><span class="n">reset</span><span class="o">/</span><span class="n">done</span><span class="o">/</span> <span class="p">[</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;password_reset_complete&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Les vues possèdent un nom d’URL pour les référencer plus facilement. Voir <a class="reference internal" href="../http/urls.html"><span class="doc">la documentation des URL</span></a> pour plus de détails sur l’utilisation de modèles d’URL nommés.</p>
<p>Si vous voulez plus de contrôle sur vos URL, vous pouvez référencer une vue spécifique dans votre URLconf</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.auth</span> <span class="k">import</span> <span class="n">views</span> <span class="k">as</span> <span class="n">auth_views</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;change-password/&#39;</span><span class="p">,</span> <span class="n">auth_views</span><span class="o">.</span><span class="n">PasswordChangeView</span><span class="o">.</span><span class="n">as_view</span><span class="p">()),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Les vues ont des paramètres optionnels que vous pouvez utiliser pour modifier le comportement de la vue. Par exemple, si vous voulez changer le nom du modèle utilisé par une vue, vous pouvez fournir le paramètre <code class="docutils literal notranslate"><span class="pre">template_name</span></code>. Une façon de le faire est de fournir des paramètres mot-clé dans l’URLconf, ceux-ci seront transmis à la vue. Par exemple</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span>
        <span class="s1">&#39;change-password/&#39;</span><span class="p">,</span>
        <span class="n">auth_views</span><span class="o">.</span><span class="n">PasswordChangeView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="n">template_name</span><span class="o">=</span><span class="s1">&#39;change-password.html&#39;</span><span class="p">),</span>
    <span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Toutes les vues sont <a class="reference internal" href="../class-based-views/index.html"><span class="doc">basées sur des classes</span></a> ce qui permet de les personnaliser facilement par héritage.</p>
</div>
<div class="section" id="s-all-authentication-views">
<span id="s-id5"></span><span id="all-authentication-views"></span><span id="id5"></span><h4>Toutes les vues d’authentification<a class="headerlink" href="#all-authentication-views" title="Lien permanent vers ce titre">¶</a></h4>
<p>Ceci est une liste de toutes les vues fournies par <code class="docutils literal notranslate"><span class="pre">django.contrib.auth</span></code>. Pour les détails de l’implémentation, voir <a class="reference internal" href="#using-the-views"><span class="std std-ref">Utilisation des vues</span></a>.</p>
<dl class="class">
<dt id="django.contrib.auth.views.LoginView">
<em class="property">class </em><code class="descname">LoginView</code><a class="headerlink" href="#django.contrib.auth.views.LoginView" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p><strong>Nom d’URL&nbsp;:</strong> <code class="docutils literal notranslate"><span class="pre">login</span></code></p>
<p>Consultez la <a class="reference internal" href="../http/urls.html"><span class="doc">documentation sur les URL</span></a> pour plus de détails sur l’utilisation des motifs d’URL nommés.</p>
<p><strong>Attributs&nbsp;:</strong></p>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">template_name</span></code>: le nom d’un gabarit pour afficher le résultat de la vue de connexion d’un utilisateur. Sa valeur par défaut est <code class="file docutils literal notranslate"><span class="pre">registration/login.html</span></code>.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">redirect_field_name</span></code>: le nom d’un champ <code class="docutils literal notranslate"><span class="pre">GET</span></code> contenant l’URL vers laquelle rediriger après la connexion. Sa valeur par défaut est <code class="docutils literal notranslate"><span class="pre">next</span></code>.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">authentication_form</span></code>: un exécutable (typiquement une classe de formulaire) à utiliser pour l’authentification. Sa valeur par défaut est <a class="reference internal" href="#django.contrib.auth.forms.AuthenticationForm" title="django.contrib.auth.forms.AuthenticationForm"><code class="xref py py-class docutils literal notranslate"><span class="pre">AuthenticationForm</span></code></a>.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">extra_context</span></code>: un dictionnaire de données de contexte qui sera fusionné avec les données de contexte par défaut transmises au gabarit.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">redirect_authenticated_user</span></code>: une valeur booléenne indiquant si les utilisateurs authentifiés accédant à la page de connexion sont redirigés comme s’ils venaient de se connecter. La valeur par défaut est <code class="docutils literal notranslate"><span class="pre">False</span></code>.</p>
<div class="admonition warning">
<p class="first admonition-title">Avertissement</p>
<p>Si vous activez <code class="docutils literal notranslate"><span class="pre">redirect_authenticated_user</span></code>, d’autres sites Web seront capables de déterminer si leurs visiteurs sont authentifiés sur votre site en faisant des requêtes de redirection vers des fichiers images de votre site. Pour éviter cette divulgation d’information par «&nbsp;<a class="reference external" href="https://robinlinus.github.io/socialmedia-leak/">empreinte de médias sociaux</a>&nbsp;», servez toutes les images ainsi que la favicon depuis un domaine distinct.</p>
<p class="last">L’activation de <code class="docutils literal notranslate"><span class="pre">redirect_authenticated_user</span></code> peut aussi aboutir à une boucle de redirection lorsque le décorateur <a class="reference internal" href="#django.contrib.auth.decorators.permission_required" title="django.contrib.auth.decorators.permission_required"><code class="xref py py-func docutils literal notranslate"><span class="pre">permission_required()</span></code></a> est utilisé sans que le paramètre <code class="docutils literal notranslate"><span class="pre">raise_exception</span></code> ne soit indiqué.</p>
</div>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">success_url_allowed_hosts</span></code>: un ensemble <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#set" title="(disponible dans Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">set</span></code></a> d’hôtes, en plus de <a class="reference internal" href="../../ref/request-response.html#django.http.HttpRequest.get_host" title="django.http.HttpRequest.get_host"><code class="xref py py-meth docutils literal notranslate"><span class="pre">request.get_host()</span></code></a>, qui sont sûrs comme cible de redirection après la connexion. L’ensemble  <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#set" title="(disponible dans Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">set</span></code></a> est vide par défaut.</p>
</li>
</ul>
<p>Voici ce que fait <code class="docutils literal notranslate"><span class="pre">LoginView</span></code>:</p>
<ul class="simple">
<li>Quand elle est appelée par <code class="docutils literal notranslate"><span class="pre">GET</span></code>, elle affiche un formulaire de connexion dont la cible <code class="docutils literal notranslate"><span class="pre">POST</span></code> envoie vers la même URL. Plus d’infos à ce sujet dans un moment.</li>
<li>Quand elle est appelée par <code class="docutils literal notranslate"><span class="pre">POST</span></code> avec les données d’authentification d’un utilisateur, elle tente de connecter cet utilisateur. Si l’opération réussit, la vue redirige vers l’URL indiquée dans <code class="docutils literal notranslate"><span class="pre">next</span></code>. Si <code class="docutils literal notranslate"><span class="pre">next</span></code> est absent, elle redirige vers <a class="reference internal" href="../../ref/settings.html#std:setting-LOGIN_REDIRECT_URL"><code class="xref std std-setting docutils literal notranslate"><span class="pre">settings.LOGIN_REDIRECT_URL</span></code></a> (<code class="docutils literal notranslate"><span class="pre">/accounts/profile/</span></code> par défaut). Si la connexion échoue, la vue affiche à nouveau le formulaire de connexion.</li>
</ul>
<p>Il est de votre devoir de fournir le code HTML du gabarit de connexion, nommé <code class="docutils literal notranslate"><span class="pre">registration/login.html</span></code> par défaut. Ce gabarit reçoit quatre variables de contexte de gabarit&nbsp;:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">form</span></code>: un objet <a class="reference internal" href="../../ref/forms/api.html#django.forms.Form" title="django.forms.Form"><code class="xref py py-class docutils literal notranslate"><span class="pre">Form</span></code></a> représentant le formulaire <a class="reference internal" href="#django.contrib.auth.forms.AuthenticationForm" title="django.contrib.auth.forms.AuthenticationForm"><code class="xref py py-class docutils literal notranslate"><span class="pre">AuthenticationForm</span></code></a>.</li>
<li><code class="docutils literal notranslate"><span class="pre">next</span></code>: l’URL vers laquelle rediriger après une connexion réussie. Elle peut aussi contenir une chaîne de requête.</li>
<li><code class="docutils literal notranslate"><span class="pre">site</span></code>: le <a class="reference internal" href="../../ref/contrib/sites.html#django.contrib.sites.models.Site" title="django.contrib.sites.models.Site"><code class="xref py py-class docutils literal notranslate"><span class="pre">Site</span></code></a> actuel, selon le réglage <a class="reference internal" href="../../ref/settings.html#std:setting-SITE_ID"><code class="xref std std-setting docutils literal notranslate"><span class="pre">SITE_ID</span></code></a>. Si l’application <code class="docutils literal notranslate"><span class="pre">site</span></code> n’est pas installée, il s’agira d’une instance de <a class="reference internal" href="../../ref/contrib/sites.html#django.contrib.sites.requests.RequestSite" title="django.contrib.sites.requests.RequestSite"><code class="xref py py-class docutils literal notranslate"><span class="pre">RequestSite</span></code></a> qui détecte le nom du site et son domaine à partir de l’objet <a class="reference internal" href="../../ref/request-response.html#django.http.HttpRequest" title="django.http.HttpRequest"><code class="xref py py-class docutils literal notranslate"><span class="pre">HttpRequest</span></code></a> en cours.</li>
<li><code class="docutils literal notranslate"><span class="pre">site_name</span></code>: un alias de <code class="docutils literal notranslate"><span class="pre">site.name</span></code>. Si l’application <code class="docutils literal notranslate"><span class="pre">site</span></code> n’est pas installée, cette variable contiendra la valeur de <a class="reference internal" href="../../ref/request-response.html#django.http.HttpRequest.META" title="django.http.HttpRequest.META"><code class="xref py py-attr docutils literal notranslate"><span class="pre">request.META['SERVER_NAME']</span></code></a>. Pour plus d’informations sur les sites, voir <a class="reference internal" href="../../ref/contrib/sites.html"><span class="doc">L’infrastructure des «&nbsp;sites&nbsp;»</span></a>.</li>
</ul>
<p>Si vous préférez ne pas utiliser le gabarit <code class="file docutils literal notranslate"><span class="pre">registration/login.html</span></code>, vous pouvez renseigner le paramètre <code class="docutils literal notranslate"><span class="pre">template_name</span></code> via les paramètres supplémentaires de la méthode <code class="docutils literal notranslate"><span class="pre">as_view</span></code> dans votre configuration d’URL. Par exemple, cette ligne de configuration d’URL force l’utilisation de <code class="file docutils literal notranslate"><span class="pre">myapp/login.html</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">path</span><span class="p">(</span><span class="s1">&#39;accounts/login/&#39;</span><span class="p">,</span> <span class="n">auth_views</span><span class="o">.</span><span class="n">LoginView</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="n">template_name</span><span class="o">=</span><span class="s1">&#39;myapp/login.html&#39;</span><span class="p">)),</span>
</pre></div>
</div>
<p>Vous pouvez également définir le nom du champ <code class="docutils literal notranslate"><span class="pre">GET</span></code> contenant l’URL vers laquelle rediriger après la connexion en utiliisant <code class="docutils literal notranslate"><span class="pre">redirect_field_name</span></code>. Par défaut, ce champ s’appelle <code class="docutils literal notranslate"><span class="pre">next</span></code>.</p>
<p>Voici un exemple de gabarit  <code class="file docutils literal notranslate"><span class="pre">registration/login.html</span></code> comme point de départ. Il compte sur la présence d’un gabarit <code class="file docutils literal notranslate"><span class="pre">base.html</span></code> qui définit un bloc <code class="docutils literal notranslate"><span class="pre">content</span></code>:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">extends</span> <span class="s2">&quot;base.html&quot;</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">block</span> <span class="nv">content</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">if</span> <span class="nv">form.errors</span> <span class="cp">%}</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Your username and password didn&#39;t match. Please try again.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">if</span> <span class="nv">next</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">if</span> <span class="nv">user.is_authenticated</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Your account doesn&#39;t have access to this page. To proceed,
    please login with an account that has access.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Please login to see this page.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>

<span class="p">&lt;</span><span class="nt">form</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;login&#39;</span> <span class="cp">%}</span><span class="s">&quot;</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">csrf_token</span> <span class="cp">%}</span>
<span class="p">&lt;</span><span class="nt">table</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">form.username.label_tag</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">form.username</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">tr</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">form.password.label_tag</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">td</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">form.password</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">td</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">tr</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">table</span><span class="p">&gt;</span>

<span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;login&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;hidden&quot;</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;next&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">next</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>

<span class="c">{# Assumes you setup the password_reset view in your URLconf #}</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;password_reset&#39;</span> <span class="cp">%}</span><span class="s">&quot;</span><span class="p">&gt;</span>Lost password?<span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="cp">{%</span> <span class="k">endblock</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>Si vous avez personnalisé l’authentification (voir <a class="reference internal" href="customizing.html"><span class="doc">Personnalisation de l’authentification</span></a>), il est possible d’utiliser un formulaire d’authentification personnalisé en définissant l’attribut <code class="docutils literal notranslate"><span class="pre">authentication_form</span></code>. La méthode  <code class="docutils literal notranslate"><span class="pre">__init__()</span></code> de ce formulaire doit accepter un paramètre nommé <code class="docutils literal notranslate"><span class="pre">request</span></code>; le formulaire doit également implémenter une méthode <code class="docutils literal notranslate"><span class="pre">get_user()</span></code> qui renvoie l’objet utilisateur authentifié (cette méthode n’est appelée qu’à la suite d’une validation de formulaire réussie).</p>
</dd></dl>

<dl class="class">
<dt id="django.contrib.auth.views.LogoutView">
<em class="property">class </em><code class="descname">LogoutView</code><a class="headerlink" href="#django.contrib.auth.views.LogoutView" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>Déconnecte un utilisateur.</p>
<p><strong>Nom d’URL&nbsp;:</strong> <code class="docutils literal notranslate"><span class="pre">logout</span></code></p>
<p><strong>Attributs&nbsp;:</strong></p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">next_page</span></code>: l’URL vers laquelle rediriger après la déconnexion. La valeur par défaut est <a class="reference internal" href="../../ref/settings.html#std:setting-LOGOUT_REDIRECT_URL"><code class="xref std std-setting docutils literal notranslate"><span class="pre">settings.LOGOUT_REDIRECT_URL</span></code></a>.</li>
<li><code class="docutils literal notranslate"><span class="pre">template_name</span></code>: le nom complet d’un gabarit à afficher après la déconnexion d’un utilisateur. Sa valeur par défaut est <code class="file docutils literal notranslate"><span class="pre">registration/logged_out.html</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">redirect_field_name</span></code>: le nom d’un champ <code class="docutils literal notranslate"><span class="pre">GET</span></code> contenant l’URL vers laquelle rediriger après la déconnexion. Sa valeur par défaut est <code class="docutils literal notranslate"><span class="pre">next</span></code>. Cela surcharge l’URL <code class="docutils literal notranslate"><span class="pre">next_page</span></code> si le paramètre <code class="docutils literal notranslate"><span class="pre">GET</span></code> indiqué est renseigné.</li>
<li><code class="docutils literal notranslate"><span class="pre">extra_context</span></code>: un dictionnaire de données de contexte qui sera fusionné avec les données de contexte par défaut transmises au gabarit.</li>
<li><code class="docutils literal notranslate"><span class="pre">success_url_allowed_hosts</span></code>: un ensemble <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#set" title="(disponible dans Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">set</span></code></a> d’hôtes, en plus de <a class="reference internal" href="../../ref/request-response.html#django.http.HttpRequest.get_host" title="django.http.HttpRequest.get_host"><code class="xref py py-meth docutils literal notranslate"><span class="pre">request.get_host()</span></code></a>, qui sont sûrs comme cible de redirection après la déconnexion. L’ensemble est vide par défaut.</li>
</ul>
<p><strong>Contexte de gabarit&nbsp;:</strong></p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">title</span></code>: la chaîne «&nbsp;Logged out&nbsp;», traduite.</li>
<li><code class="docutils literal notranslate"><span class="pre">site</span></code>: le <a class="reference internal" href="../../ref/contrib/sites.html#django.contrib.sites.models.Site" title="django.contrib.sites.models.Site"><code class="xref py py-class docutils literal notranslate"><span class="pre">Site</span></code></a> actuel, selon le réglage <a class="reference internal" href="../../ref/settings.html#std:setting-SITE_ID"><code class="xref std std-setting docutils literal notranslate"><span class="pre">SITE_ID</span></code></a>. Si l’application <code class="docutils literal notranslate"><span class="pre">site</span></code> n’est pas installée, il s’agira d’une instance de <a class="reference internal" href="../../ref/contrib/sites.html#django.contrib.sites.requests.RequestSite" title="django.contrib.sites.requests.RequestSite"><code class="xref py py-class docutils literal notranslate"><span class="pre">RequestSite</span></code></a> qui détecte le nom du site et son domaine à partir de l’objet <a class="reference internal" href="../../ref/request-response.html#django.http.HttpRequest" title="django.http.HttpRequest"><code class="xref py py-class docutils literal notranslate"><span class="pre">HttpRequest</span></code></a> en cours.</li>
<li><code class="docutils literal notranslate"><span class="pre">site_name</span></code>: un alias de <code class="docutils literal notranslate"><span class="pre">site.name</span></code>. Si l’application <code class="docutils literal notranslate"><span class="pre">site</span></code> n’est pas installée, cette variable contiendra la valeur de <a class="reference internal" href="../../ref/request-response.html#django.http.HttpRequest.META" title="django.http.HttpRequest.META"><code class="xref py py-attr docutils literal notranslate"><span class="pre">request.META['SERVER_NAME']</span></code></a>. Pour plus d’informations sur les sites, voir <a class="reference internal" href="../../ref/contrib/sites.html"><span class="doc">L’infrastructure des «&nbsp;sites&nbsp;»</span></a>.</li>
</ul>
</dd></dl>

<dl class="function">
<dt id="django.contrib.auth.views.logout_then_login">
<code class="descname">logout_then_login</code>(<em>request</em>, <em>login_url=None</em>)<a class="headerlink" href="#django.contrib.auth.views.logout_then_login" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>Déconnecte un utilisateur, puis redirige vers la page de connexion.</p>
<p><strong>Nom d’URL :</strong> aucune URL par défaut</p>
<p><strong>Paramètres facultatifs&nbsp;:</strong></p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">login_url</span></code>: l’URL de la page de connexion vers laquelle rediriger. Si ce paramètre n’est pas renseigné, la valeur par défaut utilisée est <a class="reference internal" href="../../ref/settings.html#std:setting-LOGIN_URL"><code class="xref std std-setting docutils literal notranslate"><span class="pre">settings.LOGIN_URL</span></code></a>.</li>
</ul>
</dd></dl>

<dl class="class">
<dt id="django.contrib.auth.views.PasswordChangeView">
<em class="property">class </em><code class="descname">PasswordChangeView</code><a class="headerlink" href="#django.contrib.auth.views.PasswordChangeView" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p><strong>Nom d’URL&nbsp;:</strong> <code class="docutils literal notranslate"><span class="pre">password_change</span></code></p>
<p>Permet à un utilisateur de changer son mot de passe.</p>
<p><strong>Attributs&nbsp;:</strong></p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">template_name</span></code>: le nom complet d’un gabarit à utiliser pour l’affichage du formulaire de changement de mot de passe. Sa valeur par défaut est <code class="file docutils literal notranslate"><span class="pre">registration/password_change_form.html</span></code> si le paramètre n’est pas renseigné.</li>
<li><code class="docutils literal notranslate"><span class="pre">success_url</span></code>: l’URL vers laquelle rediriger après un changement de mot de passe réussi. Contient <code class="docutils literal notranslate"><span class="pre">'password_change_done'</span></code> par défaut.</li>
<li><code class="docutils literal notranslate"><span class="pre">form_class</span></code>: un formulaire de changement de mot de passe personnalisé qui doit accepter un paramètre nommé <code class="docutils literal notranslate"><span class="pre">user</span></code>. Le formulaire est responsable de changer réellement le mot de passe de l’utilisateur. La valeur par défaut est <a class="reference internal" href="#django.contrib.auth.forms.PasswordChangeForm" title="django.contrib.auth.forms.PasswordChangeForm"><code class="xref py py-class docutils literal notranslate"><span class="pre">PasswordChangeForm</span></code></a>.</li>
<li><code class="docutils literal notranslate"><span class="pre">extra_context</span></code>: un dictionnaire de données de contexte qui sera fusionné avec les données de contexte par défaut transmises au gabarit.</li>
</ul>
<p><strong>Contexte de gabarit&nbsp;:</strong></p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">form</span></code>: le formulaire de changement de mot de passe (voir <code class="docutils literal notranslate"><span class="pre">form_class</span></code> ci-dessus).</li>
</ul>
</dd></dl>

<dl class="class">
<dt id="django.contrib.auth.views.PasswordChangeDoneView">
<em class="property">class </em><code class="descname">PasswordChangeDoneView</code><a class="headerlink" href="#django.contrib.auth.views.PasswordChangeDoneView" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p><strong>Nom d’URL&nbsp;:</strong> <code class="docutils literal notranslate"><span class="pre">password_change_done</span></code></p>
<p>La page affichée après qu’un utilisateur a changé son mot de passe.</p>
<p><strong>Attributs&nbsp;:</strong></p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">template_name</span></code>: le nom complet d’un gabarit à utiliser. Sa valeur par défaut est <code class="file docutils literal notranslate"><span class="pre">registration/password_change_done.html</span></code> si le paramètre n’est pas renseigné.</li>
<li><code class="docutils literal notranslate"><span class="pre">extra_context</span></code>: un dictionnaire de données de contexte qui sera fusionné avec les données de contexte par défaut transmises au gabarit.</li>
</ul>
</dd></dl>

<dl class="class">
<dt id="django.contrib.auth.views.PasswordResetView">
<em class="property">class </em><code class="descname">PasswordResetView</code><a class="headerlink" href="#django.contrib.auth.views.PasswordResetView" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p><strong>Nom d’URL&nbsp;:</strong> <code class="docutils literal notranslate"><span class="pre">password_reset</span></code></p>
<p>Permet à un utilisateur de réinitialiser son mot de passe en générant un lien à usage unique permettant la réinitialisation du mot de passe. Ce lien est envoyé à l’adresse électronique enregistrée pour cet utilisateur.</p>
<p>Si l’adresse électronique indiquée n’existe pas dans le système, cette vue n’envoie pas de courriel, mais l’utilisateur ne reçoit pas non plus de message d’erreur, ceci pour empêcher une divulgation d’information à de potentiels attaquants. Si vous souhaitez fournir un message d’erreur dans cette situation, vous pouvez créer une classe héritant de <a class="reference internal" href="#django.contrib.auth.forms.PasswordResetForm" title="django.contrib.auth.forms.PasswordResetForm"><code class="xref py py-class docutils literal notranslate"><span class="pre">PasswordResetForm</span></code></a> et employer l’attribut <code class="docutils literal notranslate"><span class="pre">form_class</span></code>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Soyez conscients que l’envoi d’un courriel prend un peu de temps, ce qui peut vous rendre vulnérable à une attaque temporelle d’énumération d’adresses électroniques en raison de la différence entre la durée d’une requête de réinitialisation quand l’adresse de courriel existe ou quand elle n’existe pas. Pour éviter cet écart temporel, vous pouvez utiliser un module tiers qui autorise l’envoi asynchrone de courriels, comme par exemple <a class="reference external" href="https://pypi.org/project/django-mailer/">django-mailer</a>.</p>
</div>
<p>Les utilisateurs possédant un mot de passe inutilisable (voir <a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User.set_unusable_password" title="django.contrib.auth.models.User.set_unusable_password"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set_unusable_password()</span></code></a>) ne sont pas autorisés à demander la réinitialisation de leur mot de passe afin de prévenir une utilisation abusive avec des sources d’authentification externes comme LDAP. Notez qu’ils ne reçoivent pas de message d’erreur car cela indiquerait que leur compte existe bel et bien, mais ils ne reçoivent pas de courriel non plus.</p>
<p><strong>Attributs&nbsp;:</strong></p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">template_name</span></code>: le nom complet d’un gabarit à utiliser pour l’affichage du formulaire de réinitialisation du mot de passe. Sa valeur par défaut est <code class="file docutils literal notranslate"><span class="pre">registration/password_reset_form.html</span></code> si le paramètre n’est pas renseigné.</li>
<li><code class="docutils literal notranslate"><span class="pre">form_class</span></code>: formulaire utilisé pour obtenir l’adresse électronique de l’utilisateur pour lequel le mot de passe doit être réinitialisé. La valeur par défaut est <a class="reference internal" href="#django.contrib.auth.forms.PasswordResetForm" title="django.contrib.auth.forms.PasswordResetForm"><code class="xref py py-class docutils literal notranslate"><span class="pre">PasswordResetForm</span></code></a>.</li>
<li><code class="docutils literal notranslate"><span class="pre">email_template_name</span></code>: le nom complet d’un gabarit à utiliser pour produire le courriel contenant le lien de réinitialisation du mot de passe. Sa valeur par défaut est <code class="file docutils literal notranslate"><span class="pre">registration/password_reset_email.html</span></code> si le paramètre n’est pas renseigné.</li>
<li><code class="docutils literal notranslate"><span class="pre">subject_template_name</span></code>: le nom complet d’un gabarit à utiliser pour le sujet du courriel contenant le lien de réinitialisation du mot de passe. Sa valeur par défaut est <code class="file docutils literal notranslate"><span class="pre">registration/password_reset_subject.txt</span></code> si le paramètre n’est pas renseigné.</li>
<li><code class="docutils literal notranslate"><span class="pre">token_generator</span></code>: instance de la classe qui vérifie le lien à usage unique. La valeur par défaut est <code class="docutils literal notranslate"><span class="pre">default_token_generator</span></code> qui est une instance de <code class="docutils literal notranslate"><span class="pre">django.contrib.auth.tokens.PasswordResetTokenGenerator</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">success_url</span></code>: l’URL vers laquelle rediriger après une demande de réinitialisation de mot de passe réussie. Contient <code class="docutils literal notranslate"><span class="pre">'password_reet_done'</span></code> par défaut.</li>
<li><code class="docutils literal notranslate"><span class="pre">from_email</span></code>: une adresse électronique valide. Par défaut, Django utilise <a class="reference internal" href="../../ref/settings.html#std:setting-DEFAULT_FROM_EMAIL"><code class="xref std std-setting docutils literal notranslate"><span class="pre">DEFAULT_FROM_EMAIL</span></code></a>.</li>
<li><code class="docutils literal notranslate"><span class="pre">extra_context</span></code>: un dictionnaire de données de contexte qui sera fusionné avec les données de contexte par défaut transmises au gabarit.</li>
<li><code class="docutils literal notranslate"><span class="pre">html_email_template_name</span></code>: le nom complet d’un gabarit à utiliser pour produire un courriel avec plusieurs parties <em class="mimetype">text/html</em> et contenant le lien de réinitialisation du mot de passe. Par défaut, le courriel n’est pas envoyé au format HTML.</li>
<li><code class="docutils literal notranslate"><span class="pre">extra_email_context</span></code>: un dictionnaire de données de contexte qui sera disponible dans le gabarit du courriel. Il peut être utilisé pour surcharger les valeurs de contexte de gabarit par défaut énumérées ci-dessous, par ex. <code class="docutils literal notranslate"><span class="pre">domain</span></code>.</li>
</ul>
<p><strong>Contexte de gabarit&nbsp;:</strong></p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">form</span></code>: le formulaire de réinitialisation du mot de passe de l’utilisateur (voir <code class="docutils literal notranslate"><span class="pre">form_class</span></code> ci-dessus).</li>
</ul>
<p><strong>Contexte de gabarit du courriel&nbsp;:</strong></p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">email</span></code>: un alias de <code class="docutils literal notranslate"><span class="pre">user.email</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">user</span></code>: l’utilisateur <a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User" title="django.contrib.auth.models.User"><code class="xref py py-class docutils literal notranslate"><span class="pre">User</span></code></a> actuel, en accord avec le champ de formulaire <code class="docutils literal notranslate"><span class="pre">email</span></code>. Seuls les utilisateurs actifs ont la possibilité de réinitialiser leur mot de passe (<code class="docutils literal notranslate"><span class="pre">User.is_active</span> <span class="pre">is</span> <span class="pre">True</span></code>).</li>
<li><code class="docutils literal notranslate"><span class="pre">site_name</span></code>: un alias de <code class="docutils literal notranslate"><span class="pre">site.name</span></code>. Si l’application <code class="docutils literal notranslate"><span class="pre">site</span></code> n’est pas installée, cette variable contiendra la valeur de <a class="reference internal" href="../../ref/request-response.html#django.http.HttpRequest.META" title="django.http.HttpRequest.META"><code class="xref py py-attr docutils literal notranslate"><span class="pre">request.META['SERVER_NAME']</span></code></a>. Pour plus d’informations sur les sites, voir <a class="reference internal" href="../../ref/contrib/sites.html"><span class="doc">L’infrastructure des «&nbsp;sites&nbsp;»</span></a>.</li>
<li><code class="docutils literal notranslate"><span class="pre">domain</span></code>: un alias de <code class="docutils literal notranslate"><span class="pre">site.domain</span></code>. Si l’application <code class="docutils literal notranslate"><span class="pre">site</span></code> n’est pas installée, cette variable contiendra la valeur de <code class="docutils literal notranslate"><span class="pre">request.get_host()</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">protocol</span></code>: http ou https</li>
<li><code class="docutils literal notranslate"><span class="pre">uid</span></code>: la clé primaire de l’utilisateur codée en base64.</li>
<li><code class="docutils literal notranslate"><span class="pre">token</span></code>: jeton servant à contrôler la validité du lien de réinitialisation.</li>
</ul>
<p>Exemple de <code class="docutils literal notranslate"><span class="pre">registration/password_reset_email.html</span></code> (gabarit de corps de message)&nbsp;:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span>Someone asked for password reset for email <span class="cp">{{</span> <span class="nv">email</span> <span class="cp">}}</span>. Follow the link below:
<span class="cp">{{</span> <span class="nv">protocol</span><span class="cp">}}</span>://<span class="cp">{{</span> <span class="nv">domain</span> <span class="cp">}}{%</span> <span class="k">url</span> <span class="s1">&#39;password_reset_confirm&#39;</span> <span class="nv">uidb64</span><span class="o">=</span><span class="nv">uid</span> <span class="nv">token</span><span class="o">=</span><span class="nv">token</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>Le gabarit du sujet reçoit le même contexte de gabarit. Le sujet doit être une seule ligne de texte brut.</p>
</dd></dl>

<dl class="class">
<dt id="django.contrib.auth.views.PasswordResetDoneView">
<em class="property">class </em><code class="descname">PasswordResetDoneView</code><a class="headerlink" href="#django.contrib.auth.views.PasswordResetDoneView" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p><strong>Nom d’URL&nbsp;:</strong> <code class="docutils literal notranslate"><span class="pre">password_reset_done</span></code></p>
<p>La page affichée après qu’un utilisateur a reçu le lien pour réinitialiser son mot de passe. Cette vue est appelée par défaut si la vue <a class="reference internal" href="#django.contrib.auth.views.PasswordResetView" title="django.contrib.auth.views.PasswordResetView"><code class="xref py py-class docutils literal notranslate"><span class="pre">PasswordResetView</span></code></a> ne possède pas une URL <code class="docutils literal notranslate"><span class="pre">success_url</span></code> définie explicitement.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Si l’adresse électronique fournie n’existe pas dans le système, si l’utilisateur est inactif ou si son mot de passe est inutilisable, cette vue sera tout de même affichée, mais aucun message ne sera envoyé.</p>
</div>
<p><strong>Attributs&nbsp;:</strong></p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">template_name</span></code>: le nom complet d’un gabarit à utiliser. Sa valeur par défaut est <code class="file docutils literal notranslate"><span class="pre">registration/password_reset_done.html</span></code> si le paramètre n’est pas renseigné.</li>
<li><code class="docutils literal notranslate"><span class="pre">extra_context</span></code>: un dictionnaire de données de contexte qui sera fusionné avec les données de contexte par défaut transmises au gabarit.</li>
</ul>
</dd></dl>

<dl class="class">
<dt id="django.contrib.auth.views.PasswordResetConfirmView">
<em class="property">class </em><code class="descname">PasswordResetConfirmView</code><a class="headerlink" href="#django.contrib.auth.views.PasswordResetConfirmView" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p><strong>Nom d’URL&nbsp;:</strong> <code class="docutils literal notranslate"><span class="pre">password_reset_confirm</span></code></p>
<p>Affiche un formulaire pour saisir un nouveau mot de passe.</p>
<p><strong>Paramètres nommés provenant de l’URL&nbsp;:</strong></p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">uidb64</span></code>: l’identifiant de l’utilisateur codé en base 64.</li>
<li><code class="docutils literal notranslate"><span class="pre">token</span></code>: jeton servant à contrôler la validité du mot de passe.</li>
</ul>
<p><strong>Attributs&nbsp;:</strong></p>
<ul>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">template_name</span></code>: le nom complet d’un gabarit à utiliser pour l’affichage de la vue de confirmation du mot de passe. Sa valeur par défaut est <code class="file docutils literal notranslate"><span class="pre">registration/password_reset_confirm.html</span></code>.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">token_generator</span></code>: instance de la classe qui vérifie le mot de passe. La valeur par défaut est <code class="docutils literal notranslate"><span class="pre">default_token_generator</span></code> qui est une instance de <code class="docutils literal notranslate"><span class="pre">django.contrib.auth.tokens.PasswordResetTokenGenerator</span></code>.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">post_reset_login</span></code>: une valeur booléenne indiquant si l’utilisateur doit être automatiquement authentifié à la suite d’une réinitialisation de mot de passe réussie. Vaut <code class="docutils literal notranslate"><span class="pre">False</span></code> par défaut.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">post_reset_login_backend</span></code>: un chemin Python vers le moteur d’authentification à utiliser lors d’une authentification si <code class="docutils literal notranslate"><span class="pre">post_reset_login</span></code> vaut <code class="docutils literal notranslate"><span class="pre">True</span></code>. Obligatoire seulement si plusieurs moteurs sont configurés dans <a class="reference internal" href="../../ref/settings.html#std:setting-AUTHENTICATION_BACKENDS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">AUTHENTICATION_BACKENDS</span></code></a>. La valeur par défaut est <code class="docutils literal notranslate"><span class="pre">None</span></code>.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">form_class</span></code>: formulaire utilisé pour définir le mot de passe. La valeur par défaut est <a class="reference internal" href="#django.contrib.auth.forms.SetPasswordForm" title="django.contrib.auth.forms.SetPasswordForm"><code class="xref py py-class docutils literal notranslate"><span class="pre">SetPasswordForm</span></code></a>.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">success_url</span></code>: l’URL vers laquelle rediriger après une réinitialisation de mot de passe. Contient <code class="docutils literal notranslate"><span class="pre">'password_reset_complete'</span></code> par défaut.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">extra_context</span></code>: un dictionnaire de données de contexte qui sera fusionné avec les données de contexte par défaut transmises au gabarit.</p>
</li>
<li><p class="first"><code class="docutils literal notranslate"><span class="pre">reset_url_token</span></code>: paramètre jeton affiché comme composant des URL de réinitialisation de mot de passe. Contient <code class="docutils literal notranslate"><span class="pre">'set-password'</span></code> par défaut.</p>
<div class="versionchanged">
<span class="title">Changed in Django 3.0:</span> <p>L’attribut de classe <code class="docutils literal notranslate"><span class="pre">reset_url_token</span></code> a été ajouté.</p>
</div>
</li>
</ul>
<p><strong>Contexte de gabarit&nbsp;:</strong></p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">form</span></code>: le formulaire de définition du mot de passe du nouvel utilisateur (voir <code class="docutils literal notranslate"><span class="pre">form_class</span></code> ci-dessus).</li>
<li><code class="docutils literal notranslate"><span class="pre">validlink</span></code>: valeur booléenne, <code class="docutils literal notranslate"><span class="pre">True</span></code> si le lien (combinaison de <code class="docutils literal notranslate"><span class="pre">uidb64</span></code> et de <code class="docutils literal notranslate"><span class="pre">token</span></code>) est valable ou pas encore utilisé.</li>
</ul>
</dd></dl>

<dl class="class">
<dt id="django.contrib.auth.views.PasswordResetCompleteView">
<em class="property">class </em><code class="descname">PasswordResetCompleteView</code><a class="headerlink" href="#django.contrib.auth.views.PasswordResetCompleteView" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p><strong>Nom d’URL&nbsp;:</strong> <code class="docutils literal notranslate"><span class="pre">password_reset_complete</span></code></p>
<p>Affiche une vue informant l’utilisateur que son mot de passe a été changé avec succès.</p>
<p><strong>Attributs&nbsp;:</strong></p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">template_name</span></code>: le nom complet d’un gabarit pour afficher la vue. Sa valeur par défaut est <code class="file docutils literal notranslate"><span class="pre">registration/password_reset_complete.html</span></code>.</li>
<li><code class="docutils literal notranslate"><span class="pre">extra_context</span></code>: un dictionnaire de données de contexte qui sera fusionné avec les données de contexte par défaut transmises au gabarit.</li>
</ul>
</dd></dl>

</div>
</div>
<div class="section" id="s-helper-functions">
<span id="helper-functions"></span><h3>Fonctions utilitaires<a class="headerlink" href="#helper-functions" title="Lien permanent vers ce titre">¶</a></h3>
<dl class="function">
<dt id="django.contrib.auth.views.redirect_to_login">
<code class="descname">redirect_to_login</code>(<em>next</em>, <em>login_url=None</em>, <em>redirect_field_name='next'</em>)<a class="headerlink" href="#django.contrib.auth.views.redirect_to_login" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>Redirige vers la page de connexion, puis vers une autre URL si la connexion réussit.</p>
<p><strong>Paramètres obligatoires&nbsp;:</strong></p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">next_page</span></code>: l’URL vers laquelle rediriger après une connexion réussie.</li>
</ul>
<p><strong>Paramètres facultatifs&nbsp;:</strong></p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">login_url</span></code>: l’URL de la page de connexion vers laquelle rediriger. Si ce paramètre n’est pas renseigné, la valeur par défaut utilisée est <a class="reference internal" href="../../ref/settings.html#std:setting-LOGIN_URL"><code class="xref std std-setting docutils literal notranslate"><span class="pre">settings.LOGIN_URL</span></code></a>.</li>
<li><code class="docutils literal notranslate"><span class="pre">redirect_field_name</span></code>: le nom d’un champ <code class="docutils literal notranslate"><span class="pre">GET</span></code> contenant l’URL vers laquelle rediriger après la déconnexion. Cela surcharge <code class="docutils literal notranslate"><span class="pre">next</span></code> si le paramètre <code class="docutils literal notranslate"><span class="pre">GET</span></code> indiqué est renseigné.</li>
</ul>
</dd></dl>

</div>
<div class="section" id="s-module-django.contrib.auth.forms">
<span id="s-built-in-forms"></span><span id="s-built-in-auth-forms"></span><span id="module-django.contrib.auth.forms"></span><span id="built-in-forms"></span><span id="built-in-auth-forms"></span><h3>Formulaires intégrés<a class="headerlink" href="#module-django.contrib.auth.forms" title="Lien permanent vers ce titre">¶</a></h3>
<p>Si vous ne souhaitez pas utiliser les vues intégrées mais que vous voulez profiter de ne pas devoir réécrire les formulaires de cette fonctionnalité, le système d’authentification fournit plusieurs formulaires intégrés se trouvant dans <a class="reference internal" href="#module-django.contrib.auth.forms" title="django.contrib.auth.forms"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.contrib.auth.forms</span></code></a>:</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Les formulaires d’authentification intégrés comptent sur un certain nombre de caractéristiques du modèle utilisateur avec lequel ils interagissent. Si vous utilisez un <a class="reference internal" href="customizing.html#auth-custom-user"><span class="std std-ref">modèle d’utilisateur personnalisé</span></a>, il peut être nécessaire de définir vos propres formulaires pour le système d’authentification. Pour plus d’informations, consultez la documentation sur l”<a class="reference internal" href="customizing.html#custom-users-and-the-built-in-auth-forms"><span class="std std-ref">utilisation des formulaires d’authentification intégrés avec les modèles d’utilisateur personnalisés</span></a>.</p>
</div>
<dl class="class">
<dt id="django.contrib.auth.forms.AdminPasswordChangeForm">
<em class="property">class </em><code class="descname">AdminPasswordChangeForm</code><a class="headerlink" href="#django.contrib.auth.forms.AdminPasswordChangeForm" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>Un formulaire utilisé dans l’interface d’administration pour changer le mot de passe d’un utilisateur.</p>
<p>Accepte <code class="docutils literal notranslate"><span class="pre">user</span></code> comme premier paramètre positionnel.</p>
</dd></dl>

<dl class="class">
<dt id="django.contrib.auth.forms.AuthenticationForm">
<em class="property">class </em><code class="descname">AuthenticationForm</code><a class="headerlink" href="#django.contrib.auth.forms.AuthenticationForm" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>Un formulaire pour connecter un utilisateur.</p>
<p>Accepte <code class="docutils literal notranslate"><span class="pre">request</span></code> comme premier paramètre positionnel, qui est ensuite stocké dans l’instance de formulaire à disposition des sous-classes.</p>
<dl class="method">
<dt id="django.contrib.auth.forms.AuthenticationForm.confirm_login_allowed">
<code class="descname">confirm_login_allowed</code>(<em>user</em>)<a class="headerlink" href="#django.contrib.auth.forms.AuthenticationForm.confirm_login_allowed" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>Par défaut, <code class="docutils literal notranslate"><span class="pre">AuthenticationForm</span></code> rejette les utilisateurs pour lesquels <code class="docutils literal notranslate"><span class="pre">is_active</span></code> est à <code class="docutils literal notranslate"><span class="pre">False</span></code>. Vous pouvez modifier ce comportement pour définir une stratégie personnalisée de détermination des utilisateurs qui peuvent se connecter. Pour cela, utilisez un formulaire personnalisé qui hérite de <code class="docutils literal notranslate"><span class="pre">AuthenticationForm</span></code> et remplace la méthode <code class="docutils literal notranslate"><span class="pre">confirm_login_allowed()</span></code>. Cette méthode doit générer une exception <a class="reference internal" href="../../ref/exceptions.html#django.core.exceptions.ValidationError" title="django.core.exceptions.ValidationError"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ValidationError</span></code></a> lorsque l’utilisateur donné n’est pas autorisé à se connecter.</p>
<p>Par exemple, pour permettre à tous les utilisateurs de se connecter, indépendamment de leur statut «&nbsp;actif&nbsp;»&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.contrib.auth.forms</span> <span class="k">import</span> <span class="n">AuthenticationForm</span>

<span class="k">class</span> <span class="nc">AuthenticationFormWithInactiveUsersOkay</span><span class="p">(</span><span class="n">AuthenticationForm</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">confirm_login_allowed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">):</span>
        <span class="k">pass</span>
</pre></div>
</div>
<p>(Dans ce cas, il faudra aussi utiliser un moteur d’authentification qui autorise les utilisateurs inactifs, tel que <a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.backends.AllowAllUsersModelBackend" title="django.contrib.auth.backends.AllowAllUsersModelBackend"><code class="xref py py-class docutils literal notranslate"><span class="pre">AllowAllUsersModelBackend</span></code></a>.)</p>
<p>Ou pour autoriser uniquement certains utilisateurs actifs à se connecter&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">PickyAuthenticationForm</span><span class="p">(</span><span class="n">AuthenticationForm</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">confirm_login_allowed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">user</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">user</span><span class="o">.</span><span class="n">is_active</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span>
                <span class="n">_</span><span class="p">(</span><span class="s2">&quot;This account is inactive.&quot;</span><span class="p">),</span>
                <span class="n">code</span><span class="o">=</span><span class="s1">&#39;inactive&#39;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">username</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span>
                <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Sorry, accounts starting with &#39;b&#39; aren&#39;t welcome here.&quot;</span><span class="p">),</span>
                <span class="n">code</span><span class="o">=</span><span class="s1">&#39;no_b_users&#39;</span><span class="p">,</span>
            <span class="p">)</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="django.contrib.auth.forms.PasswordChangeForm">
<em class="property">class </em><code class="descname">PasswordChangeForm</code><a class="headerlink" href="#django.contrib.auth.forms.PasswordChangeForm" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>Un formulaire pour permettre à un utilisateur de changer son mot de passe.</p>
</dd></dl>

<dl class="class">
<dt id="django.contrib.auth.forms.PasswordResetForm">
<em class="property">class </em><code class="descname">PasswordResetForm</code><a class="headerlink" href="#django.contrib.auth.forms.PasswordResetForm" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>Un formulaire pour générer et envoyer par courriel un lien à usage unique pour réinitialiser le mot de passe d’un utilisateur.</p>
<dl class="method">
<dt id="django.contrib.auth.forms.PasswordResetForm.send_mail">
<code class="descname">send_mail</code>(<em>subject_template_name</em>, <em>email_template_name</em>, <em>context</em>, <em>from_email</em>, <em>to_email</em>, <em>html_email_template_name=None</em>)<a class="headerlink" href="#django.contrib.auth.forms.PasswordResetForm.send_mail" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>Utilise les paramètres pour envoyer un message <code class="docutils literal notranslate"><span class="pre">EmailMultiAlternatives</span></code>. Peut être surchargé pour personnaliser la manière dont le courriel est envoyé à l’utilisateur.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Paramètres:</th><td class="field-body"><ul class="first last simple">
<li><strong>subject_template_name</strong> – le gabarit pour le sujet du message.</li>
<li><strong>email_template_name</strong> – le gabarit pour le corps du message.</li>
<li><strong>context</strong> – contexte transmis aux gabarits <code class="docutils literal notranslate"><span class="pre">subject_template</span></code>, <code class="docutils literal notranslate"><span class="pre">email_template</span></code> et <code class="docutils literal notranslate"><span class="pre">html_email_template</span></code> (s’il ne vaut pas <code class="docutils literal notranslate"><span class="pre">None</span></code>).</li>
<li><strong>from_email</strong> – l’adresse électronique de l’expéditeur.</li>
<li><strong>to_email</strong> – l’adresse électronique du destinataire.</li>
<li><strong>html_email_template_name</strong> – le gabarit du corps du message HTML&nbsp;; vaut <code class="docutils literal notranslate"><span class="pre">None</span></code> par défaut, auquel cas un courriel en texte pur est envoyé.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>Par défaut, <code class="docutils literal notranslate"><span class="pre">save()</span></code> remplit le <code class="docutils literal notranslate"><span class="pre">context</span></code> avec les mêmes variables que <a class="reference internal" href="#django.contrib.auth.views.PasswordResetView" title="django.contrib.auth.views.PasswordResetView"><code class="xref py py-class docutils literal notranslate"><span class="pre">PasswordResetView</span></code></a> transmet à son contexte d’envoi de courriel.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="django.contrib.auth.forms.SetPasswordForm">
<em class="property">class </em><code class="descname">SetPasswordForm</code><a class="headerlink" href="#django.contrib.auth.forms.SetPasswordForm" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>Un formulaire permettant à un utilisateur de changer son mot de passe sans saisir l’ancien mot de passe.</p>
</dd></dl>

<dl class="class">
<dt id="django.contrib.auth.forms.UserChangeForm">
<em class="property">class </em><code class="descname">UserChangeForm</code><a class="headerlink" href="#django.contrib.auth.forms.UserChangeForm" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>Un formulaire utilisé dans l’interface d’administration pour modifier les données d’un utilisateur et ses permissions.</p>
</dd></dl>

<dl class="class">
<dt id="django.contrib.auth.forms.UserCreationForm">
<em class="property">class </em><code class="descname">UserCreationForm</code><a class="headerlink" href="#django.contrib.auth.forms.UserCreationForm" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>Un <a class="reference internal" href="../forms/modelforms.html#django.forms.ModelForm" title="django.forms.ModelForm"><code class="xref py py-class docutils literal notranslate"><span class="pre">ModelForm</span></code></a> pour créer un nouvel utilisateur.</p>
<p>Il possède trois champs&nbsp;: <code class="docutils literal notranslate"><span class="pre">username</span></code> (du modèle utilisateur), <code class="docutils literal notranslate"><span class="pre">password1</span></code> et <code class="docutils literal notranslate"><span class="pre">password2</span></code>. Il vérifie que <code class="docutils literal notranslate"><span class="pre">password1</span></code> et <code class="docutils literal notranslate"><span class="pre">password2</span></code> correspondent, valide le mot de passe en utilisant <a class="reference internal" href="passwords.html#django.contrib.auth.password_validation.validate_password" title="django.contrib.auth.password_validation.validate_password"><code class="xref py py-func docutils literal notranslate"><span class="pre">validate_password()</span></code></a> et définit le mot de passe de l’utilisateur avec <a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User.set_password" title="django.contrib.auth.models.User.set_password"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set_password()</span></code></a>.</p>
</dd></dl>

</div>
<div class="section" id="s-authentication-data-in-templates">
<span id="authentication-data-in-templates"></span><h3>Données d’authentification dans les gabarits<a class="headerlink" href="#authentication-data-in-templates" title="Lien permanent vers ce titre">¶</a></h3>
<p>L’utilisateur actuellement connecté et ses permissions sont disponibles dans le <a class="reference internal" href="../../ref/templates/api.html"><span class="doc">contexte de gabarit</span></a> lorsque vous utilisez <a class="reference internal" href="../../ref/templates/api.html#django.template.RequestContext" title="django.template.RequestContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">RequestContext</span></code></a>.</p>
<div class="admonition-technicality admonition">
<p class="first admonition-title">Détail technique</p>
<p class="last">Techniquement, ces variables ne sont disponibles dans le contexte de gabarit que si vous utilisez <a class="reference internal" href="../../ref/templates/api.html#django.template.RequestContext" title="django.template.RequestContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">RequestContext</span></code></a> et que le processeur de contexte <code class="docutils literal notranslate"><span class="pre">&quot;django.contrib.auth.context_processors.auth&quot;</span></code> est activé. C’est le cas dans le fichier de réglages par défaut. Pour plus de détails, lisez la <a class="reference internal" href="../../ref/templates/api.html#subclassing-context-requestcontext"><span class="std std-ref">documentation de RequestContext</span></a>.</p>
</div>
<div class="section" id="s-users">
<span id="users"></span><h4>Utilisateurs<a class="headerlink" href="#users" title="Lien permanent vers ce titre">¶</a></h4>
<p>Lors de la génération d’un <a class="reference internal" href="../../ref/templates/api.html#django.template.RequestContext" title="django.template.RequestContext"><code class="xref py py-class docutils literal notranslate"><span class="pre">RequestContext</span></code></a> de gabarit, l’utilisateur actuellement connecté, une instance de  <a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User" title="django.contrib.auth.models.User"><code class="xref py py-class docutils literal notranslate"><span class="pre">User</span></code></a> ou de <a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.AnonymousUser" title="django.contrib.auth.models.AnonymousUser"><code class="xref py py-class docutils literal notranslate"><span class="pre">AnonymousUser</span></code></a>, est stockée dans la variable de gabarit <code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">user</span> <span class="pre">}}</span></code>:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">user.is_authenticated</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Welcome, <span class="cp">{{</span> <span class="nv">user.username</span> <span class="cp">}}</span>. Thanks for logging in.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>Welcome, new user. Please log in.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>Cette variable de contexte de gabarit n’est pas disponible si <code class="docutils literal notranslate"><span class="pre">RequestContext</span></code> n’est pas utilisé.</p>
</div>
<div class="section" id="s-permissions">
<span id="permissions"></span><h4>Permissions<a class="headerlink" href="#permissions" title="Lien permanent vers ce titre">¶</a></h4>
<p>Les permissions de l’utilisateur actuellement connecté sont stockés dans la variable de gabarit <code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">perms</span> <span class="pre">}}</span></code>. C’est une instance de <code class="docutils literal notranslate"><span class="pre">django.contrib.auth.context_processors.PermWrapper</span></code>, un objet mandataire de permissions adapté aux gabarits.</p>
<p>La consultation d’attributs simples de <code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">perms</span> <span class="pre">}}</span></code> sous forme de booléen est une méthode mandataire de <a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User.has_module_perms" title="django.contrib.auth.models.User.has_module_perms"><code class="xref py py-meth docutils literal notranslate"><span class="pre">User.has_module_perms()</span></code></a>. Par exemple, pour vérifier si l’utilisateur connecté a au moins une permission dans l’application <code class="docutils literal notranslate"><span class="pre">foo</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="o">%</span> <span class="k">if</span> <span class="n">perms</span><span class="o">.</span><span class="n">foo</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
<p>La consultation d’attributs à deux niveaux de <code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">perms</span> <span class="pre">}}</span></code> sous forme de booléen est une méthode mandataire de <a class="reference internal" href="../../ref/contrib/auth.html#django.contrib.auth.models.User.has_perm" title="django.contrib.auth.models.User.has_perm"><code class="xref py py-meth docutils literal notranslate"><span class="pre">User.has_perm()</span></code></a>. Par exemple, pour vérifier si l’utilisateur connecté a la permission <code class="docutils literal notranslate"><span class="pre">foo.add_vote</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span><span class="o">%</span> <span class="k">if</span> <span class="n">perms</span><span class="o">.</span><span class="n">foo</span><span class="o">.</span><span class="n">add_vote</span> <span class="o">%</span><span class="p">}</span>
</pre></div>
</div>
<p>Voici un exemple plus complet de contrôle de permissions dans un gabarit</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">perms.foo</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>You have permission to do something in the foo app.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">if</span> <span class="nv">perms.foo.add_vote</span> <span class="cp">%}</span>
        <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>You can vote!<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">if</span> <span class="nv">perms.foo.add_driving</span> <span class="cp">%}</span>
        <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>You can drive!<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>You don&#39;t have permission to do anything in the foo app.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>Il est aussi possible de consulter les permissions par des instructions <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">if</span> <span class="pre">in</span> <span class="pre">%}</span></code>. Par exemple&nbsp;:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">if</span> <span class="s1">&#39;foo&#39;</span> <span class="k">in</span> <span class="nv">perms</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">if</span> <span class="s1">&#39;foo.add_vote&#39;</span> <span class="k">in</span> <span class="nv">perms</span> <span class="cp">%}</span>
        <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>In lookup works, too.<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="s-managing-users-in-the-admin">
<span id="s-auth-admin"></span><span id="managing-users-in-the-admin"></span><span id="auth-admin"></span><h2>Gestion des utilisateurs dans le site d’administration<a class="headerlink" href="#managing-users-in-the-admin" title="Lien permanent vers ce titre">¶</a></h2>
<p>Quand <code class="docutils literal notranslate"><span class="pre">django.contrib.admin</span></code> et <code class="docutils literal notranslate"><span class="pre">django.contrib.auth</span></code> sont les deux installés, le site d’administration offre une interface pratique pour afficher et gérer les utilisateurs, les groupes et les permissions. Les utilisateurs peuvent être créés et supprimés comme tout autre modèle Django. Des groupes peuvent être créés et des permissions peuvent être attribuées aux utilisateurs et aux groupes. Les modifications de modèles effectuées dans l’administration par les utilisateurs sont également journalisées et affichées.</p>
<div class="section" id="s-id6">
<span id="id6"></span><h3>Création d’utilisateurs<a class="headerlink" href="#id6" title="Lien permanent vers ce titre">¶</a></h3>
<p>Vous devriez voir un lien vers «&nbsp;Utilisateurs&nbsp;» dans la section «&nbsp;Auth&nbsp;» de la page d’accueil du site d’administration. La page d’administration «&nbsp;Ajouter un utilisateur&nbsp;» est différente des autres pages d’administration dans la mesure où elle exige que vous saisissiez d’abord un nom d’utilisateur et un mot de passe avant de pouvoir modifier les autres champs de l’utilisateur.</p>
<p>Notez également que si vous voulez qu’un utilisateur puisse créer d’autres utilisateurs dans le site d’administration de Django, vous devez lui attribuer la permission d’ajouter des utilisateurs <em>et</em> de modifier des utilisateurs (c’est-à-dire les permissions «&nbsp;Can add user&nbsp;» et «&nbsp;Can change user&nbsp;»). Si un compte utilisateur a la permission d’ajouter des utilisateurs mais pas de les modifier, ce compte ne pourra pas créer d’utilisateurs. Pourquoi&nbsp;? Parce que si vous avez la permission d’ajouter des utilisateurs, vous avez le pouvoir de créer des superutilisateurs, qui peuvent à leur tour modifier d’autres utilisateurs. Django exige donc à la fois les permissions «&nbsp;ajout&nbsp;» et «&nbsp;modification&nbsp;» comme légère mesure de sécurité.</p>
<p>Faites attention à la façon dont vous permettez aux utilisateurs de gérer les autorisations. Si vous donnez à un non-superutilisateur la possibilité d’éditer les utilisateurs, cela revient  finalement au même que de lui donner un statut de super-utilisateur, car il sera en mesure d’élever les autorisations des utilisateurs, y compris les siennes !</p>
</div>
<div class="section" id="s-id7">
<span id="id7"></span><h3>Modification des mots de passe<a class="headerlink" href="#id7" title="Lien permanent vers ce titre">¶</a></h3>
<p>Les mots de passe des utilisateurs ne sont pas affichés dans le site d’administration (ni stockés dans la base de données), mais les <a class="reference internal" href="passwords.html"><span class="doc">détails de stockage des mots de passe</span></a> sont visibles. Ces informations contiennent un lien vers le formulaire de changement de mot de passe permettant aux administrateurs de changer les mots de passe des utilisateurs.</p>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      
        
          <div class="yui-b" id="sidebar">
            
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../contents.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Utilisation du système d’authentification de Django</a><ul>
<li><a class="reference internal" href="#user-objects">Objets utilisateurs</a><ul>
<li><a class="reference internal" href="#creating-users">Création d’utilisateurs</a></li>
<li><a class="reference internal" href="#creating-superusers">Création de superutilisateurs</a></li>
<li><a class="reference internal" href="#changing-passwords">Modification des mots de passe</a></li>
<li><a class="reference internal" href="#authenticating-users">Authentification des utilisateurs</a></li>
</ul>
</li>
<li><a class="reference internal" href="#permissions-and-authorization">Permissions et autorisations</a><ul>
<li><a class="reference internal" href="#default-permissions">Permissions par défaut</a></li>
<li><a class="reference internal" href="#groups">Groupes</a></li>
<li><a class="reference internal" href="#programmatically-creating-permissions">Création programmatique de permissions</a></li>
<li><a class="reference internal" href="#permission-caching">Mise en cache des permissions</a></li>
<li><a class="reference internal" href="#proxy-models">Modèles mandataires</a></li>
</ul>
</li>
<li><a class="reference internal" href="#authentication-in-web-requests">Authentification dans les requêtes Web</a><ul>
<li><a class="reference internal" href="#how-to-log-a-user-in">Connexion d’un utilisateur</a><ul>
<li><a class="reference internal" href="#selecting-the-authentication-backend">Choix du moteur d’authentification</a></li>
</ul>
</li>
<li><a class="reference internal" href="#how-to-log-a-user-out">Déconnexion d’un utilisateur</a></li>
<li><a class="reference internal" href="#limiting-access-to-logged-in-users">Restriction d’accès aux utilisateurs connectés</a><ul>
<li><a class="reference internal" href="#the-raw-way">La manière brute</a></li>
<li><a class="reference internal" href="#the-login-required-decorator">Le décorateur <code class="docutils literal notranslate"><span class="pre">login_required</span></code></a></li>
<li><a class="reference internal" href="#the-loginrequired-mixin">La classe mixin <code class="docutils literal notranslate"><span class="pre">LoginRequired</span></code></a></li>
<li><a class="reference internal" href="#limiting-access-to-logged-in-users-that-pass-a-test">Restriction d’accès aux utilisateurs connectés passant un test</a></li>
<li><a class="reference internal" href="#the-permission-required-decorator">Le décorateur <code class="docutils literal notranslate"><span class="pre">permission_required</span></code></a></li>
<li><a class="reference internal" href="#the-permissionrequiredmixin-mixin">La classe mixin <code class="docutils literal notranslate"><span class="pre">PermissionRequiredMixin</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#redirecting-unauthorized-requests-in-class-based-views">Redirection des requêtes non autorisées dans les vues fondées sur les classes</a><ul>
<li><a class="reference internal" href="#session-invalidation-on-password-change">Invalidation de session lors du changement de mot de passe</a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-django.contrib.auth.views">Vues d’authentification</a><ul>
<li><a class="reference internal" href="#using-the-views">Utilisation des vues</a></li>
<li><a class="reference internal" href="#all-authentication-views">Toutes les vues d’authentification</a></li>
</ul>
</li>
<li><a class="reference internal" href="#helper-functions">Fonctions utilitaires</a></li>
<li><a class="reference internal" href="#module-django.contrib.auth.forms">Formulaires intégrés</a></li>
<li><a class="reference internal" href="#authentication-data-in-templates">Données d’authentification dans les gabarits</a><ul>
<li><a class="reference internal" href="#users">Utilisateurs</a></li>
<li><a class="reference internal" href="#permissions">Permissions</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#managing-users-in-the-admin">Gestion des utilisateurs dans le site d’administration</a><ul>
<li><a class="reference internal" href="#id6">Création d’utilisateurs</a></li>
<li><a class="reference internal" href="#id7">Modification des mots de passe</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Sujet précédent</h4>
  <p class="topless"><a href="index.html"
                        title="Chapitre précédent">Authentification des utilisateurs dans Django</a></p>
  <h4>Sujet suivant</h4>
  <p class="topless"><a href="passwords.html"
                        title="Chapitre suivant">Gestion des mots de passe dans Django</a></p>
  <div role="note" aria-label="source link">
    <h3>Cette page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/topics/auth/default.txt"
            rel="nofollow">Montrer le code source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Recherche rapide</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
              <h3>Last update:</h3>
              <p class="topless">oct. 29, 2020</p>
          </div>
        
      
    </div>

    <div id="ft">
      <div class="nav">
    &laquo; <a href="index.html" title="Authentification des utilisateurs dans Django">previous</a>
     |
    <a href="../index.html" title="Utilisation de Django" accesskey="U">up</a>
   |
    <a href="passwords.html" title="Gestion des mots de passe dans Django">next</a> &raquo;</div>
    </div>
  </div>

      <div class="clearer"></div>
    </div>
  </body>
</html>