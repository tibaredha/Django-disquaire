
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" lang="fr">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Traduction &#8212; Documentation Django 3.1.3.dev</title>
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="../../_static/language_data.js"></script>
    <script type="text/javascript" src="../../_static/translations.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Recherche" href="../../search.html" />
    <link rel="next" title="Régionalisation des formats" href="formatting.html" />
    <link rel="prev" title="Internationalisation et régionalisation" href="index.html" />



 
<script src="../../templatebuiltins.js"></script>
<script>
(function($) {
    if (!django_template_builtins) {
       // templatebuiltins.js missing, do nothing.
       return;
    }
    $(document).ready(function() {
        // Hyperlink Django template tags and filters
        var base = "../../ref/templates/builtins.html";
        if (base == "#") {
            // Special case for builtins.html itself
            base = "";
        }
        // Tags are keywords, class '.k'
        $("div.highlight\\-html\\+django span.k").each(function(i, elem) {
             var tagname = $(elem).text();
             if ($.inArray(tagname, django_template_builtins.ttags) != -1) {
                 var fragment = tagname.replace(/_/, '-');
                 $(elem).html("<a href='" + base + "#" + fragment + "'>" + tagname + "</a>");
             }
        });
        // Filters are functions, class '.nf'
        $("div.highlight\\-html\\+django span.nf").each(function(i, elem) {
             var filtername = $(elem).text();
             if ($.inArray(filtername, django_template_builtins.tfilters) != -1) {
                 var fragment = filtername.replace(/_/, '-');
                 $(elem).html("<a href='" + base + "#" + fragment + "'>" + filtername + "</a>");
             }
        });
    });
})(jQuery);</script>

  </head><body>

    <div class="document">
  <div id="custom-doc" class="yui-t6">
    <div id="hd">
      <h1><a href="../../index.html">Documentation Django 3.1.3.dev</a></h1>
      <div id="global-nav">
        <a title="Home page" href="../../index.html">Home</a>  |
        <a title="Table of contents" href="../../contents.html">Table of contents</a>  |
        <a title="Global index" href="../../genindex.html">Index</a>  |
        <a title="Module index" href="../../py-modindex.html">Modules</a>
      </div>
      <div class="nav">
    &laquo; <a href="index.html" title="Internationalisation et régionalisation">previous</a>
     |
    <a href="../index.html" title="Utilisation de Django" accesskey="U">up</a>
   |
    <a href="formatting.html" title="Régionalisation des formats">next</a> &raquo;</div>
    </div>

    <div id="bd">
      <div id="yui-main">
        <div class="yui-b">
          <div class="yui-g" id="topics-i18n-translation">
            
  <div class="section" id="s-translation">
<span id="translation"></span><h1>Traduction<a class="headerlink" href="#translation" title="Lien permanent vers ce titre">¶</a></h1>
<div class="section" id="s-overview">
<span id="overview"></span><h2>Aperçu<a class="headerlink" href="#overview" title="Lien permanent vers ce titre">¶</a></h2>
<p>Dans le but de rendre traduisible un projet Django, il est nécessaire d’ajouter un minimum de marqueurs dans le code Python et les gabarits. Ces marqueurs s’appellent des <a class="reference internal" href="index.html#term-translation-string"><span class="xref std std-term">chaînes de traduction</span></a>. Ils indiquent à Django que «&nbsp;ce texte doit être traduit dans la langue de l’utilisateur pour autant qu’il existe une traduction de ce texte dans cette langue&nbsp;». Il est de votre responsabilité de marquer les chaînes de caractères traduisibles&nbsp;; le système ne peut traduire que les éléments qu’on lui a indiqués.</p>
<p>Django fournit ensuite des utilitaires pour extraire les chaînes à traduire dans un <a class="reference internal" href="index.html#term-message-file"><span class="xref std std-term">fichier de messages</span></a>. Ce fichier sert ensuite aux traducteurs qui pourront faire leur travail en rédigeant les équivalences des chaînes à traduire dans leur langue. Lorsque que ce travail est terminé, le fichier doit être compilé. Ce processus se base sur les outils GNU gettext.</p>
<p>Quand tout cela est fait, Django s’occupe de traduire les applications Web à la volée dans chacune des langues disponibles, en accord avec les préférences linguistiques des utilisateurs.</p>
<p>Le système d’internationalisation de Django est activé par défaut, ce qui peut générer un petit surplus de travail à certains endroits du système. Si vous n’utilisez pas l’internationalisation, prenez les deux secondes nécessaires à définir <a class="reference internal" href="../../ref/settings.html#std:setting-USE_I18N"><code class="xref std std-setting docutils literal notranslate"><span class="pre">USE_I18N</span> <span class="pre">=</span> <span class="pre">False</span></code></a> dans votre fichier de réglages. Django pourra alors effectuer certaines optimisations en ne chargeant pas tout le mécanisme d’internationalisation.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Il existe également un réglage différent mais lié nommé <a class="reference internal" href="../../ref/settings.html#std:setting-USE_L10N"><code class="xref std std-setting docutils literal notranslate"><span class="pre">USE_L10N</span></code></a> qui contrôle l’activation ou non des formats de régionalisation. Voir <a class="reference internal" href="formatting.html"><span class="doc">Régionalisation des formats</span></a> pour plus de détails.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Vérifiez si la traduction est activée dans votre projet (la manière la plus rapide est de contrôler la présence de <a class="reference internal" href="../../ref/middleware.html#django.middleware.locale.LocaleMiddleware" title="django.middleware.locale.LocaleMiddleware"><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.middleware.locale.LocaleMiddleware</span></code></a> dans <a class="reference internal" href="../../ref/settings.html#std:setting-MIDDLEWARE"><code class="xref std std-setting docutils literal notranslate"><span class="pre">MIDDLEWARE</span></code></a>). Si ce n’est pas encore fait, lisez <a class="reference internal" href="#how-django-discovers-language-preference"><span class="std std-ref">Processus de découverte de la préférence de langue par Django</span></a>.</p>
</div>
</div>
<div class="section" id="s-internationalization-in-python-code">
<span id="internationalization-in-python-code"></span><h2>Internationalisation&nbsp;: dans le code Python<a class="headerlink" href="#internationalization-in-python-code" title="Lien permanent vers ce titre">¶</a></h2>
<div class="section" id="s-standard-translation">
<span id="standard-translation"></span><h3>Traduction standard<a class="headerlink" href="#standard-translation" title="Lien permanent vers ce titre">¶</a></h3>
<p>Définissez une chaîne à traduire en utilisant la fonction <a class="reference internal" href="../../ref/utils.html#django.utils.translation.gettext" title="django.utils.translation.gettext"><code class="xref py py-func docutils literal notranslate"><span class="pre">gettext()</span></code></a>. Par convention, il est fréquent de l’importer par un alias plus court, <code class="docutils literal notranslate"><span class="pre">_</span></code>, pour s’économiser des frappes au clavier.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Le module <code class="docutils literal notranslate"><span class="pre">gettext</span></code> de la bibliothèque Python standard installe <code class="docutils literal notranslate"><span class="pre">_()</span></code> dans l’espace de noms global comme alias de <code class="docutils literal notranslate"><span class="pre">gettext()</span></code>. Dans Django, nous avons choisi de ne pas suivre cette pratique, pour plusieurs raisons&nbsp;:</p>
<ol class="last arabic simple">
<li>Parfois, il est préférable d’utiliser <a class="reference internal" href="../../ref/utils.html#django.utils.translation.gettext_lazy" title="django.utils.translation.gettext_lazy"><code class="xref py py-func docutils literal notranslate"><span class="pre">gettext_lazy()</span></code></a> comme méthode de traduction par défaut dans un certain fichier. En l’absence de <code class="docutils literal notranslate"><span class="pre">_()</span></code> dans l’espace de noms global, le développeur doit réfléchir à ce qui est le plus approprié comme fonction de traduction.</li>
<li>Le caractère soulignement (<code class="docutils literal notranslate"><span class="pre">_</span></code>) est utilisé pour représenter le «&nbsp;résultat précédent&nbsp;» dans le shell interactif de Python et les tests <code class="docutils literal notranslate"><span class="pre">doctest</span></code>. L’installation globale de <code class="docutils literal notranslate"><span class="pre">_()</span></code> interfère avec le précédent. L’importation explicite de <code class="docutils literal notranslate"><span class="pre">gettext()</span></code> comme <code class="docutils literal notranslate"><span class="pre">_()</span></code> évite ce problème.</li>
</ol>
</div>
<div class="admonition-what-functions-may-be-aliased-as admonition">
<p class="first admonition-title">Quelles fonctions peuvent-elles avoir <code class="docutils literal notranslate"><span class="pre">_</span></code> comme alias&nbsp;?</p>
<p>En raison du fonctionnement de <code class="docutils literal notranslate"><span class="pre">xgettext</span></code> (utilisé par <a class="reference internal" href="../../ref/django-admin.html#django-admin-makemessages"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">makemessages</span></code></a>), seules les fonctions acceptant un seul paramètre textuel peuvent être importées avec l’alias <code class="docutils literal notranslate"><span class="pre">_</span></code>:</p>
<ul class="last simple">
<li><a class="reference internal" href="../../ref/utils.html#django.utils.translation.gettext" title="django.utils.translation.gettext"><code class="xref py py-func docutils literal notranslate"><span class="pre">gettext()</span></code></a></li>
<li><a class="reference internal" href="../../ref/utils.html#django.utils.translation.gettext_lazy" title="django.utils.translation.gettext_lazy"><code class="xref py py-func docutils literal notranslate"><span class="pre">gettext_lazy()</span></code></a></li>
</ul>
</div>
<p>Dans cet exemple, le texte <code class="docutils literal notranslate"><span class="pre">&quot;Welcome</span> <span class="pre">to</span> <span class="pre">my</span> <span class="pre">site.&quot;</span></code> est marqué comme chaîne à traduire&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.http</span> <span class="k">import</span> <span class="n">HttpResponse</span>
<span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="k">import</span> <span class="n">gettext</span> <span class="k">as</span> <span class="n">_</span>

<span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;Welcome to my site.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</pre></div>
</div>
<p>On aurait pu écrire cela sans employer l’alias. Cet exemple est identique au précédent&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.http</span> <span class="k">import</span> <span class="n">HttpResponse</span>
<span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="k">import</span> <span class="n">gettext</span>

<span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">gettext</span><span class="p">(</span><span class="s2">&quot;Welcome to my site.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</pre></div>
</div>
<p>La traduction fonctionne sur des valeurs calculées. Cet exemple est identique aux deux précédents&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">words</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Welcome&#39;</span><span class="p">,</span> <span class="s1">&#39;to&#39;</span><span class="p">,</span> <span class="s1">&#39;my&#39;</span><span class="p">,</span> <span class="s1">&#39;site.&#39;</span><span class="p">]</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">words</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</pre></div>
</div>
<p>La traduction fonctionne avec des variables. Encore une fois, voici un exemple identique&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="n">sentence</span> <span class="o">=</span> <span class="s1">&#39;Welcome to my site.&#39;</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="n">sentence</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</pre></div>
</div>
<p>(L’inconvénient avec l’utilisation de variables ou de valeurs calculées comme dans les deux exemples précédents, c’est que l’utilitaire de détection des chaînes à traduire de Django, <a class="reference internal" href="../../ref/django-admin.html#django-admin-makemessages"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">django-admin</span> <span class="pre">makemessages</span></code></a>, ne sera pas capable de trouver ces chaînes. Plus de détails sur <a class="reference internal" href="../../ref/django-admin.html#django-admin-makemessages"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">makemessages</span></code></a> un peu plus tard.)</p>
<p>Les chaînes que vous placez dans <code class="docutils literal notranslate"><span class="pre">_()</span></code> ou <code class="docutils literal notranslate"><span class="pre">gettext()</span></code> acceptent des substituants sous la forme de la syntaxe d’interpolation par paramètres nommés standard de Python. Exemple&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">d</span><span class="p">):</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Today is </span><span class="si">%(month)s</span><span class="s1"> </span><span class="si">%(day)s</span><span class="s1">.&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">{</span><span class="s1">&#39;month&#39;</span><span class="p">:</span> <span class="n">m</span><span class="p">,</span> <span class="s1">&#39;day&#39;</span><span class="p">:</span> <span class="n">d</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>
</pre></div>
</div>
<p>Cette technique permet aux différentes traductions de modifier l’ordre des substituants. Par exemple, pour un texte anglais <code class="docutils literal notranslate"><span class="pre">&quot;Today</span> <span class="pre">is</span> <span class="pre">November</span> <span class="pre">26.&quot;</span></code>, la traduction espagnole pourrait être <code class="docutils literal notranslate"><span class="pre">&quot;Hoy</span> <span class="pre">es</span> <span class="pre">26</span> <span class="pre">de</span> <span class="pre">noviembre.&quot;</span></code>, avec les substituants mois et jour intervertis.</p>
<p>Pour cette raison, il est recommandé d’utiliser l’interpolation par paramètre nommé (ex&nbsp;: <code class="docutils literal notranslate"><span class="pre">%(day)s</span></code>) au lieu de l’interpolation par position (ex&nbsp;: <code class="docutils literal notranslate"><span class="pre">%s</span></code> ou <code class="docutils literal notranslate"><span class="pre">%d</span></code>) chaque fois qu’il y a plus d’un paramètre. Avec l’interpolation par position, les traductions ne peuvent pas changer l’ordre des substituants.</p>
<p>Comme l’extraction de chaînes est effectuée par la commande <code class="docutils literal notranslate"><span class="pre">xgettext</span></code>, seules les syntaxes prises en charge par <code class="docutils literal notranslate"><span class="pre">gettext</span></code> sont prises en charge par Django. En particulier, les chaînes Python <a class="reference external" href="https://docs.python.org/3/reference/lexical_analysis.html#f-strings" title="(disponible dans Python v3.9)"><span class="xref std std-ref">f-strings</span></a> ne sont actuellement pas prises en charge par <code class="docutils literal notranslate"><span class="pre">xgettext</span></code> et les chaînes « template strings » de JavaScript nécessitent une version de <code class="docutils literal notranslate"><span class="pre">gettext</span></code> à partir de 0.21.</p>
</div>
<div class="section" id="s-comments-for-translators">
<span id="s-translator-comments"></span><span id="comments-for-translators"></span><span id="translator-comments"></span><h3>Commentaires pour les traducteurs<a class="headerlink" href="#comments-for-translators" title="Lien permanent vers ce titre">¶</a></h3>
<p>Si vous souhaitez donner des indications aux traducteurs à propos d’une chaîne à traduire, vous pouvez ajouter un commentaire préfixé par le mot-clé <code class="docutils literal notranslate"><span class="pre">Translators</span></code> à la ligne précédant la chaîne&nbsp;; par exemple&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">my_view</span><span class="p">(</span><span class="n">request</span><span class="p">):</span>
    <span class="c1"># Translators: This message appears on the home page only</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">gettext</span><span class="p">(</span><span class="s2">&quot;Welcome to my site.&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Le commentaire apparaîtra alors dans le fichier <code class="docutils literal notranslate"><span class="pre">.po</span></code> résultant de l’extraction des chaînes, juste avant le bloc de la chaîne à traduire, et la plupart des outils de traduction l’affichent également dans leur interface.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Pour les curieux, voici le fragment correspondant dans le fichier <code class="docutils literal notranslate"><span class="pre">.po</span></code> résultant&nbsp;:</p>
<div class="last highlight-po notranslate"><div class="highlight"><pre><span></span><span class="c1">#. Translators: This message appears on the home page only</span>
<span class="c1"># path/to/python/file.py:123</span>
<span class="nv">msgid</span> <span class="s">&quot;Welcome to my site.&quot;</span>
<span class="nv">msgstr</span> <span class="s">&quot;&quot;</span>
</pre></div>
</div>
</div>
<p>Cela fonctionne aussi dans les gabarits. Voir <a class="reference internal" href="#translator-comments-in-templates"><span class="std std-ref">Commentaires pour les traducteurs dans les gabarits</span></a> pour plus de détails.</p>
</div>
<div class="section" id="s-marking-strings-as-no-op">
<span id="marking-strings-as-no-op"></span><h3>Marquage des chaînes «&nbsp;en blanc&nbsp;»<a class="headerlink" href="#marking-strings-as-no-op" title="Lien permanent vers ce titre">¶</a></h3>
<p>La fonction <a class="reference internal" href="../../ref/utils.html#django.utils.translation.gettext_noop" title="django.utils.translation.gettext_noop"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.utils.translation.gettext_noop()</span></code></a> permet de marquer une chaîne comme chaîne à traduire, mais sans la traduire réellement. La traduction effective peut se faire plus tard à partir d’une variable.</p>
<p>Cette technique est utile pour des chaînes constantes devant être stockées dans la langue source parce qu’elles sont échangées entre systèmes ou utilisateurs, comme des chaînes en base de données, mais qu’elles devraient être traduites le plus tard possible, juste avant d’être affichées pour un utilisateur.</p>
</div>
<div class="section" id="s-pluralization">
<span id="pluralization"></span><h3>Pluriels<a class="headerlink" href="#pluralization" title="Lien permanent vers ce titre">¶</a></h3>
<p>La fonction <a class="reference internal" href="../../ref/utils.html#django.utils.translation.ngettext" title="django.utils.translation.ngettext"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.utils.translation.ngettext()</span></code></a> permet de marquer des messages contenant un pluriel.</p>
<p><code class="docutils literal notranslate"><span class="pre">ngettext()</span></code> accepte trois paramètres&nbsp;: la chaîne à traduire au singulier, la chaîne à traduire au pluriel et le nombre d’objets.</p>
<p>Cette fonction est utile lorsque vous voulez traduire votre application Django dans des langues où le nombre et la complexité des <a class="reference external" href="https://www.gnu.org/software/gettext/manual/gettext.html#Plural-forms">formes plurielles</a> sont plus grands que les deux formes utilisées en anglais («&nbsp;object&nbsp;» pour le singulier et «&nbsp;objects&nbsp;» dans tous les cas où <code class="docutils literal notranslate"><span class="pre">count</span></code> est différent de un, quelle que soit sa valeur).</p>
<p>Par exemple&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.http</span> <span class="k">import</span> <span class="n">HttpResponse</span>
<span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="k">import</span> <span class="n">ngettext</span>

<span class="k">def</span> <span class="nf">hello_world</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
    <span class="n">page</span> <span class="o">=</span> <span class="n">ngettext</span><span class="p">(</span>
        <span class="s1">&#39;there is </span><span class="si">%(count)d</span><span class="s1"> object&#39;</span><span class="p">,</span>
        <span class="s1">&#39;there are </span><span class="si">%(count)d</span><span class="s1"> objects&#39;</span><span class="p">,</span>
    <span class="n">count</span><span class="p">)</span> <span class="o">%</span> <span class="p">{</span>
        <span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="n">count</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="n">page</span><span class="p">)</span>
</pre></div>
</div>
<p>Dans cet exemple, le nombre d’objets est communiqué à la langue de traduction par la variable <code class="docutils literal notranslate"><span class="pre">count</span></code>.</p>
<p>Notez que les pluriels sont compliqués et fonctionnent différemment pour chaque langue. La comparaison de <code class="docutils literal notranslate"><span class="pre">count</span></code> avec 1 n’est pas toujours la règle correcte. Ce code semble sophistiqué, mais produira des résultats incorrects pour certaines langues&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="k">import</span> <span class="n">ngettext</span>
<span class="kn">from</span> <span class="nn">myapp.models</span> <span class="k">import</span> <span class="n">Report</span>

<span class="n">count</span> <span class="o">=</span> <span class="n">Report</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="k">if</span> <span class="n">count</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Report</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">verbose_name</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Report</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">verbose_name_plural</span>

<span class="n">text</span> <span class="o">=</span> <span class="n">ngettext</span><span class="p">(</span>
    <span class="s1">&#39;There is </span><span class="si">%(count)d</span><span class="s1"> </span><span class="si">%(name)s</span><span class="s1"> available.&#39;</span><span class="p">,</span>
    <span class="s1">&#39;There are </span><span class="si">%(count)d</span><span class="s1"> </span><span class="si">%(name)s</span><span class="s1"> available.&#39;</span><span class="p">,</span>
    <span class="n">count</span>
<span class="p">)</span> <span class="o">%</span> <span class="p">{</span>
    <span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="n">count</span><span class="p">,</span>
    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">name</span>
<span class="p">}</span>
</pre></div>
</div>
<p>N’essayez pas d’implémenter votre propre logique de singulier/pluriel, vous n’y arriverez pas. Dans un cas comme celui-ci, pensez plutôt à faire quelque chose comme&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">text</span> <span class="o">=</span> <span class="n">ngettext</span><span class="p">(</span>
    <span class="s1">&#39;There is </span><span class="si">%(count)d</span><span class="s1"> </span><span class="si">%(name)s</span><span class="s1"> object available.&#39;</span><span class="p">,</span>
    <span class="s1">&#39;There are </span><span class="si">%(count)d</span><span class="s1"> </span><span class="si">%(name)s</span><span class="s1"> objects available.&#39;</span><span class="p">,</span>
    <span class="n">count</span>
<span class="p">)</span> <span class="o">%</span> <span class="p">{</span>
    <span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="n">count</span><span class="p">,</span>
    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">Report</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="admonition note" id="pluralization-var-notes">
<p class="first admonition-title">Note</p>
<p>En utilisant <code class="docutils literal notranslate"><span class="pre">ngettext()</span></code>, prenez soin de toujours utiliser le même nom pour chaque variable extrapolée incluse dans la chaîne. Dans les exemples ci-dessus, notez comment nous avons utilisé la variable Python <code class="docutils literal notranslate"><span class="pre">name</span></code> dans les deux chaînes à traduire. Cet exemple, en plus d’être faux pour certaines langues comme nous l’avons mentionné, ne fonctionnera pas&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">text</span> <span class="o">=</span> <span class="n">ngettext</span><span class="p">(</span>
    <span class="s1">&#39;There is </span><span class="si">%(count)d</span><span class="s1"> </span><span class="si">%(name)s</span><span class="s1"> available.&#39;</span><span class="p">,</span>
    <span class="s1">&#39;There are </span><span class="si">%(count)d</span><span class="s1"> </span><span class="si">%(plural_name)s</span><span class="s1"> available.&#39;</span><span class="p">,</span>
    <span class="n">count</span>
<span class="p">)</span> <span class="o">%</span> <span class="p">{</span>
    <span class="s1">&#39;count&#39;</span><span class="p">:</span> <span class="n">Report</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span>
    <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">Report</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">verbose_name</span><span class="p">,</span>
    <span class="s1">&#39;plural_name&#39;</span><span class="p">:</span> <span class="n">Report</span><span class="o">.</span><span class="n">_meta</span><span class="o">.</span><span class="n">verbose_name_plural</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Vous obtiendriez une erreur lors du lancement de <a class="reference internal" href="../../ref/django-admin.html#django-admin-compilemessages"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">django-admin</span> <span class="pre">compilemessages</span></code></a>:</p>
<div class="last highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="nb">format</span> <span class="n">specification</span> <span class="k">for</span> <span class="n">argument</span> <span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="k">as</span> <span class="ow">in</span> <span class="s1">&#39;msgstr[0]&#39;</span><span class="p">,</span> <span class="n">doesn</span><span class="s1">&#39;t exist in &#39;</span><span class="n">msgid</span><span class="s1">&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="s-contextual-markers">
<span id="s-id1"></span><span id="contextual-markers"></span><span id="id1"></span><h3>Marqueurs contextuels<a class="headerlink" href="#contextual-markers" title="Lien permanent vers ce titre">¶</a></h3>
<p>Il peut arriver que des mots ont plusieurs significations, comme <code class="docutils literal notranslate"><span class="pre">&quot;May&quot;</span></code> en anglais, qui peut se référer à un nom de mois ou à un verbe. Pour permettre aux traducteurs de traduire correctement ces mots dans des contextes différents, il est possible d’utiliser la fonction <a class="reference internal" href="../../ref/utils.html#django.utils.translation.pgettext" title="django.utils.translation.pgettext"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.utils.translation.pgettext()</span></code></a>, ou <a class="reference internal" href="../../ref/utils.html#django.utils.translation.npgettext" title="django.utils.translation.npgettext"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.utils.translation.npgettext()</span></code></a> si la chaîne contient des pluriels. Les deux acceptent une chaîne de contexte comme premier paramètre.</p>
<p>Dans le fichier <code class="docutils literal notranslate"><span class="pre">.po</span></code> résultant, la même chaîne apparaîtra aussi souvent qu’il y a de marqueurs contextuels différents (le contexte apparaît à la ligne <code class="docutils literal notranslate"><span class="pre">msgctxt</span></code>), permettant ainsi au traducteur d’attribuer des traductions différentes à chacune d’elles.</p>
<p>Par exemple&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="k">import</span> <span class="n">pgettext</span>

<span class="n">month</span> <span class="o">=</span> <span class="n">pgettext</span><span class="p">(</span><span class="s2">&quot;month name&quot;</span><span class="p">,</span> <span class="s2">&quot;May&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>ou&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="k">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="k">import</span> <span class="n">pgettext_lazy</span>

<span class="k">class</span> <span class="nc">MyThing</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="n">pgettext_lazy</span><span class="p">(</span>
        <span class="s1">&#39;help text for MyThing model&#39;</span><span class="p">,</span> <span class="s1">&#39;This is the help text&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>apparaîtra dans le fichier <code class="docutils literal notranslate"><span class="pre">.po</span></code> comme&nbsp;:</p>
<div class="highlight-po notranslate"><div class="highlight"><pre><span></span><span class="nv">msgctxt</span> <span class="s">&quot;month name&quot;</span>
<span class="nv">msgid</span> <span class="s">&quot;May&quot;</span>
<span class="nv">msgstr</span> <span class="s">&quot;&quot;</span>
</pre></div>
</div>
<p>Les marqueurs contextuels sont également pris en charge par les balises de gabarit <a class="reference internal" href="#std:templatetag-translate"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">translate</span></code></a> et <a class="reference internal" href="#std:templatetag-blocktranslate"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">blocktranslate</span></code></a>.</p>
</div>
<div class="section" id="s-lazy-translation">
<span id="s-lazy-translations"></span><span id="lazy-translation"></span><span id="lazy-translations"></span><h3>Traduction différée<a class="headerlink" href="#lazy-translation" title="Lien permanent vers ce titre">¶</a></h3>
<p>Les versions différées des fonctions de traduction dans <a class="reference internal" href="../../ref/utils.html#module-django.utils.translation" title="django.utils.translation: Internationalization support."><code class="xref py py-mod docutils literal notranslate"><span class="pre">django.utils.translation</span></code></a> (facilement reconnaissables par le suffixe <code class="docutils literal notranslate"><span class="pre">lazy</span></code> dans leur nom) permettent de traduire du texte en différé, au moment où la chaîne est réellement utilisée plutôt qu’au moment où la fonction est appelée.</p>
<p>Ces fonctions stockent une référence différée à la chaîne originale, et non pas la traduction réelle. La traduction en tant que telle est effectuée lorsque le texte est utilisé dans un contexte textuel, par exemple dans le rendu d’un gabarit.</p>
<p>Ce procédé est essentiel lorsque les appels à ces fonctions sont situés dans des endroits du code qui sont exécutés lors du chargement des modules.</p>
<p>Ceci peut facilement se produire lors de la définition des modèles, des formulaires et des formulaires de modèle, car la manière dont Django les implémente fait que leurs champs sont des attributs de classe. C’est pour cette raison qu’il faut utiliser des traductions différées dans les cas suivants&nbsp;:</p>
<div class="section" id="s-model-fields-and-relationships-verbose-name-and-help-text-option-values">
<span id="model-fields-and-relationships-verbose-name-and-help-text-option-values"></span><h4>Valeurs d’options <code class="docutils literal notranslate"><span class="pre">verbose_name</span></code> et <code class="docutils literal notranslate"><span class="pre">help_text</span></code> des champs et relations de modèle<a class="headerlink" href="#model-fields-and-relationships-verbose-name-and-help-text-option-values" title="Lien permanent vers ce titre">¶</a></h4>
<p>Par exemple, pour traduire le texte d’aide du champ <code class="docutils literal notranslate"><span class="pre">name</span></code> dans le modèle suivant, faites comme ceci&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="k">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="k">import</span> <span class="n">gettext_lazy</span> <span class="k">as</span> <span class="n">_</span>

<span class="k">class</span> <span class="nc">MyThing</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;This is the help text&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>Vous pouvez marquer les noms des relations <a class="reference internal" href="../../ref/models/fields.html#django.db.models.ForeignKey" title="django.db.models.ForeignKey"><code class="xref py py-class docutils literal notranslate"><span class="pre">ForeignKey</span></code></a>, <a class="reference internal" href="../../ref/models/fields.html#django.db.models.ManyToManyField" title="django.db.models.ManyToManyField"><code class="xref py py-class docutils literal notranslate"><span class="pre">ManyToManyField</span></code></a> ou <a class="reference internal" href="../../ref/models/fields.html#django.db.models.OneToOneField" title="django.db.models.OneToOneField"><code class="xref py py-class docutils literal notranslate"><span class="pre">OneToOneField</span></code></a> comme chaînes à traduire en utilisant leur option <a class="reference internal" href="../../ref/models/options.html#django.db.models.Options.verbose_name" title="django.db.models.Options.verbose_name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">verbose_name</span></code></a>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyThing</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">kind</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="n">ThingKind</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;kinds&#39;</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;kind&#39;</span><span class="p">),</span>
    <span class="p">)</span>
</pre></div>
</div>
<p>Comme vous le feriez pour <a class="reference internal" href="../../ref/models/options.html#django.db.models.Options.verbose_name" title="django.db.models.Options.verbose_name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">verbose_name</span></code></a>, le texte de nom verbeux de la relation devrait être en minuscules, car Django s’occupe de mettre les majuscules dans les situations appropriées.</p>
</div>
<div class="section" id="s-model-verbose-names-values">
<span id="model-verbose-names-values"></span><h4>Valeurs de noms verbeux de modèle<a class="headerlink" href="#model-verbose-names-values" title="Lien permanent vers ce titre">¶</a></h4>
<p>Il est recommandé de toujours fournir les options explicites <a class="reference internal" href="../../ref/models/options.html#django.db.models.Options.verbose_name" title="django.db.models.Options.verbose_name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">verbose_name</span></code></a> et <a class="reference internal" href="../../ref/models/options.html#django.db.models.Options.verbose_name_plural" title="django.db.models.Options.verbose_name_plural"><code class="xref py py-attr docutils literal notranslate"><span class="pre">verbose_name_plural</span></code></a> plutôt que de vous rabattre sur la version anglo-centrique et déterminée de manière quelque peu naïve du nom verbeux que Django crée en se basant sur le nom de classe du modèle&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="k">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="k">import</span> <span class="n">gettext_lazy</span> <span class="k">as</span> <span class="n">_</span>

<span class="k">class</span> <span class="nc">MyThing</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">),</span> <span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;This is the help text&#39;</span><span class="p">))</span>

    <span class="k">class</span> <span class="nc">Meta</span><span class="p">:</span>
        <span class="n">verbose_name</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;my thing&#39;</span><span class="p">)</span>
        <span class="n">verbose_name_plural</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;my things&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="s-model-methods-short-description-attribute-values">
<span id="model-methods-short-description-attribute-values"></span><h4>Valeurs d’attribut <code class="docutils literal notranslate"><span class="pre">short_description</span></code> des méthodes de modèle<a class="headerlink" href="#model-methods-short-description-attribute-values" title="Lien permanent vers ce titre">¶</a></h4>
<p>Pour les méthodes de modèle, vous pouvez indiquer à Django et au site d’administration des descriptions traduisibles dans l’attribut <code class="docutils literal notranslate"><span class="pre">short_description</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="k">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="k">import</span> <span class="n">gettext_lazy</span> <span class="k">as</span> <span class="n">_</span>

<span class="k">class</span> <span class="nc">MyThing</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">kind</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">ForeignKey</span><span class="p">(</span>
        <span class="n">ThingKind</span><span class="p">,</span>
        <span class="n">on_delete</span><span class="o">=</span><span class="n">models</span><span class="o">.</span><span class="n">CASCADE</span><span class="p">,</span>
        <span class="n">related_name</span><span class="o">=</span><span class="s1">&#39;kinds&#39;</span><span class="p">,</span>
        <span class="n">verbose_name</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;kind&#39;</span><span class="p">),</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">is_mouse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">kind</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="n">MOUSE_TYPE</span>
    <span class="n">is_mouse</span><span class="o">.</span><span class="n">short_description</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;Is it a mouse?&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="s-working-with-lazy-translation-objects">
<span id="working-with-lazy-translation-objects"></span><h3>Manipulation des objets de traduction différée<a class="headerlink" href="#working-with-lazy-translation-objects" title="Lien permanent vers ce titre">¶</a></h3>
<p>Le résultat d’un appel à <code class="docutils literal notranslate"><span class="pre">gettext_lazy()</span></code> peut être utilisé partout là où une chaîne (un objet <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str" title="(disponible dans Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">str</span></code></a>) peut être utilisée dans le code Django, mais cela ne fonctionne par forcément avec n’importe quel code Python. Par exemple, le code suivant ne marchera pas car la bibliothèque <a class="reference external" href="https://pypi.org/project/requests/">requests</a> ne gère pas les objets <code class="docutils literal notranslate"><span class="pre">gettext_lazy</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">body</span> <span class="o">=</span> <span class="n">gettext_lazy</span><span class="p">(</span><span class="s2">&quot;I </span><span class="se">\u2764</span><span class="s2"> Django&quot;</span><span class="p">)</span>  <span class="c1"># (Unicode :heart:)</span>
<span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;https://example.com/send&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;body&#39;</span><span class="p">:</span> <span class="n">body</span><span class="p">})</span>
</pre></div>
</div>
<p>Vous pouvez éviter ce genre de problème en forçant les objets <code class="docutils literal notranslate"><span class="pre">gettext_lazy()</span></code> en chaînes de texte avant de les passer à du code non Django&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">requests</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s1">&#39;https://example.com/send&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;body&#39;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">body</span><span class="p">)})</span>
</pre></div>
</div>
<p>Si vous n’aimez pas le long nom de <code class="docutils literal notranslate"><span class="pre">gettext_lazy</span></code>, vous pouvez en faire un alias <code class="docutils literal notranslate"><span class="pre">_</span></code> (soulignement), comme ceci&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.db</span> <span class="k">import</span> <span class="n">models</span>
<span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="k">import</span> <span class="n">gettext_lazy</span> <span class="k">as</span> <span class="n">_</span>

<span class="k">class</span> <span class="nc">MyThing</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Model</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">models</span><span class="o">.</span><span class="n">CharField</span><span class="p">(</span><span class="n">help_text</span><span class="o">=</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;This is the help text&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>L’utilisation de <code class="docutils literal notranslate"><span class="pre">gettext_lazy()</span></code> et <code class="docutils literal notranslate"><span class="pre">ngettext_lazy()</span></code> pour marquer des chaînes dans des modèles et des fonctions utilitaires est une opération courante. Lorsque que vous manipulez ces objets ailleurs dans votre code, vous devriez prendre soin de ne jamais les convertir accidentellement en chaînes de caractères, car ils devraient être convertis le plus tard possible (afin que la langue correcte soit active). Ceci nécessite l’emploi de la fonction utilitaire décrite ci-après.</p>
<div class="section" id="s-lazy-translations-and-plural">
<span id="s-lazy-plural-translations"></span><span id="lazy-translations-and-plural"></span><span id="lazy-plural-translations"></span><h4>Traductions différées et pluriels<a class="headerlink" href="#lazy-translations-and-plural" title="Lien permanent vers ce titre">¶</a></h4>
<p>Lors de l’utilisation de traductions différées avec une chaîne contenant des pluriels (<code class="docutils literal notranslate"><span class="pre">n[p]gettext_lazy</span></code>), vous ne connaissez généralement pas le paramètre <code class="docutils literal notranslate"><span class="pre">number</span></code> au moment de la définition de la chaîne. C’est pourquoi vous êtes autorisé dans ce cas à passer un nom de clé au lieu d’un nombre comme paramètre <code class="docutils literal notranslate"><span class="pre">number</span></code>. Ensuite, cette clé <code class="docutils literal notranslate"><span class="pre">number</span></code> sera cherchée dans le dictionnaire durant l’extrapolation de la chaîne. Voici un exemple&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django</span> <span class="k">import</span> <span class="n">forms</span>
<span class="kn">from</span> <span class="nn">django.core.exceptions</span> <span class="k">import</span> <span class="n">ValidationError</span>
<span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="k">import</span> <span class="n">ngettext_lazy</span>

<span class="k">class</span> <span class="nc">MyForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">Form</span><span class="p">):</span>
    <span class="n">error_message</span> <span class="o">=</span> <span class="n">ngettext_lazy</span><span class="p">(</span><span class="s2">&quot;You only provided </span><span class="si">%(num)d</span><span class="s2"> argument&quot;</span><span class="p">,</span>
        <span class="s2">&quot;You only provided </span><span class="si">%(num)d</span><span class="s2"> arguments&quot;</span><span class="p">,</span> <span class="s1">&#39;num&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">clean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># ...</span>
        <span class="k">if</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">error_message</span> <span class="o">%</span> <span class="p">{</span><span class="s1">&#39;num&#39;</span><span class="p">:</span> <span class="n">number</span><span class="p">})</span>
</pre></div>
</div>
<p>Si la chaîne contient un seul substituant non nommé, vous pouvez directement interpoler avec le paramètre <code class="docutils literal notranslate"><span class="pre">number</span></code>:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">MyForm</span><span class="p">(</span><span class="n">forms</span><span class="o">.</span><span class="n">Form</span><span class="p">):</span>
    <span class="n">error_message</span> <span class="o">=</span> <span class="n">ngettext_lazy</span><span class="p">(</span>
        <span class="s2">&quot;You provided </span><span class="si">%d</span><span class="s2"> argument&quot;</span><span class="p">,</span>
        <span class="s2">&quot;You provided </span><span class="si">%d</span><span class="s2"> arguments&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">clean</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># ...</span>
        <span class="k">if</span> <span class="n">error</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">ValidationError</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">error_message</span> <span class="o">%</span> <span class="n">number</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="s-formatting-strings-format-lazy">
<span id="formatting-strings-format-lazy"></span><h4>Mise en forme de chaînes&nbsp;: <code class="docutils literal notranslate"><span class="pre">format_lazy()</span></code><a class="headerlink" href="#formatting-strings-format-lazy" title="Lien permanent vers ce titre">¶</a></h4>
<p>La méthode <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str.format" title="(disponible dans Python v3.9)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">str.format()</span></code></a> de Python ne fonctionne pas quand la chaîne <code class="docutils literal notranslate"><span class="pre">format_string</span></code> ou l’un des paramètres de <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#str.format" title="(disponible dans Python v3.9)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">str.format()</span></code></a> contient des objets de traduction différée. Il faut utiliser <a class="reference internal" href="../../ref/utils.html#django.utils.text.format_lazy" title="django.utils.text.format_lazy"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.utils.text.format_lazy()</span></code></a> à la place, ce qui va créer un objet différé qui se chargera d’exécuter la méthode <code class="docutils literal notranslate"><span class="pre">str.format()</span></code> au moment précis ou le résultat sera inclus dans une chaîne. Par exemple&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.utils.text</span> <span class="k">import</span> <span class="n">format_lazy</span>
<span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="k">import</span> <span class="n">gettext_lazy</span>
<span class="o">...</span>
<span class="n">name</span> <span class="o">=</span> <span class="n">gettext_lazy</span><span class="p">(</span><span class="s1">&#39;John Lennon&#39;</span><span class="p">)</span>
<span class="n">instrument</span> <span class="o">=</span> <span class="n">gettext_lazy</span><span class="p">(</span><span class="s1">&#39;guitar&#39;</span><span class="p">)</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">format_lazy</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{name}</span><span class="s1">: </span><span class="si">{instrument}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span> <span class="n">instrument</span><span class="o">=</span><span class="n">instrument</span><span class="p">)</span>
</pre></div>
</div>
<p>Dans ce cas, les traductions différées dans <code class="docutils literal notranslate"><span class="pre">result</span></code> ne seront converties en chaînes qu’au moment où <code class="docutils literal notranslate"><span class="pre">result</span></code> sera elle-même utilisée dans une chaîne (habituellement au moment du rendu du gabarit).</p>
</div>
<div class="section" id="s-other-uses-of-lazy-in-delayed-translations">
<span id="other-uses-of-lazy-in-delayed-translations"></span><h4>Autres usages de traductions différées avec <code class="docutils literal notranslate"><span class="pre">lazy</span></code><a class="headerlink" href="#other-uses-of-lazy-in-delayed-translations" title="Lien permanent vers ce titre">¶</a></h4>
<p>Dans tout autre situation où il serait utile de différer la traduction mais qu’il est nécessaire de passer la chaîne à traduire comme paramètre d’une autre fonction, il est possible d’envelopper vous-même cette fonction à l’intérieur d’un appel à <code class="docutils literal notranslate"><span class="pre">lazy</span></code>. Par exemple&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.utils.functional</span> <span class="k">import</span> <span class="n">lazy</span>
<span class="kn">from</span> <span class="nn">django.utils.safestring</span> <span class="k">import</span> <span class="n">mark_safe</span>
<span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="k">import</span> <span class="n">gettext_lazy</span> <span class="k">as</span> <span class="n">_</span>

<span class="n">mark_safe_lazy</span> <span class="o">=</span> <span class="n">lazy</span><span class="p">(</span><span class="n">mark_safe</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span>
</pre></div>
</div>
<p>Puis, plus tard&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">lazy_string</span> <span class="o">=</span> <span class="n">mark_safe_lazy</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;&lt;p&gt;My &lt;strong&gt;string!&lt;/strong&gt;&lt;/p&gt;&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="s-localized-names-of-languages">
<span id="localized-names-of-languages"></span><h3>Noms de langues régionalisés<a class="headerlink" href="#localized-names-of-languages" title="Lien permanent vers ce titre">¶</a></h3>
<dl class="function">
<dt id="django.utils.translation.get_language_info">
<code class="descname">get_language_info</code>()<a class="headerlink" href="#django.utils.translation.get_language_info" title="Lien permanent vers cette définition">¶</a></dt>
<dd></dd></dl>

<p>La fonction <code class="docutils literal notranslate"><span class="pre">get_language_info()</span></code> fournit des informations détaillées sur les langues&nbsp;:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="k">import</span> <span class="n">activate</span><span class="p">,</span> <span class="n">get_language_info</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">activate</span><span class="p">(</span><span class="s1">&#39;fr&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">li</span> <span class="o">=</span> <span class="n">get_language_info</span><span class="p">(</span><span class="s1">&#39;de&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">li</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">],</span> <span class="n">li</span><span class="p">[</span><span class="s1">&#39;name_local&#39;</span><span class="p">],</span> <span class="n">li</span><span class="p">[</span><span class="s1">&#39;name_translated&#39;</span><span class="p">],</span> <span class="n">li</span><span class="p">[</span><span class="s1">&#39;bidi&#39;</span><span class="p">])</span>
<span class="go">German Deutsch Allemand False</span>
</pre></div>
</div>
<p>Les attributs <code class="docutils literal notranslate"><span class="pre">name</span></code>, <code class="docutils literal notranslate"><span class="pre">name_local</span></code> et <code class="docutils literal notranslate"><span class="pre">name_translated</span></code> du dictionnaire contiennent respectivement le nom de langue en anglais, dans la langue elle-même et dans la langue actuellement active. L’attribut <code class="docutils literal notranslate"><span class="pre">bidi</span></code> vaut <code class="docutils literal notranslate"><span class="pre">True</span></code> seulement pour les langues s’écrivant de droite à gauche.</p>
<p>La source des informations sur les langues se trouve dans le module <code class="docutils literal notranslate"><span class="pre">django.conf.locale</span></code>. Ces informations sont également accessibles dans le code des gabarits. Voir ci-dessous.</p>
</div>
</div>
<div class="section" id="s-internationalization-in-template-code">
<span id="s-specifying-translation-strings-in-template-code"></span><span id="internationalization-in-template-code"></span><span id="specifying-translation-strings-in-template-code"></span><h2>Internationalisation&nbsp;: dans le code des gabarits<a class="headerlink" href="#internationalization-in-template-code" title="Lien permanent vers ce titre">¶</a></h2>
<p>Les traductions dans les <a class="reference internal" href="../../ref/templates/language.html"><span class="doc">gabarits Django</span></a> utilisent deux balises de gabarit et une syntaxe légèrement différente que dans le code Python. Pour donner accès à ces balises dans vos gabarits, ajoutez <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">load</span> <span class="pre">i18n</span> <span class="pre">%}</span></code> au sommet de votre gabarit. Comme pour toutes les balises de gabarit, cette balise doit être chargée dans tous les gabarits qui utilisent les traductions, même pour les gabarits qui étendent d’autres gabarits ayant déjà chargé la bibliothèque <code class="docutils literal notranslate"><span class="pre">i18n</span></code>.</p>
<div class="admonition warning">
<p class="first admonition-title">Avertissement</p>
<p class="last">Les chaînes traduites ne sont pas échappées lorsqu’elle sont introduites dans un gabarit. Cela permet d’inclure du HTML dans les traductions, par exemple pour des mises en évidence, mais de potentiels dangereux caractères seront également insérés tel quel.</p>
</div>
<span class="target" id="std:templatetag-trans"></span><div class="section" id="s-translate-template-tag">
<span id="s-std:templatetag-translate"></span><span id="translate-template-tag"></span><span id="std:templatetag-translate"></span><h3>Balise de gabarit <code class="docutils literal notranslate"><span class="pre">translate</span></code><a class="headerlink" href="#translate-template-tag" title="Lien permanent vers ce titre">¶</a></h3>
<p>La balise de gabarit <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">translate</span> <span class="pre">%}</span></code> traduit soit une chaîne constante (entourée de guillemets simples ou doubles) ou un contenu de variable&nbsp;:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span><span class="cp">{%</span> <span class="k">translate</span> <span class="s2">&quot;This is the title.&quot;</span> <span class="cp">%}</span><span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span><span class="cp">{%</span> <span class="k">translate</span> <span class="nv">myvar</span> <span class="cp">%}</span><span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>Si l’option <code class="docutils literal notranslate"><span class="pre">noop</span></code> est présente, l’accès à la variable se fait toujours mais la traduction est omise. C’est utile pour marquer du contenu qui devra être traduit à un moment ultérieur&nbsp;:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span><span class="cp">{%</span> <span class="k">translate</span> <span class="s2">&quot;myvar&quot;</span> <span class="nv">noop</span> <span class="cp">%}</span><span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>En interne, cette technique de traduction fait appel à <a class="reference internal" href="../../ref/utils.html#django.utils.translation.gettext" title="django.utils.translation.gettext"><code class="xref py py-func docutils literal notranslate"><span class="pre">gettext()</span></code></a>.</p>
<p>Dans le cas où une variable de gabarit (<code class="docutils literal notranslate"><span class="pre">myvar</span></code> ci-dessus) est passée à la balise, celle-ci résout en premier la variable en chaîne au moment de l’exécution puis consulte les catalogues de messages pour trouver une traduction.</p>
<p>Il n’est pas possible de mélanger du texte littéral et des variables dans <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">translate</span> <span class="pre">%}</span></code>. si vos traductions nécessitent des chaînes contenant des variables (substituants), utilisez plutôt <a class="reference internal" href="#std:templatetag-blocktranslate"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">{%</span> <span class="pre">blocktranslate</span> <span class="pre">%}</span></code></a>.</p>
<p>Si vous aimeriez récupérer une chaîne traduite sans l’afficher, vous pouvez utiliser la syntaxe suivante&nbsp;:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">translate</span> <span class="s2">&quot;This is the title&quot;</span> <span class="k">as</span> <span class="nv">the_title</span> <span class="cp">%}</span>

<span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">the_title</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;description&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">the_title</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>En pratique, vous utiliserez cela pour obtenir une chaîne utilisée à plusieurs endroits dans un gabarit ou qui doit être passée comme paramètre à d’autres balises ou filtres de gabarit&nbsp;:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">translate</span> <span class="s2">&quot;starting point&quot;</span> <span class="k">as</span> <span class="nv">start</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">translate</span> <span class="s2">&quot;end point&quot;</span> <span class="k">as</span> <span class="nv">end</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">translate</span> <span class="s2">&quot;La Grande Boucle&quot;</span> <span class="k">as</span> <span class="nv">race</span> <span class="cp">%}</span>

<span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>
  <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;/&quot;</span> <span class="na">title</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{%</span> <span class="k">blocktranslate</span> <span class="cp">%}</span><span class="s">Back to &#39;</span><span class="cp">{{</span> <span class="nv">race</span> <span class="cp">}}</span><span class="s">&#39; homepage</span><span class="cp">{%</span> <span class="k">endblocktranslate</span> <span class="cp">%}</span><span class="s">&quot;</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">race</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">for</span> <span class="nv">stage</span> <span class="k">in</span> <span class="nv">tour_stages</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">cycle</span> <span class="nv">start</span> <span class="nv">end</span> <span class="cp">%}</span>: <span class="cp">{{</span> <span class="nv">stage</span> <span class="cp">}}{%</span> <span class="k">if</span> <span class="nb">forloop</span><span class="nv">.counter</span><span class="o">|</span><span class="nf">divisibleby</span><span class="o">:</span><span class="m">2</span> <span class="cp">%}</span><span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span><span class="cp">{%</span> <span class="k">else</span> <span class="cp">%}</span>, <span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
<span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">translate</span> <span class="pre">%}</span></code> prend aussi en charge les <a class="reference internal" href="#contextual-markers"><span class="std std-ref">marqueurs contextuels</span></a> à l’aide du mot-clé <code class="docutils literal notranslate"><span class="pre">context</span></code>:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">translate</span> <span class="s2">&quot;May&quot;</span> <span class="nv">context</span> <span class="s2">&quot;month name&quot;</span> <span class="cp">%}</span>
</pre></div>
</div>
<div class="versionchanged">
<span class="title">Changed in Django 3.1:</span> <p>La balise <code class="docutils literal notranslate"><span class="pre">trans</span></code> a été renommée en <code class="docutils literal notranslate"><span class="pre">translate</span></code>. &nbsp;La balise <code class="docutils literal notranslate"><span class="pre">trans</span></code> est toujours prise en charge comme alias pour des raisons de compatibilité.</p>
</div>
<span class="target" id="std:templatetag-blocktrans"></span></div>
<div class="section" id="s-blocktranslate-template-tag">
<span id="s-std:templatetag-blocktranslate"></span><span id="blocktranslate-template-tag"></span><span id="std:templatetag-blocktranslate"></span><h3>Balise de gabarit <code class="docutils literal notranslate"><span class="pre">blocktranslate</span></code><a class="headerlink" href="#blocktranslate-template-tag" title="Lien permanent vers ce titre">¶</a></h3>
<p>Contrairement à la balise <a class="reference internal" href="#std:templatetag-translate"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">translate</span></code></a>, la balise <code class="docutils literal notranslate"><span class="pre">blocktranslate</span></code> permet de marquer comme chaînes à traduire des phrases complexes contenant à la fois du texte littéral et des variables par le moyen des substituants&nbsp;:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">blocktranslate</span> <span class="cp">%}</span>This string will have <span class="cp">{{</span> <span class="nv">value</span> <span class="cp">}}</span> inside.<span class="cp">{%</span> <span class="k">endblocktranslate</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>Pour traduire une expression de gabarit, par exemple un accès aux attributs d’un objet ou une utilisation de filtre de gabarit, il est nécessaire de lier l’expression à une variable locale pour l’utiliser ensuite dans le bloc à traduire. Exemple&nbsp;:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">blocktranslate</span> <span class="k">with</span> <span class="nv">amount</span><span class="o">=</span><span class="nv">article.price</span> <span class="cp">%}</span>
That will cost $ <span class="cp">{{</span> <span class="nv">amount</span> <span class="cp">}}</span>.
<span class="cp">{%</span> <span class="k">endblocktranslate</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">blocktranslate</span> <span class="k">with</span> <span class="nv">myvar</span><span class="o">=</span><span class="nv">value</span><span class="o">|</span><span class="nf">filter</span> <span class="cp">%}</span>
This will have <span class="cp">{{</span> <span class="nv">myvar</span> <span class="cp">}}</span> inside.
<span class="cp">{%</span> <span class="k">endblocktranslate</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>Vous pouvez utiliser plusieurs expressions à l’intérieur d’une seule balise <code class="docutils literal notranslate"><span class="pre">blocktranslate</span></code>:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">blocktranslate</span> <span class="k">with</span> <span class="nv">book_t</span><span class="o">=</span><span class="nv">book</span><span class="o">|</span><span class="nf">title</span> <span class="nv">author_t</span><span class="o">=</span><span class="nv">author</span><span class="o">|</span><span class="nf">title</span> <span class="cp">%}</span>
This is <span class="cp">{{</span> <span class="nv">book_t</span> <span class="cp">}}</span> by <span class="cp">{{</span> <span class="nv">author_t</span> <span class="cp">}}</span>
<span class="cp">{%</span> <span class="k">endblocktranslate</span> <span class="cp">%}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">L’ancien format plus verbeux est toujours accepté&nbsp;: {% blocktranslate with book|title as book_t and author|title as author_t %}`</p>
</div>
<p>D’autres balises de bloc (par exemple <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">for</span> <span class="pre">%}</span></code> ou <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">if</span> <span class="pre">%}</span></code>) ne sont pas autorisées à l’intérieur des balises <code class="docutils literal notranslate"><span class="pre">blocktranslate</span></code>.</p>
<p>Si la résolution d’un des paramètres du bloc échoue, <code class="docutils literal notranslate"><span class="pre">blocktranslate</span></code> se rabat sur la langue par défaut en désactivant temporairement la langue actuelle avec la fonction <a class="reference internal" href="../../ref/utils.html#django.utils.translation.deactivate_all" title="django.utils.translation.deactivate_all"><code class="xref py py-func docutils literal notranslate"><span class="pre">deactivate_all()</span></code></a>.</p>
<p>Cette balise permet également l’utilisation de pluriels. Pour l’utiliser&nbsp;:</p>
<ul class="simple">
<li>Désignez et liez une valeur de compteur nommée <code class="docutils literal notranslate"><span class="pre">count</span></code>. Cette valeur sera celle utilisée pour choisir la bonne forme de pluriel.</li>
<li>Indiquez à la fois les formes au singulier et au pluriel en les séparant par la balise <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">plural</span> <span class="pre">%}</span></code> à l’intérieur des balises <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">blocktranslate</span> <span class="pre">%}</span></code> et <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">endblocktranslate</span> <span class="pre">%}</span></code>.</li>
</ul>
<p>Un exemple&nbsp;:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">blocktranslate</span> <span class="nv">count</span> <span class="nv">counter</span><span class="o">=</span><span class="nv">list</span><span class="o">|</span><span class="nf">length</span> <span class="cp">%}</span>
There is only one <span class="cp">{{</span> <span class="nv">name</span> <span class="cp">}}</span> object.
<span class="cp">{%</span> <span class="k">plural</span> <span class="cp">%}</span>
There are <span class="cp">{{</span> <span class="nv">counter</span> <span class="cp">}}</span> <span class="cp">{{</span> <span class="nv">name</span> <span class="cp">}}</span> objects.
<span class="cp">{%</span> <span class="k">endblocktranslate</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>Un exemple plus complexe&nbsp;:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">blocktranslate</span> <span class="k">with</span> <span class="nv">amount</span><span class="o">=</span><span class="nv">article.price</span> <span class="nv">count</span> <span class="nv">years</span><span class="o">=</span><span class="nv">i.length</span> <span class="cp">%}</span>
That will cost $ <span class="cp">{{</span> <span class="nv">amount</span> <span class="cp">}}</span> per year.
<span class="cp">{%</span> <span class="k">plural</span> <span class="cp">%}</span>
That will cost $ <span class="cp">{{</span> <span class="nv">amount</span> <span class="cp">}}</span> per <span class="cp">{{</span> <span class="nv">years</span> <span class="cp">}}</span> years.
<span class="cp">{%</span> <span class="k">endblocktranslate</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>Lorsque vous utilisez à la fois la fonction de pluriel et l’attribution de valeurs à des variables locales en plus de la valeur de compteur, il faut savoir qu’en interne, <code class="docutils literal notranslate"><span class="pre">blocktranslate</span></code> est converti en un appel <code class="docutils literal notranslate"><span class="pre">ngettext</span></code>. Cela signifie que les <a class="reference internal" href="#pluralization-var-notes"><span class="std std-ref">notes concernant les variables ngettext</span></a> s’appliquent également.</p>
<p>La résolution inverse d’URL ne peut pas se faire à l’intérieur de <code class="docutils literal notranslate"><span class="pre">blocktranslate</span></code> et doit donc être effectuée au préalable&nbsp;:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;path.to.view&#39;</span> <span class="nv">arg</span> <span class="nv">arg2</span> <span class="k">as</span> <span class="nv">the_url</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">blocktranslate</span> <span class="cp">%}</span>
This is a URL: <span class="cp">{{</span> <span class="nv">the_url</span> <span class="cp">}}</span>
<span class="cp">{%</span> <span class="k">endblocktranslate</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>Si vous aimeriez récupérer une chaîne traduite sans l’afficher, vous pouvez utiliser la syntaxe suivante&nbsp;:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">blocktranslate</span> <span class="nv">asvar</span> <span class="nv">the_title</span> <span class="cp">%}</span>The title is <span class="cp">{{</span> <span class="nv">title</span> <span class="cp">}}</span>.<span class="cp">{%</span> <span class="k">endblocktranslate</span> <span class="cp">%}</span>
<span class="p">&lt;</span><span class="nt">title</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">the_title</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">title</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">meta</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;description&quot;</span> <span class="na">content</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">the_title</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>En pratique, vous utiliserez cela pour obtenir une chaîne utilisée à plusieurs endroits dans un gabarit ou qui doit être passée comme paramètre à d’autres balises ou filtres de gabarit.</p>
<p><code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">blocktranslate</span> <span class="pre">%}</span></code> prend aussi en charge les <a class="reference internal" href="#contextual-markers"><span class="std std-ref">marqueurs contextuels</span></a> à l’aide du mot-clé <code class="docutils literal notranslate"><span class="pre">context</span></code>:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">blocktranslate</span> <span class="k">with</span> <span class="nv">name</span><span class="o">=</span><span class="nv">user.username</span> <span class="nv">context</span> <span class="s2">&quot;greeting&quot;</span> <span class="cp">%}</span>Hi <span class="cp">{{</span> <span class="nv">name</span> <span class="cp">}}{%</span> <span class="k">endblocktranslate</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>Une autre fonctionnalité prise en charge par la balise <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">blocktranslate</span> <span class="pre">%}</span></code> est l’option <code class="docutils literal notranslate"><span class="pre">trimmed</span></code>. Cette option supprime les caractères de nouvelle ligne au début et à la fin du contenu de la balise <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">blocktranslate</span> <span class="pre">%}</span></code>, remplace les espaces blancs au début et à la fin d’une ligne et fusionne toutes les lignes en une seule via l’utilisation d’un espace pour les séparer. Ceci est très utile pour l’indentation du contenu d’une balise <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">blocktranslate</span> <span class="pre">%}</span></code> sans avoir les caractères d’indentation qui se retrouvent dans l’entrée correspondante du fichier PO, rendant le processus de traduction plus facile.</p>
<p>Par exemple, la balise <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">blocktranslate</span> <span class="pre">%}</span></code> suivante&nbsp;:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">blocktranslate</span> <span class="nv">trimmed</span> <span class="cp">%}</span>
  First sentence.
  Second paragraph.
<span class="cp">{%</span> <span class="k">endblocktranslate</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>donne comme résultat <code class="docutils literal notranslate"><span class="pre">&quot;First</span> <span class="pre">sentence.</span> <span class="pre">Second</span> <span class="pre">paragraph.&quot;</span></code> dans le fichier PO, comparé à <code class="docutils literal notranslate"><span class="pre">&quot;\n</span> <span class="pre">First</span> <span class="pre">sentence.\n</span> <span class="pre">Second</span> <span class="pre">paragraph.\n&quot;</span></code> si l’option <code class="docutils literal notranslate"><span class="pre">trimmed</span></code> n’avait pas été utilisée.</p>
<div class="versionchanged">
<span class="title">Changed in Django 3.1:</span> <p>La balise <code class="docutils literal notranslate"><span class="pre">blocktrans</span></code> a été renommée en <code class="docutils literal notranslate"><span class="pre">blocktranslate</span></code>. &nbsp;La balise <code class="docutils literal notranslate"><span class="pre">blocktrans</span></code> est toujours prise en charge comme alias pour des raisons de compatibilité.</p>
</div>
</div>
<div class="section" id="s-string-literals-passed-to-tags-and-filters">
<span id="string-literals-passed-to-tags-and-filters"></span><h3>Texte littéral transmis aux balises et aux filtres<a class="headerlink" href="#string-literals-passed-to-tags-and-filters" title="Lien permanent vers ce titre">¶</a></h3>
<p>Vous pouvez traduire le texte littéral transmis comme paramètre à des balises et des filtres en utilisant la syntaxe familière <code class="docutils literal notranslate"><span class="pre">_()</span></code>:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">some_tag</span> <span class="kp">_</span><span class="o">(</span><span class="s2">&quot;Page not found&quot;</span><span class="o">)</span> <span class="nv">value</span><span class="o">|</span><span class="nf">yesno</span><span class="o">:</span><span class="kp">_</span><span class="o">(</span><span class="s2">&quot;yes,no&quot;</span><span class="o">)</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>Dans ce cas, aussi bien la balise que le filtre recevra la chaîne traduite, ils n’ont donc pas besoin de se préoccuper des traductions.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Dans cet exemple, l’infrastructure de traduction recevra la chaîne <code class="docutils literal notranslate"><span class="pre">&quot;yes,no&quot;</span></code>, et non pas les chaînes individuelles <code class="docutils literal notranslate"><span class="pre">&quot;yes&quot;</span></code> et <code class="docutils literal notranslate"><span class="pre">&quot;no&quot;</span></code>. La chaîne à traduire devra contenir la virgule afin que le code d’analyse du filtre sache où séparer les paramètres. Par exemple, un traducteur allemand pourrait traduire la chaîne <code class="docutils literal notranslate"><span class="pre">&quot;yes,no&quot;</span></code> comme <code class="docutils literal notranslate"><span class="pre">&quot;ja,nein&quot;</span></code> (en préservant la virgule).</p>
</div>
</div>
<div class="section" id="s-comments-for-translators-in-templates">
<span id="s-translator-comments-in-templates"></span><span id="comments-for-translators-in-templates"></span><span id="translator-comments-in-templates"></span><h3>Commentaires pour les traducteurs dans les gabarits<a class="headerlink" href="#comments-for-translators-in-templates" title="Lien permanent vers ce titre">¶</a></h3>
<p>Tout comme avec le <a class="reference internal" href="#translator-comments"><span class="std std-ref">code Python</span></a>, ces notes à l’intention des traducteurs peuvent être indiquées en utilisant des commentaires, soit avec la balise <a class="reference internal" href="../../ref/templates/builtins.html#std:templatetag-comment"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">comment</span></code></a>:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">comment</span> <span class="cp">%}</span><span class="c">Translators: View verb</span><span class="cp">{%</span> <span class="k">endcomment</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">translate</span> <span class="s2">&quot;View&quot;</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">comment</span> <span class="cp">%}</span><span class="c">Translators: Short intro blurb</span><span class="cp">{%</span> <span class="k">endcomment</span> <span class="cp">%}</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="cp">{%</span> <span class="k">blocktranslate</span> <span class="cp">%}</span>A multiline translatable
literal.<span class="cp">{%</span> <span class="k">endblocktranslate</span> <span class="cp">%}</span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>ou avec la <a class="reference internal" href="../../ref/templates/language.html#template-comments"><span class="std std-ref">syntaxe de commentaire sur une seule ligne</span></a> <code class="docutils literal notranslate"><span class="pre">{#</span></code> … <code class="docutils literal notranslate"><span class="pre">#}</span></code>:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="c">{# Translators: Label of a button that triggers search #}</span>
<span class="p">&lt;</span><span class="nt">button</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span><span class="p">&gt;</span><span class="cp">{%</span> <span class="k">translate</span> <span class="s2">&quot;Go&quot;</span> <span class="cp">%}</span><span class="p">&lt;/</span><span class="nt">button</span><span class="p">&gt;</span>

<span class="c">{# Translators: This is a text of the base template #}</span>
<span class="cp">{%</span> <span class="k">blocktranslate</span> <span class="cp">%}</span>Ambiguous translatable block of text<span class="cp">{%</span> <span class="k">endblocktranslate</span> <span class="cp">%}</span>
</pre></div>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p>Pour les curieux, voici les fragments correspondant dans le fichier <code class="docutils literal notranslate"><span class="pre">.po</span></code> résultant&nbsp;:</p>
<div class="last highlight-po notranslate"><div class="highlight"><pre><span></span><span class="c1">#. Translators: View verb</span>
<span class="c1"># path/to/template/file.html:10</span>
<span class="nv">msgid</span> <span class="s">&quot;View&quot;</span>
<span class="nv">msgstr</span> <span class="s">&quot;&quot;</span>

<span class="c1">#. Translators: Short intro blurb</span>
<span class="c1"># path/to/template/file.html:13</span>
<span class="nv">msgid</span> <span class="s">&quot;&quot;</span>
<span class="s">&quot;A multiline translatable&quot;</span>
<span class="s">&quot;literal.&quot;</span>
<span class="nv">msgstr</span> <span class="s">&quot;&quot;</span>

<span class="c1"># ...</span>

<span class="c1">#. Translators: Label of a button that triggers search</span>
<span class="c1"># path/to/template/file.html:100</span>
<span class="nv">msgid</span> <span class="s">&quot;Go&quot;</span>
<span class="nv">msgstr</span> <span class="s">&quot;&quot;</span>

<span class="c1">#. Translators: This is a text of the base template</span>
<span class="c1"># path/to/template/file.html:103</span>
<span class="nv">msgid</span> <span class="s">&quot;Ambiguous translatable block of text&quot;</span>
<span class="nv">msgstr</span> <span class="s">&quot;&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="s-switching-language-in-templates">
<span id="s-std:templatetag-language"></span><span id="switching-language-in-templates"></span><span id="std:templatetag-language"></span><h3>Changement de langue dans les gabarits<a class="headerlink" href="#switching-language-in-templates" title="Lien permanent vers ce titre">¶</a></h3>
<p>Si vous avez besoin de changer de langue à l’intérieur d’un gabarit, vous pouvez utiliser la balise de gabarit <code class="docutils literal notranslate"><span class="pre">language</span></code>:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">i18n</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">get_current_language</span> <span class="k">as</span> <span class="nv">LANGUAGE_CODE</span> <span class="cp">%}</span>
<span class="c">&lt;!-- Current language: </span><span class="cp">{{</span> <span class="nv">LANGUAGE_CODE</span> <span class="cp">}}</span><span class="c"> --&gt;</span>
<span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="cp">{%</span> <span class="k">translate</span> <span class="s2">&quot;Welcome to our page&quot;</span> <span class="cp">%}</span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>

<span class="cp">{%</span> <span class="k">language</span> <span class="s1">&#39;en&#39;</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">get_current_language</span> <span class="k">as</span> <span class="nv">LANGUAGE_CODE</span> <span class="cp">%}</span>
    <span class="c">&lt;!-- Current language: </span><span class="cp">{{</span> <span class="nv">LANGUAGE_CODE</span> <span class="cp">}}</span><span class="c"> --&gt;</span>
    <span class="p">&lt;</span><span class="nt">p</span><span class="p">&gt;</span><span class="cp">{%</span> <span class="k">translate</span> <span class="s2">&quot;Welcome to our page&quot;</span> <span class="cp">%}</span><span class="p">&lt;/</span><span class="nt">p</span><span class="p">&gt;</span>
<span class="cp">{%</span> <span class="k">endlanguage</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>Alors que la première occurrence de «&nbsp;Welcome to our page&nbsp;» utilise la langue active, la seconde sera toujours en anglais.</p>
</div>
<div class="section" id="s-other-tags">
<span id="s-i18n-template-tags"></span><span id="other-tags"></span><span id="i18n-template-tags"></span><h3>Autres balises<a class="headerlink" href="#other-tags" title="Lien permanent vers ce titre">¶</a></h3>
<p>Ces balises nécessitent aussi le chargement <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">load</span> <span class="pre">i18n</span> <span class="pre">%}</span></code>.</p>
<div class="section" id="s-get-available-languages">
<span id="s-std:templatetag-get_available_languages"></span><span id="get-available-languages"></span><span id="std:templatetag-get_available_languages"></span><h4><code class="docutils literal notranslate"><span class="pre">get_available_languages</span></code><a class="headerlink" href="#get-available-languages" title="Lien permanent vers ce titre">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">get_available_languages</span> <span class="pre">as</span> <span class="pre">LANGUAGES</span> <span class="pre">%}</span></code> renvoie une liste de tuples dont le premier élément est le <a class="reference internal" href="index.html#term-language-code"><span class="xref std std-term">code de langue</span></a> et le second est le nom de la langue (traduit dans la langue actuellement active).</p>
</div>
<div class="section" id="s-get-current-language">
<span id="s-std:templatetag-get_current_language"></span><span id="get-current-language"></span><span id="std:templatetag-get_current_language"></span><h4><code class="docutils literal notranslate"><span class="pre">get_current_language</span></code><a class="headerlink" href="#get-current-language" title="Lien permanent vers ce titre">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">get_current_language</span> <span class="pre">as</span> <span class="pre">LANGUAGE_CODE</span> <span class="pre">%}</span></code> renvoie la langue préférée de l’utilisateur actuel sous forme textuelle. Exemple&nbsp;: <code class="docutils literal notranslate"><span class="pre">en-us</span></code>. Voir <a class="reference internal" href="#how-django-discovers-language-preference"><span class="std std-ref">Processus de découverte de la préférence de langue par Django</span></a>.</p>
</div>
<div class="section" id="s-get-current-language-bidi">
<span id="s-std:templatetag-get_current_language_bidi"></span><span id="get-current-language-bidi"></span><span id="std:templatetag-get_current_language_bidi"></span><h4><code class="docutils literal notranslate"><span class="pre">get_current_language_bidi</span></code><a class="headerlink" href="#get-current-language-bidi" title="Lien permanent vers ce titre">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">get_current_language_bidi</span> <span class="pre">as</span> <span class="pre">LANGUAGE_BIDI</span> <span class="pre">%}</span></code> renvoie la direction du texte de la langue actuelle. Si <code class="docutils literal notranslate"><span class="pre">True</span></code>, il s’agit d’une langue s’écrivant de droite à gauche, comme l’hébreu ou l’arabe. Si <code class="docutils literal notranslate"><span class="pre">False</span></code>, il s’agit d’une langue s’écrivant de gauche à droite, comme l’anglais, le français, l’allemand, etc.</p>
</div>
<div class="section" id="s-i18n-context-processor">
<span id="s-template-translation-vars"></span><span id="i18n-context-processor"></span><span id="template-translation-vars"></span><h4>Processeur de contexte <code class="docutils literal notranslate"><span class="pre">i18n</span></code><a class="headerlink" href="#i18n-context-processor" title="Lien permanent vers ce titre">¶</a></h4>
<p>Si vous activez le processeur de contexte <a class="reference internal" href="../../ref/templates/api.html#django.template.context_processors.i18n" title="django.template.context_processors.i18n"><code class="xref py py-class docutils literal notranslate"><span class="pre">django.template.context_processors.i18n</span></code></a>, chaque <code class="docutils literal notranslate"><span class="pre">RequestContext</span></code> aura accès à  <code class="docutils literal notranslate"><span class="pre">LANGUAGES</span></code>, <code class="docutils literal notranslate"><span class="pre">LANGUAGE_CODE</span></code> et <code class="docutils literal notranslate"><span class="pre">LANGUAGE_BIDI</span></code> tels que décrits ci-dessus.</p>
</div>
<div class="section" id="s-get-language-info">
<span id="s-std:templatetag-get_language_info"></span><span id="get-language-info"></span><span id="std:templatetag-get_language_info"></span><h4><code class="docutils literal notranslate"><span class="pre">get_language_info</span></code><a class="headerlink" href="#get-language-info" title="Lien permanent vers ce titre">¶</a></h4>
<p>Vous pouvez aussi récupérer toute information à propos des langues disponibles en utilisant des balises et des filtres intégrés. Pour obtenir des informations sur une seule langue, utilisez la balise <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">get_language_info</span> <span class="pre">%}</span></code>:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">get_language_info</span> <span class="nv">for</span> <span class="nv">LANGUAGE_CODE</span> <span class="k">as</span> <span class="nv">lang</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">get_language_info</span> <span class="nv">for</span> <span class="s2">&quot;pl&quot;</span> <span class="k">as</span> <span class="nv">lang</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>Vous pouvez ensuite accéder à ces informations&nbsp;:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span>Language code: <span class="cp">{{</span> <span class="nv">lang.code</span> <span class="cp">}}</span><span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
Name of language: <span class="cp">{{</span> <span class="nv">lang.name_local</span> <span class="cp">}}</span><span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
Name in English: <span class="cp">{{</span> <span class="nv">lang.name</span> <span class="cp">}}</span><span class="p">&lt;</span><span class="nt">br</span><span class="p">&gt;</span>
Bi-directional: <span class="cp">{{</span> <span class="nv">lang.bidi</span> <span class="cp">}}</span>
Name in the active language: <span class="cp">{{</span> <span class="nv">lang.name_translated</span> <span class="cp">}}</span>
</pre></div>
</div>
</div>
<div class="section" id="s-get-language-info-list">
<span id="s-std:templatetag-get_language_info_list"></span><span id="get-language-info-list"></span><span id="std:templatetag-get_language_info_list"></span><h4><code class="docutils literal notranslate"><span class="pre">get_language_info_list</span></code><a class="headerlink" href="#get-language-info-list" title="Lien permanent vers ce titre">¶</a></h4>
<p>Vous pouvez aussi utiliser la balise de gabarit <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">get_language_info_list</span> <span class="pre">%}</span></code> pour obtenir les informations d’une liste de langues (par ex. les langues actives figurant dans <a class="reference internal" href="../../ref/settings.html#std:setting-LANGUAGES"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LANGUAGES</span></code></a>). Consultez <a class="reference internal" href="#set-language-redirect-view"><span class="std std-ref">la section sur la vue de redirection set_language</span></a> pour trouver un exemple sur la manière d’afficher un sélecteur de langue avec <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">get_language_info_list</span> <span class="pre">%}</span></code>.</p>
<p>En plus du style liste de tuples de <a class="reference internal" href="../../ref/settings.html#std:setting-LANGUAGES"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LANGUAGES</span></code></a>, <code class="docutils literal notranslate"><span class="pre">{%</span> <span class="pre">get_language_info_list</span> <span class="pre">%}</span></code> accepte des listes de codes de langue. Si vous faites ceci dans votre vue&nbsp;:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">context</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;available_languages&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;en&#39;</span><span class="p">,</span> <span class="s1">&#39;es&#39;</span><span class="p">,</span> <span class="s1">&#39;fr&#39;</span><span class="p">]}</span>
<span class="k">return</span> <span class="n">render</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="s1">&#39;mytemplate.html&#39;</span><span class="p">,</span> <span class="n">context</span><span class="p">)</span>
</pre></div>
</div>
<p>vous pouvez faire une boucle sur ces langues dans le gabarit&nbsp;:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">get_language_info_list</span> <span class="nv">for</span> <span class="nv">available_languages</span> <span class="k">as</span> <span class="nv">langs</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">for</span> <span class="nv">lang</span> <span class="k">in</span> <span class="nv">langs</span> <span class="cp">%}</span> ... <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
</pre></div>
</div>
<span class="target" id="std:templatefilter-language_name"></span><span class="target" id="std:templatefilter-language_name_local"></span><span class="target" id="std:templatefilter-language_bidi"></span></div>
<div class="section" id="s-template-filters">
<span id="s-std:templatefilter-language_name_translated"></span><span id="template-filters"></span><span id="std:templatefilter-language_name_translated"></span><h4>Filtres de gabarit<a class="headerlink" href="#template-filters" title="Lien permanent vers ce titre">¶</a></h4>
<p>Il existe aussi quelques filtres pour votre confort&nbsp;:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">LANGUAGE_CODE|language_name</span> <span class="pre">}}</span></code> («&nbsp;German&nbsp;»)</li>
<li><code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">LANGUAGE_CODE|language_name_local</span> <span class="pre">}}</span></code> («&nbsp;Deutsch&nbsp;»)</li>
<li><code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">LANGUAGE_CODE|language_bidi</span> <span class="pre">}}</span></code> (False)</li>
<li><code class="docutils literal notranslate"><span class="pre">{{</span> <span class="pre">LANGUAGE_CODE|language_name_translated</span> <span class="pre">}}</span></code> («&nbsp;německy&nbsp;», lorsque la langue actuelle est le tchèque)</li>
</ul>
</div>
</div>
</div>
<div class="section" id="s-internationalization-in-javascript-code">
<span id="internationalization-in-javascript-code"></span><h2>Internationalisation&nbsp;: dans le code JavaScript<a class="headerlink" href="#internationalization-in-javascript-code" title="Lien permanent vers ce titre">¶</a></h2>
<p>L’ajout de traductions en Javascript pose quelques problèmes&nbsp;:</p>
<ul class="simple">
<li>Le code JavaScript n’a pas d’accès à une implémentation de <code class="docutils literal notranslate"><span class="pre">gettext</span></code>.</li>
<li>Le code JavaScript n’a pas accès à des fichiers <code class="docutils literal notranslate"><span class="pre">.po</span></code> ou <code class="docutils literal notranslate"><span class="pre">.mo</span></code>; ils doivent être fournis par le serveur.</li>
<li>Les catalogues de traduction pour JavaScript doivent être aussi compacts que possible.</li>
</ul>
<p>Django fournit une solution intégrée pour ces problèmes&nbsp;: il transpose les traductions dans JavaScript afin que vous puissiez appeler les fonctions de type <code class="docutils literal notranslate"><span class="pre">gettext</span></code> dans votre code JavaScript.</p>
<p>La solution principale à ces problèmes est la vue <code class="docutils literal notranslate"><span class="pre">JavaScriptCatalog</span></code> suivante, qui génère une bibliothèque de code JavaScript avec des fonctions qui simulent l’interface <code class="docutils literal notranslate"><span class="pre">gettext</span></code>, ainsi qu’un tableau de chaînes de traduction.</p>
<div class="section" id="s-module-django.views.i18n">
<span id="s-the-javascriptcatalog-view"></span><span id="module-django.views.i18n"></span><span id="the-javascriptcatalog-view"></span><h3>La vue <code class="docutils literal notranslate"><span class="pre">JavaScriptCatalog</span></code><a class="headerlink" href="#module-django.views.i18n" title="Lien permanent vers ce titre">¶</a></h3>
<dl class="class">
<dt id="django.views.i18n.JavaScriptCatalog">
<em class="property">class </em><code class="descname">JavaScriptCatalog</code><a class="headerlink" href="#django.views.i18n.JavaScriptCatalog" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>Une vue qui génère une bibliothèque de code JavaScript avec des fonctions qui simulent l’interface <code class="docutils literal notranslate"><span class="pre">gettext</span></code>, ainsi qu’un tableau de chaînes de traduction.</p>
<p><strong>Attributs</strong></p>
<dl class="attribute">
<dt id="django.views.i18n.JavaScriptCatalog.domain">
<code class="descname">domain</code><a class="headerlink" href="#django.views.i18n.JavaScriptCatalog.domain" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>Domaine de traduction contenant les chaînes à ajouter dans le résultat de la vue. Contient <code class="docutils literal notranslate"><span class="pre">'djangojs'</span></code> par défaut.</p>
</dd></dl>

<dl class="attribute">
<dt id="django.views.i18n.JavaScriptCatalog.packages">
<code class="descname">packages</code><a class="headerlink" href="#django.views.i18n.JavaScriptCatalog.packages" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>Une liste de <a class="reference internal" href="../../ref/applications.html#django.apps.AppConfig.name" title="django.apps.AppConfig.name"><code class="xref py py-attr docutils literal notranslate"><span class="pre">noms</span> <span class="pre">d'applications</span></code></a> parmi les applications installées. Ces applications doivent contenir un dossier <code class="docutils literal notranslate"><span class="pre">locale</span></code>. Tous ces catalogues ainsi que ceux trouvés dans <a class="reference internal" href="../../ref/settings.html#std:setting-LOCALE_PATHS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LOCALE_PATHS</span></code></a> (qui sont toujours inclus) sont fusionnés en un seul catalogue. La valeur par défaut est <code class="docutils literal notranslate"><span class="pre">None</span></code>, ce qui signifie que toutes les traductions disponibles de toutes les applications dans <a class="reference internal" href="../../ref/settings.html#std:setting-INSTALLED_APPS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">INSTALLED_APPS</span></code></a> sont présentes dans le résultat JavaScript.</p>
</dd></dl>

<p><strong>Exemple avec les valeurs par défaut</strong>&nbsp;:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.views.i18n</span> <span class="kn">import</span> <span class="n">JavaScriptCatalog</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;jsi18n/&#39;</span><span class="p">,</span> <span class="n">JavaScriptCatalog</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;javascript-catalog&#39;</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<p><strong>Exemple avec des paquets personnalisés</strong>&nbsp;:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;jsi18n/myapp/&#39;</span><span class="p">,</span>
         <span class="n">JavaScriptCatalog</span><span class="o">.</span><span class="n">as_view</span><span class="p">(</span><span class="n">packages</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;your.app.label&#39;</span><span class="p">]),</span>
         <span class="n">name</span><span class="o">=</span><span class="s1">&#39;javascript-catalog&#39;</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Si votre configuration d’URL racine utilise  <a class="reference internal" href="#django.conf.urls.i18n.i18n_patterns" title="django.conf.urls.i18n.i18n_patterns"><code class="xref py py-func docutils literal notranslate"><span class="pre">i18n_patterns()</span></code></a>, <code class="docutils literal notranslate"><span class="pre">JavaScriptCatalog</span></code> doit également être enveloppé dans <code class="docutils literal notranslate"><span class="pre">i18n_patterns()</span></code> pour que le catalogue soit correctement généré.</p>
<p><strong>Exemple avec</strong> <code class="docutils literal notranslate"><span class="pre">i18n_patterns()</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.conf.urls.i18n</span> <span class="kn">import</span> <span class="n">i18n_patterns</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="n">i18n_patterns</span><span class="p">(</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;jsi18n/&#39;</span><span class="p">,</span> <span class="n">JavaScriptCatalog</span><span class="o">.</span><span class="n">as_view</span><span class="p">(),</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;javascript-catalog&#39;</span><span class="p">),</span>
<span class="p">)</span>
</pre></div>
</div>
</dd></dl>

<p>La priorité des traductions se fait par ordre d’apparition des modules dans le paramètre <code class="docutils literal notranslate"><span class="pre">packages</span></code>; ceux qui apparaissent en dernier ont la priorité sur les premiers. Ceci est important dans le cas où une même chaîne est traduite différemment dans plusieurs catalogues.</p>
<p>Si vous utilisez plus d’une vue <code class="docutils literal notranslate"><span class="pre">JavaScriptCatalog</span></code> sur un site et que plusieurs définissent les mêmes chaînes, les chaînes du catalogue chargé en dernier ont la priorité.</p>
</div>
<div class="section" id="s-using-the-javascript-translation-catalog">
<span id="using-the-javascript-translation-catalog"></span><h3>Emploi du catalogue des traductions JavaScript<a class="headerlink" href="#using-the-javascript-translation-catalog" title="Lien permanent vers ce titre">¶</a></h3>
<p>Pour utiliser le catalogue, insérez le script généré dynamiquement comme ceci&nbsp;:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">script</span> <span class="na">src</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;javascript-catalog&#39;</span> <span class="cp">%}</span><span class="s">&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>Nous utilisons la résolution inverse d’URL pour trouver l’URL de la vue du catalogue JavaScript. Lorsque le catalogue est chargé, votre code JavaScript peut utiliser les méthodes suivantes&nbsp;:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">gettext</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">ngettext</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">interpolate</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">get_format</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">gettext_noop</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">pgettext</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">npgettext</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">pluralidx</span></code></li>
</ul>
<div class="section" id="s-gettext">
<span id="gettext"></span><h4><code class="docutils literal notranslate"><span class="pre">gettext</span></code><a class="headerlink" href="#gettext" title="Lien permanent vers ce titre">¶</a></h4>
<p>La fonction <code class="docutils literal notranslate"><span class="pre">gettext</span></code> fonctionne de manière similaire à l’interface <code class="docutils literal notranslate"><span class="pre">gettext</span></code> standard accessible depuis le code Python&nbsp;:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">gettext</span><span class="p">(</span><span class="s1">&#39;this is to be translated&#39;</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="section" id="s-ngettext">
<span id="ngettext"></span><h4><code class="docutils literal notranslate"><span class="pre">ngettext</span></code><a class="headerlink" href="#ngettext" title="Lien permanent vers ce titre">¶</a></h4>
<p>La fonction <code class="docutils literal notranslate"><span class="pre">ngettext</span></code> fournit une interface pour mettre au pluriel des mots et des phrases&nbsp;:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">objectCount</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1">// or 0, or 2, or 3, ...</span>
<span class="kr">const</span> <span class="nx">string</span> <span class="o">=</span> <span class="nx">ngettext</span><span class="p">(</span>
    <span class="s1">&#39;literal for the singular case&#39;</span><span class="p">,</span>
    <span class="s1">&#39;literal for the plural case&#39;</span><span class="p">,</span>
    <span class="nx">objectCount</span>
<span class="p">);</span>
</pre></div>
</div>
</div>
<div class="section" id="s-interpolate">
<span id="interpolate"></span><h4><code class="docutils literal notranslate"><span class="pre">interpolate</span></code><a class="headerlink" href="#interpolate" title="Lien permanent vers ce titre">¶</a></h4>
<p>La fonction <code class="docutils literal notranslate"><span class="pre">interpolate</span></code> permet de remplir dynamiquement une chaîne de mise en forme. La syntaxe d’interpolation est empruntée à Python&nbsp;; ainsi, la fonction <code class="docutils literal notranslate"><span class="pre">interpolate</span></code> prend en charge à la fois les paramètres nommés et les paramètres positionnels&nbsp;:</p>
<ul>
<li><p class="first">Interpolation positionnelle&nbsp;: <code class="docutils literal notranslate"><span class="pre">obj</span></code> contient un objet Array JavaScript dont les valeurs d’éléments sont interpolées dans l’ordre d’apparition de leur substituant <code class="docutils literal notranslate"><span class="pre">fmt</span></code> correspondant. Par exemple&nbsp;:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">formats</span> <span class="o">=</span> <span class="nx">ngettext</span><span class="p">(</span>
  <span class="s1">&#39;There is %s object. Remaining: %s&#39;</span><span class="p">,</span>
  <span class="s1">&#39;There are %s objects. Remaining: %s&#39;</span><span class="p">,</span>
  <span class="mi">11</span>
<span class="p">);</span>
<span class="kr">const</span> <span class="nx">string</span> <span class="o">=</span> <span class="nx">interpolate</span><span class="p">(</span><span class="nx">formats</span><span class="p">,</span> <span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">20</span><span class="p">]);</span>
<span class="c1">// string is &#39;There are 11 objects. Remaining: 20&#39;</span>
</pre></div>
</div>
</li>
<li><p class="first">Interpolation nommée&nbsp;: ce mode est sélectionné en passant <code class="docutils literal notranslate"><span class="pre">true</span></code> dans le paramètre booléen facultatif <code class="docutils literal notranslate"><span class="pre">named</span></code>. <code class="docutils literal notranslate"><span class="pre">obj</span></code> contient un objet JavaScript ou un tableau associatif. Par exemple&nbsp;:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kr">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="p">{</span>
  <span class="nx">count</span><span class="o">:</span> <span class="mi">10</span><span class="p">,</span>
  <span class="nx">total</span><span class="o">:</span> <span class="mi">50</span>
<span class="p">};</span>

<span class="kr">const</span> <span class="nx">formats</span> <span class="o">=</span> <span class="nx">ngettext</span><span class="p">(</span>
    <span class="s1">&#39;Total: %(total)s, there is %(count)s object&#39;</span><span class="p">,</span>
    <span class="s1">&#39;there are %(count)s of a total of %(total)s objects&#39;</span><span class="p">,</span>
    <span class="nx">data</span><span class="p">.</span><span class="nx">count</span>
<span class="p">);</span>
<span class="kr">const</span> <span class="nx">string</span> <span class="o">=</span> <span class="nx">interpolate</span><span class="p">(</span><span class="nx">formats</span><span class="p">,</span> <span class="nx">data</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
</pre></div>
</div>
</li>
</ul>
<p>Il ne faut cependant pas abuser de l’interpolation de chaînes&nbsp;: c’est toujours du JavaScript, le code effectue donc des substitutions répétées par expression régulière. Ce n’est pas aussi rapide que l’interpolation de chaînes en Python, il s’agit donc de réserver cet usage pour les cas où c’est vraiment nécessaire (par exemple conjointement avec``ngettext`` pour générer des pluriels corrects).</p>
</div>
<div class="section" id="s-get-format">
<span id="get-format"></span><h4><code class="docutils literal notranslate"><span class="pre">get_format</span></code><a class="headerlink" href="#get-format" title="Lien permanent vers ce titre">¶</a></h4>
<p>La fonction <code class="docutils literal notranslate"><span class="pre">get_format</span></code> accède aux réglages de mise en forme régionalisée et peut obtenir la chaîne de format d’un nom de réglage donné&nbsp;:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">get_format</span><span class="p">(</span><span class="s1">&#39;DATE_FORMAT&#39;</span><span class="p">));</span>
<span class="c1">// &#39;N j, Y&#39;</span>
</pre></div>
</div>
<p>Elle peut accéder aux réglages suivants&nbsp;:</p>
<ul class="simple">
<li><a class="reference internal" href="../../ref/settings.html#std:setting-DATE_FORMAT"><code class="xref std std-setting docutils literal notranslate"><span class="pre">DATE_FORMAT</span></code></a></li>
<li><a class="reference internal" href="../../ref/settings.html#std:setting-DATE_INPUT_FORMATS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">DATE_INPUT_FORMATS</span></code></a></li>
<li><a class="reference internal" href="../../ref/settings.html#std:setting-DATETIME_FORMAT"><code class="xref std std-setting docutils literal notranslate"><span class="pre">DATETIME_FORMAT</span></code></a></li>
<li><a class="reference internal" href="../../ref/settings.html#std:setting-DATETIME_INPUT_FORMATS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">DATETIME_INPUT_FORMATS</span></code></a></li>
<li><a class="reference internal" href="../../ref/settings.html#std:setting-DECIMAL_SEPARATOR"><code class="xref std std-setting docutils literal notranslate"><span class="pre">DECIMAL_SEPARATOR</span></code></a></li>
<li><a class="reference internal" href="../../ref/settings.html#std:setting-FIRST_DAY_OF_WEEK"><code class="xref std std-setting docutils literal notranslate"><span class="pre">FIRST_DAY_OF_WEEK</span></code></a></li>
<li><a class="reference internal" href="../../ref/settings.html#std:setting-MONTH_DAY_FORMAT"><code class="xref std std-setting docutils literal notranslate"><span class="pre">MONTH_DAY_FORMAT</span></code></a></li>
<li><a class="reference internal" href="../../ref/settings.html#std:setting-NUMBER_GROUPING"><code class="xref std std-setting docutils literal notranslate"><span class="pre">NUMBER_GROUPING</span></code></a></li>
<li><a class="reference internal" href="../../ref/settings.html#std:setting-SHORT_DATE_FORMAT"><code class="xref std std-setting docutils literal notranslate"><span class="pre">SHORT_DATE_FORMAT</span></code></a></li>
<li><a class="reference internal" href="../../ref/settings.html#std:setting-SHORT_DATETIME_FORMAT"><code class="xref std std-setting docutils literal notranslate"><span class="pre">SHORT_DATETIME_FORMAT</span></code></a></li>
<li><a class="reference internal" href="../../ref/settings.html#std:setting-THOUSAND_SEPARATOR"><code class="xref std std-setting docutils literal notranslate"><span class="pre">THOUSAND_SEPARATOR</span></code></a></li>
<li><a class="reference internal" href="../../ref/settings.html#std:setting-TIME_FORMAT"><code class="xref std std-setting docutils literal notranslate"><span class="pre">TIME_FORMAT</span></code></a></li>
<li><a class="reference internal" href="../../ref/settings.html#std:setting-TIME_INPUT_FORMATS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">TIME_INPUT_FORMATS</span></code></a></li>
<li><a class="reference internal" href="../../ref/settings.html#std:setting-YEAR_MONTH_FORMAT"><code class="xref std std-setting docutils literal notranslate"><span class="pre">YEAR_MONTH_FORMAT</span></code></a></li>
</ul>
<p>C’est bien utile pour conserver une cohérence de mise en forme en lien avec les valeurs produites par le code Python.</p>
</div>
<div class="section" id="s-gettext-noop">
<span id="gettext-noop"></span><h4><code class="docutils literal notranslate"><span class="pre">gettext_noop</span></code><a class="headerlink" href="#gettext-noop" title="Lien permanent vers ce titre">¶</a></h4>
<p>Ceci émule la fonction <code class="docutils literal notranslate"><span class="pre">gettext</span></code>, mais ne fait rien d’autre que de renvoyer le contenu qui lui est transmis&nbsp;:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">gettext_noop</span><span class="p">(</span><span class="s1">&#39;this will not be translated&#39;</span><span class="p">));</span>
</pre></div>
</div>
<p>C’est utile pour identifier des portions de code qui vont avoir besoin d’être traduites plus tard.</p>
</div>
<div class="section" id="s-pgettext">
<span id="pgettext"></span><h4><code class="docutils literal notranslate"><span class="pre">pgettext</span></code><a class="headerlink" href="#pgettext" title="Lien permanent vers ce titre">¶</a></h4>
<p>La fonction <code class="docutils literal notranslate"><span class="pre">pgettext</span></code> fonctionne de manière similaire à son équivalent Python (<a class="reference internal" href="../../ref/utils.html#django.utils.translation.pgettext" title="django.utils.translation.pgettext"><code class="xref py py-func docutils literal notranslate"><span class="pre">pgettext()</span></code></a>), fournissant un contenu traduit en fonction d’un contexte&nbsp;:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">pgettext</span><span class="p">(</span><span class="s1">&#39;month name&#39;</span><span class="p">,</span> <span class="s1">&#39;May&#39;</span><span class="p">));</span>
</pre></div>
</div>
</div>
<div class="section" id="s-npgettext">
<span id="npgettext"></span><h4><code class="docutils literal notranslate"><span class="pre">npgettext</span></code><a class="headerlink" href="#npgettext" title="Lien permanent vers ce titre">¶</a></h4>
<p>La fonction <code class="docutils literal notranslate"><span class="pre">npgettext</span></code> fonctionne également comme son équivalent Python (<a class="reference internal" href="../../ref/utils.html#django.utils.translation.npgettext" title="django.utils.translation.npgettext"><code class="xref py py-func docutils literal notranslate"><span class="pre">npgettext()</span></code></a>), fournissant un contenu <strong>pluriel</strong> traduit en fonction d’un contexte</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">npgettext</span><span class="p">(</span><span class="s1">&#39;group&#39;</span><span class="p">,</span> <span class="s1">&#39;party&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">));</span>
<span class="c1">// party</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">npgettext</span><span class="p">(</span><span class="s1">&#39;group&#39;</span><span class="p">,</span> <span class="s1">&#39;party&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">));</span>
<span class="c1">// parties</span>
</pre></div>
</div>
</div>
<div class="section" id="s-pluralidx">
<span id="pluralidx"></span><h4><code class="docutils literal notranslate"><span class="pre">pluralidx</span></code><a class="headerlink" href="#pluralidx" title="Lien permanent vers ce titre">¶</a></h4>
<p>La fonction <code class="docutils literal notranslate"><span class="pre">pluralidx</span></code> fonctionne de manière semblable au filtre de gabarit <a class="reference internal" href="../../ref/templates/builtins.html#std:templatefilter-pluralize"><code class="xref std std-tfilter docutils literal notranslate"><span class="pre">pluralize</span></code></a>, déterminant si un nombre <code class="docutils literal notranslate"><span class="pre">count</span></code> donné doit utiliser une forme plurielle d’un mot ou pas&nbsp;:</p>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">pluralidx</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
<span class="c1">// true</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">pluralidx</span><span class="p">(</span><span class="mi">1</span><span class="p">));</span>
<span class="c1">// false</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="nx">pluralidx</span><span class="p">(</span><span class="mi">2</span><span class="p">));</span>
<span class="c1">// true</span>
</pre></div>
</div>
<p>Dans le cas le plus simple, si aucune mise au pluriel n’est nécessaire, cette fonction renvoie <code class="docutils literal notranslate"><span class="pre">false</span></code> pour le nombre <code class="docutils literal notranslate"><span class="pre">1</span></code> et <code class="docutils literal notranslate"><span class="pre">true</span></code> pour tous les autres nombres.</p>
<p>Cependant, la mise au pluriel n’est pas si simple dans toutes les langues. Si la langue ne gère pas les pluriels, une valeur vide est renvoyée.</p>
<p>De plus, si les pluriels se basent sur des règles complexes, la vue du catalogue produit une expression conditionnelle. Son résultat aboutit soit à une valeur <code class="docutils literal notranslate"><span class="pre">true</span></code> (pluriel nécessaire), soit à une valeur <code class="docutils literal notranslate"><span class="pre">false</span></code> (pluriel <strong>non</strong> nécessaire).</p>
</div>
</div>
<div class="section" id="s-the-jsoncatalog-view">
<span id="the-jsoncatalog-view"></span><h3>La vue <code class="docutils literal notranslate"><span class="pre">JSONCatalog</span></code><a class="headerlink" href="#the-jsoncatalog-view" title="Lien permanent vers ce titre">¶</a></h3>
<dl class="class">
<dt id="django.views.i18n.JSONCatalog">
<em class="property">class </em><code class="descname">JSONCatalog</code><a class="headerlink" href="#django.views.i18n.JSONCatalog" title="Lien permanent vers cette définition">¶</a></dt>
<dd><p>Pour pouvoir utiliser une autre bibliothèque côté client pour la gestion des traductions, il peut être avantageux de profiter de la vue <code class="docutils literal notranslate"><span class="pre">JSONCatalog</span></code>. Le résultat est proche de <a class="reference internal" href="#django.views.i18n.JavaScriptCatalog" title="django.views.i18n.JavaScriptCatalog"><code class="xref py py-class docutils literal notranslate"><span class="pre">JavaScriptCatalog</span></code></a> mais le contenu est renvoyé sous forme de réponse JSON.</p>
<p>Consultez la documentation de <a class="reference internal" href="#django.views.i18n.JavaScriptCatalog" title="django.views.i18n.JavaScriptCatalog"><code class="xref py py-class docutils literal notranslate"><span class="pre">JavaScriptCatalog</span></code></a> pour connaître les valeurs possibles et l’utilisation des attributs <code class="docutils literal notranslate"><span class="pre">domain</span></code> et <code class="docutils literal notranslate"><span class="pre">packages</span></code>.</p>
<p>Le format de la réponse est le suivant&nbsp;:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>{
    &quot;catalog&quot;: {
        # Translations catalog
    },
    &quot;formats&quot;: {
        # Language formats for date, time, etc.
    },
    &quot;plural&quot;: &quot;...&quot;  # Expression for plural forms, or null.
}
</pre></div>
</div>
</dd></dl>

</div>
<div class="section" id="s-note-on-performance">
<span id="note-on-performance"></span><h3>Note sur les performances<a class="headerlink" href="#note-on-performance" title="Lien permanent vers ce titre">¶</a></h3>
<p>Les différentes vues JavaScript/JSON i18n génèrent leur catalogue à partir de fichiers <code class="docutils literal notranslate"><span class="pre">.mo</span></code> pour chaque requête. Comme le résultat est constant, au moins pour une version donnée du site, c’est une bonne occasion d’utiliser le cache.</p>
<p>Le cache côté serveur réduit la charge sur le processeur. Le décorateur <a class="reference internal" href="../cache.html#django.views.decorators.cache.cache_page" title="django.views.decorators.cache.cache_page"><code class="xref py py-func docutils literal notranslate"><span class="pre">cache_page()</span></code></a> permet de le faire facilement. Pour provoquer l’invalidation du cache lorsque les traductions ont changé, ajoutez un préfixe de clé dépendant de la version, comme le montre l’exemple ci-dessous, ou faites correspondre la vue à une URL dépendant de la version&nbsp;:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.views.decorators.cache</span> <span class="kn">import</span> <span class="n">cache_page</span>
<span class="kn">from</span> <span class="nn">django.views.i18n</span> <span class="kn">import</span> <span class="n">JavaScriptCatalog</span>

<span class="c1"># The value returned by get_version() must change when translations change.</span>
<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;jsi18n/&#39;</span><span class="p">,</span>
         <span class="n">cache_page</span><span class="p">(</span><span class="mi">86400</span><span class="p">,</span> <span class="n">key_prefix</span><span class="o">=</span><span class="s1">&#39;js18n-</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">get_version</span><span class="p">())(</span><span class="n">JavaScriptCatalog</span><span class="o">.</span><span class="n">as_view</span><span class="p">()),</span>
         <span class="n">name</span><span class="o">=</span><span class="s1">&#39;javascript-catalog&#39;</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Le cache côté client économise de la bande passante et accélère le chargement de votre site. Si vous utilisez les <code class="docutils literal notranslate"><span class="pre">ETags</span></code> (<a class="reference internal" href="../../ref/middleware.html#django.middleware.http.ConditionalGetMiddleware" title="django.middleware.http.ConditionalGetMiddleware"><code class="xref py py-class docutils literal notranslate"><span class="pre">ConditionalGetMiddleware</span></code></a>), il n’y a rien à faire de plus. Sinon, vous pouvez appliquer des <a class="reference internal" href="../conditional-view-processing.html#conditional-decorators"><span class="std std-ref">décorateurs conditionnels</span></a>. Dans l’exemple qui suit, le cache est invalidé chaque fois que vous relancez le serveur d’applications&nbsp;:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.utils</span> <span class="kn">import</span> <span class="n">timezone</span>
<span class="kn">from</span> <span class="nn">django.views.decorators.http</span> <span class="kn">import</span> <span class="n">last_modified</span>
<span class="kn">from</span> <span class="nn">django.views.i18n</span> <span class="kn">import</span> <span class="n">JavaScriptCatalog</span>

<span class="n">last_modified_date</span> <span class="o">=</span> <span class="n">timezone</span><span class="o">.</span><span class="n">now</span><span class="p">()</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;jsi18n/&#39;</span><span class="p">,</span>
         <span class="n">last_modified</span><span class="p">(</span><span class="k">lambda</span> <span class="n">req</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">:</span> <span class="n">last_modified_date</span><span class="p">)(</span><span class="n">JavaScriptCatalog</span><span class="o">.</span><span class="n">as_view</span><span class="p">()),</span>
         <span class="n">name</span><span class="o">=</span><span class="s1">&#39;javascript-catalog&#39;</span><span class="p">),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Il est même possible de pré-générer le catalogue JavaScript dans le cadre de votre procédure de déploiement et le servir comme fichier statique. Cette technique radicale est implémentée dans <a class="reference external" href="https://django-statici18n.readthedocs.io/en/latest/">django-statici18n</a>.</p>
</div>
</div>
<div class="section" id="s-module-django.conf.urls.i18n">
<span id="s-internationalization-in-url-patterns"></span><span id="s-url-internationalization"></span><span id="module-django.conf.urls.i18n"></span><span id="internationalization-in-url-patterns"></span><span id="url-internationalization"></span><h2>Internationalisation&nbsp;: dans les motifs d’URL<a class="headerlink" href="#module-django.conf.urls.i18n" title="Lien permanent vers ce titre">¶</a></h2>
<p>Django fournit deux mécanismes pour internationaliser les motifs d’URL&nbsp;:</p>
<ul class="simple">
<li>En ajoutant le préfixe de langue à la racine des motifs d’URL afin que <a class="reference internal" href="../../ref/middleware.html#django.middleware.locale.LocaleMiddleware" title="django.middleware.locale.LocaleMiddleware"><code class="xref py py-class docutils literal notranslate"><span class="pre">LocaleMiddleware</span></code></a> puisse détecter la langue à activer à partir de l’URL demandée.</li>
<li>En rendant traduisibles les motifs d’URL eux-mêmes via la fonction <a class="reference internal" href="../../ref/utils.html#django.utils.translation.gettext_lazy" title="django.utils.translation.gettext_lazy"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.utils.translation.gettext_lazy()</span></code></a>.</li>
</ul>
<div class="admonition warning">
<p class="first admonition-title">Avertissement</p>
<p class="last">L’utilisation de chacune de ces techniques exige qu’une langue active soit définie pour chaque requête&nbsp;; en d’autres termes, votre réglage <a class="reference internal" href="../../ref/settings.html#std:setting-MIDDLEWARE"><code class="xref std std-setting docutils literal notranslate"><span class="pre">MIDDLEWARE</span></code></a> doit contenir <a class="reference internal" href="../../ref/middleware.html#django.middleware.locale.LocaleMiddleware" title="django.middleware.locale.LocaleMiddleware"><code class="xref py py-class docutils literal notranslate"><span class="pre">django.middleware.locale.LocaleMiddleware</span></code></a>.</p>
</div>
<div class="section" id="s-language-prefix-in-url-patterns">
<span id="language-prefix-in-url-patterns"></span><h3>Préfixe de langue dans les motifs d’URL<a class="headerlink" href="#language-prefix-in-url-patterns" title="Lien permanent vers ce titre">¶</a></h3>
<dl class="function">
<dt id="django.conf.urls.i18n.i18n_patterns">
<code class="descname">i18n_patterns</code>(<em>*urls</em>, <em>prefix_default_language=True</em>)<a class="headerlink" href="#django.conf.urls.i18n.i18n_patterns" title="Lien permanent vers cette définition">¶</a></dt>
<dd></dd></dl>

<p>Cette fonction peut être utilisée dans une configuration d’URL racine et Django préfixe automatiquement tous les motifs d’URL définis par <a class="reference internal" href="#django.conf.urls.i18n.i18n_patterns" title="django.conf.urls.i18n.i18n_patterns"><code class="xref py py-func docutils literal notranslate"><span class="pre">i18n_patterns()</span></code></a> avec le code de langue actuellement actif.</p>
<p>En définissant <code class="docutils literal notranslate"><span class="pre">prefix_default_language</span></code> à <code class="docutils literal notranslate"><span class="pre">False</span></code>, le préfixe pour la langue par défaut (<a class="reference internal" href="../../ref/settings.html#std:setting-LANGUAGE_CODE"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LANGUAGE_CODE</span></code></a>) est enlevé. Cela peut être utile lors de l’ajout de traductions à un site existant afin que les URL actuelles ne changent pas.</p>
<p>Exemples de motifs d’URL&nbsp;:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.conf.urls.i18n</span> <span class="kn">import</span> <span class="n">i18n_patterns</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">include</span><span class="p">,</span> <span class="n">path</span>

<span class="kn">from</span> <span class="nn">about</span> <span class="kn">import</span> <span class="n">views</span> <span class="k">as</span> <span class="n">about_views</span>
<span class="kn">from</span> <span class="nn">news</span> <span class="kn">import</span> <span class="n">views</span> <span class="k">as</span> <span class="n">news_views</span>
<span class="kn">from</span> <span class="nn">sitemap.views</span> <span class="kn">import</span> <span class="n">sitemap</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;sitemap.xml&#39;</span><span class="p">,</span> <span class="n">sitemap</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;sitemap-xml&#39;</span><span class="p">),</span>
<span class="p">]</span>

<span class="n">news_patterns</span> <span class="o">=</span> <span class="p">([</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">news_views</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;category/&lt;slug:slug&gt;/&#39;</span><span class="p">,</span> <span class="n">news_views</span><span class="o">.</span><span class="n">category</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;category&#39;</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;&lt;slug:slug&gt;/&#39;</span><span class="p">,</span> <span class="n">news_views</span><span class="o">.</span><span class="n">details</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;detail&#39;</span><span class="p">),</span>
<span class="p">],</span> <span class="s1">&#39;news&#39;</span><span class="p">)</span>

<span class="n">urlpatterns</span> <span class="o">+=</span> <span class="n">i18n_patterns</span><span class="p">(</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;about/&#39;</span><span class="p">,</span> <span class="n">about_views</span><span class="o">.</span><span class="n">main</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;about&#39;</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;news/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">news_patterns</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="s1">&#39;news&#39;</span><span class="p">)),</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Après la définition de ces motifs d’URL, Django ajoute automatiquement le préfixe de langue dans les motifs d’URL qui ont été ajoutés avec la fonction <code class="docutils literal notranslate"><span class="pre">i18n_patterns</span></code>. Exemple&nbsp;:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">reverse</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="kn">import</span> <span class="n">activate</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">activate</span><span class="p">(</span><span class="s1">&#39;en&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;sitemap-xml&#39;</span><span class="p">)</span>
<span class="go">&#39;/sitemap.xml&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;news:index&#39;</span><span class="p">)</span>
<span class="go">&#39;/en/news/&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">activate</span><span class="p">(</span><span class="s1">&#39;nl&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;news:detail&#39;</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;slug&#39;</span><span class="p">:</span> <span class="s1">&#39;news-slug&#39;</span><span class="p">})</span>
<span class="go">&#39;/nl/news/news-slug/&#39;</span>
</pre></div>
</div>
<p>Avec <code class="docutils literal notranslate"><span class="pre">prefix_default_language=False</span></code> et <code class="docutils literal notranslate"><span class="pre">LANGUAGE_CODE='en'</span></code>, les URL seront&nbsp;:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">activate</span><span class="p">(</span><span class="s1">&#39;en&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;news:index&#39;</span><span class="p">)</span>
<span class="go">&#39;/news/&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">activate</span><span class="p">(</span><span class="s1">&#39;nl&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;news:index&#39;</span><span class="p">)</span>
<span class="go">&#39;/nl/news/&#39;</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Avertissement</p>
<p class="last"><a class="reference internal" href="#django.conf.urls.i18n.i18n_patterns" title="django.conf.urls.i18n.i18n_patterns"><code class="xref py py-func docutils literal notranslate"><span class="pre">i18n_patterns()</span></code></a> ne peut figurer que dans la configuration d’URL racine. Si vous essayez de l’utiliser dans une configuration d’URL incluse, vous obtiendrez une exception <a class="reference internal" href="../../ref/exceptions.html#django.core.exceptions.ImproperlyConfigured" title="django.core.exceptions.ImproperlyConfigured"><code class="xref py py-exc docutils literal notranslate"><span class="pre">ImproperlyConfigured</span></code></a>.</p>
</div>
<div class="admonition warning">
<p class="first admonition-title">Avertissement</p>
<p class="last">Assurez-vous de ne pas avoir de motifs d’URL non préfixés qui pourraient être confondus avec des motifs contenant le préfixe de langue automatique.</p>
</div>
</div>
<div class="section" id="s-translating-url-patterns">
<span id="s-translating-urlpatterns"></span><span id="translating-url-patterns"></span><span id="translating-urlpatterns"></span><h3>Traduction de motifs d’URL<a class="headerlink" href="#translating-url-patterns" title="Lien permanent vers ce titre">¶</a></h3>
<p>Les motifs d’URL peuvent aussi être signalés comme traduisibles en utilisant la fonction <a class="reference internal" href="../../ref/utils.html#django.utils.translation.gettext_lazy" title="django.utils.translation.gettext_lazy"><code class="xref py py-func docutils literal notranslate"><span class="pre">gettext_lazy()</span></code></a>. Exemple&nbsp;:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.conf.urls.i18n</span> <span class="kn">import</span> <span class="n">i18n_patterns</span>
<span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">include</span><span class="p">,</span> <span class="n">path</span>
<span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="kn">import</span> <span class="n">gettext_lazy</span> <span class="k">as</span> <span class="n">_</span>

<span class="kn">from</span> <span class="nn">about</span> <span class="kn">import</span> <span class="n">views</span> <span class="k">as</span> <span class="n">about_views</span>
<span class="kn">from</span> <span class="nn">news</span> <span class="kn">import</span> <span class="n">views</span> <span class="k">as</span> <span class="n">news_views</span>
<span class="kn">from</span> <span class="nn">sitemaps.views</span> <span class="kn">import</span> <span class="n">sitemap</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;sitemap.xml&#39;</span><span class="p">,</span> <span class="n">sitemap</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;sitemap-xml&#39;</span><span class="p">),</span>
<span class="p">]</span>

<span class="n">news_patterns</span> <span class="o">=</span> <span class="p">([</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">news_views</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;category/&lt;slug:slug&gt;/&#39;</span><span class="p">),</span> <span class="n">news_views</span><span class="o">.</span><span class="n">category</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;category&#39;</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="s1">&#39;&lt;slug:slug&gt;/&#39;</span><span class="p">,</span> <span class="n">news_views</span><span class="o">.</span><span class="n">details</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;detail&#39;</span><span class="p">),</span>
<span class="p">],</span> <span class="s1">&#39;news&#39;</span><span class="p">)</span>

<span class="n">urlpatterns</span> <span class="o">+=</span> <span class="n">i18n_patterns</span><span class="p">(</span>
    <span class="n">path</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;about/&#39;</span><span class="p">),</span> <span class="n">about_views</span><span class="o">.</span><span class="n">main</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;about&#39;</span><span class="p">),</span>
    <span class="n">path</span><span class="p">(</span><span class="n">_</span><span class="p">(</span><span class="s1">&#39;news/&#39;</span><span class="p">),</span> <span class="n">include</span><span class="p">(</span><span class="n">news_patterns</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="s1">&#39;news&#39;</span><span class="p">)),</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Après avoir effectué les traductions, la fonction <a class="reference internal" href="../../ref/urlresolvers.html#django.urls.reverse" title="django.urls.reverse"><code class="xref py py-func docutils literal notranslate"><span class="pre">reverse()</span></code></a> renverra l’URL dans la langue active. Exemple&nbsp;:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.urls</span> <span class="kn">import</span> <span class="n">reverse</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="kn">import</span> <span class="n">activate</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">activate</span><span class="p">(</span><span class="s1">&#39;en&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;news:category&#39;</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;slug&#39;</span><span class="p">:</span> <span class="s1">&#39;recent&#39;</span><span class="p">})</span>
<span class="go">&#39;/en/news/category/recent/&#39;</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">activate</span><span class="p">(</span><span class="s1">&#39;nl&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">reverse</span><span class="p">(</span><span class="s1">&#39;news:category&#39;</span><span class="p">,</span> <span class="n">kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;slug&#39;</span><span class="p">:</span> <span class="s1">&#39;recent&#39;</span><span class="p">})</span>
<span class="go">&#39;/nl/nieuws/categorie/recent/&#39;</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Avertissement</p>
<p class="last">Dans la plupart des cas, il est recommandé de n’utiliser des URL traduites que dans des blocs de motifs avec préfixe de code de langue (utilisant <a class="reference internal" href="#django.conf.urls.i18n.i18n_patterns" title="django.conf.urls.i18n.i18n_patterns"><code class="xref py py-func docutils literal notranslate"><span class="pre">i18n_patterns()</span></code></a>), pour éviter l’éventualité qu’une URL mal traduite entre en conflit avec un motif d’URL non traduit.</p>
</div>
</div>
<div class="section" id="s-reversing-in-templates">
<span id="s-id2"></span><span id="reversing-in-templates"></span><span id="id2"></span><h3>Résolution inverse dans les gabarits<a class="headerlink" href="#reversing-in-templates" title="Lien permanent vers ce titre">¶</a></h3>
<p>Lors de la résolution d’URL régionalisées dans les gabarits, c’est toujours la langue active qui sera utilisée. Pour créer un lien vers une URL dans une autre langue, utilisez la balise de gabarit <a class="reference internal" href="#std:templatetag-language"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">language</span></code></a>. Elle active la langue indiquée à l’intérieur de la section de gabarit concernée&nbsp;:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">i18n</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">get_available_languages</span> <span class="k">as</span> <span class="nv">languages</span> <span class="cp">%}</span>

<span class="cp">{%</span> <span class="k">translate</span> <span class="s2">&quot;View this category in:&quot;</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">for</span> <span class="nv">lang_code</span><span class="o">,</span> <span class="nv">lang_name</span> <span class="k">in</span> <span class="nv">languages</span> <span class="cp">%}</span>
    <span class="cp">{%</span> <span class="k">language</span> <span class="nv">lang_code</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">a</span> <span class="na">href</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;category&#39;</span> <span class="nv">slug</span><span class="o">=</span><span class="nv">category.slug</span> <span class="cp">%}</span><span class="s">&quot;</span><span class="p">&gt;</span><span class="cp">{{</span> <span class="nv">lang_name</span> <span class="cp">}}</span><span class="p">&lt;/</span><span class="nt">a</span><span class="p">&gt;</span>
    <span class="cp">{%</span> <span class="k">endlanguage</span> <span class="cp">%}</span>
<span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
</pre></div>
</div>
<p>La balise <a class="reference internal" href="#std:templatetag-language"><code class="xref std std-ttag docutils literal notranslate"><span class="pre">language</span></code></a> n’accepte que le code de langue comme paramètre.</p>
</div>
</div>
<div class="section" id="s-localization-how-to-create-language-files">
<span id="s-how-to-create-language-files"></span><span id="localization-how-to-create-language-files"></span><span id="how-to-create-language-files"></span><h2>Régionalisation&nbsp;: comment créer les fichiers de langues<a class="headerlink" href="#localization-how-to-create-language-files" title="Lien permanent vers ce titre">¶</a></h2>
<p>Après avoir marqué les chaînes à traduire dans le code d’une application, il s’agit d’effectuer les traductions elles-mêmes. Voici comment ça fonctionne.</p>
<div class="section" id="s-message-files">
<span id="message-files"></span><h3>Fichiers de messages<a class="headerlink" href="#message-files" title="Lien permanent vers ce titre">¶</a></h3>
<p>La première étape est de créer un <a class="reference internal" href="index.html#term-message-file"><span class="xref std std-term">fichier de messages</span></a> pour la nouvelle langue. Il s’agit d’un simple fichier texte correspondant à une seule langue et contenant toutes les chaînes à traduire disponibles ainsi que leur traduction dans la langue cible. Les fichiers de messages possèdent l’extension de fichier <code class="docutils literal notranslate"><span class="pre">.po</span></code>.</p>
<p>Django est livré avec un outil, <a class="reference internal" href="../../ref/django-admin.html#django-admin-makemessages"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">django-admin</span> <span class="pre">makemessages</span></code></a>, qui automatise la création et la maintenance de ces fichiers.</p>
<div class="admonition-gettext-utilities admonition">
<p class="first admonition-title">Utilitaires gettext</p>
<p>La commande <code class="docutils literal notranslate"><span class="pre">makemessages</span></code> (ainsi que <code class="docutils literal notranslate"><span class="pre">compilemessages</span></code> présentée plus bas) utilise des commandes de la suite d’outils GNU gettext&nbsp;: <code class="docutils literal notranslate"><span class="pre">xgettext</span></code>, <code class="docutils literal notranslate"><span class="pre">msgfmt</span></code>, <code class="docutils literal notranslate"><span class="pre">msgmerge</span></code> et <code class="docutils literal notranslate"><span class="pre">msguniq</span></code>.</p>
<p class="last">La version minimale prise en charge des utilitaires  <code class="docutils literal notranslate"><span class="pre">gettext</span></code> est la version 0.15.</p>
</div>
<p>Pour créer ou mettre à jour un fichier de messages, exécutez cette commande&nbsp;:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">django</span><span class="o">-</span><span class="n">admin</span> <span class="n">makemessages</span> <span class="o">-</span><span class="n">l</span> <span class="n">de</span>
</pre></div>
</div>
<p>…où <code class="docutils literal notranslate"><span class="pre">de</span></code> est le <a class="reference internal" href="index.html#term-locale-name"><span class="xref std std-term">nom de locale</span></a> du fichier de messages que vous souhaitez créer. Par exemple, le portugais du Brésil est représenté par <code class="docutils literal notranslate"><span class="pre">pt_BR</span></code>, l’allemand d’Autriche par <code class="docutils literal notranslate"><span class="pre">de_AT</span></code> ou encore <code class="docutils literal notranslate"><span class="pre">id</span></code> pour l’indonésien.</p>
<p>Le script doit être lancé depuis l’un des deux endroits suivants&nbsp;:</p>
<ul class="simple">
<li>Le répertoire racine de votre projet Django (celui qui contient <code class="docutils literal notranslate"><span class="pre">manage.py</span></code>).</li>
<li>Le répertoire racine de l’une de vos applications Django.</li>
</ul>
<p>Le script parcourt l’arborescence des sources de votre projet ou de votre application et extrait toutes les chaînes marquées pour la traduction (consultez <a class="reference internal" href="#how-django-discovers-translations"><span class="std std-ref">Processus de découverte des traductions par Django</span></a> et assurez-vous que <a class="reference internal" href="../../ref/settings.html#std:setting-LOCALE_PATHS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LOCALE_PATHS</span></code></a> est correctement configuré). Il crée (ou met à jour) un fichier de messages dans le répertoire <code class="docutils literal notranslate"><span class="pre">locale/LANG/LC_MESSAGES</span></code>. Dans l’exemple avec <code class="docutils literal notranslate"><span class="pre">de</span></code>, le fichier équivaudra à <code class="docutils literal notranslate"><span class="pre">locale/de/LC_MESSAGES/django.po</span></code>.</p>
<p>Lorsque vous exécutez <code class="docutils literal notranslate"><span class="pre">makemessages</span></code> à partir du dossier racine de votre projet, les chaînes extraites sont automatiquement distribuées dans les fichiers de messages appropriés. C’est-à-dire qu’une chaîne extraite d’un fichier d’une application contenant un répertoire <code class="docutils literal notranslate"><span class="pre">locale</span></code> sera placée dans un fichier de messages sous ce répertoire. Une chaîne extraite d’un fichier d’une application sans répertoire <code class="docutils literal notranslate"><span class="pre">locale</span></code> sera placée dans un fichier de messages sous le répertoire apparaissant en premier dans <a class="reference internal" href="../../ref/settings.html#std:setting-LOCALE_PATHS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LOCALE_PATHS</span></code></a> ou générera une erreur si le réglage <a class="reference internal" href="../../ref/settings.html#std:setting-LOCALE_PATHS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LOCALE_PATHS</span></code></a> est vide.</p>
<p>Par défaut, <a class="reference internal" href="../../ref/django-admin.html#django-admin-makemessages"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">django-admin</span> <span class="pre">makemessages</span></code></a> examine chaque fichier ayant une extension <code class="docutils literal notranslate"><span class="pre">.html</span></code>, <code class="docutils literal notranslate"><span class="pre">.txt</span></code> ou <code class="docutils literal notranslate"><span class="pre">.py</span></code>. Dans le cas où vous souhaitez modifier cela, utilisez l’option <a class="reference internal" href="../../ref/django-admin.html#cmdoption-makemessages-extension"><code class="xref std std-option docutils literal notranslate"><span class="pre">--extension</span></code></a> ou <code class="docutils literal notranslate"><span class="pre">-e</span></code> pour indiquer les extensions de fichiers à examiner&nbsp;:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">django</span><span class="o">-</span><span class="n">admin</span> <span class="n">makemessages</span> <span class="o">-</span><span class="n">l</span> <span class="n">de</span> <span class="o">-</span><span class="n">e</span> <span class="n">txt</span>
</pre></div>
</div>
<p>Séparez plusieurs extensions par une virgule ou utilisez plusieurs occurrences de <code class="docutils literal notranslate"><span class="pre">-e</span></code> ou <code class="docutils literal notranslate"><span class="pre">--extension</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">django</span><span class="o">-</span><span class="n">admin</span> <span class="n">makemessages</span> <span class="o">-</span><span class="n">l</span> <span class="n">de</span> <span class="o">-</span><span class="n">e</span> <span class="n">html</span><span class="p">,</span><span class="n">txt</span> <span class="o">-</span><span class="n">e</span> <span class="n">xml</span>
</pre></div>
</div>
<div class="admonition warning">
<p class="first admonition-title">Avertissement</p>
<p class="last">Lors de la <a class="reference internal" href="#creating-message-files-from-js-code"><span class="std std-ref">création de fichiers de messages à partir de code JavaScript</span></a>, vous devez utiliser le domaine particulier <code class="docutils literal notranslate"><span class="pre">djangojs</span></code>, et <strong>non pas</strong> <code class="docutils literal notranslate"><span class="pre">-e</span> <span class="pre">js</span></code>.</p>
</div>
<div class="admonition-using-jinja2-templates admonition">
<p class="first admonition-title">Utilisation de gabarits Jinja2</p>
<p><a class="reference internal" href="../../ref/django-admin.html#django-admin-makemessages"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">makemessages</span></code></a> ne comprend pas la syntaxe des gabarits Jinja2. Pour extraire les chaînes d’un projet contenant des gabarits Jinja2, utilisez plutôt l”<a class="reference external" href="http://babel.pocoo.org/en/latest/messages.html#message-extraction">extraction de messages</a> de <a class="reference external" href="http://babel.pocoo.org/">Babel</a>.</p>
<p>Voici un exemple de fichier de configuration <code class="docutils literal notranslate"><span class="pre">babel.cfg</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># Extraction from Python source files</span>
<span class="p">[</span><span class="n">python</span><span class="p">:</span> <span class="o">**.</span><span class="n">py</span><span class="p">]</span>

<span class="c1"># Extraction from Jinja2 templates</span>
<span class="p">[</span><span class="n">jinja2</span><span class="p">:</span> <span class="o">**.</span><span class="n">jinja</span><span class="p">]</span>
<span class="n">extensions</span> <span class="o">=</span> <span class="n">jinja2</span><span class="o">.</span><span class="n">ext</span><span class="o">.</span><span class="n">with_</span>
</pre></div>
</div>
<p>Prenez soin de bien mentionner toutes les extensions que vous utilisez&nbsp;! Sinon, Babel ne reconnaîtra pas les balises définies par ces extensions et ignorera complètement les gabarits Jinja2 contenant de telles balises.</p>
<p class="last">Babel fournit des fonctionnalités similaires à <a class="reference internal" href="../../ref/django-admin.html#django-admin-makemessages"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">makemessages</span></code></a> et peut généralement le remplacer. Il ne dépend pas de <code class="docutils literal notranslate"><span class="pre">gettext</span></code>. Pour plus d’informations, lisez sa documentation au sujet de <a class="reference external" href="http://babel.pocoo.org/en/latest/messages.html">sa gestion des catalogues de messages</a>.</p>
</div>
<div class="admonition-no-gettext admonition">
<p class="first admonition-title">Pas de gettext&nbsp;?</p>
<p class="last">Si les utilitaires <code class="docutils literal notranslate"><span class="pre">gettext</span></code> ne sont pas installés, <a class="reference internal" href="../../ref/django-admin.html#django-admin-makemessages"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">makemessages</span></code></a> crée des fichiers vides. Dans ce cas, installez les utilitaires <code class="docutils literal notranslate"><span class="pre">gettext</span></code> ou copiez le fichier de messages anglais (<code class="docutils literal notranslate"><span class="pre">locale/en/LC_MESSAGES/django.po</span></code>) s’il y en a un et utilisez-le comme point de départ, celui-ci étant un fichier de traductions vides.</p>
</div>
<div class="admonition-working-on-windows admonition">
<p class="first admonition-title">Vous utilisez Windows&nbsp;?</p>
<p class="last">Si vous utilisez Windows et que vous avez besoin d’installer les utilitaires GNU gettext pour le fonctionnement de <a class="reference internal" href="../../ref/django-admin.html#django-admin-makemessages"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">makemessages</span></code></a>, consultez <a class="reference internal" href="#gettext-on-windows"><span class="std std-ref">gettext et Windows</span></a> pour plus d’informations.</p>
</div>
<p>Chaque fichier <code class="docutils literal notranslate"><span class="pre">.po</span></code> contient quelques métadonnées telles que les informations de contact du mainteneur de la traduction, mais la partie principale du fichier est composée d’une liste de <strong>messages</strong>, des correspondances entre les chaînes à traduire et les textes de la traduction dans la langue cible.</p>
<p>Par exemple, si votre application Django contient une chaîne à traduire pour le texte <code class="docutils literal notranslate"><span class="pre">&quot;Welcome</span> <span class="pre">to</span> <span class="pre">my</span> <span class="pre">site.&quot;</span></code>, comme ceci&nbsp;:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">_</span><span class="p">(</span><span class="s2">&quot;Welcome to my site.&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>…alors <a class="reference internal" href="../../ref/django-admin.html#django-admin-makemessages"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">django-admin</span> <span class="pre">makemessages</span></code></a> créera un fichier <code class="docutils literal notranslate"><span class="pre">.po</span></code> contenant l’extrait (message) suivant&nbsp;:</p>
<div class="highlight-po notranslate"><div class="highlight"><pre><span></span><span class="kd">#: path/to/python/module.py:23</span>
<span class="nv">msgid</span> <span class="s">&quot;Welcome to my site.&quot;</span>
<span class="nv">msgstr</span> <span class="s">&quot;&quot;</span>
</pre></div>
</div>
<p>Une rapide explication&nbsp;:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">msgid</span></code> est la chaîne à traduire apparaissant dans la source. N’y touchez pas.</li>
<li><code class="docutils literal notranslate"><span class="pre">msgstr</span></code> est l’emplacement devant recevoir la traduction dans la langue cible. Il est vide au début, il est donc de votre responsabilité d’y ajouter le contenu traduit. Prenez soin de ne pas enlever les guillemets autour de la traduction.</li>
<li>Chaque message contient des indications utiles sous la forme d’une ligne de commentaire préfixée par <code class="docutils literal notranslate"><span class="pre">#</span></code> et située au-dessus de la ligne <code class="docutils literal notranslate"><span class="pre">msgid</span></code>; ce commentaire contient le nom de fichier et le numéro de ligne correspondant au fichier duquel cette chaîne à traduire a été extraite.</li>
</ul>
<p>Les longs messages sont des cas spéciaux. La première expression juste après <code class="docutils literal notranslate"><span class="pre">msgstr</span></code> (ou <code class="docutils literal notranslate"><span class="pre">msgid</span></code>) est une chaîne vide. Le contenu lui-même est écrit dans les lignes suivantes sur plusieurs lignes qui seront concaténées au moment de la récupération de la traduction. N’oubliez donc pas les espaces en fin de ligne à l’intérieur du texte, sinon les lignes seront mises bout à bout sans espace&nbsp;!</p>
<div class="admonition-mind-your-charset admonition">
<p class="first admonition-title">Attention au codage des caractères</p>
<p class="last">En raison du fonctionnement interne des outils <code class="docutils literal notranslate"><span class="pre">gettext</span></code> et de la volonté du cœur de Django d’accepter dans les chaînes source des caractères hors de l’ensemble ASCII, vous <strong>devez</strong> utiliser UTF-8 comme codage pour vos fichiers PO (valeur par défaut lorsque les fichiers PO sont créés). Cela signifie que tout le monde utilise le même codage de caractères, ce qui est important pour Django lorsqu’il traite les fichiers PO.</p>
</div>
<div class="admonition-fuzzy-entries admonition">
<p class="first admonition-title">Lignes « fuzzy »</p>
<p class="last"><a class="reference internal" href="../../ref/django-admin.html#django-admin-makemessages"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">makemessages</span></code></a> génère parfois des éléments de traduction marqués comme « fuzzy » (approximatif), par exemple lorsque des traductions sont partiellement tirées d’autres chaînes précédemment traduites. Par défaut, ces chaînes approximatives ne sont <strong>pas</strong> incluses dans le résultat de <a class="reference internal" href="../../ref/django-admin.html#django-admin-compilemessages"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">compilemessages</span></code></a>.</p>
</div>
<p>Pour réexaminer tout le code source et les gabarits à la recherche de nouvelles chaînes à traduire et pour mettre à jour tous les fichiers de messages pour <strong>toutes</strong> les langues, exécutez ceci&nbsp;:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">django</span><span class="o">-</span><span class="n">admin</span> <span class="n">makemessages</span> <span class="o">-</span><span class="n">a</span>
</pre></div>
</div>
</div>
<div class="section" id="s-compiling-message-files">
<span id="compiling-message-files"></span><h3>Compilation des fichiers de messages<a class="headerlink" href="#compiling-message-files" title="Lien permanent vers ce titre">¶</a></h3>
<p>Après avoir créé un fichier de messages et lors de chaque modification à ce fichier, il est nécessaire de le compiler dans un format plus efficace utilisable par <code class="docutils literal notranslate"><span class="pre">gettext</span></code>. Ceci se fait à l’aide de la commande <a class="reference internal" href="../../ref/django-admin.html#django-admin-compilemessages"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">django-admin</span> <span class="pre">compilemessages</span></code></a>.</p>
<p>Cet outil parcourt tous les fichiers <code class="docutils literal notranslate"><span class="pre">.po</span></code> disponibles et crée des fichiers <code class="docutils literal notranslate"><span class="pre">.mo</span></code> qui sont des fichiers binaires optimisés pour <code class="docutils literal notranslate"><span class="pre">gettext</span></code>. Dans le même répertoire à partir duquel vous avez lancé <a class="reference internal" href="../../ref/django-admin.html#django-admin-makemessages"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">django-admin</span> <span class="pre">makemessages</span></code></a>, exécutez <a class="reference internal" href="../../ref/django-admin.html#django-admin-compilemessages"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">django-admin</span> <span class="pre">compilemessages</span></code></a> comme ceci&nbsp;:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">django</span><span class="o">-</span><span class="n">admin</span> <span class="n">compilemessages</span>
</pre></div>
</div>
<p>C’est tout. Vos traductions sont prêtes à l’emploi.</p>
<div class="admonition-working-on-windows admonition">
<p class="first admonition-title">Vous utilisez Windows&nbsp;?</p>
<p class="last">Si vous utilisez Windows et que vous avez besoin d’installer les utilitaires GNU gettext pour le fonctionnement de <a class="reference internal" href="../../ref/django-admin.html#django-admin-compilemessages"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">django-admin</span> <span class="pre">compilemessages</span></code></a>, consultez <a class="reference internal" href="#gettext-on-windows"><span class="std std-ref">gettext et Windows</span></a> pour plus d’informations.</p>
</div>
<div class="admonition-po-files-encoding-and-bom-usage admonition">
<p class="first admonition-title">Fichiers .po&nbsp;: codage et présence du BOM</p>
<p class="last">Django ne gère que les fichiers <code class="docutils literal notranslate"><span class="pre">.po</span></code> codés en UTF-8 et sans BOM (Byte Order Mark)&nbsp;; si votre éditeur de texte ajoute par défaut de telles marques au début des fichiers, il vous faudra le reconfigurer.</p>
</div>
</div>
<div class="section" id="s-troubleshooting-gettext-incorrectly-detects-python-format-in-strings-with-percent-signs">
<span id="troubleshooting-gettext-incorrectly-detects-python-format-in-strings-with-percent-signs"></span><h3>Dépannage&nbsp;: <code class="docutils literal notranslate"><span class="pre">gettext()</span></code> détecte <code class="docutils literal notranslate"><span class="pre">python-format</span></code> de façon erronée dans des chaînes contenant des caractères pourcent<a class="headerlink" href="#troubleshooting-gettext-incorrectly-detects-python-format-in-strings-with-percent-signs" title="Lien permanent vers ce titre">¶</a></h3>
<p>Dans certains cas, tels que des chaînes avec un caractère pourcent suivi d’un espace et d’un <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#old-string-formatting" title="(disponible dans Python v3.9)"><span class="xref std std-ref">marqueur de conversion de chaîne</span></a> (par ex. <code class="docutils literal notranslate"><span class="pre">_(&quot;10%</span> <span class="pre">interest&quot;)</span></code>), <a class="reference internal" href="../../ref/utils.html#django.utils.translation.gettext" title="django.utils.translation.gettext"><code class="xref py py-func docutils literal notranslate"><span class="pre">gettext()</span></code></a> marque faussement la chaîne avec <code class="docutils literal notranslate"><span class="pre">python-format</span></code>.</p>
<p>Si vous essayez de compiler des fichiers de messages contenant des chaînes faussement marquées, vous obtiendrez un message d’erreur du style <code class="docutils literal notranslate"><span class="pre">le</span> <span class="pre">nombre</span> <span class="pre">de</span> <span class="pre">spécifications</span> <span class="pre">de</span> <span class="pre">format</span> <span class="pre">dans</span> <span class="pre">'msgid'</span> <span class="pre">et</span> <span class="pre">'msgstr'</span> <span class="pre">ne</span> <span class="pre">correspondent</span> <span class="pre">pas</span></code> ou <code class="docutils literal notranslate"><span class="pre">'msgstr'</span> <span class="pre">n'est</span> <span class="pre">pas</span> <span class="pre">une</span> <span class="pre">chaîne</span> <span class="pre">de</span> <span class="pre">format</span> <span class="pre">Python</span> <span class="pre">valide,</span> <span class="pre">au</span> <span class="pre">contraire</span> <span class="pre">de</span> <span class="pre">'msgid'</span></code>.</p>
<p>Pour contourner ce problème, vous pouvez échapper les caractères pourcent en ajoutant un second signe pourcent&nbsp;:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="kn">import</span> <span class="n">gettext</span> <span class="k">as</span> <span class="n">_</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;10</span><span class="si">%%</span><span class="s2"> interest&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Ou il est aussi possible d’ajouter le marqueur <code class="docutils literal notranslate"><span class="pre">no-python-format</span></code> afin que tous les caractères pourcent soient considérés comme contenu littéral&nbsp;:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># xgettext:no-python-format</span>
<span class="n">output</span> <span class="o">=</span> <span class="n">_</span><span class="p">(</span><span class="s2">&quot;10</span><span class="si">% i</span><span class="s2">nterest&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="s-creating-message-files-from-javascript-source-code">
<span id="s-creating-message-files-from-js-code"></span><span id="creating-message-files-from-javascript-source-code"></span><span id="creating-message-files-from-js-code"></span><h3>Création de fichiers de messages à partir de code JavaScript<a class="headerlink" href="#creating-message-files-from-javascript-source-code" title="Lien permanent vers ce titre">¶</a></h3>
<p>La création et la mise à jour des fichiers de messages se fait de la même manière que les autres fichiers de messages de Django, à l’aide de l’outil <a class="reference internal" href="../../ref/django-admin.html#django-admin-makemessages"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">django-admin</span> <span class="pre">makemessages</span></code></a>. La seule différence est que vous devez explicitement définir ce que le jargon <code class="docutils literal notranslate"><span class="pre">gettext</span></code> appelle un domaine, dans ce cas le domaine <code class="docutils literal notranslate"><span class="pre">djangojs</span></code>, en indiquant le paramètre <code class="docutils literal notranslate"><span class="pre">-d</span> <span class="pre">djangojs</span></code> comme ceci&nbsp;:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">django</span><span class="o">-</span><span class="n">admin</span> <span class="n">makemessages</span> <span class="o">-</span><span class="n">d</span> <span class="n">djangojs</span> <span class="o">-</span><span class="n">l</span> <span class="n">de</span>
</pre></div>
</div>
<p>Ceci va créer ou mettre à jour le fichier de messages JavaScript en allemand. Après la mise à jour des fichiers de messages, lancez <a class="reference internal" href="../../ref/django-admin.html#django-admin-compilemessages"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">django-admin</span> <span class="pre">compilemessages</span></code></a> sur le même principe que pour les autres fichiers de messages de Django.</p>
</div>
<div class="section" id="s-gettext-on-windows">
<span id="s-id3"></span><span id="gettext-on-windows"></span><span id="id3"></span><h3><code class="docutils literal notranslate"><span class="pre">gettext</span></code> et Windows<a class="headerlink" href="#gettext-on-windows" title="Lien permanent vers ce titre">¶</a></h3>
<p>Ceci n’est nécessaire que pour les personnes qui doivent extraire des messages à traduire ou compiler des fichiers de messages (<code class="docutils literal notranslate"><span class="pre">.po</span></code>). Le travail de traduction en soi requiert de modifier des fichiers de ce type, mais si vous souhaitez créer vos propres fichiers de messages ou que vous vouliez tester ou compiler un fichier de messages modifié, téléchargez un <a class="reference external" href="https://mlocati.github.io/articles/gettext-iconv-windows.html">installeur binaire précompilé</a>.</p>
<p>Il est aussi possible d’utiliser des binaires <code class="docutils literal notranslate"><span class="pre">gettext</span></code> obtenus par une autre source, tant que la commande <code class="docutils literal notranslate"><span class="pre">xgettext</span> <span class="pre">--version</span></code> fonctionne correctement. N’essayez pas d’utiliser les utilitaires de traduction de Django avec un paquet <code class="docutils literal notranslate"><span class="pre">gettext</span></code> si la commande <code class="docutils literal notranslate"><span class="pre">xgettext</span> <span class="pre">--version</span></code> saisie dans une invite de commande Windows produit une fenêtre contenant un message du genre «&nbsp;xgettext.exe a produit des erreurs et sera fermé par Windows&nbsp;».</p>
</div>
<div class="section" id="s-customizing-the-makemessages-command">
<span id="s-customizing-makemessages"></span><span id="customizing-the-makemessages-command"></span><span id="customizing-makemessages"></span><h3>Personnalisation de la commande <code class="docutils literal notranslate"><span class="pre">makemessages</span></code><a class="headerlink" href="#customizing-the-makemessages-command" title="Lien permanent vers ce titre">¶</a></h3>
<p>Si vous souhaitez passer des paramètres supplémentaires à <code class="docutils literal notranslate"><span class="pre">xgettext</span></code>, vous devez créer une commande <a class="reference internal" href="../../ref/django-admin.html#django-admin-makemessages"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">makemessages</span></code></a> personnaliséeet surcharger son attribut <code class="docutils literal notranslate"><span class="pre">xgettext_options</span></code>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.core.management.commands</span> <span class="kn">import</span> <span class="n">makemessages</span>

<span class="k">class</span> <span class="nc">Command</span><span class="p">(</span><span class="n">makemessages</span><span class="o">.</span><span class="n">Command</span><span class="p">):</span>
    <span class="n">xgettext_options</span> <span class="o">=</span> <span class="n">makemessages</span><span class="o">.</span><span class="n">Command</span><span class="o">.</span><span class="n">xgettext_options</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;--keyword=mytrans&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>Si vous avez besoin de plus de souplesse, vous pouvez aussi ajouter un nouveau paramètre à votre commande <a class="reference internal" href="../../ref/django-admin.html#django-admin-makemessages"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">makemessages</span></code></a> personnalisée&nbsp;:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.core.management.commands</span> <span class="kn">import</span> <span class="n">makemessages</span>

<span class="k">class</span> <span class="nc">Command</span><span class="p">(</span><span class="n">makemessages</span><span class="o">.</span><span class="n">Command</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">add_arguments</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parser</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">add_arguments</span><span class="p">(</span><span class="n">parser</span><span class="p">)</span>
        <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
            <span class="s1">&#39;--extra-keyword&#39;</span><span class="p">,</span>
            <span class="n">dest</span><span class="o">=</span><span class="s1">&#39;xgettext_keywords&#39;</span><span class="p">,</span>
            <span class="n">action</span><span class="o">=</span><span class="s1">&#39;append&#39;</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">handle</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
        <span class="n">xgettext_keywords</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s1">&#39;xgettext_keywords&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">xgettext_keywords</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">xgettext_options</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">makemessages</span><span class="o">.</span><span class="n">Command</span><span class="o">.</span><span class="n">xgettext_options</span><span class="p">[:]</span> <span class="o">+</span>
                <span class="p">[</span><span class="s1">&#39;--keyword=</span><span class="si">%s</span><span class="s1">&#39;</span> <span class="o">%</span> <span class="n">kwd</span> <span class="k">for</span> <span class="n">kwd</span> <span class="ow">in</span> <span class="n">xgettext_keywords</span><span class="p">]</span>
            <span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">handle</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="s-miscellaneous">
<span id="miscellaneous"></span><h2>Divers<a class="headerlink" href="#miscellaneous" title="Lien permanent vers ce titre">¶</a></h2>
<div class="section" id="s-the-set-language-redirect-view">
<span id="s-set-language-redirect-view"></span><span id="the-set-language-redirect-view"></span><span id="set-language-redirect-view"></span><h3>La vue de redirection <code class="docutils literal notranslate"><span class="pre">set_language</span></code><a class="headerlink" href="#the-set-language-redirect-view" title="Lien permanent vers ce titre">¶</a></h3>
<dl class="function">
<dt id="django.views.i18n.set_language">
<code class="descname">set_language</code>(<em>request</em>)<a class="headerlink" href="#django.views.i18n.set_language" title="Lien permanent vers cette définition">¶</a></dt>
<dd></dd></dl>

<p>Par commodité, Django fournit une vue, <a class="reference internal" href="#django.views.i18n.set_language" title="django.views.i18n.set_language"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.views.i18n.set_language()</span></code></a>, qui définit la préférence de langue d’un utilisateur et redirige vers une URL donnée ou, par défaut, revient à la page précédente.</p>
<p>Activez la vue en ajoutant la ligne suivante dans votre configuration d’URL&nbsp;:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">path</span><span class="p">(</span><span class="s1">&#39;i18n/&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s1">&#39;django.conf.urls.i18n&#39;</span><span class="p">)),</span>
</pre></div>
</div>
<p>(Notez que cet exemple rend la vue disponible par <code class="docutils literal notranslate"><span class="pre">/i18n/setlang/</span></code>.)</p>
<div class="admonition warning">
<p class="first admonition-title">Avertissement</p>
<p class="last">Vérifiez que l’URL ci-dessus ne soit pas ajoutée au moyen de <a class="reference internal" href="#django.conf.urls.i18n.i18n_patterns" title="django.conf.urls.i18n.i18n_patterns"><code class="xref py py-func docutils literal notranslate"><span class="pre">i18n_patterns()</span></code></a>, car elle doit être elle-même indépendante de la langue pour fonctionner correctement.</p>
</div>
<p>La vue s’attend à être appelée par la méthode <code class="docutils literal notranslate"><span class="pre">POST</span></code>, avec un paramètre <code class="docutils literal notranslate"><span class="pre">language</span></code> défini dans la requête. Si la prise en charge des sessions est active, la vue enregistre le choix de langue dans la session de l’utilisateur. Elle enregistre aussi le choix de langue dans un cookie nommé par défaut <code class="docutils literal notranslate"><span class="pre">django_language</span></code> (le nom peut être modifié par le réglage <a class="reference internal" href="../../ref/settings.html#std:setting-LANGUAGE_COOKIE_NAME"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LANGUAGE_COOKIE_NAME</span></code></a>).</p>
<p>Après avoir défini le choix de langue, Django cherche un paramètre <code class="docutils literal notranslate"><span class="pre">next</span></code> dans les données <code class="docutils literal notranslate"><span class="pre">POST</span></code> ou <code class="docutils literal notranslate"><span class="pre">GET</span></code>. S’il y en a un et que Django le juge comme URL sûr (c.-à-d. qu’il ne pointe pas vers un hôte différent et qu’il utilise un protocole sûr), il redirige la requête vers cette URL. Sinon, Django se rabat sur la redirection vers l’URL de l’en-tête <code class="docutils literal notranslate"><span class="pre">Referer</span></code> ou, s’il n’est pas présent, vers <code class="docutils literal notranslate"><span class="pre">/</span></code>, en fonction de la nature de la requête&nbsp;:</p>
<ul class="simple">
<li>Si la requête accepte le contenu HTML (basé sur son en-tête <code class="docutils literal notranslate"><span class="pre">Accept</span></code>), la redirection est toujours effectuée.</li>
<li>Si la requête n’accepte pas le HTML, la redirection ne s’effectue que si le paramètre <code class="docutils literal notranslate"><span class="pre">next</span></code> a été défini. Sinon, un code de statut 204 (Pas de contenu) est renvoyé.</li>
</ul>
<div class="versionchanged">
<span class="title">Changed in Django 3.1:</span> <p>Dans les anciennes versions, la distinction pour décider de la redirection se basait sur la présence de l’en-tête <code class="docutils literal notranslate"><span class="pre">X-Requested-With</span></code> avec le contenu <code class="docutils literal notranslate"><span class="pre">XMLHttpRequest</span></code>. Cet en-tête est défini par la méthode <code class="docutils literal notranslate"><span class="pre">ajax()</span></code> de jQuery.</p>
</div>
<p>Voici un exemple de code de gabarit HTML&nbsp;:</p>
<div class="highlight-html+django notranslate"><div class="highlight"><pre><span></span><span class="cp">{%</span> <span class="k">load</span> <span class="nv">i18n</span> <span class="cp">%}</span>

<span class="p">&lt;</span><span class="nt">form</span> <span class="na">action</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{%</span> <span class="k">url</span> <span class="s1">&#39;set_language&#39;</span> <span class="cp">%}</span><span class="s">&quot;</span> <span class="na">method</span><span class="o">=</span><span class="s">&quot;post&quot;</span><span class="p">&gt;</span><span class="cp">{%</span> <span class="k">csrf_token</span> <span class="cp">%}</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;next&quot;</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;hidden&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">redirect_to</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">select</span> <span class="na">name</span><span class="o">=</span><span class="s">&quot;language&quot;</span><span class="p">&gt;</span>
        <span class="cp">{%</span> <span class="k">get_current_language</span> <span class="k">as</span> <span class="nv">LANGUAGE_CODE</span> <span class="cp">%}</span>
        <span class="cp">{%</span> <span class="k">get_available_languages</span> <span class="k">as</span> <span class="nv">LANGUAGES</span> <span class="cp">%}</span>
        <span class="cp">{%</span> <span class="k">get_language_info_list</span> <span class="nv">for</span> <span class="nv">LANGUAGES</span> <span class="k">as</span> <span class="nv">languages</span> <span class="cp">%}</span>
        <span class="cp">{%</span> <span class="k">for</span> <span class="nv">language</span> <span class="k">in</span> <span class="nv">languages</span> <span class="cp">%}</span>
            <span class="p">&lt;</span><span class="nt">option</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;</span><span class="cp">{{</span> <span class="nv">language.code</span> <span class="cp">}}</span><span class="s">&quot;</span><span class="cp">{%</span> <span class="k">if</span> <span class="nv">language.code</span> <span class="o">==</span> <span class="nv">LANGUAGE_CODE</span> <span class="cp">%}</span> <span class="na">selected</span><span class="cp">{%</span> <span class="k">endif</span> <span class="cp">%}</span><span class="p">&gt;</span>
                <span class="cp">{{</span> <span class="nv">language.name_local</span> <span class="cp">}}</span> (<span class="cp">{{</span> <span class="nv">language.code</span> <span class="cp">}}</span>)
            <span class="p">&lt;/</span><span class="nt">option</span><span class="p">&gt;</span>
        <span class="cp">{%</span> <span class="k">endfor</span> <span class="cp">%}</span>
    <span class="p">&lt;/</span><span class="nt">select</span><span class="p">&gt;</span>
    <span class="p">&lt;</span><span class="nt">input</span> <span class="na">type</span><span class="o">=</span><span class="s">&quot;submit&quot;</span> <span class="na">value</span><span class="o">=</span><span class="s">&quot;Go&quot;</span><span class="p">&gt;</span>
<span class="p">&lt;/</span><span class="nt">form</span><span class="p">&gt;</span>
</pre></div>
</div>
<p>Dans cet exemple, Django cherche l’URL de la page vers laquelle l’utilisateur sera redirigé dans la variable de contexte <code class="docutils literal notranslate"><span class="pre">redirect_to</span></code>.</p>
</div>
<div class="section" id="s-explicitly-setting-the-active-language">
<span id="s-id4"></span><span id="explicitly-setting-the-active-language"></span><span id="id4"></span><h3>Définition explicite de la langue active<a class="headerlink" href="#explicitly-setting-the-active-language" title="Lien permanent vers ce titre">¶</a></h3>
<p>Il peut être souhaitable de définir la langue active de la session en cours de manière explicite. On peut par exemple imaginer que la préférence de langue d’une utilisatrice est récupérée à partir d’un autre système. La fonction <a class="reference internal" href="../../ref/utils.html#django.utils.translation.activate" title="django.utils.translation.activate"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.utils.translation.activate()</span></code></a> vous a déjà été présentée. Celle-ci s’applique seulement au fil d’exécution en cours. Si l’on veut modifier plus durablement la langue pour toute la session dans un cookie, il faut définir le cookie <a class="reference internal" href="../../ref/settings.html#std:setting-LANGUAGE_COOKIE_NAME"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LANGUAGE_COOKIE_NAME</span></code></a> dans la réponse&nbsp;:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.conf</span> <span class="kn">import</span> <span class="n">settings</span>
<span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>
<span class="kn">from</span> <span class="nn">django.utils</span> <span class="kn">import</span> <span class="n">translation</span>
<span class="n">user_language</span> <span class="o">=</span> <span class="s1">&#39;fr&#39;</span>
<span class="n">translation</span><span class="o">.</span><span class="n">activate</span><span class="p">(</span><span class="n">user_language</span><span class="p">)</span>
<span class="n">response</span> <span class="o">=</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="n">response</span><span class="o">.</span><span class="n">set_cookie</span><span class="p">(</span><span class="n">settings</span><span class="o">.</span><span class="n">LANGUAGE_COOKIE_NAME</span><span class="p">,</span> <span class="n">user_language</span><span class="p">)</span>
</pre></div>
</div>
<p>Il est généralement utile d’utiliser les deux&nbsp;: <a class="reference internal" href="../../ref/utils.html#django.utils.translation.activate" title="django.utils.translation.activate"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.utils.translation.activate()</span></code></a> modifie la langue pour le fil d’exécution en cours et la définition du cookie valide cette préférence en vue des requêtes suivantes.</p>
<div class="versionchanged">
<span class="title">Changed in Django 3.0:</span> <p>Dans les anciennes versions, il était possible de définir la langue dans la session courante.</p>
</div>
</div>
<div class="section" id="s-using-translations-outside-views-and-templates">
<span id="using-translations-outside-views-and-templates"></span><h3>Traductions en dehors des vues et des gabarits<a class="headerlink" href="#using-translations-outside-views-and-templates" title="Lien permanent vers ce titre">¶</a></h3>
<p>Django contient un ensemble d’outils d’internationalisation bien fourni pour être utilisé dans les vues et les gabarits, mais leur usage n’est pas limité au code spécifique à Django. Les mécanismes de traduction de Django peuvent être utilisés pour traduire n’importe quel texte vers toutes les langues prises en charge par Django (pour autant qu’un catalogue de traductions correspondant existe, bien sûr). Vous pouvez charger un catalogue de traductions, l’activer et traduire du texte dans la langue de votre choix, mais n’oubliez pas de restaurer la langue initiale, car l’activation d’un catalogue de traductions est valable pour tout un fil d’exécution (thread) et une telle modification affecte le code s’exécutant dans le même fil.</p>
<p>Par exemple&nbsp;:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.utils</span> <span class="kn">import</span> <span class="n">translation</span>

<span class="k">def</span> <span class="nf">welcome_translated</span><span class="p">(</span><span class="n">language</span><span class="p">):</span>
    <span class="n">cur_language</span> <span class="o">=</span> <span class="n">translation</span><span class="o">.</span><span class="n">get_language</span><span class="p">()</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">translation</span><span class="o">.</span><span class="n">activate</span><span class="p">(</span><span class="n">language</span><span class="p">)</span>
        <span class="n">text</span> <span class="o">=</span> <span class="n">translation</span><span class="o">.</span><span class="n">gettext</span><span class="p">(</span><span class="s1">&#39;welcome&#39;</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">translation</span><span class="o">.</span><span class="n">activate</span><span class="p">(</span><span class="n">cur_language</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">text</span>
</pre></div>
</div>
<p>L’appel de cette fonction avec la valeur <code class="docutils literal notranslate"><span class="pre">'de'</span></code> produira <code class="docutils literal notranslate"><span class="pre">&quot;Willkommen&quot;</span></code>, quelle que soit la valeur de <a class="reference internal" href="../../ref/settings.html#std:setting-LANGUAGE_CODE"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LANGUAGE_CODE</span></code></a> ou la langue définie par un intergiciel.</p>
<p>Quelques fonctions dignes d’intérêt sont <a class="reference internal" href="../../ref/utils.html#django.utils.translation.get_language" title="django.utils.translation.get_language"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.utils.translation.get_language()</span></code></a> qui renvoie la langue utilisée dans le fil d’exécution actuel, <a class="reference internal" href="../../ref/utils.html#django.utils.translation.activate" title="django.utils.translation.activate"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.utils.translation.activate()</span></code></a> qui active un catalogue de traductions pour le fil d’exécution en cours et <a class="reference internal" href="../../ref/utils.html#django.utils.translation.check_for_language" title="django.utils.translation.check_for_language"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.utils.translation.check_for_language()</span></code></a> qui vérifie si la langue indiquée est prise en charge par Django.</p>
<p>Pour aider à écrire du code plus concis, il existe également un gestionnaire de contexte <a class="reference internal" href="../../ref/utils.html#django.utils.translation.override" title="django.utils.translation.override"><code class="xref py py-func docutils literal notranslate"><span class="pre">django.utils.translation.override()</span></code></a> qui stocke la langue en cours en entrée et la restaure en sortie. Avec ceci, l’exemple ci-dessus devient&nbsp;:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.utils</span> <span class="kn">import</span> <span class="n">translation</span>

<span class="k">def</span> <span class="nf">welcome_translated</span><span class="p">(</span><span class="n">language</span><span class="p">):</span>
    <span class="k">with</span> <span class="n">translation</span><span class="o">.</span><span class="n">override</span><span class="p">(</span><span class="n">language</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">translation</span><span class="o">.</span><span class="n">gettext</span><span class="p">(</span><span class="s1">&#39;welcome&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="s-language-cookie">
<span id="language-cookie"></span><h3>Cookie de langue<a class="headerlink" href="#language-cookie" title="Lien permanent vers ce titre">¶</a></h3>
<p>Plusieurs réglages permettent d’ajuster les options du cookie de langue&nbsp;:</p>
<ul class="simple">
<li><a class="reference internal" href="../../ref/settings.html#std:setting-LANGUAGE_COOKIE_NAME"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LANGUAGE_COOKIE_NAME</span></code></a></li>
<li><a class="reference internal" href="../../ref/settings.html#std:setting-LANGUAGE_COOKIE_AGE"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LANGUAGE_COOKIE_AGE</span></code></a></li>
<li><a class="reference internal" href="../../ref/settings.html#std:setting-LANGUAGE_COOKIE_DOMAIN"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LANGUAGE_COOKIE_DOMAIN</span></code></a></li>
<li><a class="reference internal" href="../../ref/settings.html#std:setting-LANGUAGE_COOKIE_HTTPONLY"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LANGUAGE_COOKIE_HTTPONLY</span></code></a></li>
<li><a class="reference internal" href="../../ref/settings.html#std:setting-LANGUAGE_COOKIE_PATH"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LANGUAGE_COOKIE_PATH</span></code></a></li>
<li><a class="reference internal" href="../../ref/settings.html#std:setting-LANGUAGE_COOKIE_SAMESITE"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LANGUAGE_COOKIE_SAMESITE</span></code></a></li>
<li><a class="reference internal" href="../../ref/settings.html#std:setting-LANGUAGE_COOKIE_SECURE"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LANGUAGE_COOKIE_SECURE</span></code></a></li>
</ul>
</div>
</div>
<div class="section" id="s-implementation-notes">
<span id="implementation-notes"></span><h2>Notes d’implémentation<a class="headerlink" href="#implementation-notes" title="Lien permanent vers ce titre">¶</a></h2>
<div class="section" id="s-specialties-of-django-translation">
<span id="s-specialties-of-django-i18n"></span><span id="specialties-of-django-translation"></span><span id="specialties-of-django-i18n"></span><h3>Spécialités des traductions Django<a class="headerlink" href="#specialties-of-django-translation" title="Lien permanent vers ce titre">¶</a></h3>
<p>Le mécanisme de traduction de Django utilise le module standard <code class="docutils literal notranslate"><span class="pre">gettext</span></code> livré avec Python. Si vous connaissez <code class="docutils literal notranslate"><span class="pre">gettext</span></code>, vous allez peut-être constater ces particularités dans la manière dont Django gère les traductions&nbsp;:</p>
<ul class="simple">
<li>Le texte du domaine est <code class="docutils literal notranslate"><span class="pre">django</span></code> ou <code class="docutils literal notranslate"><span class="pre">djangojs</span></code>. Ce texte sert à distinguer les divers programmes qui stockent leurs données dans un endroit commun aux fichiers de messages (normalement <code class="docutils literal notranslate"><span class="pre">/usr/share/locale/</span></code>). Le domaine <code class="docutils literal notranslate"><span class="pre">django</span></code> est utilisé  pour les chaînes de traduction du code Python et des gabarits et est chargé dans les catalogues de traductions globaux. Le domaine <code class="docutils literal notranslate"><span class="pre">djangojs</span></code> n’est utilisé que pour les catalogues de traductions JavaScript afin qu’ils restent aussi petits que possible.</li>
<li>Django n’utilise pas directement <code class="docutils literal notranslate"><span class="pre">xgettext</span></code>, mais des adaptateurs Python autour de <code class="docutils literal notranslate"><span class="pre">xgettext</span></code> et <code class="docutils literal notranslate"><span class="pre">msgfmt</span></code>. Ceci essentiellement pour des raisons pratiques.</li>
</ul>
</div>
<div class="section" id="s-how-django-discovers-language-preference">
<span id="s-id5"></span><span id="how-django-discovers-language-preference"></span><span id="id5"></span><h3>Processus de découverte de la préférence de langue par Django<a class="headerlink" href="#how-django-discovers-language-preference" title="Lien permanent vers ce titre">¶</a></h3>
<p>Après avoir préparé les traductions, ou si vous voulez utiliser les traductions qui proviennent de Django, activez les traductions pour votre application.</p>
<p>En arrière-plan, Django utilise un modèle très souple pour décider de la langue à activer, de manière globale, pour un utilisateur particulier ou les deux.</p>
<p>Pour configurer une préférence de langue générale du projet, définissez <a class="reference internal" href="../../ref/settings.html#std:setting-LANGUAGE_CODE"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LANGUAGE_CODE</span></code></a>. Django utilise cette langue comme traduction par défaut, c’est-à-dire le choix final si aucune autre traduction correspondante n’est découverte par l’une des méthodes employées par l’intergiciel de langue (voir ci-dessous).</p>
<p>Si vous souhaitez simplement faire fonctionner Django dans votre langue maternelle, la seule chose est faire est de définir <a class="reference internal" href="../../ref/settings.html#std:setting-LANGUAGE_CODE"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LANGUAGE_CODE</span></code></a> et de vérifier que les <a class="reference internal" href="index.html#term-message-file"><span class="xref std std-term">fichiers de messages</span></a> correspondants ainsi que leur version compilée (<code class="docutils literal notranslate"><span class="pre">.mo</span></code>) existent.</p>
<p>Si vous voulez que chaque utilisateur puisse indiquer sa langue préférée, il est alors nécessaire d’utiliser <code class="docutils literal notranslate"><span class="pre">LocaleMiddleware</span></code>. Cet intergiciel active le choix de la langue en fonction des données de la requête. Il personnalise le contenu pour chaque utilisateur.</p>
<p>Pour utiliser <code class="docutils literal notranslate"><span class="pre">LocaleMiddleware</span></code>, ajoutez <code class="docutils literal notranslate"><span class="pre">'django.middleware.locale.LocaleMiddleware'</span></code> à votre réglage <a class="reference internal" href="../../ref/settings.html#std:setting-MIDDLEWARE"><code class="xref std std-setting docutils literal notranslate"><span class="pre">MIDDLEWARE</span></code></a>. Comme les intergiciels sont sensibles à leur ordre d’apparition, suivez ces directives&nbsp;:</p>
<ul class="simple">
<li>Assurez vous que c’est un des premiers intergiciels installés.</li>
<li>Il devrait figurer après <code class="docutils literal notranslate"><span class="pre">SessionMiddleware</span></code>, parce que <code class="docutils literal notranslate"><span class="pre">LocaleMiddleware</span></code> emploie des données de session. Et il devrait figurer avant <code class="docutils literal notranslate"><span class="pre">CommonMiddleware</span></code>, parce que <code class="docutils literal notranslate"><span class="pre">CommonMiddleware</span></code> a besoin d’une langue active pour la résolution de l’URL demandée.</li>
<li>Si vous utilisez <code class="docutils literal notranslate"><span class="pre">CacheMiddleware</span></code>, placez-le avant <code class="docutils literal notranslate"><span class="pre">LocaleMiddleware</span></code>.</li>
</ul>
<p>Par exemple, voici à quoi pourrait ressembler votre réglage <a class="reference internal" href="../../ref/settings.html#std:setting-MIDDLEWARE"><code class="xref std std-setting docutils literal notranslate"><span class="pre">MIDDLEWARE</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">MIDDLEWARE</span> <span class="o">=</span> <span class="p">[</span>
   <span class="s1">&#39;django.contrib.sessions.middleware.SessionMiddleware&#39;</span><span class="p">,</span>
   <span class="s1">&#39;django.middleware.locale.LocaleMiddleware&#39;</span><span class="p">,</span>
   <span class="s1">&#39;django.middleware.common.CommonMiddleware&#39;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
<p>(Pour plus d’informations sur les intergiciels, consultez la <a class="reference internal" href="../http/middleware.html"><span class="doc">documentation sur les intergiciels</span></a>.)</p>
<p><code class="docutils literal notranslate"><span class="pre">LocaleMiddleware</span></code> essaie de déterminer la préférence de langue de l’utilisateur en suivant cet algorithme&nbsp;:</p>
<ul>
<li><p class="first">Premièrement, il cherche un préfixe de langue dans l’URL demandée. Ceci n’est valable que lorsque vous utilisez la fonction <code class="docutils literal notranslate"><span class="pre">i18n_patterns</span></code> dans votre configuration d’URL racine. Voir <a class="reference internal" href="#url-internationalization"><span class="std std-ref">Internationalisation&nbsp;: dans les motifs d’URL</span></a> pour plus d’informations sur les préfixes de langue et sur la manière d’internationaliser les motifs d’URL.</p>
</li>
<li><p class="first">S’il ne trouve rien, il cherche un cookie.</p>
<p>Le nom de ce cookie est défini par le réglage <a class="reference internal" href="../../ref/settings.html#std:setting-LANGUAGE_COOKIE_NAME"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LANGUAGE_COOKIE_NAME</span></code></a> (la valeur par défaut est <code class="docutils literal notranslate"><span class="pre">django_language</span></code>).</p>
</li>
<li><p class="first">S’il ne trouve rien, il examine l’en-tête HTTP <code class="docutils literal notranslate"><span class="pre">Accept-Language</span></code>. Cet en-tête est envoyé par le navigateur et indique au serveur les langues préférées de l’utilisateur, triées par ordre de préférence. Django prend en compte chaque langue de cet en-tête jusqu’à ce qu’il en trouve une dont les traductions sont disponibles.</p>
</li>
<li><p class="first">S’il ne trouve rien, il utilise le réglage global <a class="reference internal" href="../../ref/settings.html#std:setting-LANGUAGE_CODE"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LANGUAGE_CODE</span></code></a>.</p>
</li>
</ul>
<p id="locale-middleware-notes">Notes&nbsp;:</p>
<ul>
<li><p class="first">À chacun de ces endroits, la préférence de langue est supposée être dans le <a class="reference internal" href="index.html#term-language-code"><span class="xref std std-term">format de langue</span></a> standard, sous forme textuelle. Par exemple, le portugais brésilien est représenté par <code class="docutils literal notranslate"><span class="pre">pt-br</span></code>.</p>
</li>
<li><p class="first">Si une langue de base est disponible mais que la variante indiquée ne l’est pas, Django utilise la langue de base. Par exemple, si un utilisateur indique <code class="docutils literal notranslate"><span class="pre">fr-be</span></code> (français de Belgique) mais que Django ne connaît que <code class="docutils literal notranslate"><span class="pre">fr</span></code>, il utilisera <code class="docutils literal notranslate"><span class="pre">fr</span></code>.</p>
</li>
<li><p class="first">Seules les langues présentes dans le réglage <a class="reference internal" href="../../ref/settings.html#std:setting-LANGUAGES"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LANGUAGES</span></code></a> peuvent être choisies. Si vous souhaitez restreindre le choix possible des langues à un sous-ensemble des langues disponibles (parce que votre application ne fournit pas toutes ces langues), définissez <a class="reference internal" href="../../ref/settings.html#std:setting-LANGUAGES"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LANGUAGES</span></code></a> à une liste de langues. Par exemple&nbsp;:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">LANGUAGES</span> <span class="o">=</span> <span class="p">[</span>
  <span class="p">(</span><span class="s1">&#39;de&#39;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;German&#39;</span><span class="p">)),</span>
  <span class="p">(</span><span class="s1">&#39;en&#39;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;English&#39;</span><span class="p">)),</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Cet exemple limite les langues disponibles lors de la sélection automatique à l’allemand et à l’anglais (et à toute variante, du genre <code class="docutils literal notranslate"><span class="pre">de-ch</span></code> ou <code class="docutils literal notranslate"><span class="pre">en-us</span></code>).</p>
</li>
<li><p class="first">Si vous définissez un réglage <a class="reference internal" href="../../ref/settings.html#std:setting-LANGUAGES"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LANGUAGES</span></code></a> personnalisé comme expliqué au point ci-dessus, il est possible de marquer les noms de langues comme chaînes à traduire, mais utilisez alors <a class="reference internal" href="../../ref/utils.html#django.utils.translation.gettext_lazy" title="django.utils.translation.gettext_lazy"><code class="xref py py-func docutils literal notranslate"><span class="pre">gettext_lazy()</span></code></a> au lieu de <a class="reference internal" href="../../ref/utils.html#django.utils.translation.gettext" title="django.utils.translation.gettext"><code class="xref py py-func docutils literal notranslate"><span class="pre">gettext()</span></code></a> pour éviter une importation circulaire.</p>
<p>Voici un exemple de fichier de réglages&nbsp;:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.utils.translation</span> <span class="kn">import</span> <span class="n">gettext_lazy</span> <span class="k">as</span> <span class="n">_</span>

<span class="n">LANGUAGES</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">(</span><span class="s1">&#39;de&#39;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;German&#39;</span><span class="p">)),</span>
    <span class="p">(</span><span class="s1">&#39;en&#39;</span><span class="p">,</span> <span class="n">_</span><span class="p">(</span><span class="s1">&#39;English&#39;</span><span class="p">)),</span>
<span class="p">]</span>
</pre></div>
</div>
</li>
</ul>
<p>Lorsque <code class="docutils literal notranslate"><span class="pre">LocaleMiddleware</span></code> a déterminé la préférence de langue de l’utilisateur, il rend disponible cette préférence dans la variable <code class="docutils literal notranslate"><span class="pre">request.LANGUAGE_CODE</span></code> de chaque <a class="reference internal" href="../../ref/request-response.html#django.http.HttpRequest" title="django.http.HttpRequest"><code class="xref py py-class docutils literal notranslate"><span class="pre">HttpRequest</span></code></a>. Cette valeur est à votre disposition dans le code de vos vues. Voici un exemple&nbsp;:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django.http</span> <span class="kn">import</span> <span class="n">HttpResponse</span>

<span class="k">def</span> <span class="nf">hello_world</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">count</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">request</span><span class="o">.</span><span class="n">LANGUAGE_CODE</span> <span class="o">==</span> <span class="s1">&#39;de-at&#39;</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s2">&quot;You prefer to read Austrian German.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">HttpResponse</span><span class="p">(</span><span class="s2">&quot;You prefer to read another language.&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Remarquez qu’avec la traduction statique (sans intergiciel), la langue se trouve dans <code class="docutils literal notranslate"><span class="pre">settings.LANGUAGE_CODE</span></code> alors qu’avec la traduction dynamique (avec intergiciel), elle se trouve dans <code class="docutils literal notranslate"><span class="pre">request.LANGUAGE_CODE</span></code>.</p>
</div>
<div class="section" id="s-how-django-discovers-translations">
<span id="s-id6"></span><span id="how-django-discovers-translations"></span><span id="id6"></span><h3>Processus de découverte des traductions par Django<a class="headerlink" href="#how-django-discovers-translations" title="Lien permanent vers ce titre">¶</a></h3>
<p>Au moment de l’exécution, Django construit un catalogue consolidé en mémoire des chaînes de traduction. Pour faire cela, il cherche des traductions selon l’algorithme suivant concernant l’ordre dans lequel il examine les différents chemins de fichiers en vue du chargement des <a class="reference internal" href="index.html#term-message-file"><span class="xref std std-term">fichiers de messages</span></a> compilés (<code class="docutils literal notranslate"><span class="pre">.mo</span></code>) et de la priorité d’éventuelles traductions différentes de la même chaîne&nbsp;:</p>
<ol class="arabic simple">
<li>Les répertoires énumérés dans <a class="reference internal" href="../../ref/settings.html#std:setting-LOCALE_PATHS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LOCALE_PATHS</span></code></a> ont la plus haute priorité, ceux apparaissant en premier ayant priorité sur les suivants.</li>
<li>Puis, il recherche et utilise le cas échéant un répertoire <code class="docutils literal notranslate"><span class="pre">locale</span></code> dans chacune des applications installées figurant dans <a class="reference internal" href="../../ref/settings.html#std:setting-INSTALLED_APPS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">INSTALLED_APPS</span></code></a>. Celles apparaissant en premier ayant priorité sur les suivantes.</li>
<li>Et finalement, la traduction de base fournie par Django dans <code class="docutils literal notranslate"><span class="pre">django/conf/locale</span></code> est utilisée en dernier recours.</li>
</ol>
<div class="admonition seealso">
<p class="first admonition-title">Voir aussi</p>
<p>Les traductions de chaînes contenues dans des fichiers JavaScript sont parcourues par un algorithme semblable mais pas identique. Voir  <a class="reference internal" href="#django.views.i18n.JavaScriptCatalog" title="django.views.i18n.JavaScriptCatalog"><code class="xref py py-class docutils literal notranslate"><span class="pre">JavaScriptCatalog</span></code></a> pour plus de détails.</p>
<p class="last">Vous pouvez également placer des <a class="reference internal" href="formatting.html#custom-format-files"><span class="std std-ref">fichiers de formats personnalisés</span></a> dans les répertoires <a class="reference internal" href="../../ref/settings.html#std:setting-LOCALE_PATHS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LOCALE_PATHS</span></code></a> si vous définissez aussi <a class="reference internal" href="../../ref/settings.html#std:setting-FORMAT_MODULE_PATH"><code class="xref std std-setting docutils literal notranslate"><span class="pre">FORMAT_MODULE_PATH</span></code></a>.</p>
</div>
<p>Dans tous les cas, le nom du répertoire contenant une traduction doit respecter le format de nommage avec la notation de <a class="reference internal" href="index.html#term-locale-name"><span class="xref std std-term">nom de locale</span></a>. Par ex.&nbsp;: <code class="docutils literal notranslate"><span class="pre">de</span></code>, <code class="docutils literal notranslate"><span class="pre">pt_BR</span></code>, <code class="docutils literal notranslate"><span class="pre">es_AR</span></code>, etc. Les chaînes non traduites des variantes territoriales de langues utilisent les traductions de la langue générique. Par exemple, les chaînes <code class="docutils literal notranslate"><span class="pre">pt_BR</span></code> non traduites utilisent les traductions <code class="docutils literal notranslate"><span class="pre">pt</span></code>.</p>
<p>De cette façon, vous pouvez écrire des applications incluant leurs propres traductions et il est possible de surcharger les traductions de base par celles de votre projet. Ou, vous pouvez construire un gros projet composé de plusieurs applications et placer toutes les traductions dans un seul gros fichier de messages commun spécifique au projet que vous mettez en place. C’est à vous de choisir.</p>
<p>Tous les dépôts de fichiers de messages sont structurés de la même façon. C’est-à-dire&nbsp;:</p>
<ul class="simple">
<li>Django parcourt tous les chemins mentionnés dans <a class="reference internal" href="../../ref/settings.html#std:setting-LOCALE_PATHS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LOCALE_PATHS</span></code></a> de votre fichier de réglages à la recherche de <code class="docutils literal notranslate"><span class="pre">&lt;code_de_langue&gt;/LC_MESSAGES/django.(po|mo)</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">$CHEMIN_APP/locale/&lt;code_de_langue&gt;/LC_MESSAGES/django.(po|mo)</span></code></li>
<li><code class="docutils literal notranslate"><span class="pre">$PYTHONPATH/django/conf/locale/&lt;code_de_langue&gt;/LC_MESSAGES/django.(po|mo)</span></code></li>
</ul>
<p>Pour créer des fichiers de messages, il faut utiliser l’outil <a class="reference internal" href="../../ref/django-admin.html#django-admin-makemessages"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">django-admin</span> <span class="pre">makemessages</span></code></a>. Et pour produire les fichiers binaires <code class="docutils literal notranslate"><span class="pre">.mo</span></code> utilisés par <code class="docutils literal notranslate"><span class="pre">gettext</span></code>, il faut utiliser <a class="reference internal" href="../../ref/django-admin.html#django-admin-compilemessages"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">django-admin</span> <span class="pre">compilemessages</span></code></a>.</p>
<p>Vous pouvez aussi exécuter <a class="reference internal" href="../../ref/django-admin.html#django-admin-compilemessages"><code class="xref std std-djadmin docutils literal notranslate"><span class="pre">django-admin</span> <span class="pre">compilemessages</span> <span class="pre">--settings=chemin.vers.settings</span></code></a> pour que le compilateur s’occupe de tous les répertoires énumérés dans le réglage <a class="reference internal" href="../../ref/settings.html#std:setting-LOCALE_PATHS"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LOCALE_PATHS</span></code></a>.</p>
</div>
<div class="section" id="s-using-a-non-english-base-language">
<span id="using-a-non-english-base-language"></span><h3>Utilisation d’une langue de base autre que l’anglais<a class="headerlink" href="#using-a-non-english-base-language" title="Lien permanent vers ce titre">¶</a></h3>
<p>Django part du principe général que les chaînes originales d’un projet traduisible sont écrites en anglais. Il est possible de choisir une autre langue, mais il faut garder à l’esprit un certain nombre de limites&nbsp;:</p>
<ul class="simple">
<li><code class="docutils literal notranslate"><span class="pre">gettext</span></code> ne fournit que deux formes plurielles pour les messages originaux, ce qui signifie que vous devrez aussi fournir une traduction pour la langue de base afin d’inclure toutes les formes plurielles si les règles de pluriel de la langue de base diffèrent de l’anglais.</li>
<li>Lorsqu’une variante d’anglais est activée et que les chaînes anglaises sont manquantes, la langue de repli ne sera pas la langue <a class="reference internal" href="../../ref/settings.html#std:setting-LANGUAGE_CODE"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LANGUAGE_CODE</span></code></a> du projet, mais dans la langue des chaînes originales. Par exemple, un utilisateur anglais visitant un site dont <a class="reference internal" href="../../ref/settings.html#std:setting-LANGUAGE_CODE"><code class="xref std std-setting docutils literal notranslate"><span class="pre">LANGUAGE_CODE</span></code></a> est l’espagnol et dont les chaînes originales sont écrites en russe obtiendra du russe et non de l’espagnol.</li>
</ul>
</div>
</div>
</div>


          </div>
        </div>
      </div>
      
        
          <div class="yui-b" id="sidebar">
            
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../contents.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Traduction</a><ul>
<li><a class="reference internal" href="#overview">Aperçu</a></li>
<li><a class="reference internal" href="#internationalization-in-python-code">Internationalisation&nbsp;: dans le code Python</a><ul>
<li><a class="reference internal" href="#standard-translation">Traduction standard</a></li>
<li><a class="reference internal" href="#comments-for-translators">Commentaires pour les traducteurs</a></li>
<li><a class="reference internal" href="#marking-strings-as-no-op">Marquage des chaînes «&nbsp;en blanc&nbsp;»</a></li>
<li><a class="reference internal" href="#pluralization">Pluriels</a></li>
<li><a class="reference internal" href="#contextual-markers">Marqueurs contextuels</a></li>
<li><a class="reference internal" href="#lazy-translation">Traduction différée</a><ul>
<li><a class="reference internal" href="#model-fields-and-relationships-verbose-name-and-help-text-option-values">Valeurs d’options <code class="docutils literal notranslate"><span class="pre">verbose_name</span></code> et <code class="docutils literal notranslate"><span class="pre">help_text</span></code> des champs et relations de modèle</a></li>
<li><a class="reference internal" href="#model-verbose-names-values">Valeurs de noms verbeux de modèle</a></li>
<li><a class="reference internal" href="#model-methods-short-description-attribute-values">Valeurs d’attribut <code class="docutils literal notranslate"><span class="pre">short_description</span></code> des méthodes de modèle</a></li>
</ul>
</li>
<li><a class="reference internal" href="#working-with-lazy-translation-objects">Manipulation des objets de traduction différée</a><ul>
<li><a class="reference internal" href="#lazy-translations-and-plural">Traductions différées et pluriels</a></li>
<li><a class="reference internal" href="#formatting-strings-format-lazy">Mise en forme de chaînes&nbsp;: <code class="docutils literal notranslate"><span class="pre">format_lazy()</span></code></a></li>
<li><a class="reference internal" href="#other-uses-of-lazy-in-delayed-translations">Autres usages de traductions différées avec <code class="docutils literal notranslate"><span class="pre">lazy</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#localized-names-of-languages">Noms de langues régionalisés</a></li>
</ul>
</li>
<li><a class="reference internal" href="#internationalization-in-template-code">Internationalisation&nbsp;: dans le code des gabarits</a><ul>
<li><a class="reference internal" href="#translate-template-tag">Balise de gabarit <code class="docutils literal notranslate"><span class="pre">translate</span></code></a></li>
<li><a class="reference internal" href="#blocktranslate-template-tag">Balise de gabarit <code class="docutils literal notranslate"><span class="pre">blocktranslate</span></code></a></li>
<li><a class="reference internal" href="#string-literals-passed-to-tags-and-filters">Texte littéral transmis aux balises et aux filtres</a></li>
<li><a class="reference internal" href="#comments-for-translators-in-templates">Commentaires pour les traducteurs dans les gabarits</a></li>
<li><a class="reference internal" href="#switching-language-in-templates">Changement de langue dans les gabarits</a></li>
<li><a class="reference internal" href="#other-tags">Autres balises</a><ul>
<li><a class="reference internal" href="#get-available-languages"><code class="docutils literal notranslate"><span class="pre">get_available_languages</span></code></a></li>
<li><a class="reference internal" href="#get-current-language"><code class="docutils literal notranslate"><span class="pre">get_current_language</span></code></a></li>
<li><a class="reference internal" href="#get-current-language-bidi"><code class="docutils literal notranslate"><span class="pre">get_current_language_bidi</span></code></a></li>
<li><a class="reference internal" href="#i18n-context-processor">Processeur de contexte <code class="docutils literal notranslate"><span class="pre">i18n</span></code></a></li>
<li><a class="reference internal" href="#get-language-info"><code class="docutils literal notranslate"><span class="pre">get_language_info</span></code></a></li>
<li><a class="reference internal" href="#get-language-info-list"><code class="docutils literal notranslate"><span class="pre">get_language_info_list</span></code></a></li>
<li><a class="reference internal" href="#template-filters">Filtres de gabarit</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#internationalization-in-javascript-code">Internationalisation&nbsp;: dans le code JavaScript</a><ul>
<li><a class="reference internal" href="#module-django.views.i18n">La vue <code class="docutils literal notranslate"><span class="pre">JavaScriptCatalog</span></code></a></li>
<li><a class="reference internal" href="#using-the-javascript-translation-catalog">Emploi du catalogue des traductions JavaScript</a><ul>
<li><a class="reference internal" href="#gettext"><code class="docutils literal notranslate"><span class="pre">gettext</span></code></a></li>
<li><a class="reference internal" href="#ngettext"><code class="docutils literal notranslate"><span class="pre">ngettext</span></code></a></li>
<li><a class="reference internal" href="#interpolate"><code class="docutils literal notranslate"><span class="pre">interpolate</span></code></a></li>
<li><a class="reference internal" href="#get-format"><code class="docutils literal notranslate"><span class="pre">get_format</span></code></a></li>
<li><a class="reference internal" href="#gettext-noop"><code class="docutils literal notranslate"><span class="pre">gettext_noop</span></code></a></li>
<li><a class="reference internal" href="#pgettext"><code class="docutils literal notranslate"><span class="pre">pgettext</span></code></a></li>
<li><a class="reference internal" href="#npgettext"><code class="docutils literal notranslate"><span class="pre">npgettext</span></code></a></li>
<li><a class="reference internal" href="#pluralidx"><code class="docutils literal notranslate"><span class="pre">pluralidx</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#the-jsoncatalog-view">La vue <code class="docutils literal notranslate"><span class="pre">JSONCatalog</span></code></a></li>
<li><a class="reference internal" href="#note-on-performance">Note sur les performances</a></li>
</ul>
</li>
<li><a class="reference internal" href="#module-django.conf.urls.i18n">Internationalisation&nbsp;: dans les motifs d’URL</a><ul>
<li><a class="reference internal" href="#language-prefix-in-url-patterns">Préfixe de langue dans les motifs d’URL</a></li>
<li><a class="reference internal" href="#translating-url-patterns">Traduction de motifs d’URL</a></li>
<li><a class="reference internal" href="#reversing-in-templates">Résolution inverse dans les gabarits</a></li>
</ul>
</li>
<li><a class="reference internal" href="#localization-how-to-create-language-files">Régionalisation&nbsp;: comment créer les fichiers de langues</a><ul>
<li><a class="reference internal" href="#message-files">Fichiers de messages</a></li>
<li><a class="reference internal" href="#compiling-message-files">Compilation des fichiers de messages</a></li>
<li><a class="reference internal" href="#troubleshooting-gettext-incorrectly-detects-python-format-in-strings-with-percent-signs">Dépannage&nbsp;: <code class="docutils literal notranslate"><span class="pre">gettext()</span></code> détecte <code class="docutils literal notranslate"><span class="pre">python-format</span></code> de façon erronée dans des chaînes contenant des caractères pourcent</a></li>
<li><a class="reference internal" href="#creating-message-files-from-javascript-source-code">Création de fichiers de messages à partir de code JavaScript</a></li>
<li><a class="reference internal" href="#gettext-on-windows"><code class="docutils literal notranslate"><span class="pre">gettext</span></code> et Windows</a></li>
<li><a class="reference internal" href="#customizing-the-makemessages-command">Personnalisation de la commande <code class="docutils literal notranslate"><span class="pre">makemessages</span></code></a></li>
</ul>
</li>
<li><a class="reference internal" href="#miscellaneous">Divers</a><ul>
<li><a class="reference internal" href="#the-set-language-redirect-view">La vue de redirection <code class="docutils literal notranslate"><span class="pre">set_language</span></code></a></li>
<li><a class="reference internal" href="#explicitly-setting-the-active-language">Définition explicite de la langue active</a></li>
<li><a class="reference internal" href="#using-translations-outside-views-and-templates">Traductions en dehors des vues et des gabarits</a></li>
<li><a class="reference internal" href="#language-cookie">Cookie de langue</a></li>
</ul>
</li>
<li><a class="reference internal" href="#implementation-notes">Notes d’implémentation</a><ul>
<li><a class="reference internal" href="#specialties-of-django-translation">Spécialités des traductions Django</a></li>
<li><a class="reference internal" href="#how-django-discovers-language-preference">Processus de découverte de la préférence de langue par Django</a></li>
<li><a class="reference internal" href="#how-django-discovers-translations">Processus de découverte des traductions par Django</a></li>
<li><a class="reference internal" href="#using-a-non-english-base-language">Utilisation d’une langue de base autre que l’anglais</a></li>
</ul>
</li>
</ul>
</li>
</ul>

  <h4>Sujet précédent</h4>
  <p class="topless"><a href="index.html"
                        title="Chapitre précédent">Internationalisation et régionalisation</a></p>
  <h4>Sujet suivant</h4>
  <p class="topless"><a href="formatting.html"
                        title="Chapitre suivant">Régionalisation des formats</a></p>
  <div role="note" aria-label="source link">
    <h3>Cette page</h3>
    <ul class="this-page-menu">
      <li><a href="../../_sources/topics/i18n/translation.txt"
            rel="nofollow">Montrer le code source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Recherche rapide</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
              <h3>Last update:</h3>
              <p class="topless">oct. 29, 2020</p>
          </div>
        
      
    </div>

    <div id="ft">
      <div class="nav">
    &laquo; <a href="index.html" title="Internationalisation et régionalisation">previous</a>
     |
    <a href="../index.html" title="Utilisation de Django" accesskey="U">up</a>
   |
    <a href="formatting.html" title="Régionalisation des formats">next</a> &raquo;</div>
    </div>
  </div>

      <div class="clearer"></div>
    </div>
  </body>
</html>